
/* Copyright (C) 2005-2009 Zimbra Inc. http://www.zimbra.com/ */
if(AjxPackage.define("Startup1_1")){
if(AjxPackage.define("ajax.core.AjxCore")){
AjxCore=function(){};
AjxCore._objectIds=[null];
AjxCore.assignId=function(e){
var t=AjxCore._objectIds.length;
AjxCore._objectIds[t]=e;
return t
};
AjxCore.unassignId=function(e){
AjxCore._objectIds[e]=null
};
AjxCore.objectWithId=function(e){
return AjxCore._objectIds[e]
};
AjxCore.addListener=function(a,e,t){
a=AjxCore._getEventSource(a);
var i=AjxCore._getListenerStruct(a,e,true);
i.list[i.list.length]=t
};
AjxCore.setEventHandler=function(a,e,t){
a=AjxCore._getEventSource(a);
var i=AjxCore._getListenerStruct(a,e,true);
i.single=t
};
AjxCore.removeListener=function(n,t,o){
n=AjxCore._getEventSource(n);
var s=AjxCore._getListenerStruct(n,t);
if(s){
var r=s.list;
var e=r.length;
for(var a=0;
a<e;
a++){
if(r[a]==o){
r[a]=null
}}}};
AjxCore.removeAllListeners=function(o,t){
o=AjxCore._getEventSource(o);
var n=AjxCore._getListenerStruct(o,t);
if(n){
var s=n.list;
var e=s.length;
for(var a=0;
a<e;
a++){
s[a]=null
}}
AjxCore.unassignId(n.id)
};
AjxCore.notifyListeners=function(a,e,t){
a=AjxCore._getEventSource(a);
var i=AjxCore._getListenerStruct(a,e);
if(i){
a[e](t)
}};
AjxCore._getEventSource=function(e){
if(typeof(e)=="string"){
e=document.getElementById(e)
}
return e
};
AjxCore.getListenerStruct=function(t,e){
return AjxCore._getListenerStruct(t,e)
};
AjxCore._getListenerStruct=function(a,e,t){
var i=null;
if(a[e]){
var o=a[e]._lsListenerStructId;
i=AjxCore.objectWithId(o)
}else{
if(t){
i=AjxCore._setupListener(a,e)
}}
return i
};
AjxCore._setupListener=function(a,e,o){
var i=new Object();
i.list=new Array();
i.single=null;
var o=i.id=AjxCore.assignId(i);
var t=AjxCore._createListenerClosure(o);
a[e]=t;
a[e]._lsListenerStructId=o;
return i
};
AjxCore._createListenerClosure=function(id){
var closure=function(arg1){
var listenerStruct=AjxCore.objectWithId(id);
var listenerList=listenerStruct.list;
var len=listenerList.length;
for(var i=0;
i<len;
i++){
var callback=listenerList[i];
if(callback){
if(typeof(callback)=="string"){
eval(callback)
}else{
if(callback.handleEvent){
callback.handleEvent(arg1,this)
}else{
callback(arg1,this)
}}}}
if(listenerStruct.single){
var callback=listenerStruct.single;
if(typeof(callback)=="string"){
eval(callback)
}else{
return callback.handleEvent?callback.handleEvent(arg1,this):callback(arg1,this)
}}};
return closure
};
AjxCore.addOnloadListener=function(e){
if(window.onload&&(!window.onload._lsListenerStructId)){
var t=window.onload;
window.onload=null;
AjxCore.addListener(window,"onload",t)
}
AjxCore.addListener(window,"onload",e)
};
AjxCore.addOnunloadListener=function(e){
if(window.onunload&&(!window.onunload._lsListenerStructId)){
var t=window.onunload;
window.onunload=null;
AjxCore.addListener(window,"onunload",t)
}
AjxCore.addListener(window,"onunload",e)
}
}
if(AjxPackage.define("ajax.util.AjxUtil")){
AjxUtil=function(){};
AjxUtil.FLOAT_RE=/^[+\-]?((\d+(\.\d*)?)|((\d*\.)?\d+))([eE][+\-]?\d+)?$/;
AjxUtil.NOTFLOAT_RE=/[^\d\.]/;
AjxUtil.NOTINT_RE=/[^0-9]+/;
AjxUtil.LIFETIME_FIELD=/^([0-9])+([dhms]|ms)?$/;
AjxUtil.INT_RE=/^\-?(0|[1-9]\d*)$/;
AjxUtil.isSpecified=function(e){
return((e!==void 0)&&(e!==null))
};
AjxUtil.isUndefined=function(e){
return(e===void 0)
};
AjxUtil.isNull=function(e){
return(e===null)
};
AjxUtil.isBoolean=function(e){
return(typeof(e)==="boolean")
};
AjxUtil.isString=function(e){
return(typeof(e)==="string")
};
AjxUtil.isNumber=function(e){
return(typeof(e)==="number")
};
AjxUtil.isObject=function(e){
return((typeof(e)==="object")&&(e!==null))
};
AjxUtil.isArray=function(e){
return AjxUtil.isInstance(e,Array)
};
AjxUtil.isArrayLike=function(e){
return typeof e!=="string"&&typeof e.length==="number"
};
AjxUtil.isFunction=function(e){
return(typeof(e)==="function")
};
AjxUtil.isDate=function(e){
return AjxUtil.isInstance(e,Date)
};
AjxUtil.isLifeTime=function(e){
return AjxUtil.LIFETIME_FIELD.test(e)
};
AjxUtil.isNumeric=function(e){
return(!isNaN(parseFloat(e))&&AjxUtil.FLOAT_RE.test(e)&&!AjxUtil.NOTFLOAT_RE.test(e))
};
AjxUtil.isInt=function(e){
return AjxUtil.INT_RE.test(e)
};
AjxUtil.isPositiveInt=function(e){
return AjxUtil.isInt(e)&&parseInt(e,10)>0
};
AjxUtil.isLong=AjxUtil.isInt;
AjxUtil.isNonNegativeLong=function(e){
return AjxUtil.isLong(e)&&parseInt(e,10)>=0
};
AjxUtil.isEmpty=function(e){
return(AjxUtil.isNull(e)||AjxUtil.isUndefined(e)||(e==="")||(AjxUtil.isArray(e)&&(e.length==0)))
};
AjxUtil.IPv4_ADDRESS_RE=/^\d{1,3}(\.\d{1,3}){3}(\.\d{1,3}\.\d{1,3})?$/;
AjxUtil.IPv4_ADDRESS_WITH_PORT_RE=/^\d{1,3}(\.\d{1,3}){3}(\.\d{1,3}\.\d{1,3})?:\d{1,5}$/;
AjxUtil.IPv6_ADDRESS_RE=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|(?:%[-\w.~]+)?$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})(?:%[-\w.~]+)?$/i;
AjxUtil.IPv6_ADDRESS_WITH_PORT_RE=new RegExp(AjxUtil.IPv6_ADDRESS_RE.source.replace("^","^\\[").replace("$","\\]:\\d{1,5}$"),"i");
AjxUtil.SUBNET_RE=/^\d{1,3}(\.\d{1,3}){3}(\.\d{1,3}\.\d{1,3})?\/\d{1,2}$/;
AjxUtil.DOMAIN_NAME_SHORT_RE=/^[A-Za-z0-9\-]{2,}$/;
AjxUtil.DOMAIN_NAME_FULL_RE=/^[A-Za-z0-9\-]{1,}(\.[A-Za-z0-9\-]{2,}){1,}$/;
AjxUtil.HOST_NAME_RE=/^[A-Za-z0-9\-]{2,}(\.[A-Za-z0-9\-]{1,})*(\.[A-Za-z0-9\-]{2,})*$/;
AjxUtil.HOST_NAME_WITH_PORT_RE=/^[A-Za-z0-9\-]{2,}(\.[A-Za-z0-9\-]{2,})*:([0-9])+$/;
AjxUtil.EMAIL_SHORT_RE=/^[^@\s]+$/;
AjxUtil.EMAIL_FULL_RE=/^[^@\s]+@[A-Za-z0-9\-]{2,}(\.[A-Za-z0-9\-]{2,})+$/;
AjxUtil.FULL_URL_RE=/^[A-Za-z0-9]{2,}:\/\/[A-Za-z0-9\-]+(\.[A-Za-z0-9\-]+)*(:([0-9])+)?(\/[\w\.\|\^\*\[\]\{\}\(\)\-<>~,'#_;@:!%]+)*(\/)?(\?[\w\.\|\^\*\+\[\]\{\}\(\)\-<>~,'#_;@:!%&=]*)?$/;
AjxUtil.IP_FULL_URL_RE=/^[A-Za-z0-9]{2,}:\/\/\d{1,3}(\.\d{1,3}){3}(\.\d{1,3}\.\d{1,3})?(:([0-9])+)?(\/[\w\.\|\^\*\[\]\{\}\(\)\-<>~,'#_;@:!%]+)*(\/)?(\?[\w\.\|\^\*\+\[\]\{\}\(\)\-<>~,'#_;@:!%&=]*)?$/;
AjxUtil.SHORT_URL_RE=/^[A-Za-z0-9]{2,}:\/\/[A-Za-z0-9\-]+(\.[A-Za-z0-9\-]+)*(:([0-9])+)?$/;
AjxUtil.IP_SHORT_URL_RE=/^[A-Za-z0-9]{2,}:\/\/\d{1,3}(\.\d{1,3}){3}(\.\d{1,3}\.\d{1,3})?(:([0-9])+)?$/;
AjxUtil.isHostName=function(e){
return AjxUtil.HOST_NAME_RE.test(e)
};
AjxUtil.isDomainName=function(t,e){
return e?AjxUtil.DOMAIN_NAME_SHORT_RE.test(t):AjxUtil.DOMAIN_NAME_FULL_RE.test(t)
};
AjxUtil.isEmailAddress=function(t,e){
return e?AjxUtil.EMAIL_SHORT_RE.test(t):AjxUtil.EMAIL_FULL_RE.test(t)
};
AjxUtil.isValidEmailNonReg=function(e){
return((e.indexOf("@")>0)&&(e.lastIndexOf("@")==e.indexOf("@"))&&(e.indexOf(".@")<0))
};
AjxUtil.isHash=function(e){
var t=e&&e.toString?e.toString():Object.prototype.toString.call(e);
return AjxUtil.isObject(e)&&t==="[object Object]"
};
AjxUtil.SIZE_GIGABYTES="GB";
AjxUtil.SIZE_MEGABYTES="MB";
AjxUtil.SIZE_KILOBYTES="KB";
AjxUtil.SIZE_BYTES="B";
AjxUtil.formatSize=function(o,i,n){
if(i==null){
i=true
}
if(n==null){
n=20
}
var t=AjxMsg.sizeBytes;
var a=AjxMsg.SIZE_BYTES;
if(o>=1073741824){
t=AjxMsg.sizeGigaBytes;
a=AjxUtil.SIZE_GIGABYTES
}else{
if(o>=1048576){
t=AjxMsg.sizeMegaBytes;
a=AjxUtil.SIZE_MEGABYTES
}else{
if(o>1023){
t=AjxMsg.sizeKiloBytes;
a=AjxUtil.SIZE_KILOBYTES
}}}
var e=AjxUtil.formatSizeForUnits(o,a,i,n);
return AjxMessageFormat.format(AjxMsg.formatSizeAndUnits,[e,t])
};
AjxUtil.formatSizeForUnits=function(n,a,t,r){
if(a==null){
a=AjxUtil.SIZE_BYTES
}
if(t==null){
t=true
}
if(r==null){
r=20
}
switch(a){
case AjxUtil.SIZE_GIGABYTES:n/=1073741824;
break;
case AjxUtil.SIZE_MEGABYTES:n/=1048576;
break;
case AjxUtil.SIZE_KILOBYTES:n/=1024;
break
}
var e=I18nMsg.numberSeparatorDecimal!=""?I18nMsg.numberSeparatorDecimal:".";
var s=I18nMsg.formatNumber.replace(/\..*$/,"");
s=s.replace(/,/,"");
if(!t&&r){
s=s+=e;
for(var o=0;
o<r;
o++){
s+="#"
}}
return AjxNumberFormat.format(s,n)
};
AjxUtil.parseSize=function(t,i){
if(typeof t!=_STRING_){
t=t.toString()
}
var o=parseFloat(t.replace(/^\s*/,""));
var a=/[GMK]?B$/i;
var e=a.exec(t);
if(e){
i=e[0].toUpperCase()
}
switch(i){
case AjxUtil.SIZE_GIGABYTES:o*=1073741824;
break;
case AjxUtil.SIZE_MEGABYTES:o*=1048576;
break;
case AjxUtil.SIZE_KILOBYTES:o*=1024;
break
}
return o
};
AjxUtil.isInstance=function(e,t){
return !!(e&&e.constructor&&(e.constructor===t))
};
AjxUtil.assert=function(e,t){
if(!e&&AjxUtil.onassert){
AjxUtil.onassert(t)
}};
AjxUtil.onassert=function(t){
var l=new Object();
l.message=t;
var c=new Array();
if(AjxEnv.isIE5_5up){
var o=arguments.callee.caller;
var n=0;
while(o&&n++<20){
c[c.length]=o;
o=o.caller
}}else{
try{
var o=arguments.callee.caller;
while(o){
c[c.length]=o;
if(c.length>2){
break
}
o=o.caller
}}
catch(h){}}
l.stack=c;
var r="";
var a=170;
for(var n=1;
n<c.length;
n++){
if(n>1){
r+="\n"
}
if(n<11){
var s=c[n].toString();
if(s.length>a){
s=s.substr(0,a)+"...";
s=s.replace(/\n/g,"")
}
r+=n+": "+s
}else{
r+="("+(c.length-11)+" frames follow)";
break
}}
alert("assertion:\n\n"+t+"\n\n---- Call Stack ---\n"+r);
throw l
};
AjxUtil.ELEMENT_NODE=1;
AjxUtil.TEXT_NODE=3;
AjxUtil.DOCUMENT_NODE=9;
AjxUtil.getInnerText=function(e){
if(AjxEnv.isIE){
return e.innerText
}
function t(s){
if(s){
if(s.nodeType==3){
return s.data
}
if(s.nodeType==1){
if(/^br$/i.test(s.tagName)){
return"\r\n"
}
var o="";
for(var a=s.firstChild;
a;
a=a.nextSibling){
o+=t(a)
}
return o
}}
return""
}
return t(e)
};
AjxUtil.createProxy=function(a,s){
var o;
var t=function(){};
t.prototype=a;
if(a instanceof Array){
o=new Array();
var i=a.length;
for(var e=0;
e<i;
e++){
o[e]=a[e]
}}else{
o=new t
}
if(s){
for(var n in a){
if(typeof a[n]=="object"&&a[n]!==null){
o[n]=AjxUtil.createProxy(a[n],s-1)
}}}
o._object_=a;
return o
};
AjxUtil.unProxy=function(t){
var e=t&&t._object_;
if(e){
for(var a in t){
if(t.hasOwnProperty(a)&&a!="_object_"){
e[a]=t[a]
}}
return e
}
return null
};
AjxUtil.collapseList=function(a){
var t=[];
for(var e=0;
e<a.length;
e++){
if(a[e]){
t.push(a[e])
}}
return t
};
AjxUtil.arrayAsHash=function(r,o){
r=AjxUtil.toArray(r);
var s={};
var a=typeof o=="function"&&o;
var n=o||true;
for(var t=0;
t<r.length;
t++){
var e=r[t];
s[e]=a?a(e,s,t,r):n
}
return s
};
AjxUtil.arrayAdd=function(a,t,e){
if(e==null||e<0||e>=a.length){
a.push(t)
}else{
a.splice(e,0,t)
}};
AjxUtil.arrayRemove=function(a,t){
if(a){
for(var e=0;
e<a.length;
e++){
if(a[e]==t){
a.splice(e,1);
return true
}}}
return false
};
AjxUtil.indexOf=function(n,t,e){
if(n){
for(var a=0;
a<n.length;
a++){
var o=n[a];
if((e&&o===t)||(!e&&o==t)){
return a
}}}
return -1
};
AjxUtil.arrayContains=function(a,t,e){
return AjxUtil.indexOf(a,t,e)!=-1
};
AjxUtil.keys=function(t,e){
var a=[];
for(var i in t){
if(e&&!e(i,t)){
continue
}
a.push(i)
}
return a
};
AjxUtil.values=function(a,t){
var e=[];
for(var i in a){
if(t&&!t(i,a)){
continue
}
e.push(a[i])
}
return e
};
AjxUtil.valueHash=function(n,a){
var i=Object.prototype.hasOwnProperty.bind(n);
var o={};
for(var t in n){
var e=n[t];
if(!i(t)||(a&&!a(t,n))){
continue
}
o[e]=t
}
return o
};
AjxUtil.backMap=AjxUtil.valueHash;
AjxUtil.foreach=function(o,a){
if(!a){
return
}
if(AjxUtil.isArrayLike(o)){
var n=o;
for(var t=0;
t<n.length;
t++){
a(n[t],t)
}}else{
hasown=Object.prototype.hasOwnProperty.bind(o);
for(var e in o){
if(hasown(e)){
a(o[e],e)
}}}};
AjxUtil.map=function(o,a){
var e=new Array(o.length);
for(var t=0;
t<o.length;
t++){
e[t]=a?a(o[t],t):o[t]
}
return e
};
AjxUtil.uniq=function(a){
var e={};
for(var t=0;
t<a.length;
t++){
e[a[t]]=true
}
return AjxUtil.keys(e)
};
AjxUtil.dedup=function(n,t){
if(!t){
t=function(i){
return i
}
}
var e={};
for(var o=0;
o<n.length;
o++){
var a=t(n[o]);
if(a!==undefined&&e[a]){
n.splice(o,1);
o-=1
}
e[a]=true
}};
AjxUtil.concat=function(t){
var a=[];
for(var e=0;
e<arguments.length;
e++){
a.push.apply(a,arguments[e])
}
return a
};
AjxUtil.union=function(e){
var t=[];
return AjxUtil.uniq(t.concat.apply(t,arguments))
};
AjxUtil.intersection=function(t){
var i=AjxUtil.concat.apply(this,arguments);
var e=AjxUtil.arrayAsHash(i,AjxUtil.__intersection_count);
for(var a in e){
if(e[a]==1){
delete e[a]
}}
return AjxUtil.keys(e)
};
AjxUtil.__intersection_count=function(t,a,e,i){
return a[t]!=null?a[t]+1:1
};
AjxUtil.complement=function(i,t){
var a=AjxUtil.arrayAsHash(i);
var e=AjxUtil.arrayAsHash(t);
for(var o in e){
if(o in a){
delete e[o]
}}
return AjxUtil.keys(e)
};
AjxUtil.getFirstElement=function(o,i,a,t){
for(var n=o.firstChild;
n;
n=n.nextSibling){
if(n.nodeType!=AjxUtil.ELEMENT_NODE){
continue
}
if(i&&n.nodeName!=i){
continue
}
if(a){
var e=n.getAttributeNode(a);
if(e.nodeName!=a){
continue
}
if(t&&e.nodeValue!=t){
continue
}}
return n
}
return null
};
AjxUtil.formatUrl=function(s){
s=s||{};
var a=[];
var o=0;
if(!s.relative){
var n=s.protocol||location.protocol;
if(n.indexOf(":")==-1){
n=n+":"
}
a[o++]=n;
a[o++]="//";
a[o++]=s.host||location.hostname;
var t=Number(s.port||location.port);
if(t&&((n==ZmSetting.PROTO_HTTP&&t!=ZmSetting.HTTP_DEFAULT_PORT)||(n==ZmSetting.PROTO_HTTPS&&t!=ZmSetting.HTTPS_DEFAULT_PORT))){
a[o++]=":";
a[o++]=t
}}
a[o++]=s.path||location.pathname;
var e="";
if(s.qsArgs){
e=AjxStringUtil.queryStringSet(s.qsArgs,s.qsReset)
}else{
e=s.qsReset?"":location.search
}
a[o++]=e;
return a.join("")
};
AjxUtil.byNumber=function(t,e){
return Number(t)-Number(e)
};
AjxUtil.byStringProp=function(i,t,e){
return t[i].localeCompare(e[i])
};
AjxUtil.arraySize=function(t){
var i=0;
for(var o in t){
if(t.hasOwnProperty(o)){
i++
}}
return i
};
AjxUtil.mergeArrays=function(h,n,e){
if(!e){
e=AjxUtil.__mergeArrays_orderfunc
}
var l=[];
var o=h.length;
for(var t=0;
t<o;
t++){
l.push(h[t])
}
var s=[];
var a=n.length;
for(var t=0;
t<a;
t++){
s.push(n[t])
}
var r=[];
while(l.length>0&&s.length>0){
if(e(l[0],r[r.length-1])==0){
l.shift();
continue
}
if(e(s[0],r[r.length-1])==0){
s.shift();
continue
}
if(e(l[0],s[0])<0){
r.push(l.shift())
}else{
if(e(l[0],s[0])==0){
r.push(l.shift());
s.shift()
}else{
r.push(s.shift())
}}}
while(l.length>0){
if(e(l[0],r[r.length-1])==0){
l.shift();
continue
}
r.push(l.shift())
}
while(s.length>0){
if(e(s[0],r[r.length-1])==0){
s.shift();
continue
}
r.push(s.shift())
}
return r
};
AjxUtil.__mergeArrays_orderfunc=function(t,e){
if(t>e){
return 1
}
if(t<e){
return -1
}
if(t==e){
return 0
}};
AjxUtil.arraySubtract=function(h,n,e){
if(!e){
e=function(c,i){
if(c>i){
return 1
}
if(c<i){
return -1
}
if(c==i){
return 0
}}
}
var l=[];
var o=h.length;
for(var t=0;
t<o;
t++){
l.push(h[t])
}
var s=[];
var a=n.length;
for(var t=0;
t<a;
t++){
s.push(n[t])
}
s.sort(e);
l.sort(e);
var r=[];
while(l.length>0&&s.length>0){
if(e(l[0],s[0])==0){
l.shift();
s.shift();
continue
}
if(e(l[0],s[0])<0){
r.push(l.shift());
continue
}
if(e(l[0],s[0])>0){
s.shift();
continue
}}
while(l.length>0){
r.push(l.shift())
}
return r
};
AjxUtil.arraySubstract=AjxUtil.arraySubtract;
AjxUtil.getHashKeys=function(a){
var t=[];
for(var e in a){
t.push(e)
}
t.sort();
return t
};
AjxUtil.arrayCompare=function(t,e){
if((!t||!e)&&(t!=e)){
return false
}
if(t.length!=e.length){
return false
}
for(var a=0;
a<t.length;
a++){
if(t[a]!=e[a]){
return false
}}
return true
};
AjxUtil.hashCompare=function(r,s){
var a=AjxUtil.getHashKeys(r);
var t=AjxUtil.getHashKeys(s);
if(!AjxUtil.arrayCompare(a,t)){
return false
}
for(var n=0,e=a.length;
n<e;
n++){
var o=a[n];
if(r[o]!=s[o]){
return false
}}
return true
};
AjxUtil.hashCopy=function(t){
var a={};
for(var e in t){
a[e]=t[e]
}
return a
};
AjxUtil.hashUpdate=function(i,a,e,o){
for(var t in a){
if((e||!(t in i))&&(!o||AjxUtil.indexOf(o,t)==-1)){
i[t]=a[t]
}}
return i
};
AjxUtil.isArray1=function(e){
return !!(e&&(e.length!=null)&&e.splice&&e.slice)
};
AjxUtil.toArray=function(t){
if(!t){
return[]
}else{
if(AjxUtil.isArray1(t)){
return t
}else{
if(AjxUtil.isArrayLike(t)){
try{
return Array.prototype.slice.call(t)
}
catch(a){
return AjxUtil.map(t)
}}else{
if(t.isAjxVector){
return t.getArray()
}else{
return[t]
}}}}};
AjxUtil.get=function(e){
for(var t=1;
e&&t<arguments.length;
t++){
e=e[arguments[t]]
}
return e
};
AjxUtil.convertToEntities=function(n){
var e="";
var o=0;
if(!n||!(o=n.length)){
return n
}
for(var a=0;
a<o;
a++){
if(n.charCodeAt(a)>127){
var t=n.charCodeAt(a).toString(10);
while(t.length<4){
t="0"+t
}
e+="&#"+t+";"
}else{
e+=n.charAt(a)
}}
return e
};
AjxUtil.getClassAttr=function(t){
var e=[];
if(t&&t.length>0){
t=AjxUtil.uniq(t);
return["class='",t.join(" "),"'"].join("")
}
return""
};
AjxUtil.dataURItoBlob=function(s){
if(!(s&&typeof window.atob==="function"&&typeof window.Blob==="function")){
return
}
var l=s.split(",");
if(l.length===2){
if(l[0].indexOf("base64")===-1){
return
}
try{
var n=window.atob(l[1])
}
catch(h){
return
}
if(!n){
return
}
var o=l[0].split(":");
if(!o[1]){
return
}
o=o[1].split(";")[0];
if(o){
var t=n.length,c=new ArrayBuffer(t),a=new Uint8Array(c);
for(var r=0;
r<t;
r++){
a[r]=n.charCodeAt(r)
}
return new Blob([c],{
type:o}
)
}}};
AjxUtil.reduce=function(r,s,o){
var i=Array.prototype.reduce;
if(i){
return i.call(r,s,o)
}else{
if(r===null||"undefined"===typeof r){
throw new TypeError("AjxUtil.reduce called on null or undefined")
}
if("function"!==typeof s){
throw new TypeError(s+" is not a function")
}
var e,a,t=r.length>>>0,n=false;
if(1<arguments.length){
a=o;
n=true
}
for(e=0;
t>e;
++e){
if(r.hasOwnProperty(e)){
if(n){
a=s(a,r[e],e,r)
}else{
a=r[e];
n=true
}}}
if(!n){
throw new TypeError("Reduce of empty array with no initial value")
}
return a
}};
AjxUtil.getBrightness=function(t){
var i,a,e;
if(t&&t.length===7&&t.indexOf("#")===0){
t=t.substr(1)
}else{
return null
}
i=parseInt(t.substr(0,2),16);
a=parseInt(t.substr(2,2),16);
e=parseInt(t.substr(4,2),16);
return Math.sqrt(i*i*0.299+a*a*0.587+e*e*0.114)
};
AjxUtil.getForegroundColor=function(e){
var t=AjxUtil.getBrightness(e);
return(t!=null&&t<130)?"white":"black"
}
}
if(AjxPackage.define("ajax.core.AjxException")){
AjxException=function(a,t,i,e){
if(arguments.length==0){
return
}
this.msg=a;
this.code=t;
this.method=i;
this.detail=e
};
AjxException.prototype.toString=function(){
return"AjxException"
};
AjxException.prototype.dump=function(){
return"AjxException: msg="+this.msg+" code="+this.code+" method="+this.method+" detail="+this.detail
};
AjxException.INVALIDPARENT="AjxException.INVALIDPARENT";
AjxException.INVALID_OP="AjxException.INVALID_OP";
AjxException.INTERNAL_ERROR="AjxException.INTERNAL_ERROR";
AjxException.INVALID_PARAM="AjxException.INVALID_PARAM";
AjxException.UNIMPLEMENTED_METHOD="AjxException.UNIMPLEMENTED_METHOD";
AjxException.NETWORK_ERROR="AjxException.NETWORK_ERROR";
AjxException.OUT_OF_RPC_CACHE="AjxException.OUT_OF_RPC_CACHE";
AjxException.UNSUPPORTED="AjxException.UNSUPPORTED";
AjxException.UNKNOWN_ERROR="AjxException.UNKNOWN_ERROR";
AjxException.CANCELED="AjxException.CANCELED";
AjxException.defaultScriptErrorHandler=function(e){
alert(e)
};
AjxException.setScriptErrorHandler=function(e){
AjxException.scriptErrorHandler=e
};
AjxException.reportScriptError=function(e){
if(AjxException.reportScriptErrors&&AjxException.scriptErrorHandler&&!(e instanceof AjxException)){
AjxException.scriptErrorHandler(e)
}
throw e
};
AjxException.reportScriptErrors=false;
AjxException.scriptErrorHandler=AjxException.defaultScriptErrorHandler
}
if(AjxPackage.define("ajax.util.AjxCookie")){
AjxCookie=function(){};
AjxCookie.prototype.toString=function(){
return"AjxCookie"
};
AjxCookie.getCookie=function(h,t){
var l=t+"=";
var o=l.length;
var r=h.cookie.length;
var a=h.cookie;
var s=0;
while(s<r){
var n=s+o;
if(a.substring(s,n)==l){
var e=a.indexOf(";",n);
if(e==-1){
e=a.length
}
return unescape(a.substring(n,e))
}
s=a.indexOf(" ",s)+1;
if(s==0){
break
}}
return null
};
AjxCookie.setCookie=function(s,t,i,e,n,a,o){
s.cookie=t+"="+escape(i)+((e)?"; expires="+e.toGMTString():"")+((n)?"; path="+n:"")+((a)?"; domain="+a:"")+((o)?"; secure":"")
};
AjxCookie.deleteCookie=function(i,e,a,t){
i.cookie=e+"="+((a)?"; path="+a:"")+((t)?"; domain="+t:"")+"; expires=Fri, 31 Dec 1999 23:59:59 GMT"
};
AjxCookie.areCookiesEnabled=function(i){
var e="ZM_COOKIE_TEST";
var a="Zimbra";
AjxCookie.setCookie(i,e,a);
var t=AjxCookie.getCookie(i,e);
AjxCookie.deleteCookie(i,e);
return t==a
}
}
if(AjxPackage.define("ajax.soap.AjxSoapException")){
AjxSoapException=function(a,t,i,e){
AjxException.call(this,a,t,i,e)
};
AjxSoapException.prototype.toString=function(){
return"AjxSoapException"
};
AjxSoapException.prototype=new AjxException;
AjxSoapException.prototype.constructor=AjxSoapException;
AjxSoapException.INTERNAL_ERROR="INTERNAL_ERROR";
AjxSoapException.INVALID_PDU="INVALID_PDU";
AjxSoapException.ELEMENT_EXISTS="ELEMENT_EXISTS"
}
if(AjxPackage.define("ajax.soap.AjxSoapFault")){
AjxSoapFault=function(t){
if(arguments.length==0){
return
}
var r=t.prefix;
var s=r+":Code";
var n=r+":Reason";
var a=r+":Detail";
var h=t.childNodes.length;
for(var o=0;
o<h;
o++){
var e=t.childNodes[o];
if(e.nodeName==s){
var l=e.firstChild.firstChild.nodeValue;
if(l==(r+":VersionMismatch")){
this.faultCode=AjxSoapFault.VERSION_MISMATCH
}else{
if(l==(r+":MustUnderstand")){
this.faultCode=AjxSoapFault.MUST_UNDERSTAND
}else{
if(l==(r+":DataEncodingUnknown")){
this.faultCode=AjxSoapFault.DATA_ENCODING_UNKNOWN
}else{
if(l==(r+":Sender")){
this.faultCode=AjxSoapFault.SENDER
}else{
if(l==(r+":Receiver")){
this.faultCode=AjxSoapFault.RECEIVER
}else{
this.faultCode=AjxSoapFault.UNKNOWN
}}}}}}else{
if(e.nodeName==n){
this.reason=e.firstChild.firstChild.nodeValue
}else{
if(e.nodeName==a){
this.errorCode=e.firstChild.firstChild.firstChild.nodeValue
}}}}};
AjxSoapFault.prototype.toString=function(){
return"AjxSoapFault"
};
AjxSoapFault.SENDER=-1;
AjxSoapFault.RECEIVER=-2;
AjxSoapFault.VERSION_MISMATCH=-3;
AjxSoapFault.MUST_UNDERSTAND=-4;
AjxSoapFault.DATA_ENCODING_UNKNOWN=-5;
AjxSoapFault.UNKNOWN=-6
}
if(AjxPackage.define("ajax.soap.AjxSoapDoc")){
AjxSoapDoc=function(){
this._soapURI=AjxSoapDoc._SOAP_URI
};
AjxSoapDoc.prototype.isAjxSoapDoc=true;
AjxSoapDoc.prototype.toString=function(){
return"AjxSoapDoc"
};
AjxSoapDoc._SOAP_URI="http://www.w3.org/2003/05/soap-envelope";
AjxSoapDoc._XMLNS_URI="http://www.w3.org/2000/xmlns";
AjxSoapDoc.create=function(e,a,r,s){
var n=new AjxSoapDoc();
n._xmlDoc=AjxXmlDoc.create();
var o=n._xmlDoc.getDoc();
if(!s){
s=AjxSoapDoc._SOAP_URI
}
n._soapURI=s;
var t=o.createElementNS&&!AjxEnv.isSafari;
var i=t?o.createElementNS(s,"soap:Envelope"):o.createElement("soap:Envelope");
if(!t){
i.setAttribute("xmlns:soap",s)
}
o.appendChild(i);
var h=t?o.createElementNS(s,"soap:Body"):o.createElement("soap:Body");
i.appendChild(h);
n._methodEl=a&&t?o.createElementNS(a,e):o.createElement(e);
if(a!=null&&!t){
if(r==null){
n._methodEl.setAttribute("xmlns",a)
}else{
n._methodEl.setAttribute("xmlns:"+r,a)
}}
h.appendChild(n._methodEl);
return n
};
AjxSoapDoc.createFromDom=function(t){
var e=new AjxSoapDoc();
e._xmlDoc=AjxXmlDoc.createFromDom(t);
e._methodEl=e._check(e._xmlDoc);
return e
};
AjxSoapDoc.createFromXml=function(e){
var t=new AjxSoapDoc();
t._xmlDoc=AjxXmlDoc.createFromXml(e);
t._methodEl=t._check(t._xmlDoc);
return t
};
AjxSoapDoc.element2FaultObj=function(t){
var e=t.firstChild;
if(!AjxEnv.isSafari){
if(e!=null&&e.namespaceURI!=AjxSoapDoc._SOAP_URI||e.nodeName!=(t.prefix+":Fault")){
return null
}}else{
if(e!=null&&e.nodeName!=(t.prefix+":Fault")){
return null
}}
return new AjxSoapFault(e)
};
AjxSoapDoc.prototype.setMethodAttribute=function(e,t){
this._methodEl.setAttribute(e,t)
};
AjxSoapDoc.prototype.set=function(t,l,c,n){
var h=this.getDoc();
var e=h.createElementNS&&!AjxEnv.isSafari;
var a=t?(n&&e?h.createElementNS(n,t):h.createElement(t)):h.createDocumentFragment();
if((n!==undefined)&&(n!==null)&&!e){
a.setAttribute("xmlns",n)
}
if(l!=null){
if(typeof l=="object"){
for(var r in l){
var o=l[r];
if(r.charAt(0)=="!"){
a.setAttribute(r.substr(1),o)
}else{
if(o instanceof Array){
for(var s=0;
s<o.length;
++s){
this.set(r,o[s],a)
}}else{
this.set(r,o,a)
}}}}else{
a.appendChild(h.createTextNode(l))
}}
if(!c){
c=this._methodEl
}
return c.appendChild(a)
};
AjxSoapDoc.prototype.getMethod=function(){
return this._methodEl
};
AjxSoapDoc.prototype.createHeaderElement=function(){
var a=this._xmlDoc.getDoc();
var t=a.firstChild;
var i=this.getHeader();
if(i!=null){
throw new AjxSoapException("SOAP header already exists",AjxSoapException.ELEMENT_EXISTS,"AjxSoapDoc.prototype.createHeaderElement")
}
var e=a.createElementNS&&!AjxEnv.isSafari;
i=e?a.createElementNS(this._soapURI,"soap:Header"):a.createElement("soap:Header");
t.insertBefore(i,t.firstChild);
return i
};
AjxSoapDoc.prototype.getHeader=function(){
var t=this._xmlDoc.getDoc();
var e=!t.getElementsByTagNameNS?(t.getElementsByTagName(t.firstChild.prefix+":Header")):(t.getElementsByTagNameNS(this._soapURI,"Header"));
return e?e[0]:null
};
AjxSoapDoc.prototype.getBody=function(){
var t=this._xmlDoc.getDoc();
var e=!t.getElementsByTagNameNS?(t.getElementsByTagName(t.firstChild.prefix+":Body")):(t.getElementsByTagNameNS(this._soapURI,"Body"));
return e?e[0]:null
};
AjxSoapDoc.prototype.getByTagName=function(t){
if(t.indexOf(":")==-1){
t="soap:"+t
}
var e=this.getDoc().getElementsByTagName(t);
if(e.length==1){
return e[0]
}else{
if(e.length>0){
return e
}else{
return null
}}};
AjxSoapDoc.prototype.ensureHeader=function(){
return(this.getHeader()||this.createHeaderElement())
};
AjxSoapDoc.prototype.getDoc=function(){
return this._xmlDoc.getDoc()
};
AjxSoapDoc.prototype.adoptNode=function(t){
if(AjxEnv.isFirefox3up||!AjxEnv.isFirefox){
try{
var a=this.getDoc();
if(a.adoptNode){
return a.adoptNode(t,true)
}}
catch(e){}}
return t.parentNode.removeChild(t)
};
AjxSoapDoc.prototype.getXml=function(){
return this._xmlDoc.getXml()
};
AjxSoapDoc.prototype._check=function(t){
var a=t.getDoc();
if(a.childNodes.length!=1){
throw new AjxSoapException("Invalid SOAP PDU",AjxSoapException.INVALID_PDU,"AjxSoapDoc.createFromXml:1")
}
var e=a.firstChild;
if(!AjxEnv.isSafari){
if(e.namespaceURI!=AjxSoapDoc._SOAP_URI||e.nodeName!=(e.prefix+":Envelope")||(e.childNodes.length<1||e.childNodes.length>2)){
throw new AjxSoapException("Invalid SOAP PDU",AjxSoapException.INVALID_PDU,"AjxSoapDoc.createFromXml:2")
}}else{
if(e.nodeName!=(e.prefix+":Envelope")){
throw new AjxSoapException("Invalid SOAP PDU",AjxSoapException.INVALID_PDU,"AjxSoapDoc.createFromXml:2")
}}}
}
if(AjxPackage.define("ajax.net.AjxRpcRequest")){
AjxRpcRequest=function(e){
if(!AjxRpcRequest.__inited){
AjxRpcRequest.__init()
}
this.id=e;
this.__httpReq=AjxRpcRequest.__msxmlVers?(new ActiveXObject(AjxRpcRequest.__msxmlVers)):(new XMLHttpRequest())
};
AjxRpcRequest.prototype.isAjxRpcRequest=true;
AjxRpcRequest.prototype.toString=function(){
return"AjxRpcRequest"
};
AjxRpcRequest.TIMEDOUT=-1000;
AjxRpcRequest.HTTP_GET="get";
AjxRpcRequest.HTTP_POST="post";
AjxRpcRequest.HTTP_PUT="put";
AjxRpcRequest.HTTP_DELETE="delete";
AjxRpcRequest.__inited=false;
AjxRpcRequest.__msxmlVers=null;
AjxRpcRequest.prototype.invoke=function(n,o,h,d,e,l){
var t=(d!=null);
this.methodName=o||"";
var a=AjxRpcRequest.HTTP_POST;
if(e){
a=e===true?AjxRpcRequest.HTTP_GET:e
}
if(window.csrfToken&&(a===AjxRpcRequest.HTTP_POST||a===AjxRpcRequest.HTTP_PUT||a===AjxRpcRequest.HTTP_DELETE)){
h=h||{};
h["X-Zimbra-Csrf-Token"]=window.csrfToken
}
this.__httpReq.open(a,o,t);
if(t){
if(l){
var s=new AjxTimedAction(this,this.__handleTimeout,[d]);
d._timedActionId=AjxTimedAction.scheduleAction(s,l)
}
var c=this;
this.__httpReq.onreadystatechange=function(i){
if(window.AjxRpcRequest){
AjxRpcRequest.__handleResponse(c,d)
}}
}else{
this.__httpReq.onreadystatechange=function(i){}
}
if(h){
for(var r in h){
if(h.hasOwnProperty(r)){
this.__httpReq.setRequestHeader(r,h[r])
}}}
AjxDebug.println(AjxDebug.RPC,AjxDebug._getTimeStamp()+" RPC send: "+this.id);
this.__httpReq.send(n);
if(t){
return this.id
}else{
if(this.__httpReq.status==200||this.__httpReq.status==201){
return{
text:this.__httpReq.responseText,xml:this.__httpReq.responseXML,success:true}
}else{
return{
text:this.__httpReq.responseText,xml:this.__httpReq.responseXML,success:false,status:this.__httpReq.status}
}}};
AjxRpcRequest.prototype.cancel=function(){
AjxRpc.freeRpcCtxt(this);
if(AjxEnv.isFirefox3_5up){
this.__httpReq.onreadystatechange=function(){}
}
this.__httpReq.abort()
};
AjxRpcRequest.prototype.__handleTimeout=function(e){
this.cancel();
e.run({
text:null,xml:null,success:false,status:AjxRpcRequest.TIMEDOUT}
)
};
AjxRpcRequest.__handleResponse=function(a,i){
try{
if(!a||!a.__httpReq){
a.cancel();
AjxDebug.println(AjxDebug.RPC,AjxDebug._getTimeStamp()+" Async RPC request: Lost request object!!!");
i.run({
text:null,xml:null,success:false,status:500}
);
AjxRpc.freeRpcCtxt(a);
return
}
if(a.__httpReq.readyState==4){
if(i._timedActionId!==null){
AjxTimedAction.cancelAction(i._timedActionId)
}
var e=500;
try{
e=a.__httpReq.status
}
catch(t){}
if(e==200||e==201){
i.run({
text:a.__httpReq.responseText,xml:a.__httpReq.responseXML,success:true,reqId:a.id}
)
}else{
i.run({
text:a.__httpReq.responseText,xml:a.__httpReq.responseXML,success:false,status:e,reqId:a.id}
)
}
AjxRpc.freeRpcCtxt(a)
}}
catch(t){
if(window.AjxException){
AjxException.reportScriptError(t)
}}};
AjxRpcRequest.__init=function(){
if(!window.XMLHttpRequest&&window.ActiveXObject){
var t=["MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];
for(var o=0;
o<t.length;
o++){
try{
var e=new ActiveXObject(t[o]);
AjxRpcRequest.__msxmlVers=t[o];
break
}
catch(a){}}
if(!AjxRpcRequest.__msxmlVers){
throw new AjxException("MSXML not installed",AjxException.INTERNAL_ERROR,"AjxRpc._init")
}}
AjxRpcRequest.__inited=true
}
}
if(AjxPackage.define("ajax.net.AjxRpc")){
AjxRpc=function(){};
AjxRpc.__rpcCache=[];
AjxRpc.__rpcOutstanding={};
AjxRpc.__RPC_CACHE_MAX=50;
AjxRpc.__RPC_ID=0;
AjxRpc.__RPC_IN_USE=0;
AjxRpc.__RPC_HIGH_WATER=0;
AjxRpc.__RPC_REAP_AGE=300000;
AjxRpc.__RPC_REAP_INTERVAL=1800000;
AjxRpc.invoke=function(i,a,s,c,e,l){
var t=(c!=null);
var n=AjxRpc.__getFreeRpcCtxt();
try{
var o=n.invoke(i,a,s,c,e,l)
}
catch(r){
var h=new AjxException();
h.method="AjxRpc.prototype._invoke";
if(r instanceof Error){
h.detail=r.message;
h.code=AjxException.NETWORK_ERROR;
h.msg="Network error"
}else{
if(r.code==101){
h.detail=r.message;
h.code=AjxException.NETWORK_ERROR;
h.msg="Network error"
}else{
h.detail=r.toString();
h.code=AjxException.UNKNOWN_ERROR;
h.msg="Unknown Error"
}}
AjxRpc.freeRpcCtxt(n);
throw h
}
if(!t){
AjxRpc.freeRpcCtxt(n)
}
return o
};
AjxRpc.freeRpcCtxt=function(e){
if(AjxRpc.__rpcOutstanding[e.id]){
AjxDebug.println(AjxDebug.RPC,AjxDebug._getTimeStamp()+" --- freeing rpcCtxt "+e.id);
AjxRpc.__rpcCache.push(e);
delete AjxRpc.__rpcOutstanding[e.id];
AjxRpc.__RPC_IN_USE--
}};
AjxRpc.removeRpcCtxt=function(e){
AjxDebug.println(AjxDebug.RPC,AjxDebug._getTimeStamp()+" REMOVE rpcCtxt "+e.id);
if(AjxRpc.__rpcOutstanding[e.id]){
delete AjxRpc.__rpcOutstanding[e.id];
AjxRpc.__RPC_IN_USE--
}
AjxUtil.arrayRemove(AjxRpc.__rpcCache,e)
};
AjxRpc.getRpcRequestById=function(e){
return(AjxRpc.__rpcOutstanding[e])
};
AjxRpc.__getFreeRpcCtxt=function(){
var e;
if(AjxRpc.__rpcCache.length>0){
e=AjxRpc.__rpcCache.pop();
AjxDebug.println(AjxDebug.RPC,AjxDebug._getTimeStamp()+" reusing RPC ID "+e.id)
}else{
if(AjxRpc.__RPC_IN_USE<AjxRpc.__RPC_CACHE_MAX){
var n="__RpcCtxt_"+AjxRpc.__RPC_ID;
e=new AjxRpcRequest(n);
AjxRpc.__RPC_ID++;
AjxDebug.println(AjxDebug.RPC,AjxDebug._getTimeStamp()+" Created RPC "+n)
}else{
e=AjxRpc.__reap();
if(!e){
var o=[];
for(var t in AjxRpc.__rpcOutstanding){
var e=AjxRpc.__rpcOutstanding[t];
o.push(e.methodName)
}
var a=o.join("<br>")+"<br>";
AjxDebug.println(AjxDebug.RPC,AjxDebug._getTimeStamp()+" Out of RPC cache!!! Outstanding requests: "+a);
throw new AjxException("Out of RPC cache",AjxException.OUT_OF_RPC_CACHE,"AjxRpc.__getFreeRpcCtxt",a)
}}}
AjxRpc.__rpcOutstanding[e.id]=e;
AjxRpc.__RPC_IN_USE++;
if(AjxRpc.__RPC_IN_USE>AjxRpc.__RPC_HIGH_WATER){
AjxRpc.__RPC_HIGH_WATER=AjxRpc.__RPC_IN_USE;
AjxDebug.println(AjxDebug.RPC,AjxDebug._getTimeStamp()+" High water mark: "+AjxRpc.__RPC_HIGH_WATER)
}
e.timestamp=(new Date()).getTime();
return e
};
AjxRpc.__reap=function(a){
var e;
var o=(new Date()).getTime();
AjxDebug.println(AjxDebug.RPC,AjxDebug._getTimeStamp()+" Running RPC context reaper");
for(var t in AjxRpc.__rpcOutstanding){
e=AjxRpc.__rpcOutstanding[t];
if((e.timestamp+AjxRpc.__RPC_REAP_AGE)<o){
AjxDebug.println(AjxDebug.RPC,AjxDebug._getTimeStamp()+" AjxRpc.__reap: cleared RPC context "+e.id);
e.cancel();
delete AjxRpc.__rpcOutstanding[t];
AjxRpc.__RPC_IN_USE--;
if(!a){
return e
}}}
return null
};
window.setInterval(AjxRpc.__reap.bind(null,true),AjxRpc.__RPC_REAP_INTERVAL)
}
if(AjxPackage.define("ajax.util.AjxVector")){
AjxVector=function(e){
this._array=e||[]
};
AjxVector.prototype.isAjxVector=true;
AjxVector.prototype.toString=function(n,t){
if(t!==true){
return this._array.join(n)
}
var o=new Array();
for(var s=0;
s<this._array.length;
s++){
var e=this._array[s];
if(e!=undefined&&e!=null&&e!=""){
o.push(e)
}}
return o.join(n)
};
AjxVector.fromArray=function(t){
var e=new AjxVector();
if(AjxUtil.isArray1(t)){
e._array=t
}
return e
};
AjxVector.prototype.size=function(){
return this._array.length
};
AjxVector.prototype.add=function(a,e,t){
if(t&&this.contains(a)){
return
}
AjxUtil.arrayAdd(this._array,a,e)
};
AjxVector.prototype.addList=function(a){
if(!a){
return
}
if(a.length){
this._array=this._array.concat(a)
}else{
if(a.size&&a.size()){
if(AjxEnv.isIE&&(!(a._array instanceof Array))){
var t=[];
for(var e=0;
e<a._array.length;
e++){
t.push(a._array[e])
}
a._array=t
}
this._array=this._array.concat(a._array)
}}};
AjxVector.prototype.remove=function(e){
return AjxUtil.arrayRemove(this._array,e)
};
AjxVector.prototype.removeAt=function(t){
if(t>=this._array.length||t<0){
return null
}
var a=this._array.splice(t,1);
var e=null;
if(a){
e=a[0]
}
return e
};
AjxVector.prototype.removeAll=function(){
for(var e=0;
e<this._array.length;
e++){
this._array[e]=null
}
this._array.length=0
};
AjxVector.prototype.removeLast=function(){
return this._array.length>0?this._array.pop():null
};
AjxVector.prototype.reverse=function(){
this._array.reverse()
};
AjxVector.prototype.replace=function(a,t){
var e=this._array[a];
this._array[a]=t;
return e
};
AjxVector.prototype.replaceObject=function(a,e){
for(var t=0;
t<this._array.length;
t++){
if(this._array[t]==a){
this._array[t]=e;
return a
}}
return null
};
AjxVector.prototype.indexOf=function(t){
if(t==null){
return -1
}
for(var e=0;
e<this._array.length;
e++){
if(this._array[e]==t){
return e
}}
return -1
};
AjxVector.prototype.indexOfLike=function(o,a){
var t=a.call(o);
for(var e=0;
e<this._array.length;
e++){
var n=a.call(this._array[e]);
if(n==t){
return e
}}
return -1
};
AjxVector.prototype.lastIndexOf=function(t){
if(t==null){
return -1
}
for(var e=this._array.length-1;
e>=0;
e--){
if(this._array[e]==t){
return e
}}
return -1
};
AjxVector.prototype.lastIndexOfLike=function(o,a){
var t=a.call(o);
for(var e=this._array.length-1;
e>=0;
e--){
var n=a.call(this._array[e]);
if(n==t){
return e
}}
return -1
};
AjxVector.prototype.clone=function(){
var e=new AjxVector();
e.addList(this);
return e
};
AjxVector.prototype.contains=function(e){
return AjxUtil.arrayContains(this._array,e)
};
AjxVector.prototype.containsLike=function(o,a){
var t=a.call(o);
for(var e=0;
e<this._array.length;
e++){
var n=a.call(this._array[e]);
if(n==t){
return true
}}
return false
};
AjxVector.prototype.get=function(e){
return e>=this._array.length||e<0?null:this._array[e]
};
AjxVector.prototype.getArray=function(){
return this._array
};
AjxVector.prototype.getLast=function(){
return this._array.length==0?null:this._array[this._array.length-1]
};
AjxVector.prototype.getNext=function(t){
var e=this.indexOf(t);
if(e==-1){
return null
}
return this.get(++e)
};
AjxVector.prototype.getPrev=function(t){
var e=this.indexOf(t);
if(e==-1){
return null
}
return this.get(--e)
};
AjxVector.prototype.sort=function(e){
if(!e){
e=AjxVector._defaultArrayComparator
}
this._array.sort(e)
};
AjxVector.prototype.binarySearch=function(s,r){
if(!r){
r=AjxVector._defaultArrayComparator
}
var a=0;
var e=this._array;
var o=e.length-1;
while(true){
if(o<a){
return -1
}
var n=Math.floor((a+o)/2);
var t=r(s,e[n]);
if(t<0){
o=n-1
}else{
if(t>0){
a=n+1
}else{
return n
}}}};
AjxVector.prototype.merge=function(n,o){
if(n<0){
return
}
var s=o instanceof AjxVector?o.getArray():o;
var e=this._array.length<(n+s.length)?this._array.length:n+s.length;
if(n<this._array.length){
var a=0;
for(var t=n;
t<e;
t++){
this._array[t]=s[a++]
}
if(a<s.length){
this._array=this._array.concat(s.slice(a))
}}else{
this._array=this._array.concat(s)
}};
AjxVector._defaultArrayComparator=function(t,e){
return t<e?-1:(t>e?1:0)
};
AjxVector.prototype.foreach=function(o,n){
var e=this.size(),t=0,a;
if(typeof o=="function"){
while(--e>=0){
o.call(n,this.get(t),t++)
}}else{
while(--e>=0){
a=this.get(t++);
if(a!=null){
a[o].call(a)
}}}};
AjxVector.prototype.map=function(n,s){
var e=[],t=this.size(),o;
if(typeof n=="function"){
while(--t>=0){
e[t]=n.call(s,this.get(t),t)
}}else{
if(n instanceof AjxCallback){
while(--t>=0){
e[t]=n.run(this.get(t),t)
}}else{
while(--t>=0){
o=this.get(t);
if(o!=null){
if(typeof o[n]=="function"){
e.unshift(o[n].call(o))
}else{
e.unshift(o[n])
}}}}}
return AjxVector.fromArray(e)
};
AjxVector.prototype.join=function(e){
return this._array.join(e)
};
AjxVector.prototype.sub=function(s,r){
var t=[],e=this.size(),o=0,n;
while(--e>=0){
n=this.get(o++);
if(!s.call(r,n,o)){
t.push(n)
}}
return AjxVector.fromArray(t)
};
AjxVector.prototype.slice=function(t,e){
return AjxVector.fromArray(this._array.slice(t,e))
}
}
if(AjxPackage.define("ajax.util.AjxStringUtil")){
AjxStringUtil=function(){};
AjxStringUtil.TRIM_RE=/^\s+|\s+$/g;
AjxStringUtil.COMPRESS_RE=/\s+/g;
AjxStringUtil.ELLIPSIS=" ... ";
AjxStringUtil.LIST_SEP=", ";
AjxStringUtil.CRLF="\r\n";
AjxStringUtil.CRLF2="\r\n\r\n";
AjxStringUtil.CRLF_HTML="<br>";
AjxStringUtil.CRLF2_HTML="<div><br></div><div><br></div>";
AjxStringUtil.IMG_SRC_CID_REGEX=/<img([^>]*)\ssrc=["']cid:/gi;
AjxStringUtil.makeString=function(e){
return e?String(e):""
};
AjxStringUtil.capitalize=function(e){
return e&&e.length>0?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""
};
AjxStringUtil.capitalizeFirstLetter=function(e){
return e&&e.length>0?e.charAt(0).toUpperCase()+e.substr(1):""
};
AjxStringUtil.capitalizeWords=function(e){
return e?AjxUtil.map(e.split(/\s+/g),AjxStringUtil.capitalizeFirstLetter).join(" "):""
};
AjxStringUtil.toMixed=function(s,e,o){
if(!s||(typeof s!="string")){
return""
}
e=e||/\s+/;
var a=s.split(e);
var n=[];
n.push(o?a[0].toLowerCase():a[0].substring(0,1).toUpperCase()+a[0].substring(1).toLowerCase());
for(var t=1;
t<a.length;
t++){
n.push(a[t].substring(0,1).toUpperCase()+a[t].substring(1).toLowerCase())
}
return n.join("")
};
AjxStringUtil.fromMixed=function(t,e){
e=["$1",e||" ","$2"].join("");
return AjxStringUtil.trim(t.replace(/([a-z])([A-Z]+)/g,e))
};
AjxStringUtil.trim=function(o,e,i){
if(!o){
return""
}
var a=AjxStringUtil.TRIM_RE;
var t=AjxStringUtil.COMPRESS_RE;
if(i){
a=new RegExp("^"+i+"+|"+i+"+$","g");
t=new RegExp(i+"+","g")
}else{
i=" "
}
o=o.replace(a,"");
if(e){
o=o.replace(t,i)
}
return o
};
AjxStringUtil.repeat=function(o,e){
var a="";
for(var t=0;
t<e;
t++){
a+=o
}
return a
};
AjxStringUtil.getUnitsFromSizeString=function(t){
var a="px";
if(typeof(t)=="string"){
var e=Number(parseInt(t,10)).toString();
if(t.length>e.length){
a=t.substr(e.length,(t.length-e.length));
if(!(a=="em"||a=="ex"||a=="px"||a=="in"||a=="cm"==a=="mm"||a=="pt"||a=="pc"||a=="%")){
a="px"
}}}
return a
};
AjxStringUtil.split=function(l,o){
if(!l){
return[]
}
var s=0;
o=o?o:",";
var u=new Object();
if(typeof o=="string"){
u[o]=1
}else{
for(s=0;
s<o.length;
s++){
u[o[s]]=1
}}
var e=false;
var a=0;
var t=0;
var d;
var r=[];
var n=0;
for(s=0;
s<l.length;
s++){
var h=l.charAt(s);
if(h=='"'){
e=!e
}else{
if(h=="("){
a++
}else{
if(h==")"){
a--
}else{
if(u[h]){
if(!e&&!a){
d=l.substring(t,s);
r[n++]=d;
t=s+1
}}}}}}
d=l.substring(t,l.length);
r[n++]=d;
return r
};
AjxStringUtil.SPACE_WORD_RE=new RegExp("\\s*\\S+","g");
AjxStringUtil.splitKeepLeadingWhitespace=function(t){
var a=[],e;
while(e=AjxStringUtil.SPACE_WORD_RE.exec(t)){
a.push(e[0])
}
return a
};
AjxStringUtil.WRAP_LENGTH=80;
AjxStringUtil.HDR_WRAP_LENGTH=120;
AjxStringUtil.MAX_HTMLNODE_COUNT=250;
AjxStringUtil.HTML_QUOTE_COLOR="#1010FF";
AjxStringUtil.HTML_QUOTE_STYLE="color:#000;font-weight:normal;font-style:normal;text-decoration:none;font-family:Helvetica,Arial,sans-serif;font-size:12pt;";
AjxStringUtil.HTML_QUOTE_PREFIX_PRE='<blockquote style="border-left:2px solid '+AjxStringUtil.HTML_QUOTE_COLOR+";margin-left:5px;padding-left:5px;"+AjxStringUtil.HTML_QUOTE_STYLE+'">';
AjxStringUtil.HTML_QUOTE_PREFIX_POST="</blockquote>";
AjxStringUtil.HTML_QUOTE_NONPREFIX_PRE='<div style="'+AjxStringUtil.HTML_QUOTE_STYLE+'">';
AjxStringUtil.HTML_QUOTE_NONPREFIX_POST="</div><br/>";
AjxStringUtil.wordWrap=function(D){
if(!(D&&D.text)){
return""
}
var p=D.text;
var g=D.before||"";
var t=D.after||"";
var a=D.isFlowed;
if(D.htmlMode){
g=D.before||(D.prefix?AjxStringUtil.HTML_QUOTE_PREFIX_PRE:AjxStringUtil.HTML_QUOTE_NONPREFIX_PRE);
t=D.after||(D.prefix?AjxStringUtil.HTML_QUOTE_PREFIX_POST:AjxStringUtil.HTML_QUOTE_NONPREFIX_POST);
return[g,p,t].join("")
}
var T=D.len||(D.isHeaders?AjxStringUtil.HDR_WRAP_LENGTH:AjxStringUtil.WRAP_LENGTH);
var S=D.prefix||"";
var s="\n";
var e=p.split(AjxStringUtil.SPLIT_RE);
var v=[];
for(var q=0,C=e.length;
q<C;
q++){
var u=e[q];
var x=u.match(/^([\s>\|]+)/);
var j=x?x[1]:"";
if(j){
u=u.substr(j.length)
}
if(AjxStringUtil._NON_WHITESPACE.test(u)){
var h=AjxStringUtil.splitKeepLeadingWhitespace(u);
if(h&&h[0]&&h[0].length){
var k=AjxStringUtil.MSG_SEP_RE.test(u)||AjxStringUtil.COLON_RE.test(u)||AjxStringUtil.HDR_RE.test(u)||D.isHeaders||AjxStringUtil.SIG_RE.test(u);
var y=D.preserveReturns;
if(a){
var x=u.match(/( +)$/);
if(x){
h[h.length-1]+=x[1];
y=false
}else{
y=true
}}
for(var d=0,f=h.length;
d<f;
d++){
v.push({
w:h[d],prefix:j,mustStart:(d===0)&&k,mustEnd:(d===f-1)&&y}
)
}}}else{
v.push({
para:true,prefix:j}
)
}}
var c="",n=0,h=[],r=null;
for(var z=0,O=v.length;
z<O;
z++){
var A=v[z];
var d=A.w,j=A.prefix;
var o=!S?"":r?S:S+" ";
var W=(r===null)?0:r.length;
W=0;
var B=o+(r||"");
if(A.para){
if(h.length){
c+=B+h.join("").replace(/^ +/,"")+s
}
if(z<v.length-1){
r=j;
o=!S?"":r?S:S+" ";
B=o+(r||"");
c+=B+s
}
h=[];
n=0;
r=null
}else{
if((W+n+d.length<=T)&&(j===r||r===null)&&!A.mustStart){
h.push(d);
n+=d.length;
r=j;
if(A.mustEnd&&v[z+1]){
v[z+1].mustStart=true
}}else{
if(h.length){
c+=B+h.join("").replace(/^ +/,"")+s
}
h=[d];
n=d.length;
r=j;
if(A.mustEnd&&v[z+1]){
v[z+1].mustStart=true
}}}}
if(h.length){
var o=!S?"":h[0].prefix?S:S+" ";
var B=o+(r||"");
c+=B+h.join("").replace(/^ /,"")+s
}
return[g,c,t].join("")
};
AjxStringUtil.quoteText=function(i){
if(!(i&&i.text)){
return""
}
var h=i.text;
var r=i.before||"",e=i.after||"";
if(i.htmlMode||!i.pre){
return[r,h,e].join("")
}
var n=i.len||80;
var a=i.pre||"";
var s="\n";
h=AjxStringUtil.trim(h);
h=h.replace(/\n\r/g,s);
var u=h.split(s);
var d=[];
for(var t=0,o=u.length;
t<o;
t++){
var c=AjxStringUtil.trim(u[t]);
d.push(a+c+s)
}
return r+d.join("")+e
};
AjxStringUtil.SHIFT_CHAR={
48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'};
AjxStringUtil.shiftChar=function(e,t){
return t?AjxStringUtil.SHIFT_CHAR[e]||String.fromCharCode(e):String.fromCharCode(e)
};
AjxStringUtil.diffPoint=function(o,a){
if(!(o&&a)){
return 0
}
var e=Math.min(o.length,a.length);
var t=0;
while(t<e&&(o.charAt(t)==a.charAt(t))){
t++
}
return t
};
AjxStringUtil.resolve=function(t,e){
return AjxMessageFormat.format(t,e)
};
AjxStringUtil.urlEncode=function(t){
if(!t){
return""
}
var e=window.encodeURL||window.encodeURI;
return e(t)
};
AjxStringUtil.urlComponentEncode=function(t){
if(!t){
return""
}
var e=window.encodeURLComponent||window.encodeURIComponent;
return e(t)
};
AjxStringUtil.urlDecode=function(i){
if(!i){
return""
}
var t=window.decodeURL||window.decodeURI;
try{
return t(i)
}
catch(a){
return""
}};
AjxStringUtil.urlComponentDecode=function(o){
if(!o){
return""
}
var a=window.decodeURLComponent||window.decodeURIComponent;
var t;
try{
t=a(o)
}
catch(i){
t=unescape(o)
}
return t||o
};
AjxStringUtil.ENCODE_MAP={
">":"&gt;","<":"&lt;","&":"&amp;"};
AjxStringUtil.htmlEncode=function(t,e){
if(!t){
return""
}
if(typeof(t)!="string"){
t=t.toString?t.toString():""
}
if(!AjxEnv.isSafari||AjxEnv.isSafariNightly){
if(e){
return t.replace(/[<>&]/g,function(a){
return AjxStringUtil.ENCODE_MAP[a]
}
).replace(/  /g," &nbsp;")
}else{
return t.replace(/[<>&]/g,function(a){
return AjxStringUtil.ENCODE_MAP[a]
}
)
}}else{
if(e){
return t.replace(/[&]/g,"&amp;").replace(/  /g," &nbsp;").replace(/[<]/g,"&lt;").replace(/[>]/g,"&gt;")
}else{
return t.replace(/[&]/g,"&amp;").replace(/[<]/g,"&lt;").replace(/[>]/g,"&gt;")
}}};
AjxStringUtil.encodeQuotes=function(e){
return e.replace(/"/g,"&quot;").replace(/'/g,"&#39;")
};
AjxStringUtil.htmlDecode=function(t,e){
if(e){
t=t.replace(/&nbsp;/g," ")
}
return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")
};
AjxStringUtil.__jsEscapeChar=function(t){
var e=t.charCodeAt(0).toString(16);
if(e.length==1){
return"\\u000"+e
}else{
if(e.length==2){
return"\\u00"+e
}else{
if(e.length==3){
return"\\u0"+e
}else{
if(e.length==4){
return"\\u"+e
}}}}
DBG.println(AjxDebug.NONE,"unexpected condition in AjxStringUtil.__jsEscapeChar -- code point 0x"+e+" doesn't fit in 16 bits")
};
AjxStringUtil.jsEncode=function(e){
return e.replace(/[^\u0020-\u007e]/g,AjxStringUtil.__jsEscapeChar)
};
AjxStringUtil.stripTags=function(t,e){
if(typeof t!=="string"){
return""
}
if(e){
t=t.replace(/(<(\w+)[^>]*>).*(<\/\2[^>]*>)/,"$1$3")
}
return t.replace(/<\/?[^>]+>/gi,"")
};
AjxStringUtil.convertToHtml=function(h,a,t,r){
t=t||"<blockquote>";
r=r||"</blockquote>";
if(!h){
return""
}
h=AjxStringUtil.htmlEncode(h);
if(a){
var o=/^(>|&gt;|\|\s+)/;
var c=h.split(/\r?\n/);
var e=0;
for(var n=0;
n<c.length;
n++){
var l=c[n];
if(l.length>0){
var s=0;
while(l.match(o)){
l=l.replace(o,"");
s++
}
while(s>e){
l=t+l;
e++
}
while(s<e){
c[n-1]=c[n-1]+r;
e--
}}
c[n]=l
}
while(e>0){
c.push(r);
e--
}
h=c.join("\n")
}
h=h.replace(/  /mg," &nbsp;").replace(/^ /mg,"&nbsp;").replace(/\t/mg,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\r?\n/mg,"<br>");
return h
};
AjxStringUtil.SPACE_ENCODE_MAP={
" ":"&nbsp;",">":"&gt;","<":"&lt;","&":"&amp;","\n":"<br>"};
AjxStringUtil.htmlEncodeSpace=function(e){
if(!e){
return""
}
return e.replace(/[&]/g,"&amp;").replace(/ /g,"&nbsp;").replace(/[<]/g,"&lt;").replace(/[>]/g,"&gt;")
};
AjxStringUtil.htmlRubyEncode=function(e,t){
if(e&&t){
return["<ruby>","<rb>",AjxStringUtil.htmlEncode(e),"</rb> ","<rp>(</rp><rt>",AjxStringUtil.htmlEncode(t),"</rt><rp>)</rp>","</ruby>"].join("")
}
return AjxStringUtil.htmlEncode(e||t||"")
};
AjxStringUtil.nl2br=function(e){
if(!e){
return""
}
return e.replace(/^ /mg,"&nbsp;").replace(/\t/mg,"<span style='white-space:pre'>\t</span>").replace(/\n/g,"<br>")
};
AjxStringUtil.xmlEncode=function(e){
if(e){
e=""+e;
return e.replace(/&/g,"&amp;").replace(/</g,"&lt;")
}
return""
};
AjxStringUtil.xmlDecode=function(e){
return e?e.replace(/&amp;/g,"&").replace(/&lt;/g,"<"):""
};
AjxStringUtil.xmlAttrEncode=function(e){
return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\x22/g,"&quot;").replace(/\x27/g,"&apos;"):""
};
AjxStringUtil.xmlAttrDecode=function(e){
return e?e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&apos;/g,"'"):""
};
AjxStringUtil.__RE_META={
" ":" ","\n":"\\n","\r":"\\r","\t":"\\t"};
AjxStringUtil.__reMetaEscape=function(t,e){
return AjxStringUtil.__RE_META[e]||"\\"+e
};
AjxStringUtil.regExEscape=function(e){
return e.replace(/(\W)/g,AjxStringUtil.__reMetaEscape)
};
AjxStringUtil._calcDIV=null;
AjxStringUtil.calcDIV=function(){
if(AjxStringUtil._calcDIV==null){
AjxStringUtil._calcDIV=document.createElement("div");
AjxStringUtil._calcDIV.style.zIndex=0;
AjxStringUtil._calcDIV.style.position=DwtControl.ABSOLUTE_STYLE;
AjxStringUtil._calcDIV.style.visibility="hidden";
document.body.appendChild(AjxStringUtil._calcDIV)
}
return AjxStringUtil._calcDIV
};
AjxStringUtil.clip=function(e,s,n){
var o=AjxStringUtil.calcDIV();
if(arguments.length==3){
o.className=n
}
o.innerHTML=e;
if(o.offsetWidth<=s){
return e
}
for(var a=e.length-1;
a>0;
a--){
var t=e.substr(0,a);
o.innerHTML=t+AjxStringUtil.ELLIPSIS;
if(o.offsetWidth<=s){
return t+AjxStringUtil.ELLIPSIS
}}
return e
};
AjxStringUtil.clipByLength=function(a,t){
var e=a.length;
return(e<=t)?a:[a.substr(0,t/2),"...",a.substring(e-((t/2)-3),e)].join("")
};
AjxStringUtil.wrap=function(n,s,r){
var u=AjxStringUtil.calcDIV();
if(arguments.length==3){
u.className=r
}
var h="";
var o="";
var e=n.split("/n");
for(var i=0;
i<e.length;
i++){
if(i!=0){
h+=o+"<br>";
o=""
}
htmlRows=e[i].split("<br>");
for(var c=0;
c<htmlRows.length;
c++){
if(c!=0){
h+=o+"<br>";
o=""
}
words=htmlRows[c].split(" ");
var d=0;
while(d<words.length){
u.innerHTML=o+" "+words[d];
var a=u.offsetWidth;
if(a>s){
u.innerHTML=words[d];
a=a-u.offsetWidth;
if((a>=s)||(u.offsetWidth<=s)){
h+=o+"<br>";
o=""
}else{
var l=true;
var t=0;
while(l){
t++;
u.innerHTML=o+" "+words[d].substring(0,t);
l=(u.offsetWidth<=s)
}
t--;
h+=o+words[d].substring(0,t)+"<br>";
words[d]=words[d].substr(t);
o=""
}}else{
o+=" "+words[d];
d++
}}}}
h+=o;
return h
};
AjxStringUtil.MSG_SEP_RE=new RegExp("^\\s*--+\\s*("+AjxMsg.origMsg+"|"+AjxMsg.forwardedMessage+")\\s*--+","i");
AjxStringUtil.SIG_RE=/^(- ?-+)|(__+)\r?$/;
AjxStringUtil.SPLIT_RE=/\r\n|\r|\n/;
AjxStringUtil.HDR_RE=/^\s*\w+:/;
AjxStringUtil.COLON_RE=/\S+:$/;
AjxStringUtil._NO_LIST=0;
AjxStringUtil._ORDERED_LIST=1;
AjxStringUtil._UNORDERED_LIST=2;
AjxStringUtil._INDENT="    ";
AjxStringUtil._NON_WHITESPACE=/\S+/;
AjxStringUtil._LF=/\n/;
AjxStringUtil.convertHtml2Text=function(i,n,o){
if(!i){
return""
}
if(n&&AjxUtil.isFunction(n._before)){
i=n._before(i)
}
if(typeof i=="string"){
var s=document.createElement("SPAN");
s.innerHTML=i;
i=s
}
var r=[];
var a=0;
var t={};
AjxStringUtil._traverse(i,r,a,AjxStringUtil._NO_LIST,0,0,t,n,o);
var e=r.join("");
if(n&&AjxUtil.isFunction(n._after)){
e=n._after(e)
}
return e
};
AjxStringUtil._traverse=function(e,f,d,l,r,n,s,c,u){
var h=e.nodeName.toLowerCase();
var p=null;
if(c&&c[h]){
p=c[h](e,s)
}
if(p!=null){
f[d++]=p
}else{
if(h=="#text"){
if(e.nodeValue.search(AjxStringUtil._NON_WHITESPACE)!=-1){
if(s.lastNode=="ol"||s.lastNode=="ul"){
f[d++]="\n"
}
if(s.isPreformatted){
f[d++]=AjxStringUtil.trim(e.nodeValue)+" "
}else{
f[d++]=AjxStringUtil.trim(e.nodeValue.replace(AjxStringUtil._LF," "),true)+" "
}}}else{
if(h=="p"){
f[d++]=u?"\n":"\n\n"
}else{
if(l==AjxStringUtil._NO_LIST&&(h=="br"||h=="hr")){
f[d++]="\n"
}else{
if(h=="ol"||h=="ul"){
f[d++]="\n";
if(e.parentNode.nodeName.toLowerCase()!="li"&&s.lastNode!="br"&&s.lastNode!="hr"){
f[d++]="\n"
}
l=(h=="ol")?AjxStringUtil._ORDERED_LIST:AjxStringUtil._UNORDERED_LIST;
r++;
n=0
}else{
if(h=="li"){
for(var a=0;
a<r;
a++){
f[d++]=AjxStringUtil._INDENT
}
if(l==AjxStringUtil._ORDERED_LIST){
f[d++]=n+". "
}else{
f[d++]="\u002A "
}}else{
if(h=="tr"&&e.parentNode.firstChild!=e){
f[d++]="\n"
}else{
if(h=="td"&&e.parentNode.firstChild!=e){
f[d++]="\t"
}else{
if(h=="div"||h=="address"){
if(d&&f[d-1]!=="\n"){
f[d++]="\n"
}}else{
if(h=="blockquote"){
f[d++]="\n\n"
}else{
if(h=="pre"){
if(d&&f[d-1]!=="\n"){
f[d++]="\n"
}
s.isPreformatted=true
}else{
if(h=="#comment"||h=="script"||h=="select"||h=="style"){
return d
}}}}}}}}}}}}
var m=e.childNodes;
var o=m.length;
for(var a=0;
a<o;
a++){
var t=m[a];
if(t.nodeType==1&&t.tagName.toLowerCase()=="li"){
n++
}
d=AjxStringUtil._traverse(t,f,d,l,r,n,s,c,u)
}
if(c&&c["/"+h]){
f[d++]=c["/"+h](e)
}
if(h=="h1"||h=="h2"||h=="h3"||h=="h4"||h=="h5"||h=="h6"||h=="div"||h=="address"){
if(d&&f[d-1]!=="\n"){
f[d++]="\n"
}
s.list=false
}else{
if(h=="pre"){
if(d&&f[d-1]!=="\n"){
f[d++]="\n"
}
s.isPreformatted=false
}else{
if(h=="li"){
if(!s.list){
f[d++]="\n"
}
s.list=false
}else{
if(h=="ol"||h=="ul"){
s.list=true
}else{
if(h!="#text"){
s.list=false
}}}}}
s.lastNode=h;
return d
};
AjxStringUtil.queryStringSet=function(r,l){
var h=l?"":location.search;
if(h.indexOf("?")==0){
h=h.substr(1)
}
var s=h.split("&");
var a={};
for(var o=0;
o<s.length;
o++){
var n=s[o].split("=");
a[n[0]]=n[1]
}
for(var e in r){
a[e]=r[e]
}
var t=[];
var o=0;
for(var e in a){
if(e){
t[o++]=[e,a[e]].join("=")
}}
return"?"+t.join("&")
};
AjxStringUtil.queryStringRemove=function(e,a){
e=e?e:"";
if(e.indexOf("?")==0){
e=e.substr(1)
}
var n=e.split("&");
var t=[];
for(var o=0;
o<n.length;
o++){
if(n[o].indexOf(a)!=0){
t.push(n[o])
}}
return"?"+t.join("&")
};
AjxStringUtil.getAsString=function(e){
return !e?"":(typeof(e)=="object")?e.toString():e
};
AjxStringUtil.isWhitespace=function(e){
return(e.charCodeAt(0)<=32)
};
AjxStringUtil.isDigit=function(t){
var e=t.charCodeAt(0);
return(e>=48&&e<=57)
};
AjxStringUtil.compareRight=function(o,t){
var n=0;
var r=0;
var s=0;
var i;
var e;
for(;
(r<o.length||s<t.length);
r++,s++){
i=o.charAt(r);
e=t.charAt(s);
if(!AjxStringUtil.isDigit(i)&&!AjxStringUtil.isDigit(e)){
return n
}else{
if(!AjxStringUtil.isDigit(i)){
return -1
}else{
if(!AjxStringUtil.isDigit(e)){
return +1
}else{
if(i<e){
if(n==0){
n=-1
}}else{
if(i>e){
if(n==0){
n=+1
}}}}}}}};
AjxStringUtil.natCompare=function(h,r){
var s=0,o=0;
var t=0,e=0;
var n,i;
while(s<h.length||o<r.length){
t=e=0;
n=h.charAt(s);
i=r.charAt(o);
while(AjxStringUtil.isWhitespace(n)||n=="0"){
t=(n=="0")?(t+1):0;
n=h.charAt(++s)
}
while(AjxStringUtil.isWhitespace(i)||i=="0"){
e=(i=="0")?(e+1):0;
i=r.charAt(++o)
}
if(AjxStringUtil.isDigit(n)&&AjxStringUtil.isDigit(i)){
var l=AjxStringUtil.compareRight(h.substring(s),r.substring(o));
if(l&&l!=0){
return l
}}
if(n==0&&i==0){
return t-e
}
if(n<i){
return -1
}else{
if(n>i){
return +1
}}
++s;
++o
}};
AjxStringUtil.clipFile=function(o,e){
var t=o.lastIndexOf(".");
if(t<=0){
t=o.length
}
if(t<=e){
return o
}
var i=o.slice(0,t);
var a=o.slice(t);
return[i.slice(0,e/2),AjxMsg.ellipsis,i.slice(-Math.ceil(e/2)+AjxMsg.ellipsis.length),a].join("")
};
AjxStringUtil.URL_PARSE_RE=new RegExp("^(?:([^:/?#.]+):)?(?://)?(([^:/?#]*)(?::(\\d*))?)?((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?");
AjxStringUtil.parseURL=function(a){
var n=["source","protocol","authority","domain","port","path","directoryPath","fileName","query","anchor"];
var o=AjxStringUtil.URL_PARSE_RE.exec(a);
var t={};
for(var e=0;
e<n.length;
e++){
t[n[e]]=(o[e]?o[e]:"")
}
if(t.directoryPath.length>0){
t.directoryPath=t.directoryPath.replace(/\/?$/,"/")
}
return t
};
AjxStringUtil.parseMailtoLink=function(a){
var t={};
if(!a){
return t
}
if(a.toLowerCase().indexOf("mailto:")===-1){
t.to=a;
return t
}
var e=a.match(/\bsubject=([^&]+)/i);
t.subject=e?decodeURIComponent(e[1]):null;
e=a.match(/\bto\:([^&]+)/);
if(!e){
e=a.match(/\bmailto\:([^\?]+)/i)
}
t.to=e?decodeURIComponent(e[1]):null;
e=a.match(/\bbody=([^&]+)/i);
t.body=e?decodeURIComponent(e[1]):null;
return t
};
AjxStringUtil.parseQueryString=function(n){
var h=n||(""+window.location);
var l=h.indexOf("?");
var s=(l===-1)?h:h.substring(l+1);
s=s.replace(/#.*$/,"");
var o=s.split("&");
var e={}
,t,c,r;
for(var a=0;
a<o.length;
a++){
t=o[a].split("=");
c=decodeURIComponent(t[0]),r=t[1]?decodeURIComponent(t[1]):true;
e[c]=r
}
return e
};
AjxStringUtil.prettyPrint=function(i,a,e,t){
AjxStringUtil._visited=new AjxVector();
var o=AjxStringUtil._prettyPrint(i,a,e,t);
AjxStringUtil._visited=null;
return o
};
AjxStringUtil._visited=null;
AjxStringUtil._prettyPrint=function(r,t,y,a){
var d=0;
var o=false;
var u=false;
if(arguments.length>4){
d=arguments[4];
o=arguments[5];
u=arguments[6]
}
if(AjxUtil.isObject(r)){
var p=r.toString?r.toString():"";
if(a&&p&&a[p]){
return"["+p+"]"
}
if(AjxStringUtil._visited.contains(r)){
return"[visited object]"
}else{
AjxStringUtil._visited.add(r)
}}
var s=AjxStringUtil.repeat(" ",d);
var h="";
if(r===undefined){
h+="[undefined]"
}else{
if(r===null){
h+="[null]"
}else{
if(AjxUtil.isBoolean(r)){
h+=r?"true":"false"
}else{
if(AjxUtil.isString(r)){
h+='"'+AjxStringUtil._escapeForHTML(r)+'"'
}else{
if(AjxUtil.isNumber(r)){
h+=r
}else{
if(AjxUtil.isObject(r)){
var n=AjxUtil.isArray(r)||AjxUtil.isArray1(r);
if(u){
h+=n?"[Array]":r.toString()
}else{
u=!t;
var l=new Array();
for(var m in r){
if(r.hasOwnProperty(m)){
l.push(m)
}}
if(n){
l.sort(function(v,i){
return v-i
}
)
}else{
l.sort()
}
if(o){
h+=n?"[":"{"
}
var f=l.length;
for(var m=0;
m<f;
m++){
var w=l[m];
var g=r[w];
var c=null;
if(g==window||g==document||(!AjxEnv.isIE&&g instanceof Node)){
c=g.toString()
}
if((typeof(g)=="function")){
if(y){
c="[function]"
}else{
continue
}}
if(m>0){
h+=","
}
h+="\n"+s;
var e;
if(n){
e="// ["+w+"]:\n"+s
}else{
e=w+": "
}
if(a&&a[w]){
h+=e+"["+w+"]"
}else{
if(c!=null){
h+=e+c
}else{
h+=e+AjxStringUtil._prettyPrint(g,t,y,a,d+2,true,u)
}}}
if(m>0){
h+="\n"+AjxStringUtil.repeat(" ",d-1)
}
if(o){
h+=n?"]":"}"
}}}}}}}}
return h
};
AjxStringUtil._escapeForHTML=function(t){
if(typeof(t)!="string"){
return t
}
var e=t;
e=e.replace(/\&/g,"&amp;");
e=e.replace(/\</g,"&lt;");
e=e.replace(/\>/g,"&gt;");
e=e.replace(/\"/g,"&quot;");
e=e.replace(/\xA0/g,"&nbsp;");
return e
};
AjxStringUtil._testSpan=null;
AjxStringUtil._testSpanBold=null;
AjxStringUtil.WIDTH={};
AjxStringUtil.WIDTH_BOLD={};
AjxStringUtil.MAX_CACHE=1000;
AjxStringUtil._cacheSize=0;
AjxStringUtil.getWidth=function(o,i,h){
if(!AjxStringUtil._testSpan){
var a=AjxStringUtil._testSpan=document.createElement("SPAN");
var t=AjxStringUtil._testSpanBold=document.createElement("SPAN");
a.style.position=t.style.position=Dwt.ABSOLUTE_STYLE;
var l=DwtShell.getShell(window).getHtmlElement();
l.appendChild(a);
l.appendChild(t);
Dwt.setLocation(a,Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE);
Dwt.setLocation(t,Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE);
t.style.fontWeight="bold"
}
if(AjxUtil.isString(h)){
h=DwtCssStyle.asPixelCount(h)
}
var n=""+(h||0);
var e=i?AjxStringUtil.WIDTH_BOLD:AjxStringUtil.WIDTH;
if(e[o]&&e[o][n]){
return e[o][n]
}
if(AjxStringUtil._cacheSize>=AjxStringUtil.MAX_CACHE){
AjxStringUtil.WIDTH={};
AjxStringUtil.WIDTH_BOLD={};
AjxStringUtil._cacheSize=0
}
var r=i?AjxStringUtil._testSpanBold:AjxStringUtil._testSpan;
r.innerHTML=o;
r.style.fontSize=h?(h+"px"):null;
if(!e[o]){
e[o]={}
}
var s=e[o][n]=Dwt.getSize(r).x;
AjxStringUtil._cacheSize++;
return s
};
AjxStringUtil.fixCrossDomainReference=function(t,i,a){
var n=AjxStringUtil.parseURL(t);
if(n.authority==window.location.host){
return t
}
if((i&&t.indexOf(i)>=0)||!i){
if(a){
t=n.path
}else{
var o=n.protocol+"://"+n.authority;
var e=window.location.protocol+"//"+window.location.host;
t=t.replace(o,e)
}}
return t
};
AjxStringUtil._dummyDiv=document.createElement("DIV");
AjxStringUtil.htmlPlatformIndependent=function(t){
var a=AjxStringUtil._dummyDiv;
a.innerHTML=t;
var e=a.innerHTML;
a.innerHTML="";
return e
};
AjxStringUtil.equalsHtmlPlatformIndependent=function(t,e){
return AjxStringUtil.htmlPlatformIndependent(t)==AjxStringUtil.htmlPlatformIndependent(e)
};
AjxStringUtil.ORIG_UNKNOWN="UNKNOWN";
AjxStringUtil.ORIG_QUOTED="QUOTED";
AjxStringUtil.ORIG_SEP_STRONG="SEP_STRONG";
AjxStringUtil.ORIG_SEP_WEAK="SEP_WEAK";
AjxStringUtil.ORIG_WROTE_STRONG="WROTE_STRONG";
AjxStringUtil.ORIG_WROTE_WEAK="WROTE_WEAK";
AjxStringUtil.ORIG_HEADER="HEADER";
AjxStringUtil.ORIG_LINE="LINE";
AjxStringUtil.ORIG_SIG_SEP="SIG_SEP";
AjxStringUtil.MSG_REGEXES=[{
type:AjxStringUtil.ORIG_QUOTED,regex:/^\s*(>|\|)/}
,{
type:AjxStringUtil.ORIG_SEP_STRONG,regex:new RegExp("^\\s*--+\\s*("+AjxMsg.origMsg+"|"+AjxMsg.forwardedMessage+"|"+AjxMsg.origAppt+")\\s*--+\\s*$","i")}
,{
type:AjxStringUtil.ORIG_SEP_STRONG,regex:new RegExp("^"+AjxMsg.forwardedMessage1+"$","i")}
,{
type:AjxStringUtil.ORIG_HEADER,regex:new RegExp("^\\s*("+[AjxMsg.from,AjxMsg.to,AjxMsg.subject,AjxMsg.date,AjxMsg.sent,AjxMsg.cc].join("|")+")")}
,{
type:AjxStringUtil.ORIG_LINE,regex:/^\s*_{5,}\s*$/}
];
AjxStringUtil.HTML_SEP_ID="zwchr";
AjxStringUtil.ORIG_EMAIL_RE=/[^@\s]+@[A-Za-z0-9\-]{2,}(\.[A-Za-z0-9\-]{2,})+/;
AjxStringUtil.ORIG_DATE_RE=/\d+\s*(\/|\-|, )20\d\d/;
AjxStringUtil.ORIG_INTRO_RE=new RegExp("^(-{2,}|"+AjxMsg.on+"\\s+)","i");
AjxStringUtil._writeToTestIframeDoc=function(t){
var a;
if(!AjxStringUtil.__curIframeId){
a=document.createElement("IFRAME");
AjxStringUtil.__curIframeId=a.id=Dwt.getNextId();
Dwt.setPosition(a,Dwt.ABSOLUTE_STYLE);
Dwt.setLocation(a,Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE);
a.setAttribute("aria-hidden",true);
document.body.appendChild(a)
}else{
a=document.getElementById(AjxStringUtil.__curIframeId)
}
var e=Dwt.getIframeDoc(a);
t=t&&t.replace(AjxStringUtil.IMG_SRC_CID_REGEX,'<img $1 pnsrc="cid:');
e.open();
e.write(t);
e.close();
return e.childNodes[0]
};
AjxStringUtil._removeTestIframeDoc=function(){
if(AjxEnv.isFirefox){
var e=document.getElementById(AjxStringUtil.__curIframeId);
if(e){
e.parentNode.removeChild(e)
}
AjxStringUtil.__curIframeId=null
}};
AjxStringUtil.getOriginalContent=function(u,d){
if(!u){
return""
}
if(d){
return AjxStringUtil._getOriginalHtmlContent(u)
}
var f=[];
var e=u.split(AjxStringUtil.SPLIT_RE);
var a,c=[],n={}
,s,g,m=false;
for(var w=0;
w<e.length;
w++){
var l=e[w];
var v=AjxStringUtil.trim(l);
if(!AjxStringUtil._NON_WHITESPACE.test(v)){
c.push(l);
continue
}
if((v.indexOf("| DO NOT REPLY")===0)&&(e[w+2].indexOf("bugzilla")!==-1)){
m=true
}
var t=AjxStringUtil._getLineType(v);
if(t===AjxStringUtil.ORIG_QUOTED){
t=m?AjxStringUtil.ORIG_UNKNOWN:t
}else{
m=false
}
var x=e[w+1];
var s=false;
if(x&&(t===AjxStringUtil.ORIG_UNKNOWN)&&AjxStringUtil.ORIG_INTRO_RE.test(v)&&x.match(/\w+:$/)){
v=[v,x].join(" ");
t=AjxStringUtil._getLineType(v);
s=true
}
if(t===AjxStringUtil.ORIG_LINE){
var y=w+1;
x=e[y];
while(!AjxStringUtil._NON_WHITESPACE.test(x)&&y<e.length){
x=e[++y]
}
var p=x&&AjxStringUtil._getLineType(x);
if(p===AjxStringUtil.ORIG_HEADER){
t=AjxStringUtil.ORIG_HEADER
}else{
t=AjxStringUtil.ORIG_UNKNOWN
}}
if(a){
if(a!==t){
f.push({
type:a,block:c}
);
g=(a===AjxStringUtil.ORIG_UNKNOWN)?c:g;
n[a]=n[a]?n[a]+1:1;
c=[];
a=t
}}else{
a=t
}
if(s&&(t===AjxStringUtil.ORIG_WROTE_WEAK||t===AjxStringUtil.ORIG_WROTE_STRONG)){
c.push(l);
c.push(x);
w++;
s=false
}else{
c.push(l)
}}
if(c.length){
f.push({
type:a,block:c}
);
g=(a===AjxStringUtil.ORIG_UNKNOWN)?c:g;
n[a]=n[a]?n[a]+1:1
}
var o=f[0],k=f[1];
if(o&&o.type===AjxStringUtil.ORIG_UNKNOWN&&k&&(k.type===AjxStringUtil.ORIG_HEADER||k.type===AjxStringUtil.ORIG_WROTE_STRONG)){
var q=AjxStringUtil._getTextFromBlock(o.block);
if(q){
return q
}}
var q=AjxStringUtil._checkInlineWrote(n,f,false);
if(q){
return q
}
if(n[AjxStringUtil.ORIG_UNKNOWN]===1&&n[AjxStringUtil.ORIG_QUOTED]>0){
var q=AjxStringUtil._getTextFromBlock(g);
if(q){
return q
}}
if(n[AjxStringUtil.ORIG_SEP_STRONG]>0){
var r=[];
for(var w=0;
w<f.length;
w++){
var h=f[w];
if(h.type===AjxStringUtil.ORIG_SEP_STRONG){
break
}
r=r.concat(h.block)
}
var q=AjxStringUtil._getTextFromBlock(r);
if(q){
return q
}}
return u
};
AjxStringUtil._getLineType=function(o){
var n=AjxStringUtil.ORIG_UNKNOWN;
for(var a=0;
a<AjxStringUtil.MSG_REGEXES.length;
a++){
var i=AjxStringUtil.MSG_REGEXES[a];
var s=i.regex;
if(s.test(o.toLowerCase())){
if(i.type==AjxStringUtil.ORIG_QUOTED&&/^\s*\|.*\|\s*$/.test(o)){
continue
}
n=i.type;
break
}}
if(n===AjxStringUtil.ORIG_UNKNOWN){
var t=o.match(/(\w+):$/);
var e=t&&t[1]&&t[1].toLowerCase();
if(e){
var r=0;
r=r+(e===AjxMsg.wrote)?5:(e===AjxMsg.changed)?0:2;
if(AjxStringUtil.ORIG_EMAIL_RE.test(o)){
r+=4
}
if(AjxStringUtil.ORIG_DATE_RE.test(o)){
r+=3
}
var h=new RegExp("^(--|"+AjxMsg.on+")","i");
if(AjxStringUtil.ORIG_INTRO_RE.test(o)){
r+=1
}
if(r>=7){
n=AjxStringUtil.ORIG_WROTE_STRONG
}else{
if(r>=5){
n=AjxStringUtil.ORIG_WROTE_WEAK
}}}}
return n
};
AjxStringUtil._getTextFromBlock=function(t){
if(!(t&&t.length)){
return null
}
var e=t.join("\n")+"\n";
e=e.replace(/\s+$/,"\n");
return(AjxStringUtil._NON_WHITESPACE.test(e))?e:null
};
AjxStringUtil.SCRIPT_REGEX=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;
AjxStringUtil.IGNORE_NODE_LIST=["#comment","br","script","select","style"];
AjxStringUtil.IGNORE_NODE=AjxUtil.arrayAsHash(AjxStringUtil.IGNORE_NODE_LIST);
AjxStringUtil._getOriginalHtmlContent=function(c){
while(AjxStringUtil.SCRIPT_REGEX.test(c)){
c=c.replace(AjxStringUtil.SCRIPT_REGEX,"")
}
var s=AjxStringUtil._writeToTestIframeDoc(c);
var d=false,w=[];
AjxStringUtil._flatten(s,w);
var r=w.length,y,f=[],n={}
,t,m,e,o,a,l;
for(y=0;
y<r;
y++){
t=w[y];
if(t.nodeType===AjxUtil.ELEMENT_NODE){
t.normalize()
}
e=t.nodeName.toLowerCase();
o=AjxStringUtil._checkNode(w[y]);
if(o===AjxStringUtil.ORIG_UNKNOWN&&t.nodeName==="#text"&&(AjxStringUtil.ORIG_DATE_RE.test(t.nodeValue)||AjxStringUtil.ORIG_INTRO_RE.test(t.nodeValue))){
var p=t.nodeValue;
for(var g=1;
g<10;
g++){
var u=w[y+g];
if(u&&u.nodeName==="#text"){
p+=u.nodeValue;
if(/:$/.test(p)){
o=AjxStringUtil._getLineType(AjxStringUtil.trim(p));
if(o===AjxStringUtil.ORIG_WROTE_STRONG){
y=y+g;
break
}}}}}
if(o!==null){
f.push({
type:o,node:t,nodeName:e}
);
n[o]=n[o]?n[o]+1:1;
if(o===AjxStringUtil.ORIG_SEP_STRONG||o===AjxStringUtil.ORIG_WROTE_STRONG){
l=t;
d=true;
break
}
if(o===AjxStringUtil.ORIG_HEADER&&a===AjxStringUtil.ORIG_LINE){
l=m;
d=true;
break
}
m=t;
a=o
}}
if(l){
AjxStringUtil._prune(l,true)
}
var h=d?"<html>"+s.innerHTML+"</html>":c;
AjxStringUtil._removeTestIframeDoc();
return h
};
AjxStringUtil._flatten=function(o,n){
n.push(o);
var t=o.childNodes||[];
for(var e=0;
e<t.length;
e++){
var a=t[e],s=a.nodeName.toLowerCase();
if(s!=="blockquote"&&!AjxStringUtil.IGNORE_NODE[s]){
this._flatten(a,n)
}}};
AjxStringUtil._prune=function(t,e){
var a=t&&t.parentNode;
while(a&&a.lastChild&&a.lastChild!==t){
a.removeChild(a.lastChild)
}
if(e&&a&&a.lastChild===t){
a.removeChild(a.lastChild)
}
var i=a&&a.nodeName.toLowerCase();
if(a&&i!=="body"&&i!=="html"){
AjxStringUtil._prune(a,false)
}};
AjxStringUtil._checkNode=function(t){
if(!t){
return null
}
var o=t.nodeName.toLowerCase();
var e=null;
if(o==="#text"){
var a=AjxStringUtil.trim(t.nodeValue);
if(AjxStringUtil._NON_WHITESPACE.test(a)){
e=AjxStringUtil._getLineType(a)
}}else{
if(o==="hr"){
if(t.id===AjxStringUtil.HTML_SEP_ID||(t.size==="2"&&t.width==="100%"&&t.align==="center")){
e=AjxStringUtil.ORIG_SEP_STRONG
}else{
e=AjxStringUtil.ORIG_LINE
}}else{
if(o==="pre"){
e=AjxStringUtil._checkNodeContent(t)
}else{
if(o==="div"){
if(t.className==="OutlookMessageHeader"||t.className==="gmail_quote"){
e=AjxStringUtil.ORIG_SEP_STRONG
}else{
if(t.style.borderTop){
var i=DwtCssStyle.getComputedStyleObject(t);
if(i&&i.borderTopWidth&&parseInt(i.borderTopWidth)===1&&i.borderTopColor){
e=AjxStringUtil.ORIG_SEP_STRONG
}}}
e=e||AjxStringUtil._checkNodeContent(t)
}else{
if(o==="span"){
e=e||AjxStringUtil._checkNodeContent(t)
}else{
if(o==="img"){
e=AjxStringUtil.ORIG_UNKNOWN
}else{
if(o==="blockquote"){
e=AjxStringUtil.ORIG_QUOTED
}}}}}}}
return e
};
AjxStringUtil._checkNodeContent=function(a){
var t=a.textContent||"";
if(!AjxStringUtil._NON_WHITESPACE.test(t)||t.length>200){
return null
}
var e=AjxStringUtil._getLineType(t);
return(e===AjxStringUtil.ORIG_SEP_STRONG||e===AjxStringUtil.ORIG_WROTE_STRONG)?e:null
};
AjxStringUtil.checkForCleanHtml=function(a,o,n){
a=a.replace(new RegExp("hrefs*=s*(['\"])s*#((?!\\1).)*\\1","g"),"");
var s=AjxStringUtil._writeToTestIframeDoc(a);
var t={
allowedTags:AjxUtil.arrayAsHash(o),untrustedAttrs:n||[]};
AjxStringUtil._traverseCleanHtml(s,t);
var e="<html>"+s.innerHTML+"</html>";
var i=Math.max(s.scrollWidth,s.lastChild.scrollWidth);
AjxStringUtil._removeTestIframeDoc();
return{
html:e,width:i,useIframe:t.fail}
};
AjxStringUtil._traverseCleanHtml=function(o,d){
var t=true;
var m=o.nodeName.toLowerCase();
if(m==="style"&&o.innerHTML==="p { margin: 0; }"){
o.doDelete=true
}else{
if(m==="title"&&!o.innerHTML){}else{
if(d.allowedTags[m]){
if(o.style){
var a=o.style&&o.style.cssText;
a=a.toLowerCase();
if(!AjxStringUtil._checkStyle(a)){
t=false
}
o.style.cssText=AjxStringUtil._fixStyle(a)
}
if(o.removeAttribute&&o.attributes&&o.attributes.length){
for(var s=0;
s<d.untrustedAttrs.length;
s++){
if(o.hasAttribute(d.untrustedAttrs[s])){
t=false
}}
for(var s=0,f=o.attributes,n=f.length;
s<n;
s++){
var c=f.item(s);
if(!c){
continue
}
var u=c.nodeName&&c.nodeName.toLowerCase();
if(u&&u.indexOf("on")===0){
o.removeAttribute(u);
continue
}
var r=c.nodeValue&&String(c.nodeValue);
if(r){
r=r.toLowerCase();
if(m==="table"&&(u==="cellpadding"||u==="cellspacing"||u==="border")&&r!=="0"){
t=false
}}}}}else{
t=false
}}}
for(var s=0,h=o.childNodes.length;
s<h;
s++){
var e=o.childNodes[s];
AjxStringUtil._traverseCleanHtml(e,d)
}
for(var s=o.childNodes.length-1;
s>=0;
s--){
var e=o.childNodes[s];
if(e.doDelete){
o.removeChild(e)
}}
if(!t){
d.fail=true
}};
AjxStringUtil._checkStyle=function(e){
if(e.match(/\bposition\s*:\s*absolute[^;]*;?/)){
return false
}
if(e.match(/\bfont-[^;]*;?/)){
return false
}
return true
};
AjxStringUtil._fixStyle=function(e){
e=e.replace(/\bmargin-?(top|left|right|bottom)?\s*:[^;]*-\d+[^;]*;?/gi,"");
e=e.replace(/\bpadding-?(top|left|right|bottom)?\s*:[^;]*-\d+[^;]*;?/gi,"");
return e
};
AjxStringUtil._checkInlineWrote=function(r,n){
if(r[AjxStringUtil.ORIG_WROTE_STRONG]>0){
var c,a=false,e={};
for(var s=0;
s<n.length;
s++){
var d=n[s],h=d.type;
if(h===AjxStringUtil.ORIG_WROTE_STRONG){
a=true
}else{
if(h===AjxStringUtil.ORIG_UNKNOWN&&!a){
if(c){
return null
}else{
c=d.block
}}else{
if(a){
e[h]=true
}}}}
var l=(e[AjxStringUtil.ORIG_UNKNOWN]&&e[AjxStringUtil.ORIG_QUOTED]);
var t=(r[AjxStringUtil.ORIG_UNKNOWN]===2&&n[n.length-1].type===AjxStringUtil.ORIG_UNKNOWN);
if(c&&(!l||t)){
var o=AjxStringUtil._getTextFromBlock(c);
if(o){
return o
}}}};
AjxStringUtil.trimHtml=function(i){
if(!i){
return""
}
var a=i;
a=a.replace(AjxStringUtil.DOC_TAG_REGEX,"");
a=a.replace(/<div><br ?\/?><\/div>/gi,"<br>");
var t=0;
while(a.length!==t&&(/^<br ?\/?>/i.test(a)||/<br ?\/?>$/i.test(a))){
t=a.length;
a=a.replace(/^<br ?\/?>/i,"").replace(/<br ?\/?>$/i,"")
}
var e=a&&a.match(/((<br ?\/?>)+)((<\/\w+>)+)$/i);
if(e&&e.length){
var o=new RegExp(e[1]+e[3]+"$","i");
a=a.replace(o,e[3])
}
a=a.replace(/(<div><\/div>)+/gi,"");
return AjxStringUtil.trim(a)
};
AjxStringUtil.DOC_TAG_REGEX=/<\/?(html|head|body)>/gi;
AjxStringUtil.defangHtmlContent=function(n){
var r=AjxStringUtil._writeToTestIframeDoc(n);
var e=r.getElementsByTagName("img");
if(e&&e.length){
var h;
var t;
for(var o=0;
o<e.length;
o++){
h=e[o];
t=h.getAttribute("dfsrc");
if(t&&(t!=="#")){
h.setAttribute("src",t)
}
h.removeAttribute("dfsrc")
}}
var s="";
var a=r.childNodes;
for(var o=0;
o<a.length;
o++){
if(a[o].tagName&&(a[o].tagName.toLowerCase()==="body")){
s=a[o].innerHTML;
break
}}
AjxStringUtil._removeTestIframeDoc();
return s
}
}
if(AjxPackage.define("ajax.xml.AjxXmlDoc")){
AjxXmlDoc=function(){
if(!AjxXmlDoc._inited){
AjxXmlDoc._init()
}};
AjxXmlDoc.prototype.isAjxXmlDoc=true;
AjxXmlDoc.prototype.toString=function(){
return"AjxXmlDoc"
};
AjxXmlDoc.INVALID_CHARS_RE=/[\u0000-\u0008\u000B-\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE-\uFFFF]/g;
AjxXmlDoc.REC_AVOID_CHARS_RE=/[\u007F-\u0084\u0086-\u009F\uFDD0-\uFDDF]/g;
AjxXmlDoc._inited=false;
AjxXmlDoc._msxmlVers=null;
AjxXmlDoc._useDOM=Boolean(document.implementation&&document.implementation.createDocument);
AjxXmlDoc._useActiveX=!AjxXmlDoc._useDOM&&Boolean(window.ActiveXObject);
AjxXmlDoc.create=function(){
var t=new AjxXmlDoc();
var e=null;
if(AjxXmlDoc._useActiveX){
e=new ActiveXObject(AjxXmlDoc._msxmlVers);
e.async=true;
if(AjxXmlDoc._msxmlVers=="MSXML2.DOMDocument.4.0"){
e.setProperty("SelectionLanguage","XPath");
e.setProperty("SelectionNamespaces","xmlns:zimbra='urn:zimbra' xmlns:mail='urn:zimbraMail' xmlns:account='urn:zimbraAccount'")
}}else{
if(AjxXmlDoc._useDOM){
e=document.implementation.createDocument("","",null)
}else{
throw new AjxException("Unable to create new Doc",AjxException.INTERNAL_ERROR,"AjxXmlDoc.create")
}}
t._doc=e;
return t
};
AjxXmlDoc.createFromDom=function(t){
var e=new AjxXmlDoc();
e._doc=t;
return e
};
AjxXmlDoc.createFromXml=function(e){
var t=AjxXmlDoc.create();
t.loadFromString(e);
return t
};
AjxXmlDoc.replaceInvalidChars=function(e){
AjxXmlDoc.INVALID_CHARS_RE.lastIndex=0;
return e.replace(AjxXmlDoc.INVALID_CHARS_RE,"?")
};
AjxXmlDoc.getXml=function(a){
if(!a){
return""
}
var t=a.xml;
if(!t){
var e=new XMLSerializer();
t=e.serializeToString(a)
}
return AjxXmlDoc.replaceInvalidChars(t)
};
AjxXmlDoc.prototype.getDoc=function(){
return this._doc
};
AjxXmlDoc.prototype.loadFromString=function(t){
var e=this._doc;
e.loadXML(t);
if(AjxXmlDoc._useActiveX){
if(e.parseError.errorCode!=0){
throw new AjxException(e.parseError.reason,AjxException.INVALID_PARAM,"AjxXmlDoc.loadFromString")
}}};
AjxXmlDoc.prototype.loadFromUrl=function(e){
if(AjxEnv.isChrome||AjxEnv.isSafari){
var t=new window.XMLHttpRequest();
t.open("GET",e,false);
t.send(null);
var a=t.responseXML;
this._doc=a
}else{
this._doc.load(e)
}};
AjxXmlDoc.prototype.toJSObject=function(a,t,e){
_node=function(){
this.__msh_content=""
};
_node.prototype.toString=function(){
return this.__msh_content
};
rec=function(l,c){
var r={}
,h,d;
for(l=l.firstChild;
l;
l=l.nextSibling){
if(l.nodeType==1){
h=l.tagName;
if(a){
h=h.replace(/^.*?:/,"")
}
if(t){
h=h.toLowerCase()
}
d=new _node();
if(r[h]){
if(r[h]==1){
c[h]=[c[h]];
r[h]=2
}
c[h].push(d)
}else{
c[h]=d;
r[h]=1
}
if(e){
if(l.attributes&&l.attributes.length){
for(var s=0;
s<l.attributes.length;
s++){
attr=l.attributes[s];
d[attr.name]=AjxUtil.isNumeric(attr.value)?attr.value:String(attr.value)
}}}
rec(l,d)
}else{
if(l.nodeType==3){
c.__msh_content+=l.nodeValue
}}}};
var i=new _node();
rec(this._doc.documentElement,i);
return i
};
AjxXmlDoc.prototype.getElementsByTagNameNS=function(t,e){
var a=this.getDoc();
return !a.getElementsByTagNameNS?a.getElementsByTagName(t+":"+e):a.getElementsByTagNameNS(t,e)
};
AjxXmlDoc.prototype.getFirstElementByTagNameNS=function(t,e){
return this.getElementsByTagNameNS(t,e)[0]
};
AjxXmlDoc.prototype.getElementsByTagName=function(e){
var t=this.getDoc();
return t.getElementsByTagName(e)
};
AjxXmlDoc._init=function(){
if(AjxXmlDoc._useActiveX){
var e=["MSXML4.DOMDocument","MSXML3.DOMDocument","MSXML2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XmlDom"];
for(var a=0;
a<e.length;
a++){
try{
new ActiveXObject(e[a]);
AjxXmlDoc._msxmlVers=e[a];
break
}
catch(t){}}
if(!AjxXmlDoc._msxmlVers){
throw new AjxException("MSXML not installed",AjxException.INTERNAL_ERROR,"AjxXmlDoc._init")
}}else{
if(!Document.prototype.loadXML){
Document.prototype.loadXML=function(l){
var h=new DOMParser();
var n=h.parseFromString(l,"text/xml");
while(this.hasChildNodes()){
this.removeChild(this.lastChild)
}
var o=n.childNodes.length;
for(var s=0;
s<o;
s++){
var r=this.importNode(n.childNodes[s],true);
this.appendChild(r)
}};
if(AjxEnv.isNav){
_NodeGetXml=function(){
var i=new XMLSerializer();
return i.serializeToString(this)
};
Node.prototype.__defineGetter__("xml",_NodeGetXml)
}}}
AjxXmlDoc._inited=true
};
AjxXmlDoc.prototype.set=function(e,i,t){
var o=this._doc.createElement(e);
if(i!=null){
var a=this._doc.createTextNode("");
o.appendChild(a);
a.nodeValue=i
}
if(t==null){
this.root.appendChild(o)
}else{
t.appendChild(o)
}
return o
};
AjxXmlDoc.prototype.getXml=function(){
return AjxXmlDoc.getXml(this.getDoc())
};
AjxXmlDoc.prototype.getDocXml=AjxXmlDoc.prototype.getXml;
AjxXmlDoc.createRoot=function(a){
var e=AjxXmlDoc.create();
var t=e.getDoc();
e.root=t.createElement(a);
t.appendChild(e.root);
return e
};
AjxXmlDoc.createElement=function(t,i){
var e=AjxXmlDoc.create();
var o=e.getDoc();
e.root=o.createElement(t);
if(i!=null){
var a=o.createTextNode("");
e.root.appendChild(a);
a.nodeValue=i
}
o.appendChild(e.root);
return e
};
AjxXmlDoc.prototype.appendChild=function(e){
if(this._doc!=e._doc&&(AjxEnv.isChrome||AjxEnv.isSafari)){
this.root.appendChild(this.getDoc().importNode(e.root,true))
}else{
this.root.appendChild(e.root)
}}
}
if(AjxPackage.define("ajax.core.AjxImg")){
AjxImg=function(){};
AjxImg.prototype=new Object;
AjxImg.prototype.constructor=null;
AjxImg._VIEWPORT_ID="AjxImg_VP";
AjxImg.DISABLED=true;
AjxImg.RE_COLOR=/^(.*?),color=(.*)$/;
AjxImg.setImage=function(h,u,f,r,a){
if(!h){
return
}
a=a||[];
var d=u;
var o,t=u&&u.match(AjxImg.RE_COLOR);
if(t){
u=t&&t[1];
o=t&&t[2]
}
var c=AjxImg.getClassForImage(u,r);
if(f){
a.push(c);
h.className=a.join(" ");
return
}
var e=h.firstChild&&h.firstChild.id;
var p=c+"Overlay";
var l=c+"Mask";
if(o&&window.AjxImgData&&AjxImgData[p]&&AjxImgData[l]){
o=(o.match(/^\d$/)?ZmOrganizer.COLOR_VALUES[o]:o)||ZmOrganizer.COLOR_VALUES[ZmOrganizer.ORG_DEFAULT_COLOR];
h.innerHTML=AjxImg.getImageHtml({
imageName:d,attrStr:e?"id='"+e+"'":null,disabled:r}
);
return
}
if(h.firstChild==null||h.firstChild.nodeName.toLowerCase()!="div"){
var s=[],n=0;
s[n++]="<div ";
if(e){
s[n++]=" id='";
s[n++]=e;
s[n++]="' "
}
if(c){
a.push(c)
}
s[n++]=AjxUtil.getClassAttr(a);
s[n++]="></div>";
h.innerHTML=s.join("");
return
}else{
if(AjxEnv.isIE&&!AjxEnv.isIE9up){
h.firstChild.innerHTML=""
}}
if(c){
a.push(c)
}
h.firstChild.className=a.join(" ")
};
AjxImg.setDisabledImage=function(a,i,e,t){
return AjxImg.setImage(a,i,e,true,t)
};
AjxImg.getClassForImage=function(a,t){
var e=a?"Img"+a:"";
if(t){
e+=" ZDisabledImage"
}
return e
};
AjxImg.getImageClass=function(e){
return e.firstChild?e.firstChild.className:e.className
};
AjxImg.getImageElement=function(e){
return e.firstChild?e.firstChild:e
};
AjxImg.getParentElement=function(e){
return e.parentNode
};
AjxImg.GET_IMAGE_HTML_PARAMS=["imageName","styles","attrStr","wrapInTable","disabled","classes","altText"];
AjxImg.getImageHtml=function(){
var D=Dwt.getParams(arguments,AjxImg.GET_IMAGE_HTML_PARAMS);
var O=D.imageName;
var r=D.styles||"";
var d=r?" style='"+r+"'":"";
var f=D.attrStr?" "+D.attrStr:"";
var o=D.disabled;
var C=D.classes||[];
var n=D.altText;
var y=D.wrapInTable?"<table style='display:inline' cellpadding=0 cellspacing=0 border=0><tr><td align=center valign=bottom>":"";
var l="";
var z=D.wrapInTable?"</td></tr></table>":"";
if(O){
var q,v=O.match(AjxImg.RE_COLOR);
if(v){
O=v&&v[1];
q=v&&v[2]
}
var a=AjxImg.getClassForImage(O,o);
var B=a+"Overlay";
var u=a+"Mask";
if(q&&window.AjxImgData&&AjxImgData[B]&&AjxImgData[u]){
q=(q.match(/^\d$/)?ZmOrganizer.COLOR_VALUES[q]:q)||ZmOrganizer.COLOR_VALUES[ZmOrganizer.ORG_DEFAULT_COLOR];
var A=AjxImgData[B],j=AjxImgData[u];
if(n){
f+=" alt='"+AjxStringUtil.encodeQuotes(n)+"'"
}
if(AjxEnv.isIE&&!AjxEnv.isIE9up){
var g=["width:",A.w,"px;","height:",A.h,"px;"].join("");
var e=["top:",j.t,";","left:",j.l,";"].join("");
var W=["clip:rect(",(-1*j.t)-1,"px,",A.w-1,"px,",(j.t*-1)+A.h-1,"px,",A.l,"px);"].join("");
var h="filter:mask(color="+q+");";
l=["<div class='IEImage' style='display:inline-block;zoom:1;position:relative;overflow:hidden;",g,r,"' ",f,">","<div class='IEImageMask' style='position:absolute;top:0px;left:0px;",g,"'>","<img src='",j.ief,"?v=",window.cacheKillerVersion,"' border=0 style='position:absolute;",e,h,"'>","</div>","<div class='IEImageOverlay ",B,"' style='",g,"position:absolute;top:0;left:0;'></div>","</div>"].join("")
}else{
if(!A[q]){
var w=A.w,p=A.h;
var i=document.createElement("CANVAS");
i.width=w;
i.height=p;
var k=i.getContext("2d");
k.save();
k.clearRect(0,0,w,p);
k.save();
var x=f;
if(!x){
x=Dwt.getNextId("CANVAS_IMG_");
f=" id='"+x+"'"
}else{
var s=f.match(/id=[\"\']([^\"\']+)[\"\']+/);
if(s&&s.length>1){
x=s[1]
}
AjxDebug.println(AjxDebug.TAG_ICON,"imgId = "+x)
}
var t=document.getElementById(u);
var T=document.getElementById(B);
if(!t.complete||!T.complete){
AjxDebug.println(AjxDebug.TAG_ICON,"mask status = "+t.complete+" for "+x);
AjxDebug.println(AjxDebug.TAG_ICON,"overlay status = "+T.complete+" for "+x);
var c=new Image();
c.onload=function(){
AjxDebug.println(AjxDebug.TAG_ICON,"mask image loaded");
var m=new Image();
m.onload=function(){
AjxImg._drawCanvasImage(k,c,m,j,A,q,w,p);
AjxDebug.println(AjxDebug.TAG_ICON,"overlay image loaded");
var S=document.getElementById(x);
if(S){
AjxDebug.println(AjxDebug.TAG_ICON,"element found for id = "+x);
S.src=i.toDataURL();
A[q]=i.toDataURL()
}else{
AjxDebug.println(AjxDebug.TAG_ICON,"no element found for id = "+x)
}};
m.src=document.getElementById(B).src
};
c.src=document.getElementById(u).src
}else{
AjxImg._drawCanvasImage(k,t,T,j,A,q,w,p);
A[q]=i.toDataURL()
}}
l=["<img src='",A[q],"'"," border=0 ",AjxUtil.getClassAttr(C),d,f,">"].join("")
}}else{
C.push("Img"+O);
l=["<div ",AjxUtil.getClassAttr(C),d,f,">"];
if(n){
l.push("<span class='ScreenReaderOnly'>",AjxStringUtil.htmlEncode(n),"</span>")
}
l.push("</div>");
l=l.join("")
}}else{
l=["<div",d,f,">"];
if(n){
l.push("<span class='ScreenReaderOnly'>",AjxStringUtil.htmlEncode(n),"</span>")
}
l.push("</div>");
l=l.join("")
}
return y||z?[y,l,z].join(""):l
};
AjxImg.getImageSpanHtml=function(o,n,t,a,e){
e=e||"inlineIcon";
var i=["<span style='white-space:nowrap'>","<span class='",e,"'>",AjxImg.getImageHtml(o,n,t),(a||""),"</span>","</span>"];
return i.join("")
};
AjxImg._drawCanvasImage=function(a,s,r,t,o,i,n,e){
a.drawImage(s,t.l,t.t);
a.globalCompositeOperation="source-out";
a.fillStyle=i;
a.fillRect(0,0,n,e);
a.restore();
a.drawImage(r,o.l,o.t);
a.restore()
}
}
if(AjxPackage.define("ajax.core.AjxColor")){
AjxColor=function(a,t,e){
if(arguments.length==0){
return
}
this.r=a;
this.g=t;
this.b=e
};
AjxColor.prototype.toString=function(){
return AjxColor.color(this.r,this.g,this.b)
};
AjxColor.components=function(t){
var e=AjxColor.__RE.exec(t);
return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null
};
AjxColor.color=function(a,t,e){
return["#",AjxColor.__pad(Number(Math.round(a)).toString(16),2),AjxColor.__pad(Number(Math.round(t)).toString(16),2),AjxColor.__pad(Number(Math.round(e)).toString(16),2)].join("")
};
AjxColor.lighten=function(e,a){
var t=AjxColor.components(e);
return t?AjxColor.color(AjxColor.__lighten(t[0],a),AjxColor.__lighten(t[1],a),AjxColor.__lighten(t[2],a)):""
};
AjxColor.darken=function(e,a){
var t=AjxColor.components(e);
return t?AjxColor.color(AjxColor.__darken(t[0],a),AjxColor.__darken(t[1],a),AjxColor.__darken(t[2],a)):""
};
AjxColor.deepen=function(e,a){
var s=AjxColor.components(e);
var t=0;
for(var o=1;
o<s.length;
o++){
if(s[o]>s[t]){
t=o
}}
for(var o=0;
o<s.length;
o++){
var n=s[t]?(s[o]/s[t]):1;
s[o]=Math.floor(s[o]*n*(a||1))
}
return AjxColor.color(s[0],s[1],s[2])
};
AjxColor.__RE=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})/i;
AjxColor.__pad=function(n,a,o){
if(!o){
o="0"
}
var t=String(n);
for(var e=t.length;
e<a;
e++){
t=o+t
}
return t
};
AjxColor.__lighten=function(e,t){
return Math.max(0,Math.min(255,e+(255-e)*t))
};
AjxColor.__darken=function(e,t){
return Math.max(0,Math.min(255,e+(1-e)*t))
}
}
if(AjxPackage.define("ajax.events.AjxEvent")){
AjxEvent=function(){
this.data=null
};
AjxEvent.HISTORY="HISTORY";
AjxEvent.prototype.toString=function(){
return"AjxEvent"
}
}
if(AjxPackage.define("ajax.events.AjxEventMgr")){
AjxEventMgr=function(){
this._listeners=new Object()
};
AjxEventMgr.prototype.toString=function(){
return"AjxEventMgr"
};
AjxEventMgr.prototype.addListener=function(t,a,e){
var i=this._listeners[t];
if(i==null){
i=this._listeners[t]=new AjxVector()
}
if(!i.contains(a)){
if(this._notifyingListeners){
i=this._listeners[t]=i.clone()
}
i.add(a,e);
return true
}
return false
};
AjxEventMgr.prototype.notifyListeners=function(o,r){
this._notifyingListeners=true;
var l=this._listeners[o];
if(l!=null){
var e=l.getArray();
var n=l.size();
var h=null;
var d=null;
for(var t=0;
t<n;
t++){
d=e[t];
if(!(d&&((d instanceof AjxListener)||(typeof d=="function")))){
continue
}
h=d.handleEvent?d.handleEvent(r):d(r);
if(h===false){
break
}}}
this._notifyingListeners=false;
return h
};
AjxEventMgr.prototype.isListenerRegistered=function(e){
var t=this._listeners[e];
return(t!=null&&t.size()>0)
};
AjxEventMgr.prototype.removeListener=function(e,t){
var a=this._listeners[e];
if(a!=null){
if(this._notifyingListeners){
a=this._listeners[e]=a.clone()
}
a.remove(t);
return true
}
return false
};
AjxEventMgr.prototype.removeAll=function(e){
var t=this._listeners[e];
if(t!=null){
if(this._notifyingListeners){
t=this._listeners[e]=t.clone()
}
t.removeAll();
return true
}
return false
};
AjxEventMgr.prototype.clearAllEvents=function(){
var t=this._listeners;
for(var e in t){
this.removeAll(e)
}}
}
if(AjxPackage.define("ajax.util.AjxTimedAction")){
AjxTimedAction=function(a,t,e){
AjxCallback.call(this,a,t,e);
this._tid=-1;
this._id=-1;
this._runResult=null
};
AjxTimedAction.prototype=new AjxCallback();
AjxTimedAction.prototype.constructor=AjxTimedAction;
AjxTimedAction.MAX_TIMEOUT=20*24*60*60*1000;
AjxTimedAction.prototype.toString=function(){
return"AjxTimedAction"
};
AjxTimedAction.prototype.getRunResult=function(){
return this._runResult
};
AjxTimedAction._pendingActions={};
AjxTimedAction._nextActionId=1;
AjxTimedAction.scheduleAction=function(a,t){
if(!a){
return
}
if(a._tid&&a._tid!=-1){
AjxTimedAction.cancelAction(a._id)
}
t=t||0;
if(t>AjxTimedAction.MAX_TIMEOUT){
if(window.DBG){}
t=AjxTimedAction.MAX_TIMEOUT
}
var i=a._id=AjxTimedAction._nextActionId++;
AjxTimedAction._pendingActions[i]=a;
var e="AjxTimedAction._exec("+i+")";
a._tid=window.setTimeout(e,t);
return a._id
};
AjxTimedAction.cancelAction=function(t){
var e=AjxTimedAction._pendingActions[t];
if(e){
window.clearTimeout(e._tid);
delete AjxTimedAction._pendingActions[t];
delete e._tid
}};
AjxTimedAction._exec=function(a){
try{
var t=AjxTimedAction._pendingActions[a];
if(t){
delete AjxTimedAction._pendingActions[a];
delete t._tid;
t._runResult=t.run()
}}
catch(e){
AjxException.reportScriptError(e)
}}
}
if(AjxPackage.define("ajax.net.AjxInclude")){
AjxInclude=function(i,n,o,a){
var t=document.getElementsByTagName("head")[0];
function e(s){
if(AjxEnv.isIE&&s&&!/loaded|complete/.test(s.readyState)){
return
}
if(s){
s[AjxInclude.eventName]=null
}
window.status="";
if(i.length>0){
var r=i.shift();
var l=typeof r=="string"?r:r.src;
var d=l;
if(!/^((https?|ftps?):\x2f\x2f|\x2f)/.test(l)){
if(n){
l=n+l
}
if(cacheKillerVersion){
l+="?v="+cacheKillerVersion
}}else{
if(a&&l.indexOf("/")!=0){
l=a+AjxStringUtil.urlEncode(l)
}}
var s=document.createElement("script");
var h=AjxCallback.simpleClosure(e,null,s);
if(s.attachEvent){
s.attachEvent("onreadystatechange",h);
s.attachEvent("onerror",h)
}else{
if(s.addEventListener){
s.addEventListener("load",h,true);
s.addEventListener("error",h,true)
}}
s.type="text/javascript";
s.src=l;
window.status="Loading script: "+d;
var c=null;
if(r.id){
s.id=r.id;
c=document.getElementById(r.id)
}
if(c){
c.parentNode.replaceChild(s,c)
}else{
t.appendChild(s)
}}else{
if(i.length==0){
s=null;
t=null;
if(o){
o.run()
}}}}
e(null)
}
}
if(AjxPackage.define("ajax.events.AjxListener")){
AjxListener=function(t,a,e){
AjxCallback.call(this,t,a,e)
};
AjxListener.prototype=new AjxCallback();
AjxListener.prototype.constructor=AjxListener;
AjxListener.prototype.isAjxListener=true;
AjxListener.prototype.toString=function(){
return"AjxListener"
};
AjxListener.prototype.handleEvent=function(e){
return this.run(e)
}
}
if(AjxPackage.define("ajax.util.AjxText")){
AjxFormat=function(e){
if(arguments.length==0){
return
}
this._pattern=e;
this._segments=[]
};
AjxFormat.prototype.toString=function(){
var t=[];
t.push('pattern="',this._pattern,'"');
if(this._segments.length>0){
t.push(", segments={ ");
for(var e=0;
e<this._segments.length;
e++){
if(e>0){
t.push(", ")
}
t.push(String(this._segments[e]))
}
t.push(" }")
}
return t.join("")
};
AjxFormat.initialize=function(){
AjxDateFormat.initialize();
AjxNumberFormat.initialize()
};
AjxFormat.prototype.format=function(e){
var a=[];
for(var t=0;
t<this._segments.length;
t++){
a.push(this._segments[t].format(e))
}
return a.join("")
};
AjxFormat.prototype.parse=function(o){
var t=this._createParseObject();
var e=0;
for(var a=0;
a<this._segments.length;
a++){
var n=this._segments[a];
e=n.parse(t,o,e)
}
if(e<o.length){
throw new AjxFormat.ParsingException(this,null,"input too long")
}
return t
};
AjxFormat.prototype.getSegments=function(){
return this._segments
};
AjxFormat.prototype.toPattern=function(){
return this._pattern
};
AjxFormat.prototype.clone=function(){
return new this.constructor(this._pattern)
};
AjxFormat.prototype._createParseObject=function(e){
throw new AjxFormat.ParsingException(this,null,"not implemented")
};
AjxFormat._zeroPad=function(n,r,t,h){
n=typeof n=="string"?n:String(n);
if(n.length>=r){
return n
}
t=t||"0";
var e=[];
for(var o=n.length;
o<r;
o++){
e.push(t)
}
e[h?"unshift":"push"](n);
return e.join("")
};
AjxFormat.FormatException=function(t,e){
this._format=t;
this._message=e
};
AjxFormat.FormatException.prototype.toString=function(){
return this._message
};
AjxFormat.FormattingException=function(a,t,e){
AjxFormat.FormatException.call(this,a,e);
this._segment=t
};
AjxFormat.FormattingException.prototype=new AjxFormat.FormatException;
AjxFormat.FormattingException.prototype.constructor=AjxFormat.FormattingException;
AjxFormat.ParsingException=function(a,t,e){
AjxFormat.FormatException.call(this,a,e);
this._segment=t
};
AjxFormat.ParsingException.prototype=new AjxFormat.FormatException;
AjxFormat.ParsingException.prototype.constructor=AjxFormat.ParsingException;
AjxFormat.Segment=function(t,e){
if(arguments.length==0){
return
}
this._parent=t;
this._s=e
};
AjxFormat.Segment.prototype.toString=function(){
return'segment: "'+this._s+'"'
};
AjxFormat.Segment.prototype.format=function(e){
return this._s
};
AjxFormat.Segment.prototype.parse=function(a,t,e){
throw new AjxFormat.ParsingException(this._parent,this,"not implemented")
};
AjxFormat.Segment.prototype.getFormat=function(){
return this._parent
};
AjxFormat.Segment.prototype.toSubPattern=function(){
return this._s
};
AjxFormat.Segment.prototype._getFixedLength=function(){
var e;
if(this._index+1<this._parent._segments.length){
var t=this._parent._segments[this._index+1];
if(!(t instanceof AjxFormat.TextSegment)){
e=this._s.length
}}
return e
};
AjxFormat.Segment._parseLiteral=function(o,a,e){
if(a.length-e<o.length){
throw new AjxFormat.ParsingException(this._parent,this,"input too short")
}
for(var t=0;
t<o.length;
t++){
if(o.charAt(t)!=a.charAt(e+t)){
throw new AjxFormat.ParsingException(this._parent,this,"input doesn't match")
}}
return e+o.length
};
AjxFormat.Segment._parseLiterals=function(a,h,u,t,p,l){
for(var r=0;
r<t.length;
r++){
try{
var m=t[r];
var n=AjxFormat.Segment._parseLiteral(m,p,l);
if(h){
var d=a||window;
if(typeof h=="function"){
h.call(d,r+u)
}else{
d[h]=r+u
}}
return n
}
catch(c){}}
return -1
};
AjxFormat.Segment._parseInt=function(t,n,p,g,r,e,u){
var h=e||g.length-r;
var d=r;
for(var a=0;
a<h;
a++){
if(!g.charAt(r++).match(/\d/)){
r--;
break
}}
var c=r;
if(d==c){
throw new AjxFormat.ParsingException(this._parent,this,"number not present")
}
if(e&&c-d!=e){
throw new AjxFormat.ParsingException(this._parent,this,"number too short")
}
var m=parseInt(g.substring(d,c),u||10);
if(n){
var l=t||window;
if(typeof n=="function"){
n.call(l,m+p)
}else{
l[n]=m+p
}}
return c
};
AjxDateFormat=function(s){
if(arguments.length==0){
return
}
AjxFormat.call(this,s);
if(s==null){
return
}
if(typeof s=="number"){
switch(s){
case AjxDateFormat.SHORT:s=I18nMsg.formatDateShort;
break;
case AjxDateFormat.MEDIUM:s=I18nMsg.formatDateMedium;
break;
case AjxDateFormat.LONG:s=I18nMsg.formatDateLong;
break;
case AjxDateFormat.FULL:s=I18nMsg.formatDateFull;
break;
case AjxDateFormat.NUMBER:s=I18nMsg.formatDateNumber;
break
}}
for(var a=0;
a<s.length;
a++){
var h=s.charAt(a);
if(h=="'"){
var t=a+1;
for(a++;
a<s.length;
a++){
var h=s.charAt(a);
if(h=="'"){
if(a+1<s.length&&s.charAt(a+1)=="'"){
s=s.substr(0,a)+s.substr(a+1)
}else{
break
}}}
var e=a;
var n=new AjxFormat.TextSegment(this,s.substring(t,e));
this._segments.push(n);
continue
}
var t=a;
while(a<s.length){
h=s.charAt(a);
if(AjxDateFormat._META_CHARS.indexOf(h)!=-1||h=="'"){
break
}
a++
}
var e=a;
if(t!=e){
var n=new AjxFormat.TextSegment(this,s.substring(t,e));
this._segments.push(n);
a--;
continue
}
var t=a;
while(++a<s.length){
if(s.charAt(a)!=h){
break
}}
var e=a--;
var o=e-t;
var r=s.substr(t,o);
var n=null;
switch(h){
case"G":n=new AjxDateFormat.EraSegment(this,r);
break;
case"y":n=new AjxDateFormat.YearSegment(this,r);
break;
case"M":n=new AjxDateFormat.MonthSegment(this,r);
break;
case"w":n=new AjxDateFormat.WeekSegment(this,r);
break;
case"W":n=new AjxDateFormat.WeekSegment(this,r);
break;
case"D":n=new AjxDateFormat.DaySegment(this,r);
break;
case"d":n=new AjxDateFormat.DaySegment(this,r);
break;
case"F":n=new AjxDateFormat.WeekdaySegment(this,r);
break;
case"E":n=new AjxDateFormat.WeekdaySegment(this,r);
break;
case"a":n=new AjxDateFormat.AmPmSegment(this,r);
break;
case"H":n=new AjxDateFormat.HourSegment(this,r);
break;
case"k":n=new AjxDateFormat.HourSegment(this,r);
break;
case"K":n=new AjxDateFormat.HourSegment(this,r);
break;
case"h":n=new AjxDateFormat.HourSegment(this,r);
break;
case"m":n=new AjxDateFormat.MinuteSegment(this,r);
break;
case"s":n=new AjxDateFormat.SecondSegment(this,r);
break;
case"S":n=new AjxDateFormat.SecondSegment(this,r);
break;
case"z":n=new AjxDateFormat.TimezoneSegment(this,r);
break;
case"Z":n=new AjxDateFormat.TimezoneSegment(this,r);
break
}
if(n!=null){
n._index=this._segments.length;
this._segments.push(n)
}}};
AjxDateFormat.prototype=new AjxFormat;
AjxDateFormat.prototype.constructor=AjxDateFormat;
AjxDateFormat.prototype.toString=function(){
return"[AjxDateFormat: "+AjxFormat.prototype.toString.call(this)+"]"
};
AjxDateFormat.SHORT=0;
AjxDateFormat.MEDIUM=1;
AjxDateFormat.LONG=2;
AjxDateFormat.FULL=3;
AjxDateFormat.DEFAULT=AjxDateFormat.MEDIUM;
AjxDateFormat._META_CHARS="GyMwWDdFEaHkKhmsSzZ";
AjxDateFormat.NUMBER=4;
AjxDateFormat.getDateInstance=function(e){
e=e!=null?e:AjxDateFormat.DEFAULT;
if(!AjxDateFormat._DATE_FORMATTERS[e]){
AjxDateFormat._DATE_FORMATTERS[e]=new AjxDateFormat(AjxDateFormat._dateFormats[e])
}
return AjxDateFormat._DATE_FORMATTERS[e]
};
AjxDateFormat.getTimeInstance=function(e){
e=e!=null?e:AjxDateFormat.DEFAULT;
if(!AjxDateFormat._TIME_FORMATTERS[e]){
AjxDateFormat._TIME_FORMATTERS[e]=new AjxDateFormat(AjxDateFormat._timeFormats[e])
}
return AjxDateFormat._TIME_FORMATTERS[e]
};
AjxDateFormat.getDateTimeInstance=function(e,t){
e=e!=null?e:AjxDateFormat.DEFAULT;
t=t!=null?t:AjxDateFormat.DEFAULT;
var i=e*10+t;
if(!AjxDateFormat._DATETIME_FORMATTERS[i]){
var o=I18nMsg.formatDateTime;
var n=[AjxDateFormat._dateFormats[e],AjxDateFormat._timeFormats[t]];
var a=AjxMessageFormat.format(o,n);
AjxDateFormat._DATETIME_FORMATTERS[i]=new AjxDateFormat(a)
}
return AjxDateFormat._DATETIME_FORMATTERS[i]
};
AjxDateFormat.format=function(t,e){
return new AjxDateFormat(t).format(e)
};
AjxDateFormat.parse=function(t,e){
return new AjxDateFormat(t).parse(e)
};
AjxDateFormat.initialize=function(){
AjxDateFormat._dateFormats=[I18nMsg.formatDateShort,I18nMsg.formatDateMedium,I18nMsg.formatDateLong,I18nMsg.formatDateFull,I18nMsg.formatDateNumber];
AjxDateFormat._timeFormats=[I18nMsg.formatTimeShort,I18nMsg.formatTimeMedium,I18nMsg.formatTimeLong,I18nMsg.formatTimeFull];
AjxDateFormat._timeParsers=[];
for(var t=1,e;
e=I18nMsg["parseTime"+t];
t++){
AjxDateFormat._timeParsers.push(new RegExp(e,"i"))
}
AjxDateFormat._DATE_FORMATTERS={};
AjxDateFormat._TIME_FORMATTERS={};
AjxDateFormat._DATETIME_FORMATTERS={};
AjxDateFormat.MonthSegment.initialize();
AjxDateFormat.WeekdaySegment.initialize()
};
AjxDateFormat.parseTime=function(r){
for(var s=0;
s<AjxDateFormat._timeParsers.length;
s++){
var e=AjxDateFormat._timeParsers[s].exec(r);
if(e){
var a=parseInt(e[1],10)||0;
var n=parseInt(e[2],10)||0;
var o=e[3];
if(o){
var t=I18nMsg.parseTimePMChars;
if(a==12){
a=0
}
if(t.indexOf(o)!=-1){
a+=12
}}
if(a<24&&n<60){
date=new Date();
date.setHours(a);
date.setMinutes(n);
date.setSeconds(0);
return date
}}}};
AjxDateFormat.prototype.parse=function(o){
var i=null;
try{
i=AjxFormat.prototype.parse.call(this,o);
var a=new Date(0,0,2,0,0,0,0);
if(i.year!=null){
a.setFullYear(i.year)
}
if(i.month!=null){
a.setMonth(i.month)
}
a.setDate(1);
if(i.dayofmonth!=null){
a.setDate(i.dayofmonth)
}else{
if(i.dayofyear!=null){
a.setMonth(0,i.dayofyear)
}}
if(i.hours!=null){
a.setHours(i.hours)
}
if(i.minutes!=null){
a.setMinutes(i.minutes)
}
if(i.seconds!=null){
a.setSeconds(i.seconds)
}
if(i.milliseconds!=null){
a.setMilliseconds(i.milliseconds)
}
if(i.ampm!=null){
var t=a.getHours();
if(t==12&&i.ampm==0){
t=0
}else{
if(t!=12&&i.ampm==1){
t+=12
}}
a.setHours(t)
}
if(i.timezone!=null){
a.setMinutes(a.getMinutes()-i.timezone)
}
if(isNaN(a.getTime())){
return null
}
i=a
}
catch(n){}
return i
};
AjxDateFormat.prototype._createParseObject=function(){
return{
year:null,month:null,dayofmonth:null,dayofyear:null,hours:null,minutes:null,seconds:null,milliseconds:null,ampm:null,era:null,timezone:null}
};
AjxFormat.TextSegment=function(t,e){
if(arguments.length==0){
return
}
AjxFormat.Segment.call(this,t,e)
};
AjxFormat.TextSegment.prototype=new AjxFormat.Segment;
AjxFormat.TextSegment.prototype.constructor=AjxFormat.TextSegment;
AjxFormat.TextSegment.prototype.toString=function(){
return'text: "'+this._s+'"'
};
AjxFormat.TextSegment.prototype.parse=function(a,t,e){
return AjxFormat.Segment._parseLiteral(this._s,t,e)
};
AjxDateFormat.DateSegment=function(t,e){
if(arguments.length==0){
return
}
AjxFormat.Segment.call(this,t,e)
};
AjxDateFormat.DateSegment.prototype=new AjxFormat.Segment;
AjxDateFormat.DateSegment.prototype.constructor=AjxDateFormat.DateSegment;
AjxDateFormat.EraSegment=function(t,e){
if(arguments.length==0){
return
}
AjxDateFormat.DateSegment.call(this,t,e)
};
AjxDateFormat.EraSegment.prototype=new AjxDateFormat.DateSegment;
AjxDateFormat.EraSegment.prototype.constructor=AjxDateFormat.EraSegment;
AjxDateFormat.EraSegment.prototype.toString=function(){
return'dateEra: "'+this._s+'"'
};
AjxDateFormat.EraSegment.prototype.format=function(e){
return I18nMsg.eraAD
};
AjxDateFormat.YearSegment=function(t,e){
if(arguments.length==0){
return
}
AjxDateFormat.DateSegment.call(this,t,e)
};
AjxDateFormat.YearSegment.prototype=new AjxDateFormat.DateSegment;
AjxDateFormat.YearSegment.prototype.constructor=AjxDateFormat.YearSegment;
AjxDateFormat.YearSegment.prototype.toString=function(){
return'dateYear: "'+this._s+'"'
};
AjxDateFormat.YearSegment.prototype.format=function(e){
var t=String(e.getFullYear());
return this._s.length<4?t.substr(t.length-2):AjxFormat._zeroPad(t,this._s.length)
};
AjxDateFormat.YearSegment.prototype.parse=function(a,l,o){
var e=this._getFixedLength();
var t=AjxFormat.Segment._parseInt(a,"year",0,l,o,e);
if(t-o==2){
if(!AjxDateFormat._2digitStartYear){
AjxDateFormat._2digitStartYear=parseInt(AjxMsg.dateParsing2DigitStartYear)
}
var r=AjxDateFormat._2digitStartYear;
var h=parseInt(l.substr(o,2),10);
var i=(Math.floor(r/100)+(h<(r%100)?1:0))*100;
var n=i+h;
a.year=n
}
return t
};
AjxDateFormat.MonthSegment=function(t,e){
if(arguments.length==0){
return
}
AjxDateFormat.DateSegment.call(this,t,e)
};
AjxDateFormat.MonthSegment.prototype=new AjxDateFormat.DateSegment;
AjxDateFormat.MonthSegment.prototype.constructor=AjxDateFormat.MonthSegment;
AjxDateFormat.MonthSegment.prototype.toString=function(){
return'dateMonth: "'+this._s+'"'
};
AjxDateFormat.MonthSegment.initialize=function(){
AjxDateFormat.MonthSegment.MONTHS={};
AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.SHORT]=[AjxMsg.monthJanShort,AjxMsg.monthFebShort,AjxMsg.monthMarShort,AjxMsg.monthAprShort,AjxMsg.monthMayShort,AjxMsg.monthJunShort,AjxMsg.monthJulShort,AjxMsg.monthAugShort,AjxMsg.monthSepShort,AjxMsg.monthOctShort,AjxMsg.monthNovShort,AjxMsg.monthDecShort];
AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.MEDIUM]=[I18nMsg.monthJanMedium,I18nMsg.monthFebMedium,I18nMsg.monthMarMedium,I18nMsg.monthAprMedium,I18nMsg.monthMayMedium,I18nMsg.monthJunMedium,I18nMsg.monthJulMedium,I18nMsg.monthAugMedium,I18nMsg.monthSepMedium,I18nMsg.monthOctMedium,I18nMsg.monthNovMedium,I18nMsg.monthDecMedium];
AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.LONG]=[I18nMsg.monthJanLong,I18nMsg.monthFebLong,I18nMsg.monthMarLong,I18nMsg.monthAprLong,I18nMsg.monthMayLong,I18nMsg.monthJunLong,I18nMsg.monthJulLong,I18nMsg.monthAugLong,I18nMsg.monthSepLong,I18nMsg.monthOctLong,I18nMsg.monthNovLong,I18nMsg.monthDecLong]
};
AjxDateFormat.MonthSegment.prototype.format=function(e){
var t=e.getMonth();
switch(this._s.length){
case 1:return String(t+1);
case 2:return AjxFormat._zeroPad(t+1,2);
case 3:return AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.MEDIUM][t];
case 5:return AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.SHORT][t]
}
return AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.LONG][t]
};
AjxDateFormat.MonthSegment.prototype.parse=function(a,o,t){
var e;
switch(this._s.length){
case 3:e=AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.MEDIUM];
case 4:e=e||AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.LONG];
case 5:e=e||AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.SHORT];
var i=AjxFormat.Segment._parseLiterals(a,"month",0,e,o,t);
if(i==-1){
throw new AjxFormat.ParsingException(this._parent,this,"no match")
}
return i
}
var n=this._getFixedLength();
return AjxFormat.Segment._parseInt(a,"month",-1,o,t,n)
};
AjxDateFormat.WeekSegment=function(t,e){
if(arguments.length==0){
return
}
AjxDateFormat.DateSegment.call(this,t,e)
};
AjxDateFormat.WeekSegment.prototype=new AjxDateFormat.DateSegment;
AjxDateFormat.WeekSegment.prototype.constructor=AjxDateFormat.WeekSegment;
AjxDateFormat.WeekSegment.prototype.toString=function(){
return'weekMonth: "'+this._s+'"'
};
AjxDateFormat.WeekSegment.prototype.format=function(t){
var i=t.getYear();
var n=t.getMonth();
var e=t.getDate();
var s=/w/.test(this._s);
var o=new Date(i,s?0:n,1);
var a=0;
while(true){
a++;
if(o.getMonth()>n||(o.getMonth()==n&&o.getDate()>=e)){
break
}
o.setDate(o.getDate()+7)
}
return AjxFormat._zeroPad(a,this._s.length)
};
AjxDateFormat.WeekSegment.prototype.parse=function(t,a,e){
var i=this._getFixedLength();
return AjxFormat.Segment._parseInt(null,null,0,a,e,i)
};
AjxDateFormat.DaySegment=function(t,e){
if(arguments.length==0){
return
}
AjxDateFormat.DateSegment.call(this,t,e)
};
AjxDateFormat.DaySegment.prototype=new AjxDateFormat.DateSegment;
AjxDateFormat.DaySegment.prototype.constructor=AjxDateFormat.DaySegment;
AjxDateFormat.DaySegment.prototype.toString=function(){
return'dateDay: "'+this._s+'"'
};
AjxDateFormat.DaySegment.prototype.format=function(t){
var o=t.getMonth();
var e=t.getDate();
if(/D/.test(this._s)&&o>0){
var a=t.getYear();
do{
var i=new Date(a,o,1);
i.setDate(0);
e+=i.getDate();
o--
}
while(o>0)
}
return AjxFormat._zeroPad(e,this._s.length)
};
AjxDateFormat.DaySegment.prototype.parse=function(t,o,e){
var n=this._getFixedLength();
var i=function(s){
if(s>AjxDateUtil.MAX_DAYS_PER_MONTH){
throw new AjxFormat.ParsingException(this._parent,this,"number too long")
}else{
t.dayofmonth=s
}};
var a=/D/.test(this._s)?"dayofyear":i;
return AjxFormat.Segment._parseInt(t,a,0,o,e,n)
};
AjxDateFormat.WeekdaySegment=function(t,e){
if(arguments.length==0){
return
}
AjxDateFormat.DateSegment.call(this,t,e)
};
AjxDateFormat.WeekdaySegment.prototype=new AjxDateFormat.DateSegment;
AjxDateFormat.WeekdaySegment.prototype.constructor=AjxDateFormat.WeekdaySegment;
AjxDateFormat.DaySegment.prototype.toString=function(){
return'dateDay: "'+this._s+'"'
};
AjxDateFormat.WeekdaySegment.initialize=function(){
AjxDateFormat.WeekdaySegment.WEEKDAYS={};
AjxDateFormat.WeekdaySegment.WEEKDAYS[AjxDateFormat.SHORT]=[AjxMsg.weekdaySunShort,AjxMsg.weekdayMonShort,AjxMsg.weekdayTueShort,AjxMsg.weekdayWedShort,AjxMsg.weekdayThuShort,AjxMsg.weekdayFriShort,AjxMsg.weekdaySatShort];
AjxDateFormat.WeekdaySegment.WEEKDAYS[AjxDateFormat.MEDIUM]=[I18nMsg.weekdaySunMedium,I18nMsg.weekdayMonMedium,I18nMsg.weekdayTueMedium,I18nMsg.weekdayWedMedium,I18nMsg.weekdayThuMedium,I18nMsg.weekdayFriMedium,I18nMsg.weekdaySatMedium];
AjxDateFormat.WeekdaySegment.WEEKDAYS[AjxDateFormat.LONG]=[I18nMsg.weekdaySunLong,I18nMsg.weekdayMonLong,I18nMsg.weekdayTueLong,I18nMsg.weekdayWedLong,I18nMsg.weekdayThuLong,I18nMsg.weekdayFriLong,I18nMsg.weekdaySatLong]
};
AjxDateFormat.WeekdaySegment.prototype.format=function(e){
var a=e.getDay();
if(/E/.test(this._s)){
var t;
switch(this._s.length){
case 4:t=AjxDateFormat.LONG;
break;
case 5:t=AjxDateFormat.SHORT;
break;
default:t=AjxDateFormat.MEDIUM
}
return AjxDateFormat.WeekdaySegment.WEEKDAYS[t][a]
}
return AjxFormat._zeroPad(a,this._s.length)
};
AjxDateFormat.WeekdaySegment.prototype.parse=function(a,o,t){
var e;
switch(this._s.length){
case 3:e=AjxDateFormat.WeekdaySegment.WEEKDAYS[AjxDateFormat.MEDIUM];
case 4:e=e||AjxDateFormat.WeekdaySegment.WEEKDAYS[AjxDateFormat.LONG];
case 5:e=e||AjxDateFormat.WeekdaySegment.WEEKDAYS[AjxDateFormat.SHORT];
var i=AjxFormat.Segment._parseLiterals(null,null,0,e,o,t);
if(i==-1){
throw new AjxFormat.ParsingException(this._parent,this,"no match")
}
return i
}
var n=this._getFixedLength();
return AjxFormat.Segment._parseInt(null,null,0,o,t,n)
};
AjxDateFormat.TimeSegment=function(t,e){
if(arguments.length==0){
return
}
AjxFormat.Segment.call(this,t,e)
};
AjxDateFormat.TimeSegment.prototype=new AjxFormat.Segment;
AjxDateFormat.TimeSegment.prototype.constructor=AjxDateFormat.TimeSegment;
AjxDateFormat.HourSegment=function(t,e){
if(arguments.length==0){
return
}
AjxFormat.Segment.call(this,t,e)
};
AjxDateFormat.HourSegment.prototype=new AjxDateFormat.TimeSegment;
AjxDateFormat.HourSegment.prototype.constructor=AjxDateFormat.HourSegment;
AjxDateFormat.HourSegment.prototype.toString=function(){
return'timeHour: "'+this._s+'"'
};
AjxDateFormat.HourSegment.prototype.format=function(t){
var e=t.getHours();
if(e>12&&/[hK]/.test(this._s)){
e-=12
}else{
if(e==0&&/[h]/.test(this._s)){
e=12
}else{
if(e===12&&/K/.test(this._s)){
e=0
}else{
if(e===0&&/k/.test(this._s)){
e=24
}}}}
return AjxFormat._zeroPad(e,this._s.length)
};
AjxDateFormat.HourSegment.prototype.parse=function(t,a,e){
var i=this._getFixedLength();
return AjxFormat.Segment._parseInt(t,"hours",0,a,e,i)
};
AjxDateFormat.MinuteSegment=function(t,e){
if(arguments.length==0){
return
}
AjxFormat.Segment.call(this,t,e)
};
AjxDateFormat.MinuteSegment.prototype=new AjxDateFormat.TimeSegment;
AjxDateFormat.MinuteSegment.prototype.constructor=AjxDateFormat.MinuteSegment;
AjxDateFormat.MinuteSegment.prototype.toString=function(){
return'timeMinute: "'+this._s+'"'
};
AjxDateFormat.MinuteSegment.prototype.format=function(e){
var t=e.getMinutes();
return AjxFormat._zeroPad(t,this._s.length)
};
AjxDateFormat.MinuteSegment.prototype.parse=function(t,a,e){
var i=this._getFixedLength();
return AjxFormat.Segment._parseInt(t,"minutes",0,a,e,i)
};
AjxDateFormat.SecondSegment=function(t,e){
if(arguments.length==0){
return
}
AjxFormat.Segment.call(this,t,e)
};
AjxDateFormat.SecondSegment.prototype=new AjxDateFormat.TimeSegment;
AjxDateFormat.SecondSegment.prototype.constructor=AjxDateFormat.SecondSegment;
AjxDateFormat.SecondSegment.prototype.toString=function(){
return'timeSecond: "'+this._s+'"'
};
AjxDateFormat.SecondSegment.prototype.format=function(e){
var t=/s/.test(this._s)?e.getSeconds():e.getMilliseconds();
return AjxFormat._zeroPad(t,this._s.length)
};
AjxDateFormat.SecondSegment.prototype.parse=function(a,o,t){
var e=/s/.test(this._s);
var i=e?"seconds":"milliseconds";
var n=e?this._getFixedLength():0;
return AjxFormat.Segment._parseInt(a,i,0,o,t,n)
};
AjxDateFormat.AmPmSegment=function(t,e){
if(arguments.length==0){
return
}
AjxFormat.Segment.call(this,t,e)
};
AjxDateFormat.AmPmSegment.prototype=new AjxDateFormat.TimeSegment;
AjxDateFormat.AmPmSegment.prototype.constructor=AjxDateFormat.AmPmSegment;
AjxDateFormat.AmPmSegment.prototype.toString=function(){
return'timeAmPm: "'+this._s+'"'
};
AjxDateFormat.AmPmSegment.prototype.format=function(t){
var e=t.getHours();
return e<12?I18nMsg.periodAm:I18nMsg.periodPm
};
AjxDateFormat.AmPmSegment.prototype.parse=function(t,i,e){
var o=[I18nMsg.periodAm.toLowerCase(),I18nMsg.periodPm.toLowerCase(),I18nMsg.periodAm.toUpperCase(),I18nMsg.periodPm.toUpperCase()];
var a=AjxFormat.Segment._parseLiterals(t,"ampm",0,o,i,e);
if(a==-1){
throw new AjxFormat.ParsingException(this._parent,this,"no match")
}
t.ampm=t.ampm%2;
return a
};
AjxDateFormat.TimezoneSegment=function(t,e){
if(arguments.length==0){
return
}
AjxFormat.Segment.call(this,t,e)
};
AjxDateFormat.TimezoneSegment.prototype=new AjxDateFormat.TimeSegment;
AjxDateFormat.TimezoneSegment.prototype.constructor=AjxDateFormat.TimezoneSegment;
AjxDateFormat.TimezoneSegment.prototype.toString=function(){
return'timeTimezone: "'+this._s+'"'
};
AjxDateFormat.TimezoneSegment.prototype.format=function(t){
var e=t.timezone||AjxTimezone.DEFAULT;
if(/Z/.test(this._s)){
return AjxTimezone.getShortName(e)
}
return this._s.length<4?AjxTimezone.getMediumName(e):AjxTimezone.getLongName(e)
};
AjxMessageFormat=function(s){
if(arguments.length==0){
return
}
AjxFormat.call(this,s);
if(s==null){
return
}
for(var t=0;
t<s.length;
t++){
var r=s.charAt(t);
if(r=="'"){
if(t+1<s.length&&s.charAt(t+1)=="'"){
var a=new AjxFormat.TextSegment(this,"'");
this._segments.push(a);
t++;
continue
}
var h=t+1;
for(t++;
t<s.length;
t++){
var r=s.charAt(t);
if(r=="'"){
if(t+1<s.length&&s.charAt(t+1)=="'"){
s=s.substr(0,t)+s.substr(t+1)
}else{
break
}}}
var n=t;
var a=new AjxFormat.TextSegment(this,s.substring(h,n));
this._segments.push(a);
continue
}
var h=t;
while(t<s.length){
r=s.charAt(t);
if(r=="{"||r=="'"){
break
}
t++
}
var n=t;
if(h!=n){
var a=new AjxFormat.TextSegment(this,s.substring(h,n));
this._segments.push(a);
t--;
continue
}
var h=t+1;
var e=0;
while(++t<s.length){
var r=s.charAt(t);
if(r=="{"){
e++
}else{
if(r=="}"){
if(e==0){
break
}
e--
}}}
var n=t;
var o=n-h;
var l=s.substr(h,o);
var a=new AjxMessageFormat.MessageSegment(this,l);
if(a!=null){
this._segments.push(a)
}}};
AjxMessageFormat.prototype=new AjxFormat;
AjxMessageFormat.prototype.constructor=AjxMessageFormat;
AjxMessageFormat.prototype.toString=function(){
return"[AjxMessageFormat: "+AjxFormat.prototype.toString.call(this)+"]"
};
AjxMessageFormat.format=function(e,t){
return new AjxMessageFormat(e).format(t)
};
AjxMessageFormat.prototype.format=function(e){
if(!(e instanceof Array)){
e=[e]
}
return AjxFormat.prototype.format.call(this,e)
};
AjxMessageFormat.prototype.getFormats=function(){
var e=[];
for(var t=0;
t<this._segments.length;
t++){
var a=this._segments[t];
if(a instanceof AjxMessageFormat.MessageSegment){
e.push(a.getSegmentFormat())
}}
return e
};
AjxMessageFormat.prototype.getFormatsByArgumentIndex=function(){
var e=[];
for(var t=0;
t<this._segments.length;
t++){
var a=this._segments[t];
if(a instanceof AjxMessageFormat.MessageSegment){
e[a.getIndex()]=a.getSegmentFormat()
}}
return e
};
AjxMessageFormat.MessageSegment=function(i,e){
if(arguments.length==0){
return
}
AjxFormat.Segment.call(this,i,e);
var a=AjxMessageFormat.MessageSegment._split(e,",");
this._index=Number(a[0]);
this._type=a[1]||"string";
this._style=a[2];
if(this._type=="list"){
this._isList=true;
this._type=a[2]||"string";
this._style=a[3]
}
switch(this._type){
case"number":switch(this._style){
case"integer":this._formatter=AjxNumberFormat.getIntegerInstance();
break;
case"currency":this._formatter=AjxNumberFormat.getCurrencyInstance();
break;
case"percent":this._formatter=AjxNumberFormat.getPercentInstance();
break;
default:this._formatter=this._style==null?AjxNumberFormat.getInstance():new AjxNumberFormat(this._style)
}
break;
case"date":case"time":var t=this._type=="date"?AjxDateFormat.getDateInstance:AjxDateFormat.getTimeInstance;
switch(this._style){
case"short":this._formatter=t(AjxDateFormat.SHORT);
break;
case"medium":this._formatter=t(AjxDateFormat.MEDIUM);
break;
case"long":this._formatter=t(AjxDateFormat.LONG);
break;
case"full":this._formatter=t(AjxDateFormat.FULL);
break;
default:this._formatter=this._style==null?t(AjxDateFormat.DEFAULT):new AjxDateFormat(this._style)
}
break;
case"choice":this._formatter=new AjxChoiceFormat(this._style);
break
}
if(this._isList){
this._formatter=new AjxListFormat(this._formatter)
}};
AjxMessageFormat.MessageSegment.prototype=new AjxFormat.Segment;
AjxMessageFormat.MessageSegment.prototype.constructor=AjxMessageFormat.MessageSegment;
AjxMessageFormat.MessageSegment.prototype.toString=function(){
var e=['message: "',this._s,'", index: ',this._index];
if(this._isList){
e.push(", list: ",this._isList)
}
if(this._type){
e.push(", type: ",this._type)
}
if(this._style){
e.push(", style: ",this._style)
}
if(this._formatter){
e.push(", formatter: ",this._formatter.toString())
}
return e.join("")
};
AjxMessageFormat.MessageSegment.prototype._isList=false;
AjxMessageFormat.MessageSegment.prototype.format=function(t){
var e=t[this._index];
if(this._formatter instanceof AjxChoiceFormat){
return this._formatter.format(t,this._index)
}
return this._formatter?this._formatter.format(e):String(e)
};
AjxMessageFormat.MessageSegment.prototype.getIndex=function(){
return this._index
};
AjxMessageFormat.MessageSegment.prototype.getType=function(){
return this._type
};
AjxMessageFormat.MessageSegment.prototype.getStyle=function(){
return this._style
};
AjxMessageFormat.MessageSegment.prototype.getSegmentFormat=function(){
return this._formatter
};
AjxMessageFormat.MessageSegment._split=function(i,e){
var o=[];
var a=0;
var t;
var n=0;
for(t=0;
t<i.length;
t++){
var r=i.charAt(t);
if(r=="{"){
n++
}else{
if(r=="}"){
n--
}else{
if(r==e&&n==0){
o.push(i.substring(a,t));
a=t+1
}}}}
if(t>a){
o.push(i.substring(a,t))
}
return o
};
AjxNumberFormat=function(g,y){
if(arguments.length==0){
return
}
AjxFormat.call(this,g);
if(!g){
return
}
var a=g.split(/;/);
var g=a[0];
var f=0;
var u=this.__parseStatic(g,f);
f=u.offset;
var s=u.text!="";
if(s){
this._segments.push(new AjxFormat.TextSegment(this,u.text))
}
var r=f;
while(f<g.length&&AjxNumberFormat._META_CHARS.indexOf(g.charAt(f))!=-1){
f++
}
var n=f;
var t=g.substring(r,n);
var w=t.indexOf("E");
var c=w!=-1?t.substring(w+1):null;
if(c){
t=t.substring(0,w);
this._showExponent=true
}
var d=t.indexOf(I18nMsg.numberSeparatorDecimal!=""?I18nMsg.numberSeparatorDecimal:".");
var v=d!=-1?t.substring(0,d):t;
if(v){
var k=v.lastIndexOf(I18nMsg.numberSeparatorGrouping!=""?I18nMsg.numberSeparatorGrouping:",");
if(k!=-1){
this._groupingOffset=v.length-k-1
}
v=v.replace(/[^#0]/g,"");
var l=v.indexOf("0");
if(l!=-1){
this._minIntDigits=v.length-l
}
this._maxIntDigits=v.length
}
var p=d!=-1?t.substring(d+1):null;
if(p){
var l=p.lastIndexOf("0");
if(l!=-1){
this._minFracDigits=l+1
}
this._maxFracDigits=p.replace(/[^#0]/g,"").length
}
this._segments.push(new AjxNumberFormat.NumberSegment(this,t));
var u=this.__parseStatic(g,f);
f=u.offset;
if(u.text!=""){
this._segments.push(new AjxFormat.TextSegment(this,u.text))
}
if(y){
return
}
if(a.length>1){
var g=a[1];
this._negativeFormatter=new AjxNumberFormat(g,true)
}else{
var m=new AjxNumberFormat("");
m._segments=m._segments.concat(this._segments);
var h=s?1:0;
var o=new AjxFormat.TextSegment(m,I18nMsg.numberSignMinus);
m._segments.splice(h,0,o);
this._negativeFormatter=m
}};
AjxNumberFormat.prototype=new AjxFormat;
AjxNumberFormat.prototype.constructor=AjxNumberFormat;
AjxNumberFormat.prototype.toString=function(){
var e=["[AjxNumberFormat: ","formatter=",AjxFormat.prototype.toString.call(this)];
if(this._negativeFormatter){
e.push(", negativeFormatter=",this._negativeFormatter.toString())
}
e.push("]");
return e.join("")
};
AjxNumberFormat._NUMBER="number";
AjxNumberFormat._INTEGER="integer";
AjxNumberFormat._CURRENCY="currency";
AjxNumberFormat._PERCENT="percent";
AjxNumberFormat._META_CHARS="0#.,E";
AjxNumberFormat.prototype._groupingOffset=Number.MAX_VALUE;
AjxNumberFormat.prototype._minIntDigits=1;
AjxNumberFormat.prototype._isCurrency=false;
AjxNumberFormat.prototype._isPercent=false;
AjxNumberFormat.prototype._isPerMille=false;
AjxNumberFormat.prototype._showExponent=false;
AjxNumberFormat.getInstance=function(){
if(!AjxNumberFormat._FORMATTERS[AjxNumberFormat._NUMBER]){
AjxNumberFormat._FORMATTERS[AjxNumberFormat._NUMBER]=new AjxNumberFormat(I18nMsg.formatNumber)
}
return AjxNumberFormat._FORMATTERS[AjxNumberFormat._NUMBER]
};
AjxNumberFormat.getNumberInstance=AjxNumberFormat.getInstance;
AjxNumberFormat.getCurrencyInstance=function(){
if(!AjxNumberFormat._FORMATTERS[AjxNumberFormat._CURRENCY]){
AjxNumberFormat._FORMATTERS[AjxNumberFormat._CURRENCY]=new AjxNumberFormat(I18nMsg.formatNumberCurrency)
}
return AjxNumberFormat._FORMATTERS[AjxNumberFormat._CURRENCY]
};
AjxNumberFormat.getIntegerInstance=function(){
if(!AjxNumberFormat._FORMATTERS[AjxNumberFormat._INTEGER]){
AjxNumberFormat._FORMATTERS[AjxNumberFormat._INTEGER]=new AjxNumberFormat(I18nMsg.formatNumberInteger)
}
return AjxNumberFormat._FORMATTERS[AjxNumberFormat._INTEGER]
};
AjxNumberFormat.getPercentInstance=function(){
if(!AjxNumberFormat._FORMATTERS[AjxNumberFormat._PERCENT]){
AjxNumberFormat._FORMATTERS[AjxNumberFormat._PERCENT]=new AjxNumberFormat(I18nMsg.formatNumberPercent)
}
return AjxNumberFormat._FORMATTERS[AjxNumberFormat._PERCENT]
};
AjxNumberFormat.format=function(t,e){
return new AjxNumberFormat(t).format(e)
};
AjxNumberFormat.initialize=function(){
AjxNumberFormat._FORMATTERS={}
};
AjxNumberFormat.prototype.format=function(e){
if(e<0&&this._negativeFormatter){
return this._negativeFormatter.format(e)
}
return AjxFormat.prototype.format.call(this,e)
};
AjxNumberFormat.prototype.__parseStatic=function(a,t){
var o=[];
while(t<a.length){
var r=a.charAt(t++);
if(AjxNumberFormat._META_CHARS.indexOf(r)!=-1){
t--;
break
}
switch(r){
case"'":var n=t;
while(t<a.length&&a.charAt(t++)!="'"){}
var e=t;
r=e-n==0?"'":a.substring(n,e);
break;
case"%":r=I18nMsg.numberSignPercent;
this._isPercent=true;
break;
case"\u2030":r=I18nMsg.numberSignPerMill;
this._isPerMille=true;
break;
case"\u00a4":r=a.charAt(t)=="\u00a4"?I18nMsg.currencyCode:I18nMsg.currencySymbol;
this._isCurrency=true;
break
}
o.push(r)
}
return{
text:o.join(""),offset:t}
};
AjxNumberFormat.NumberSegment=function(t,e){
if(arguments.length==0){
return
}
AjxFormat.Segment.call(this,t,e)
};
AjxNumberFormat.NumberSegment.prototype=new AjxFormat.Segment;
AjxNumberFormat.NumberSegment.prototype.constructor=AjxNumberFormat.NumberSegment;
AjxNumberFormat.NumberSegment.prototype.toString=function(){
return'number: "'+this._s+'"'
};
AjxNumberFormat.NumberSegment.prototype.format=function(t){
if(isNaN(t)){
return I18nMsg.numberNaN
}
if(t===Number.NEGATIVE_INFINITY||t===Number.POSITIVE_INFINITY){
return I18nMsg.numberInfinity
}
if(typeof t!="number"){
t=Number(t)
}
t=Math.abs(t);
if(this._parent._isPercent){
t*=100
}else{
if(this._parent._isPerMille){
t*=1000
}}
var e=this._parent._showExponent?t.toExponential(this._parent._maxFracDigits).toUpperCase().replace(/E\+/,"E"):t.toFixed(this._parent._maxFracDigits||0);
e=this._normalize(e);
return e
};
AjxNumberFormat.NumberSegment.prototype._normalize=function(r){
var o=r.split(/[\.Ee]/);
var h=o.shift();
if(h.length<this._parent._minIntDigits){
h=AjxFormat._zeroPad(h,this._parent._minIntDigits,I18nMsg.numberZero)
}
if(h.length>this._parent._groupingOffset){
var t=[];
var n=h.length-this._parent._groupingOffset;
while(n>0){
t.unshift(h.substr(n,this._parent._groupingOffset));
t.unshift(I18nMsg.numberSeparatorGrouping);
n-=this._parent._groupingOffset
}
t.unshift(h.substring(0,n+this._parent._groupingOffset));
h=t.join("")
}
var l="0";
var c;
if(r.match(/\./)){
l=o.shift()
}else{
if(r.match(/\e/)||r.match(/\E/)){
c=o.shift()
}}
l=l.replace(/0+$/,"");
if(l.length<this._parent._minFracDigits){
l=AjxFormat._zeroPad(l,this._parent._minFracDigits,I18nMsg.numberZero,true)
}
var t=[h];
if(l.length>0){
var e=this._parent._isCurrency?I18nMsg.numberSeparatorMoneyDecimal:I18nMsg.numberSeparatorDecimal;
t.push(e,l)
}
if(c){
t.push("E",c.replace(/^\+/,""))
}
return t.join("")
};
AjxChoiceFormat=function(s){
if(arguments.length==0){
return
}
AjxFormat.call(this,s);
if(s==null){
return
}
var l=s.split("|");
if(arguments.length==1){
this._limits=new Array(l.length);
this._lessThan=new Array(l.length);
this._formats=new Array(l.length);
var r=new RegExp("^([^#<\u2264]+)([#<\u2264])(.*)$");
for(var a=0;
a<l.length;
a++){
var t=l[a];
var o=r.exec(t);
var e=o[1];
var n=o[2];
var h=o[3];
if(e=="\u221E"){
this._limits[a]=Number.POSITIVE_INFINITY
}else{
if(e=="-\u221E"){
this._limits[a]=Number.NEGATIVE_INFINITY
}else{
this._limits[a]=parseFloat(e)
}}
this._lessThan[a]=n=="#"||n=="\u2264";
this._formats[a]=new AjxMessageFormat(h)
}}else{
this._limits=arguments[0];
this._lessThan=new Array(arguments[0].length);
this._formats=arguments[1];
this._pattern=[];
for(var a=0;
a<this._formats.length;
a++){
if(a>0){
this._pattern.push("|")
}
this._pattern.push(this._limits[a],"#",this._formats[a]);
this._lessThan[a]=false;
this._formats[a]=new AjxMessageFormat(this._formats[a])
}
this._pattern=this._pattern.join("")
}};
AjxChoiceFormat.prototype=new AjxFormat;
AjxChoiceFormat.prototype.constructor=AjxChoiceFormat;
AjxChoiceFormat.prototype.toString=function(){
return["[AjxChoiceFormat: ","limits={ ",this._limits.join(", ")," }, ","formats={ ",this._formats.join(", ")," }, ","lessThan={ ",this._lessThan.join(", ")," }]"].join("")
};
AjxChoiceFormat.prototype.getLimits=function(){
return this._limits
};
AjxChoiceFormat.prototype.getFormats=function(){
return this._formats
};
AjxChoiceFormat.prototype.format=function(e,n){
var o=e instanceof Array?e[n]:e;
var l;
if(isNaN(o)||o<this._limits[0]){
l=this._formats[0]
}else{
for(var t=0;
t<this._limits.length-1;
t++){
var h=this._limits[t];
var r=this._limits[t+1];
var c=o>=h;
var s=this._lessThan[t+1]?o<r:o<=r;
if(c&&s){
l=this._formats[t];
break
}}
if(!l){
l=this._formats[this._formats.length-1]
}}
return l.format(e)
};
AjxListFormat=function(t,i,a,e){
AjxFormat.call(this,t?t.toPattern():"");
this._formatter=t;
this._separator=i||AjxMsg.listSeparator;
this._lastSeparator=a||AjxMsg.listSeparatorLast;
this._twoSeparator=e||AjxMsg.listSeparatorTwo
};
AjxListFormat.prototype=new AjxFormat;
AjxListFormat.prototype.constructor=AjxListFormat;
AjxListFormat.prototype.format=function(n){
n=n instanceof Array?n:[n];
var o=[];
var e=n.length;
for(var t=0;
t<e;
t++){
if(t>0){
o.push((t<e-1)?this._separator:(e==2)?this._twoSeparator:this._lastSeparator)
}
var a=n[t];
o.push(this._formatter?this._formatter.format(a):String(a))
}
return o.join("")
};
AjxFormat.initialize()
}
if(AjxPackage.define("ajax.util.AjxDateUtil")){
AjxDateUtil=function(){};
AjxDateUtil.YEAR=1;
AjxDateUtil.MONTH=2;
AjxDateUtil.WEEK=3;
AjxDateUtil.DAY=4;
AjxDateUtil.TWO_WEEKS=5;
AjxDateUtil.MSEC_PER_MINUTE=60000;
AjxDateUtil.MSEC_PER_FIFTEEN_MINUTES=900000;
AjxDateUtil.MSEC_PER_HALF_HOUR=1800000;
AjxDateUtil.MSEC_PER_HOUR=3600000;
AjxDateUtil.MSEC_PER_DAY=24*AjxDateUtil.MSEC_PER_HOUR;
AjxDateUtil.MINUTES_PER_DAY=60*24;
AjxDateUtil.SECONDS_PER_DAY=60*60*24;
AjxDateUtil.WEEKDAY_SHORT=AjxDateFormat.WeekdaySegment.WEEKDAYS[AjxDateFormat.SHORT];
AjxDateUtil.WEEKDAY_MEDIUM=AjxDateFormat.WeekdaySegment.WEEKDAYS[AjxDateFormat.MEDIUM];
AjxDateUtil.WEEKDAY_LONG=AjxDateFormat.WeekdaySegment.WEEKDAYS[AjxDateFormat.LONG];
AjxDateUtil.MONTH_SHORT=AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.SHORT];
AjxDateUtil.MONTH_MEDIUM=AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.MEDIUM];
AjxDateUtil.MONTH_LONG=AjxDateFormat.MonthSegment.MONTHS[AjxDateFormat.LONG];
AjxDateUtil._daysPerMonth={
0:31,1:29,2:31,3:30,4:31,5:30,6:31,7:31,8:30,9:31,10:30,11:31};
AjxDateUtil.MAX_DAYS_PER_MONTH=31;
AjxDateUtil.WEEK_ONE_JAN_DATE=1;
AjxDateUtil._init=function(){
AjxDateUtil._dateFormat=AjxDateFormat.getDateInstance(AjxDateFormat.SHORT).clone();
var e=AjxDateUtil._dateFormat.getSegments();
for(var t=0;
t<e.length;
t++){
if(e[t] instanceof AjxDateFormat.YearSegment){
e[t]=new AjxDateFormat.YearSegment(AjxDateUtil._dateFormat,"yyyy")
}}
AjxDateUtil._dateTimeFormat=new AjxDateFormat(AjxDateUtil._dateFormat.toPattern()+" "+AjxDateFormat.getTimeInstance(AjxDateFormat.SHORT));
AjxDateUtil._dateFormatNoYear=new AjxDateFormat(AjxMsg.formatDateMediumNoYear)
};
AjxDateUtil._init();
AjxDateUtil.validDate=function(o,e,i){
var t=new Date(o,e,i);
var a=o>999?t.getFullYear():t.getYear();
return t.getMonth()==e&&t.getDate()==i&&a==o
};
AjxDateUtil.daysInMonth=function(a,e){
var t=new Date(a,e,1,12);
t.setMonth(t.getMonth()+1);
t.setDate(t.getDate()-1);
return t.getDate()
};
AjxDateUtil.isLeapYear=function(e){
return(new Date(e,1,29)).getMonth()==1
};
AjxDateUtil.isLocale24Hour=function(){
var t=AjxDateFormat.getTimeInstance(AjxDateFormat.SHORT);
var e=t._segments.length;
for(var a=0;
a<e;
a++){
if(t._segments[a]._s=="a"){
return false
}}
return true
};
AjxDateUtil.roll=function(t,a,o){
var i=t.getDate();
if(a==AjxDateUtil.MONTH){
t.setDate(1);
t.setMonth(t.getMonth()+o);
var e=AjxDateUtil.daysInMonth(t.getFullYear(),t.getMonth());
t.setDate(Math.min(i,e))
}else{
if(a==AjxDateUtil.YEAR){
t.setDate(1);
t.setFullYear(t.getFullYear()+o);
var e=AjxDateUtil.daysInMonth(t.getFullYear(),t.getMonth());
t.setDate(Math.min(i,e))
}else{
if(a==AjxDateUtil.WEEK){
t.setDate(t.getDate()+7*o)
}else{
if(a==AjxDateUtil.DAY){
t.setDate(t.getDate()+o)
}else{
if(a==AjxDateUtil.TWO_WEEKS){
t.setDate(t.getDate()+14*o)
}else{
return t
}}}}}
return t
};
AjxDateUtil.isDayShifted=function(e){
var t=new Date(e.getTime());
t.setDate(t.getDate()+1);
t.setHours(0,0,0,0);
return t.getTime()==e.getTime()
};
AjxDateUtil.rollToNextDay=function(e){
e.setHours(0,0,0,0);
e.setTime(e.getTime()+AjxDateUtil.MSEC_PER_DAY)
};
AjxDateUtil.computeDateDelta=function(e){
var t=(new Date()).getTime()-e;
var a=AjxDateUtil.computeDuration(t);
return a?(a+" "+AjxMsg.ago):null
};
AjxDateUtil.agoTime=function(e){
var t=(new Date()).getTime()-e;
var a=AjxDateUtil.computeDuration(t,false,true);
return a?(a+" "+AjxMsg.ago):null
};
AjxDateUtil.computeDuration=function(a,l,n){
if(a<0){
return null
}
var o=Math.floor(a/(AjxDateUtil.MSEC_PER_DAY*365));
if(o!=0){
a-=o*AjxDateUtil.MSEC_PER_DAY*365
}
var t=Math.floor(a/(AjxDateUtil.MSEC_PER_DAY*30.42));
if(t>0){
a-=Math.floor(t*AjxDateUtil.MSEC_PER_DAY*30.42)
}
var h=Math.floor(a/AjxDateUtil.MSEC_PER_DAY);
if(h>0){
a-=h*AjxDateUtil.MSEC_PER_DAY
}
var s=Math.floor(a/AjxDateUtil.MSEC_PER_HOUR);
if(s>0){
a-=s*AjxDateUtil.MSEC_PER_HOUR
}
var e=Math.floor(a/60000);
if(e>0){
a-=e*60000
}
var i=Math.floor(a/1000);
var r=l?AjxDurationFormatConcise:AjxDurationFormatVerbose;
if(o>0){
return n?r.formatYears(o):r.formatYears(o,t)
}else{
if(t>0){
return n?r.formatMonths(t):r.formatMonths(t,h)
}else{
if(h>0){
return n?r.formatDays(h):r.formatDays(h,s)
}else{
if(s>0){
return n?r.formatHours(s):r.formatHours(s,e)
}else{
if(e>0){
return n?r.formatMinutes(e):r.formatMinutes(e,i)
}else{
return r.formatSeconds(i)
}}}}}};
AjxDateUtil.simpleComputeDateStr=function(t,a){
var e=AjxDateUtil._dateFormat.format(t);
return a?a+e:e
};
AjxDateUtil.simpleParseDateStr=function(e){
return AjxDateUtil._dateFormat.parse(e)
};
AjxDateUtil.simpleComputeDateTimeStr=function(t,a){
var e=AjxDateUtil._dateTimeFormat.format(t);
return a?a+e:e
};
AjxDateUtil.simpleParseDateTimeStr=function(e){
return AjxDateUtil._dateTimeFormat.parse(e)
};
AjxDateUtil.longComputeDateStr=function(e){
var t=AjxDateFormat.getDateInstance(AjxDateFormat.FULL);
return t.format(e)
};
AjxDateUtil.computeDateStr=function(a,t){
if(t==null){
return""
}
var e=new Date(t);
if(a.getTime()-t<AjxDateUtil.MSEC_PER_DAY&&a.getDay()==e.getDay()){
return AjxDateUtil.computeTimeString(e)
}
if(a.getFullYear()==e.getFullYear()){
return AjxDateUtil._dateFormatNoYear.format(e)
}
return AjxDateUtil.simpleComputeDateStr(e)
};
AjxDateUtil.computeDateStrNoYear=function(e){
return AjxDateUtil._dateFormatNoYear.format(e)
};
AjxDateUtil.computeWordyDateStr=function(a,t){
if(t==null){
return""
}
var e=new Date(t);
if(a.getTime()-t<AjxDateUtil.MSEC_PER_DAY&&a.getDay()==e.getDay()){
if(!AjxDateUtil._wordyDateToday){
AjxDateUtil._wordyDateToday=new AjxDateFormat(AjxMsg.formatWordyDateToday)
}
return AjxDateUtil._wordyDateToday.format(e)
}else{
if((a.getTime()-t)<(2*AjxDateUtil.MSEC_PER_DAY)&&(a.getDay()-1)==e.getDay()){
if(!AjxDateUtil._wordyDateYesterday){
AjxDateUtil._wordyDateYesterday=new AjxDateFormat(AjxMsg.formatWordyDateYesterday)
}
return AjxDateUtil._wordyDateYesterday.format(e)
}else{
if(!AjxDateUtil._wordyDate){
AjxDateUtil._wordyDate=new AjxDateFormat(AjxMsg.formatWordyDate)
}
return AjxDateUtil._wordyDate.format(e)
}}};
AjxDateUtil.isValidSimpleDateStr=function(a){
if(!a){
return false
}
var t=AjxDateUtil.getSimpleDateFormat().parse(a);
if(!t){
return false
}
var e=AjxDateUtil.simpleComputeDateStr(t);
return(a==e)
};
AjxDateUtil.computeTimeString=function(e){
var t=AjxDateFormat.getTimeInstance(AjxDateFormat.SHORT);
return t.format(e)
};
AjxDateUtil.computeDateTimeString=function(e){
var t=AjxDateFormat.getDateTimeInstance(AjxDateFormat.LONG);
return t.format(e)
};
AjxDateUtil._getHoursStr=function(t,a,e){
var i=t.getHours();
if(!e){
i%=12;
if(i==0){
i=12
}}
return a?AjxDateUtil._pad(i):i
};
AjxDateUtil._getMinutesStr=function(e){
return AjxDateUtil._pad(e.getMinutes())
};
AjxDateUtil._getSecondsStr=function(e){
return AjxDateUtil._pad(e.getSeconds())
};
AjxDateUtil._getAMPM=function(t,a){
var e=t.getHours();
return(e<12)?(a?"AM":"am"):(a?"PM":"pm")
};
AjxDateUtil._getMonthName=function(e,t){
return t?AjxDateUtil.MONTH_MEDIUM[e.getMonth()]:AjxDateUtil.MONTH_LONG[e.getMonth()]
};
AjxDateUtil._getMonth=function(e,a){
var t=e.getMonth()+1;
if(a){
return AjxDateUtil._pad(t)
}else{
return t
}};
AjxDateUtil._getDate=function(e,t){
var a=e.getDate();
return t?AjxDateUtil._pad(a):a
};
AjxDateUtil._getWeekday=function(e){
var t=e.getDay();
return AjxDateUtil.WEEKDAY_LONG[t]
};
AjxDateUtil._getWeekdayMedium=function(e){
var t=e.getDay();
return AjxDateUtil.WEEKDAY_MEDIUM[t]
};
AjxDateUtil._getFullYear=function(e){
return e.getFullYear()
};
AjxDateUtil.getFirstDayOfWeek=function(i,e){
e=e||0;
var t=i.getDay();
var a=(t-e+7)%7;
i.setDate(i.getDate()-a);
return i
};
AjxDateUtil.getLastDayOfWeek=function(i,e){
e=e||0;
var t=i.getDay();
var a=(t-e+7)%7;
i.setDate(i.getDate()-a+6);
i.setHours(23,59,59,999);
return i
};
AjxDateUtil.getWeekNumber=function(p,l,x,w){
l=l||0;
x=x||AjxDateUtil.WEEK_ONE_JAN_DATE;
p=p||new Date();
p.setHours(12,0,0,0);
var o=p,k,r;
if(o.getDay()===l){
k=o
}else{
k=AjxDateUtil.getFirstDayOfWeek(o,l)
}
var d=k.getFullYear(),h=k.getTime();
r=new Date(k.getTime()+6*AjxDateUtil.MSEC_PER_DAY);
var e;
if(!w){
if(d!==r.getFullYear()&&r.getDate()>=x){
e=1
}else{
var n=(new Date(d,0,x));
n.setHours(12,0,0,0);
var i=AjxDateUtil.getFirstDayOfWeek(n,l);
var m=Math.round((o.getTime()-i.getTime())/AjxDateUtil.MSEC_PER_DAY);
var t=m%7;
var v=(m-t)/7;
e=v+1
}
return e
}else{
var g=new Date(p.getFullYear(),0,1);
var u=g.getDay()-1;
u=(u>=0?u:u+7);
var a=Math.floor((p.getTime()-g.getTime()-(p.getTimezoneOffset()-g.getTimezoneOffset())*60000)/AjxDateUtil.MSEC_PER_DAY)+1;
if(u<4){
e=Math.floor((a+u-1)/7)+1;
if(e>52){
var y=new Date(p.getFullYear()+1,0,1);
var f=y.getDay()-1;
f=f>=0?f:f+7;
e=f<4?1:53
}}else{
e=Math.floor((a+u-1)/7);
if(e==0){
var s=new Date(p.getFullYear()-1,0,1);
var c=s.getDay()-1;
c=(c>=0?c:c+7);
e=(c==3||(AjxDateUtil.isLeapYear(s.getFullYear())&&c==2))?53:52
}}
return e
}};
AjxDateUtil.getTimeStr=function(e,a){
var t=a;
t=t.replace(/%d/g,AjxDateUtil._getDate(e,true));
t=t.replace(/%D/g,AjxDateUtil._getDate(e,false));
t=t.replace(/%w/g,AjxDateUtil._getWeekday(e));
t=t.replace(/%M/g,AjxDateUtil._getMonthName(e));
t=t.replace(/%t/g,AjxDateUtil._getMonthName(e,true));
t=t.replace(/%n/g,AjxDateUtil._getMonth(e,true));
t=t.replace(/%Y/g,AjxDateUtil._getFullYear(e));
t=t.replace(/%h/g,AjxDateUtil._getHoursStr(e,false,false));
t=t.replace(/%H/g,AjxDateUtil._getHoursStr(e,true,false));
t=t.replace(/%m/g,AjxDateUtil._getMinutesStr(e));
t=t.replace(/%s/g,AjxDateUtil._getSecondsStr(e));
t=t.replace(/%P/g,AjxDateUtil._getAMPM(e,true));
t=t.replace(/%p/g,AjxDateUtil._getAMPM(e,false));
return t
};
AjxDateUtil.getRoundedMins=function(e,a){
var t=e.getMinutes();
if(t!=0&&a){
t=(Math.ceil((t/a)))*a
}
return t
};
AjxDateUtil.roundTimeMins=function(t,i){
var a=t.getMinutes();
var e=t.getHours();
if(a!=0&&i){
a=(Math.ceil((a/i)))*i;
if(a==60){
a=0;
e++
}
t.setMinutes(a);
t.setHours(e)
}
return t
};
AjxDateUtil.isInRange=function(i,t,a,e){
return(i<e&&t>a)
};
AjxDateUtil.getSimpleDateFormat=function(){
return AjxDateUtil._dateFormat
};
AjxDateUtil.getServerDate=function(e){
if(!AjxDateUtil._serverDateFormatter){
AjxDateUtil._serverDateFormatter=new AjxDateFormat("yyyyMMdd")
}
return AjxDateUtil._serverDateFormatter.format(e)
};
AjxDateUtil.getServerDateTime=function(t,i){
var e=t;
var a=null;
if(i){
if(!AjxDateUtil._serverDateTimeFormatterUTC){
AjxDateUtil._serverDateTimeFormatterUTC=new AjxDateFormat("yyyyMMdd'T'HHmmss'Z'")
}
a=AjxDateUtil._serverDateTimeFormatterUTC;
e=new Date(t.getTime());
e.setMinutes(e.getMinutes()+e.getTimezoneOffset())
}else{
if(!AjxDateUtil._serverDateTimeFormatter){
AjxDateUtil._serverDateTimeFormatter=new AjxDateFormat("yyyyMMdd'T'HHmmss")
}
a=AjxDateUtil._serverDateTimeFormatter
}
return a.format(e)
};
AjxDateUtil.parseServerTime=function(o,e,i){
if(o.charAt(8)=="T"){
var a=parseInt(o.substr(9,2),10);
var n=parseInt(o.substr(11,2),10);
var t=parseInt(o.substr(13,2),10);
if(!i&&o.charAt(15)=="Z"){
n+=AjxTimezone.getOffset(AjxTimezone.DEFAULT,e)
}
e.setHours(a,n,t,0)
}
return e
};
AjxDateUtil.parseISO8601Date=function(o){
var t=AjxDateUtil.__ISO8601_formats;
if(!t){
t=AjxDateUtil.__ISO8601_formats=[new AjxDateUtil.TZDFormat("yyyy-MM-dd'T'HH:mm:ss.SZ"),new AjxDateUtil.TZDFormat("yyyy-MM-dd'T'HH:mm:ssZ"),new AjxDateUtil.TZDFormat("yyyy-MM-dd'T'HH:mmZ"),new AjxDateFormat("yyyy-MM-dd"),new AjxDateFormat("yyyy-MM"),new AjxDateFormat("yyyy")]
}
for(var a=0;
a<t.length;
a++){
var e=t[a].parse(o);
if(e){
return e
}}
return null
};
AjxDateUtil.TZDFormat=function(o){
if(arguments.length==0){
return
}
AjxDateFormat.apply(this,arguments);
var e=this._segments||[];
for(var t=0;
t<e.length;
t++){
var a=e[t];
if(a instanceof AjxDateFormat.TimezoneSegment){
e[t]=new AjxDateUtil.TZDSegment(a.toSubPattern())
}}};
AjxDateUtil.TZDFormat.prototype=new AjxDateFormat;
AjxDateUtil.TZDFormat.prototype.constructor=AjxDateUtil.TZDFormat;
AjxDateUtil.TZDFormat.prototype.toString=function(){
return"TZDFormat"
};
AjxDateUtil.TZDSegment=function(e){
if(arguments.length==0){
return
}
AjxDateFormat.TimezoneSegment.apply(this,arguments)
};
AjxDateUtil.TZDSegment.prototype=new AjxDateFormat.TimezoneSegment;
AjxDateUtil.TZDSegment.prototype.constructor=AjxDateUtil.TZDSegment;
AjxDateUtil.TZDSegment.prototype.toString=function(){
return"TZDSegment"
};
AjxDateUtil.TZDSegment.prototype.parse=function(l,n,a){
var e=/^(Z)|^(\+|\-)(\d\d):(\d\d)/.exec(n.substr(a));
if(e){
var h=new Date().getTimezoneOffset();
if(e[1]){
l.timezone=h
}else{
var t=parseInt(e[3],10),r=parseInt(e[4],10);
l.timezone=t*60+r;
if(e[2]!="-"){
l.timezone*=-1
}
l.timezone-=h
}}
return a+(e?e[0].length:0)
};
AjxDateUtil.parseServerDateTime=function(a,t){
if(a==null){
return null
}
var i=new Date();
var n=parseInt(a.substr(0,4),10);
var o=parseInt(a.substr(4,2),10);
var e=parseInt(a.substr(6,2),10);
i.setFullYear(n);
i.setMonth(o-1);
i.setMonth(o-1);
i.setDate(e);
AjxDateUtil.parseServerTime(a,i,t);
return i
};
AjxDateUtil._pad=function(e){
return e<10?("0"+e):e
};
AjxDurationFormatVerbose=function(){};
AjxDurationFormatVerbose.formatYears=function(a,e){
var t=a+" ";
t+=(a>1)?AjxMsg.years:AjxMsg.year;
if(a<=3&&e>0){
t+=" "+e;
t+=" "+((e>1)?AjxMsg.months:AjxMsg.months)
}
return t
};
AjxDurationFormatVerbose.formatMonths=function(e,a){
var t=e+" ";
t+=(e>1)?AjxMsg.months:AjxMsg.month;
if(e<=3&&a>0){
t+=" "+a;
t+=" "+((a>1)?AjxMsg.days:AjxMsg.day)
}
return t
};
AjxDurationFormatVerbose.formatDays=function(a,e){
var t=a+" ";
t+=(a>1)?AjxMsg.days:AjxMsg.day;
if(a<=2&&e>0){
t+=" "+e;
t+=" "+((e>1)?AjxMsg.hours:AjxMsg.hour)
}
return t
};
AjxDurationFormatVerbose.formatHours=function(e,a){
var t=e+" ";
t+=(e>1)?AjxMsg.hours:AjxMsg.hour;
if(e<5&&a>0){
t+=" "+a;
t+=" "+((a>1)?AjxMsg.minutes:AjxMsg.minute)
}
return t
};
AjxDurationFormatVerbose.formatMinutes=function(a,t){
var e=a+" ";
e+=((a>1)?AjxMsg.minutes:AjxMsg.minute);
if(a<5&&t>0){
e+=" "+t;
e+=" "+((t>1)?AjxMsg.seconds:AjxMsg.second)
}
return e
};
AjxDurationFormatVerbose.formatSeconds=function(e){
return(e+" "+((e>1)?AjxMsg.seconds:AjxMsg.second))
};
AjxDurationFormatConcise=function(){};
AjxDurationFormatConcise.formatYears=function(t,e){
return this._format(t,e)
};
AjxDurationFormatConcise.formatMonths=function(e,t){
return this._format(e,t)
};
AjxDurationFormatConcise.formatDays=function(t,e){
return this._format(t,e)
};
AjxDurationFormatConcise.formatHours=function(e,t){
return this._format(e,t)
};
AjxDurationFormatConcise.formatMinutes=function(t,e){
return this._format(t,e)
};
AjxDurationFormatConcise.formatSeconds=function(e){
return this._format(0,e)
};
AjxDurationFormatConcise._format=function(o,t){
var n=0;
var e=[];
e[n++]=o;
e[n++]=":";
if(t<10){
e[n++]="0"
}
e[n++]=t;
return e.join("")
};
AjxDateUtil.SUNDAY=0;
AjxDateUtil.MONDAY=1;
AjxDateUtil.TUESDAY=2;
AjxDateUtil.WEDNESDAY=3;
AjxDateUtil.THURSDAY=4;
AjxDateUtil.FRIDAY=5;
AjxDateUtil.SATURDAY=6;
AjxDateUtil.getDateForNextDay=function(t,n,o){
o=o||1;
var a=new Date(t);
for(var e=0;
e<o;
e++){
a=AjxDateUtil._getDateForNextWeekday(a,n);
if(e<o-1){
a.setDate(a.getDate()+1)
}}
return a
};
AjxDateUtil.getDateForNextWorkWeekDay=function(t,o){
o=o?o:1;
var a=new Date(t);
for(var e=0;
e<o;
e++){
a=AjxDateUtil._getDateForNextWorkWeekday(a);
if(e<o-1){
a.setDate(a.getDate()+1)
}}
return a
};
AjxDateUtil.getDateForThisDay=function(e,a,t){
if(t<0){
return AjxDateUtil.getDateForPrevDay(e,a,-t)
}else{
return AjxDateUtil.getDateForNextDay(e,a,t)
}};
AjxDateUtil.getDateForThisWorkWeekDay=function(e,t){
if(t<0){
return AjxDateUtil.getDateForPrevWorkWeekDay(e,-t)
}else{
return AjxDateUtil.getDateForNextWorkWeekDay(e,t)
}};
AjxDateUtil.getDateForPrevDay=function(t,n,o){
o=o||1;
var a=new Date(t);
for(var e=0;
e<o;
e++){
a=AjxDateUtil._getDateForPrevWeekday(a,n);
if(e<o-1){
a.setDate(a.getDate()-1)
}}
return a
};
AjxDateUtil.getDateForPrevWorkWeekDay=function(t,o){
o=o||1;
var a=new Date(t);
for(var e=0;
e<o;
e++){
a=AjxDateUtil._getDateForPrevWorkWeekday(a);
if(e<o-1){
a.setDate(a.getDate()-1)
}}
return a
};
AjxDateUtil.dateLocal2GMT=function(c){
if(!c){
return""
}
var u,t,m,d,r,h;
u=parseInt(c.substr(0,4),10);
t=parseInt(c.substr(4,2),10);
m=parseInt(c.substr(6,2),10);
d=parseInt(c.substr(8,2),10);
r=parseInt(c.substr(10,2),10);
h=parseInt(c.substr(12,2),10);
var o=new Date(u,t-1,m,d,r,h,0);
u=o.getUTCFullYear();
t=o.getUTCMonth()+1;
m=o.getUTCDate();
d=o.getUTCHours();
r=o.getUTCMinutes();
h=o.getUTCSeconds();
var l=[u,t,m,d,r,h];
for(var s=l.length;
--s>0;
){
var e=l[s];
if(e<10){
l[s]="0"+e
}}
return(l.join("")+"Z")
};
AjxDateUtil.dateGMT2Local=function(c){
if(!c){
return""
}
var u,t,m,d,r,h;
u=parseInt(c.substr(0,4),10);
t=parseInt(c.substr(4,2),10);
m=parseInt(c.substr(6,2),10);
d=parseInt(c.substr(8,2),10);
r=parseInt(c.substr(10,2),10);
h=parseInt(c.substr(12,2),10);
var o=new Date();
o.setUTCMilliseconds(0);
o.setUTCSeconds(h);
o.setUTCMinutes(r);
o.setUTCHours(d);
o.setUTCDate(m);
o.setUTCMonth(t-1);
o.setUTCFullYear(u);
u=o.getFullYear();
t=o.getMonth()+1;
m=o.getDate();
d=o.getHours();
r=o.getMinutes();
h=o.getSeconds();
var l=[u,t,m,d,r,h];
for(var s=l.length;
--s>0;
){
var e=l[s];
if(e<10){
l[s]="0"+e
}}
return(l.join("")+"Z")
};
AjxDateUtil._getDateForNextWeekday=function(a,o){
var e=new Date(a);
var t=a.getDay();
if(t==o){
return e
}
var i=(o-t);
if(i>0){
e.setDate(a.getDate()+i)
}else{
e.setDate(a.getDate()+(7+i))
}
return e
};
AjxDateUtil._getDateForNextWorkWeekday=function(a){
var e=new Date(a);
var t=a.getDay();
if(t==AjxDateUtil.SUNDAY){
e.setDate(a.getDate()+1)
}else{
if(t==AjxDateUtil.SATURDAY){
e.setDate(a.getDate()+2)
}}
return e
};
AjxDateUtil._getDateForPrevWeekday=function(a,o){
var e=new Date(a);
var t=a.getDay();
if(t==o){
return e
}
var i=(t-o);
if(i>0){
e.setDate(a.getDate()-i)
}else{
e.setDate(a.getDate()-(7+i))
}
return e
};
AjxDateUtil._getDateForPrevWorkWeekday=function(a){
var e=new Date(a);
var t=a.getDay();
if(t==AjxDateUtil.SUNDAY){
e.setDate(a.getDate()-2)
}else{
if(t==AjxDateUtil.SATURDAY){
e.setDate(a.getDate()-1)
}}
return e
};
AjxDateUtil.calculate=function(u,n){
if(!AjxDateUtil.__calculate_initialized){
AjxDateUtil.__calculate_initialized=true;
AjxDateUtil.__calculate_init()
}
var e=n||new Date;
u=u.replace(/^\s*|\s*$/,"").replace(/\s*=\s*/g,"=").replace(/\s*,\s*/g,",");
var f=u.split(/\s+/g);
var g,r,o,h,d,c,p,t;
for(var l=0;
l<f.length;
l++){
g=f[l];
if(g.match(AjxDateUtil.RE_COMMENT)){
break
}
if(g.match(AjxDateUtil.RE_NOW)){
n=new Date(e.getTime());
continue
}
if(r=g.match(AjxDateUtil.RE_ADD_NUMBER)){
o=r[1];
h=AjxDateUtil.__calculate_parseInt(r[2]);
d=f[++l];
c=o=="+"?h:h*-1;
AjxDateUtil.__calculate_add(n,d,c);
continue
}
if(r=g.match(AjxDateUtil.RE_SET)){
AjxDateUtil.__calculate_set(n,r[1],r[2]);
continue
}
n=AjxDateFormat.parse("yyyyy-MM-dd",g);
if(!n&&(n=AjxDateFormat.parse("yyyy-MM-dd'T'hh:mm:ss'Z'",g))){
n.setMinutes(n.getMinutes()-n.getTimezoneOffset())
}
if(!n){
n=AjxDateFormat.parse("yyyy-MM-dd'T'HH:mm:ss",g)
}
if(!n){
throw'invalid date pattern: "'+g+'"'
}}
return n
};
AjxDateUtil.S_DAYNAME=[AjxMsg["calc.dayname.sunday"],AjxMsg["calc.dayname.monday"],AjxMsg["calc.dayname.tuesday"],AjxMsg["calc.dayname.wednesday"],AjxMsg["calc.dayname.thursday"],AjxMsg["calc.dayname.friday"],AjxMsg["calc.dayname.saturday"]].join("|");
AjxDateUtil.S_MONTHNAME=[AjxMsg["calc.monthname.january"],AjxMsg["calc.monthname.february"],AjxMsg["calc.monthname.march"],AjxMsg["calc.monthname.april"],AjxMsg["calc.monthname.may"],AjxMsg["calc.monthname.june"],AjxMsg["calc.monthname.july"],AjxMsg["calc.monthname.august"],AjxMsg["calc.monthname.september"],AjxMsg["calc.monthname.october"],AjxMsg["calc.monthname.november"],AjxMsg["calc.monthname.december"]].join("|");
AjxDateUtil.S_WEEKORD=[AjxMsg["calc.ordinal.first"],AjxMsg["calc.ordinal.second"],AjxMsg["calc.ordinal.third"],AjxMsg["calc.ordinal.fourth"],AjxMsg["calc.ordinal.fifth"],AjxMsg["calc.ordinal.last"]].join("|");
AjxDateUtil.WEEKORD_RE=[new RegExp("(first|"+AjxMsg["calc.ordinal.first"]+")","i"),new RegExp("(second|"+AjxMsg["calc.ordinal.second"]+")","i"),new RegExp("(third|"+AjxMsg["calc.ordinal.third"]+")","i"),new RegExp("(fourth|"+AjxMsg["calc.ordinal.fourth"]+")","i"),new RegExp("(last|"+AjxMsg["calc.ordinal.last"]+")","i")];
AjxMsg["calc.now"]="now";
AjxMsg["calc.date"]="date";
AjxMsg["calc.duration.year"]="year|years";
AjxMsg["calc.duration.month"]="mons|month|months";
AjxMsg["calc.duration.day"]="day|days";
AjxMsg["calc.duration.hour"]="hour|hours";
AjxMsg["calc.duration.minute"]="min|mins|minute|minutes";
AjxMsg["calc.duration.week"]="week";
AjxMsg["calc.duration.second"]="sec|secs|second|seconds";
AjxMsg["calc.duration.millisecond"]="milli|millis|millisecond|milliseconds";
AjxDateUtil.S_DURATION=[AjxMsg["calc.duration.year"],AjxMsg["calc.duration.month"],AjxMsg["calc.duration.week"],AjxMsg["calc.duration.day"],AjxMsg["calc.duration.hour"],AjxMsg["calc.duration.minute"],AjxMsg["calc.duration.second"],AjxMsg["calc.duration.millisecond"]].join("|");
AjxDateUtil.__calculate_init=function(){
AjxDateUtil.WEEKDAYS={};
var t=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];
for(var o=0;
o<t.length;
o++){
var n=AjxMsg["calc.dayname."+t[o]].split("|");
for(var a=0;
a<n.length;
a++){
AjxDateUtil.WEEKDAYS[n[a].toLowerCase()]=o
}}
AjxDateUtil.MONTHNAME2MONTHNUM={};
var e=["january","february","march","april","may","june","july","august","september","october","november","december"];
for(var o=0;
o<e.length;
o++){
var s=AjxMsg["calc.monthname."+e[o]].split("|");
for(var a=0;
a<s.length;
a++){
AjxDateUtil.MONTHNAME2MONTHNUM[s[a].toLowerCase()]=o
}}
AjxDateUtil.RE_YEAR=new RegExp("^("+AjxMsg["calc.duration.year"]+")$","i");
AjxDateUtil.RE_MONTH=new RegExp("^("+AjxMsg["calc.duration.month"]+")$","i");
AjxDateUtil.RE_WEEK=new RegExp("^("+AjxMsg["calc.duration.week"]+")$","i");
AjxDateUtil.RE_DAY=new RegExp("^("+AjxMsg["calc.duration.day"]+")$","i");
AjxDateUtil.RE_HOUR=new RegExp("^("+AjxMsg["calc.duration.hour"]+")$","i");
AjxDateUtil.RE_MINUTE=new RegExp("^("+AjxMsg["calc.duration.minute"]+")$","i");
AjxDateUtil.RE_SECOND=new RegExp("^("+AjxMsg["calc.duration.second"]+")$","i");
AjxDateUtil.RE_MILLISECOND=new RegExp("^("+AjxMsg["calc.duration.millisecond"]+")$","i");
AjxDateUtil.RE_DATE=new RegExp("^("+AjxMsg["calc.date"]+")$","i");
AjxDateUtil.RE_DAYNAME=new RegExp("^("+AjxDateUtil.S_DAYNAME+")$","i");
AjxDateUtil.RE_MONTHNAME=new RegExp("^("+AjxDateUtil.S_MONTHNAME+")$","i");
AjxDateUtil.RE_WEEKORD=new RegExp("^("+AjxDateUtil.S_WEEKORD+")$","i");
AjxDateUtil.RE_COMMENT=/^#/;
AjxDateUtil.RE_NOW=new RegExp("^("+AjxMsg["calc.now"]+")$","i");
AjxDateUtil.RE_ADD_NUMBER=new RegExp("^([+\\-])(\\d+)$","i");
AjxDateUtil.RE_SET=new RegExp("^("+AjxDateUtil.S_DURATION+"|"+AjxMsg["calc.date"]+")=(.*)$","i")
};
AjxDateUtil.__calculate_normalizeFullWidthDigit=function(t){
var e="0".charCodeAt(0)+t.charCodeAt(0)-"\uff10".charCodeAt(0);
return String.fromCharCode(e)
};
AjxDateUtil.__calculate_replaceFullWidthDigit=function(e,t){
return AjxDateUtil.__calculate_normalizeFullWidthDigit(t)
};
AjxDateUtil.__calculate_parseInt=function(e){
e=e.replace(/([\uFF10-\uFF19])/g,AjxDateUtil.__calculate_normalizeFullWidthDigit);
return parseInt(e,10)
};
AjxDateUtil.__calculate_add=function(a,o,i){
if(o.match(AjxDateUtil.RE_YEAR)){
a.setFullYear(a.getFullYear()+i);
return
}
if(o.match(AjxDateUtil.RE_MONTH)){
var n=a.getMonth();
a.setMonth(n+i);
if(Math.abs(n+i)%12!=a.getMonth()){
a.setDate(0)
}
return
}
if(o.match(AjxDateUtil.RE_WEEK)){
a.setDate(a.getDate()+i*7);
return
}
if(o.match(AjxDateUtil.RE_DAY)){
a.setDate(a.getDate()+i);
return
}
if(o.match(AjxDateUtil.RE_HOUR)){
a.setHours(a.getHours()+i);
return
}
if(o.match(AjxDateUtil.RE_MINUTE)){
a.setMinutes(a.getMinutes()+i);
return
}
if(o.match(AjxDateUtil.RE_SECOND)){
a.setSeconds(a.getSeconds()+i);
return
}
if(o.match(AjxDateUtil.RE_MILLISECOND)){
a.setMilliseconds(a.getMilliseconds()+i);
return
}
if(o.match(AjxDateUtil.RE_MONTHNAME)){
var e=AjxDateUtil.MONTHNAME2MONTHNUM[o.toLowerCase()];
if(e<a.getMonth()){
i+=i>0?0:1
}else{
if(e>a.getMonth()){
i+=i>0?-1:0
}}
a.setFullYear(a.getFullYear()+i,e,1);
return
}
if(o.match(AjxDateUtil.RE_DAYNAME)){
var t=AjxDateUtil.WEEKDAYS[o.toLowerCase()];
if(t<a.getDay()){
i+=i>0?0:1
}else{
if(t>a.getDay()){
i+=i>0?-1:0
}}
a.setDate(a.getDate()+(t-a.getDay())+7*i);
return
}
throw"unknown type: "+o
};
AjxDateUtil.__calculate_add_ordinal=function(){
throw"TODO: not implemented"
};
AjxDateUtil.__calculate_set=function(i,r,l){
var n=l.split(/,/);
if(n[0].indexOf("H")==0){
n[0]=parseInt(n[0].replace("H",""))+1988
}
if(r.match(AjxDateUtil.RE_YEAR)){
n[0]=AjxDateUtil.__calculate_fullYear(n[0]);
if(n[1]!=null){
n[1]=AjxDateUtil.__calculate_month(n[1])
}
if(n[2]!=null){
n[2]=parseInt(n[2],10)
}
i.setFullYear.apply(i,n);
return
}
if(r.match(AjxDateUtil.RE_MONTH)){
n[0]=AjxDateUtil.__calculate_month(n[0]);
if(n[1]!=null){
n[1]=parseInt(n[1],10)
}
i.setMonth.apply(i,n);
return
}
if(r.match(AjxDateUtil.RE_WEEK)){
var t=AjxDateUtil.__calculate_week(n[0]);
var h=n[1]?AjxDateUtil.__calculate_day(n[1]):i.getDay();
var o;
if(t!=-1){
var e=new Date(i.getFullYear(),i.getMonth(),1,12,0,0,0);
var a=e.getDay();
var c=a-h;
o=new Date(e.getTime());
o.setDate(1-c);
if(c>0){
o.setDate(o.getDate()+7)
}
o.setDate(o.getDate()+7*t)
}else{
var s=new Date(i.getFullYear(),i.getMonth()+1,0,12,0,0,0);
o=new Date(s.getTime());
o.setDate(o.getDate()-(o.getDay()-h));
if(o.getMonth()!=s.getMonth()){
o.setDate(o.getDate()-7)
}}
if(o&&(i.getMonth()==o.getMonth())){
i.setTime(o.getTime())
}
return
}
if(r.match(AjxDateUtil.RE_DATE)){
n[0]=parseInt(n[0],10);
i.setDate.apply(i,n);
return
}
if(r.match(AjxDateUtil.RE_HOUR)){
n[0]=parseInt(n[0],10);
if(n[1]!=null){
n[1]=parseInt(n[1],10)
}
if(n[2]!=null){
n[2]=parseInt(n[2],10)
}
if(n[3]!=null){
n[3]=parseInt(n[3],10)
}
i.setHours.apply(i,n);
return
}
if(r.match(AjxDateUtil.RE_MINUTE)){
n[0]=parseInt(n[0],10);
if(n[1]!=null){
n[1]=parseInt(n[1],10)
}
if(n[2]!=null){
n[2]=parseInt(n[2],10)
}
i.setMinutes.apply(i,n);
return
}
if(r.match(AjxDateUtil.RE_SECOND)){
n[0]=parseInt(n[0],10);
if(n[1]!=null){
n[1]=parseInt(n[1],10)
}
i.setSeconds.apply(i,n);
return
}
if(r.match(AjxDateUtil.RE_MILLISECOND)){
i.setMilliseconds.apply(i,n);
return
}
throw"unknown type: "+r
};
AjxDateUtil.__calculate_fullYear=function(t){
if(t.length==2){
var a=new Date;
a.setYear(parseInt(t,10));
var e=a.getFullYear();
if(e<=AjxMsg.dateParsing2DigitStartYear){
t=String(e+100)
}else{
t=String(e).substr(0,2)+t
}}
return parseInt(t,10)
};
AjxDateUtil.__calculate_month=function(t){
var e=AjxDateUtil.MONTHNAME2MONTHNUM[t.toLowerCase()];
return e!=null?e:parseInt(t,10)-1
};
AjxDateUtil.__calculate_week=function(t){
for(var e=0;
e<AjxDateUtil.WEEKORD_RE.length;
e++){
if(t.match(AjxDateUtil.WEEKORD_RE[e])){
if(e==AjxDateUtil.WEEKORD_RE.length-1){
return -1
}
return e
}}
return 0
};
AjxDateUtil.__calculate_day=function(t){
var e=AjxDateUtil.WEEKDAYS[t.toLowerCase()];
return e!=null?e:parseInt(t,10)
}
}
if(AjxPackage.define("ajax.util.AjxTimezoneData")){
AjxTimezoneData={};
AjxTimezoneData.TRANSITION_YEAR=2020;
AjxTimezoneData.TIMEZONE_RULES=[{
serverId:"Etc/GMT+12",clientId:"Etc/GMT+12",score:100,standard:{
offset:-720,tzname:"-12"}}
,{
serverId:"Pacific/Midway",clientId:"Pacific/Midway",score:100,standard:{
offset:-660,tzname:"-11"}}
,{
serverId:"America/Adak",clientId:"America/Adak",score:100,standard:{
offset:-600,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"HST"}
,daylight:{
offset:-540,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"HDT"}}
,{
serverId:"Pacific/Honolulu",clientId:"Pacific/Honolulu",score:200,standard:{
offset:-600,tzname:"HST"}}
,{
serverId:"Pacific/Marquesas",clientId:"Pacific/Marquesas",score:100,standard:{
offset:-570,tzname:"-0930"}}
,{
serverId:"America/Anchorage",clientId:"America/Anchorage",score:200,standard:{
offset:-540,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"AKST"}
,daylight:{
offset:-480,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"AKDT"}}
,{
serverId:"America/Los_Angeles",clientId:"America/Los_Angeles",score:200,standard:{
offset:-480,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"PST"}
,daylight:{
offset:-420,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"PDT"}}
,{
serverId:"America/Tijuana",clientId:"America/Tijuana",score:100,standard:{
offset:-480,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"PST"}
,daylight:{
offset:-420,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"PDT"}}
,{
serverId:"America/Chihuahua",clientId:"America/Chihuahua",score:100,standard:{
offset:-420,mon:10,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,10,25],tzname:"MST"}
,daylight:{
offset:-360,mon:4,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,4,5],tzname:"MDT"}}
,{
serverId:"America/Denver",clientId:"America/Denver",score:200,standard:{
offset:-420,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"MST"}
,daylight:{
offset:-360,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"MDT"}}
,{
serverId:"America/Fort_Nelson",clientId:"America/Fort_Nelson",score:100,standard:{
offset:-420,tzname:"MST"}}
,{
serverId:"America/Phoenix",clientId:"America/Phoenix",score:200,standard:{
offset:-420,tzname:"MST"}}
,{
serverId:"America/Chicago",clientId:"America/Chicago",score:200,standard:{
offset:-360,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"CST"}
,daylight:{
offset:-300,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"CDT"}}
,{
serverId:"America/Guatemala",clientId:"America/Guatemala",score:100,standard:{
offset:-360}}
,{
serverId:"America/Mexico_City",clientId:"America/Mexico_City",score:100,standard:{
offset:-360,mon:10,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,10,25],tzname:"CST"}
,daylight:{
offset:-300,mon:4,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,4,5],tzname:"CDT"}}
,{
serverId:"America/Regina",clientId:"America/Regina",score:200,standard:{
offset:-360,tzname:"CST"}}
,{
serverId:"Pacific/Easter",clientId:"Pacific/Easter",score:100,standard:{
offset:-360,mon:5,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,5,10],tzname:"-06/-05"}
,daylight:{
offset:-300,mon:8,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,8,9],tzname:"-06/-05"}}
,{
serverId:"America/Bogota",clientId:"America/Bogota",score:100,standard:{
offset:-300,tzname:"-05/-04"}}
,{
serverId:"America/Cancun",clientId:"America/Cancun",score:100,standard:{
offset:-300,tzname:"EST"}}
,{
serverId:"America/Havana",clientId:"America/Havana",score:100,standard:{
offset:-300,mon:11,week:1,wkday:1,hour:1,min:0,sec:0,trans:[2020,11,1],tzname:"CST"}
,daylight:{
offset:-240,mon:3,week:2,wkday:1,hour:0,min:0,sec:0,trans:[2020,3,8],tzname:"CDT"}}
,{
serverId:"America/Indiana/Indianapolis",clientId:"America/Indiana/Indianapolis",score:100,standard:{
offset:-300,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"EST"}
,daylight:{
offset:-240,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"EDT"}}
,{
serverId:"America/New_York",clientId:"America/New_York",score:200,standard:{
offset:-300,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"EST"}
,daylight:{
offset:-240,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"EDT"}}
,{
serverId:"America/Port-au-Prince",clientId:"America/Port-au-Prince",score:100,standard:{
offset:-300,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"EST"}
,daylight:{
offset:-240,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"EDT"}}
,{
serverId:"America/Asuncion",clientId:"America/Asuncion",score:100,standard:{
offset:-240,mon:3,week:-1,wkday:1,hour:0,min:0,sec:0,trans:[2020,3,29],tzname:"-04/-03"}
,daylight:{
offset:-180,mon:10,week:1,wkday:1,hour:0,min:0,sec:0,trans:[2020,10,4],tzname:"-04/-03"}}
,{
serverId:"America/Caracas",clientId:"America/Caracas",score:100,standard:{
offset:-240,tzname:"-04"}}
,{
serverId:"America/Cuiaba",clientId:"America/Cuiaba",score:100,standard:{
offset:-240,mon:2,week:3,wkday:1,hour:0,min:0,sec:0,trans:[2020,2,16],tzname:"-04/-03"}
,daylight:{
offset:-180,mon:10,week:3,wkday:1,hour:0,min:0,sec:0,trans:[2020,10,18],tzname:"-04/-03"}}
,{
serverId:"America/Grand_Turk",clientId:"America/Grand_Turk",score:100,standard:{
offset:-240,tzname:"AST"}}
,{
serverId:"America/Guyana",clientId:"America/Guyana",score:100,standard:{
offset:-240,tzname:"-04"}}
,{
serverId:"America/Halifax",clientId:"America/Halifax",score:100,standard:{
offset:-240,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"AST"}
,daylight:{
offset:-180,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"ADT"}}
,{
serverId:"America/Santiago",clientId:"America/Santiago",score:100,standard:{
offset:-240,mon:5,week:2,wkday:1,hour:0,min:0,sec:0,trans:[2020,5,10],tzname:"-04/-03"}
,daylight:{
offset:-180,mon:8,week:2,wkday:1,hour:0,min:0,sec:0,trans:[2020,8,9],tzname:"-04/-03"}}
,{
serverId:"America/St_Johns",clientId:"America/St_Johns",score:100,standard:{
offset:-210,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"NST"}
,daylight:{
offset:-150,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"NDT"}}
,{
serverId:"America/Araguaina",clientId:"America/Araguaina",score:100,standard:{
offset:-180,tzname:"-03"}}
,{
serverId:"America/Argentina/Buenos_Aires",clientId:"America/Argentina/Buenos_Aires",score:100,standard:{
offset:-180,tzname:"-03/-02"}}
,{
serverId:"America/Bahia",clientId:"America/Bahia",score:100,standard:{
offset:-180,tzname:"-03"}}
,{
serverId:"America/Cayenne",clientId:"America/Cayenne",score:100,standard:{
offset:-180,tzname:"-03"}}
,{
serverId:"America/Godthab",clientId:"America/Godthab",score:100,standard:{
offset:-180,mon:10,week:-1,wkday:1,hour:1,min:0,sec:0,trans:[2020,10,25],tzname:"-03/-02"}
,daylight:{
offset:-120,mon:3,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,29],tzname:"-03/-02"}}
,{
serverId:"America/Miquelon",clientId:"America/Miquelon",score:100,standard:{
offset:-180,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"-03/-02"}
,daylight:{
offset:-120,mon:3,week:2,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,8],tzname:"-03/-02"}}
,{
serverId:"America/Montevideo",clientId:"America/Montevideo",score:100,standard:{
offset:-180,tzname:"-03/-02"}}
,{
serverId:"America/Punta_Arenas",clientId:"America/Punta_Arenas",score:100,standard:{
offset:-180,tzname:"-03"}}
,{
serverId:"America/Sao_Paulo",clientId:"America/Sao_Paulo",score:100,standard:{
offset:-180,mon:2,week:3,wkday:1,hour:0,min:0,sec:0,trans:[2020,2,16],tzname:"-03/-02"}
,daylight:{
offset:-120,mon:10,week:3,wkday:1,hour:0,min:0,sec:0,trans:[2020,10,18],tzname:"-03/-02"}}
,{
serverId:"Atlantic/South_Georgia",clientId:"Atlantic/South_Georgia",score:100,standard:{
offset:-120,tzname:"-02"}}
,{
serverId:"Atlantic/Azores",clientId:"Atlantic/Azores",score:100,standard:{
offset:-60,mon:10,week:-1,wkday:1,hour:1,min:0,sec:0,trans:[2020,10,25],tzname:"-01/+00"}
,daylight:{
offset:0,mon:3,week:-1,wkday:1,hour:0,min:0,sec:0,trans:[2020,3,29],tzname:"-01/+00"}}
,{
serverId:"Atlantic/Cape_Verde",clientId:"Atlantic/Cape_Verde",score:100,standard:{
offset:-60,tzname:"-01"}}
,{
serverId:"Africa/Casablanca",clientId:"Africa/Casablanca",score:100,standard:{
offset:0,mon:5,week:3,wkday:1,hour:3,min:0,sec:0,trans:[2020,5,17],tzname:"WET"}
,daylight:{
offset:60,mon:7,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,7,5],tzname:"WEST"}}
,{
serverId:"Africa/Monrovia",clientId:"Africa/Monrovia",score:100,standard:{
offset:0,tzname:"GMT"}}
,{
serverId:"Europe/London",clientId:"Europe/London",score:100,standard:{
offset:0,mon:10,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,10,25],tzname:"GMT/BST"}
,daylight:{
offset:60,mon:3,week:-1,wkday:1,hour:1,min:0,sec:0,trans:[2020,3,29],tzname:"GMT/BST"}}
,{
serverId:"UTC",clientId:"UTC",score:100,standard:{
offset:0,tzname:"UTC"}}
,{
serverId:"Africa/Algiers",clientId:"Africa/Algiers",score:100,standard:{
offset:60,tzname:"CET"}}
,{
serverId:"Africa/Windhoek",clientId:"Africa/Windhoek",score:100,standard:{
offset:60,mon:4,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,4,5],tzname:"WAT"}
,daylight:{
offset:120,mon:9,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,9,6],tzname:"WAST"}}
,{
serverId:"Europe/Belgrade",clientId:"Europe/Belgrade",score:100,standard:{
offset:60,mon:10,week:-1,wkday:1,hour:3,min:0,sec:0,trans:[2020,10,25],tzname:"CET"}
,daylight:{
offset:120,mon:3,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,29],tzname:"CEST"}}
,{
serverId:"Europe/Berlin",clientId:"Europe/Berlin",score:200,standard:{
offset:60,mon:10,week:-1,wkday:1,hour:3,min:0,sec:0,trans:[2020,10,25],tzname:"CET"}
,daylight:{
offset:120,mon:3,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,29],tzname:"CEST"}}
,{
serverId:"Europe/Brussels",clientId:"Europe/Brussels",score:100,standard:{
offset:60,mon:10,week:-1,wkday:1,hour:3,min:0,sec:0,trans:[2020,10,25],tzname:"CET"}
,daylight:{
offset:120,mon:3,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,29],tzname:"CEST"}}
,{
serverId:"Europe/Warsaw",clientId:"Europe/Warsaw",score:100,standard:{
offset:60,mon:10,week:-1,wkday:1,hour:3,min:0,sec:0,trans:[2020,10,25],tzname:"CET"}
,daylight:{
offset:120,mon:3,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,29],tzname:"CEST"}}
,{
serverId:"Africa/Cairo",clientId:"Africa/Cairo",score:100,standard:{
offset:120}}
,{
serverId:"Africa/Harare",clientId:"Africa/Harare",score:200,standard:{
offset:120,tzname:"CAT"}}
,{
serverId:"Africa/Tripoli",clientId:"Africa/Tripoli",score:100,standard:{
offset:120,tzname:"EET"}}
,{
serverId:"Asia/Amman",clientId:"Asia/Amman",score:100,standard:{
offset:120,mon:10,week:-1,wkday:6,hour:1,min:0,sec:0,trans:[2020,10,30],tzname:"EET"}
,daylight:{
offset:180,mon:3,week:-1,wkday:5,hour:23,min:59,sec:59,trans:[2020,3,26],tzname:"EEST"}}
,{
serverId:"Asia/Beirut",clientId:"Asia/Beirut",score:100,standard:{
offset:120,mon:10,week:-1,wkday:1,hour:0,min:0,sec:0,trans:[2020,10,25],tzname:"EET"}
,daylight:{
offset:180,mon:3,week:-1,wkday:1,hour:0,min:0,sec:0,trans:[2020,3,29],tzname:"EEST"}}
,{
serverId:"Asia/Damascus",clientId:"Asia/Damascus",score:100,standard:{
offset:120,mon:10,week:-1,wkday:6,hour:0,min:0,sec:0,trans:[2020,10,30],tzname:"EET"}
,daylight:{
offset:180,mon:3,week:-1,wkday:6,hour:0,min:0,sec:0,trans:[2020,3,27],tzname:"EEST"}}
,{
serverId:"Asia/Gaza",clientId:"Asia/Gaza",score:100,standard:{
offset:120,mon:10,week:-1,wkday:7,hour:1,min:0,sec:0,trans:[2020,10,31],tzname:"EET"}
,daylight:{
offset:180,mon:3,week:-1,wkday:7,hour:1,min:0,sec:0,trans:[2020,3,28],tzname:"EEST"}}
,{
serverId:"Asia/Jerusalem",clientId:"Asia/Jerusalem",score:100,standard:{
offset:120,mon:10,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,10,25],tzname:"IST"}
,daylight:{
offset:180,mon:3,week:4,wkday:6,hour:2,min:0,sec:0,trans:[2020,3,27],tzname:"IDT"}}
,{
serverId:"Europe/Athens",clientId:"Europe/Athens",score:200,standard:{
offset:120,mon:10,week:-1,wkday:1,hour:4,min:0,sec:0,trans:[2020,10,25],tzname:"EET"}
,daylight:{
offset:180,mon:3,week:-1,wkday:1,hour:3,min:0,sec:0,trans:[2020,3,29],tzname:"EEST"}}
,{
serverId:"Europe/Bucharest",clientId:"Europe/Bucharest",score:100,standard:{
offset:120,mon:10,week:-1,wkday:1,hour:4,min:0,sec:0,trans:[2020,10,25],tzname:"EET"}
,daylight:{
offset:180,mon:3,week:-1,wkday:1,hour:3,min:0,sec:0,trans:[2020,3,29],tzname:"EEST"}}
,{
serverId:"Europe/Chisinau",clientId:"Europe/Chisinau",score:100,standard:{
offset:120,mon:10,week:-1,wkday:1,hour:3,min:0,sec:0,trans:[2020,10,25],tzname:"EET"}
,daylight:{
offset:180,mon:3,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,3,29],tzname:"EEST"}}
,{
serverId:"Europe/Helsinki",clientId:"Europe/Helsinki",score:100,standard:{
offset:120,mon:10,week:-1,wkday:1,hour:4,min:0,sec:0,trans:[2020,10,25],tzname:"EET"}
,daylight:{
offset:180,mon:3,week:-1,wkday:1,hour:3,min:0,sec:0,trans:[2020,3,29],tzname:"EEST"}}
,{
serverId:"Europe/Kaliningrad",clientId:"Europe/Kaliningrad",score:100,standard:{
offset:120,tzname:"EET"}}
,{
serverId:"Africa/Nairobi",clientId:"Africa/Nairobi",score:200,standard:{
offset:180,tzname:"EAT"}}
,{
serverId:"Asia/Baghdad",clientId:"Asia/Baghdad",score:100,standard:{
offset:180,tzname:"+03/+04"}}
,{
serverId:"Asia/Kuwait",clientId:"Asia/Kuwait",score:100,standard:{
offset:180,tzname:"+03"}}
,{
serverId:"Europe/Istanbul",clientId:"Europe/Istanbul",score:100,standard:{
offset:180,tzname:"+03"}}
,{
serverId:"Europe/Minsk",clientId:"Europe/Minsk",score:100,standard:{
offset:180,tzname:"+03"}}
,{
serverId:"Europe/Moscow",clientId:"Europe/Moscow",score:100,standard:{
offset:180,tzname:"MSK"}}
,{
serverId:"Asia/Tehran",clientId:"Asia/Tehran",score:100,standard:{
offset:210,mon:9,week:4,wkday:6,hour:0,min:0,sec:0,trans:[2020,9,25],tzname:"+0330/+0430"}
,daylight:{
offset:270,mon:3,week:4,wkday:4,hour:0,min:0,sec:0,trans:[2020,3,25],tzname:"+0330/+0430"}}
,{
serverId:"Asia/Baku",clientId:"Asia/Baku",score:100,standard:{
offset:240,tzname:"+04/+05"}}
,{
serverId:"Asia/Muscat",clientId:"Asia/Muscat",score:100,standard:{
offset:240,tzname:"+04"}}
,{
serverId:"Asia/Tbilisi",clientId:"Asia/Tbilisi",score:200,standard:{
offset:240,tzname:"+04"}}
,{
serverId:"Asia/Yerevan",clientId:"Asia/Yerevan",score:100,standard:{
offset:240,tzname:"+04/+05"}}
,{
serverId:"Europe/Astrakhan",clientId:"Europe/Astrakhan",score:100,standard:{
offset:240,tzname:"+04"}}
,{
serverId:"Europe/Samara",clientId:"Europe/Samara",score:100,standard:{
offset:240,tzname:"+04"}}
,{
serverId:"Europe/Saratov",clientId:"Europe/Saratov",score:100,standard:{
offset:240,tzname:"+04"}}
,{
serverId:"Indian/Mauritius",clientId:"Indian/Mauritius",score:100,standard:{
offset:240,tzname:"+04/+05"}}
,{
serverId:"Asia/Kabul",clientId:"Asia/Kabul",score:100,standard:{
offset:270,tzname:"+0430"}}
,{
serverId:"Asia/Karachi",clientId:"Asia/Karachi",score:200,standard:{
offset:300}}
,{
serverId:"Asia/Tashkent",clientId:"Asia/Tashkent",score:100,standard:{
offset:300,tzname:"+05"}}
,{
serverId:"Asia/Yekaterinburg",clientId:"Asia/Yekaterinburg",score:100,standard:{
offset:300,tzname:"+05"}}
,{
serverId:"Asia/Colombo",clientId:"Asia/Colombo",score:100,standard:{
offset:330,tzname:"+0530"}}
,{
serverId:"Asia/Kolkata",clientId:"Asia/Kolkata",score:200,standard:{
offset:330,tzname:"IST"}}
,{
serverId:"Asia/Kathmandu",clientId:"Asia/Kathmandu",score:100,standard:{
offset:345,tzname:"+0545"}}
,{
serverId:"Asia/Almaty",clientId:"Asia/Almaty",score:100,standard:{
offset:360,tzname:"+06"}}
,{
serverId:"Asia/Dhaka",clientId:"Asia/Dhaka",score:100,standard:{
offset:360,tzname:"+06/+07"}}
,{
serverId:"Asia/Omsk",clientId:"Asia/Omsk",score:100,standard:{
offset:360,tzname:"+06"}}
,{
serverId:"Asia/Yangon",clientId:"Asia/Yangon",score:100,standard:{
offset:390,tzname:"+0630"}}
,{
serverId:"Asia/Bangkok",clientId:"Asia/Bangkok",score:100,standard:{
offset:420,tzname:"+07"}}
,{
serverId:"Asia/Barnaul",clientId:"Asia/Barnaul",score:100,standard:{
offset:420,tzname:"+07"}}
,{
serverId:"Asia/Hovd",clientId:"Asia/Hovd",score:100,standard:{
offset:420,tzname:"+07/+08"}}
,{
serverId:"Asia/Krasnoyarsk",clientId:"Asia/Krasnoyarsk",score:100,standard:{
offset:420,tzname:"+07"}}
,{
serverId:"Asia/Novosibirsk",clientId:"Asia/Novosibirsk",score:100,standard:{
offset:420,tzname:"+07"}}
,{
serverId:"Asia/Tomsk",clientId:"Asia/Tomsk",score:100,standard:{
offset:420,tzname:"+07"}}
,{
serverId:"Asia/Hong_Kong",clientId:"Asia/Hong_Kong",score:200,standard:{
offset:480}}
,{
serverId:"Asia/Irkutsk",clientId:"Asia/Irkutsk",score:100,standard:{
offset:480,tzname:"+08"}}
,{
serverId:"Asia/Kuala_Lumpur",clientId:"Asia/Kuala_Lumpur",score:100,standard:{
offset:480,tzname:"+08"}}
,{
serverId:"Asia/Singapore",clientId:"Asia/Singapore",score:100,standard:{
offset:480,tzname:"+08"}}
,{
serverId:"Asia/Taipei",clientId:"Asia/Taipei",score:100,standard:{
offset:480}}
,{
serverId:"Asia/Ulaanbaatar",clientId:"Asia/Ulaanbaatar",score:100,standard:{
offset:480,tzname:"+08/+09"}}
,{
serverId:"Australia/Perth",clientId:"Australia/Perth",score:100,standard:{
offset:480}}
,{
serverId:"Asia/Pyongyang",clientId:"Asia/Pyongyang",score:100,standard:{
offset:510,tzname:"KST"}}
,{
serverId:"Australia/Eucla",clientId:"Australia/Eucla",score:100,standard:{
offset:525,tzname:"+0845/+0945"}}
,{
serverId:"Asia/Chita",clientId:"Asia/Chita",score:100,standard:{
offset:540,tzname:"+09"}}
,{
serverId:"Asia/Seoul",clientId:"Asia/Seoul",score:100,standard:{
offset:540}}
,{
serverId:"Asia/Tokyo",clientId:"Asia/Tokyo",score:200,standard:{
offset:540}}
,{
serverId:"Asia/Yakutsk",clientId:"Asia/Yakutsk",score:100,standard:{
offset:540,tzname:"+09"}}
,{
serverId:"Australia/Adelaide",clientId:"Australia/Adelaide",score:100,standard:{
offset:570,mon:4,week:1,wkday:1,hour:3,min:0,sec:0,trans:[2020,4,5],tzname:"ACST"}
,daylight:{
offset:630,mon:10,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,10,4],tzname:"ACDT"}}
,{
serverId:"Australia/Darwin",clientId:"Australia/Darwin",score:100,standard:{
offset:570}}
,{
serverId:"Asia/Vladivostok",clientId:"Asia/Vladivostok",score:100,standard:{
offset:600,tzname:"+10"}}
,{
serverId:"Australia/Brisbane",clientId:"Australia/Brisbane",score:200,standard:{
offset:600}}
,{
serverId:"Australia/Hobart",clientId:"Australia/Hobart",score:100,standard:{
offset:600,mon:4,week:1,wkday:1,hour:3,min:0,sec:0,trans:[2020,4,5],tzname:"AEST"}
,daylight:{
offset:660,mon:10,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,10,4],tzname:"AEDT"}}
,{
serverId:"Australia/Sydney",clientId:"Australia/Sydney",score:200,standard:{
offset:600,mon:4,week:1,wkday:1,hour:3,min:0,sec:0,trans:[2020,4,5],tzname:"AEST"}
,daylight:{
offset:660,mon:10,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,10,4],tzname:"AEDT"}}
,{
serverId:"Pacific/Guam",clientId:"Pacific/Guam",score:100,standard:{
offset:600,tzname:"ChST"}}
,{
serverId:"Australia/Lord_Howe",clientId:"Australia/Lord_Howe",score:100,standard:{
offset:630,mon:4,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,4,5],tzname:"+1030/+11"}
,daylight:{
offset:660,mon:10,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,10,4],tzname:"+1030/+11"}}
,{
serverId:"Asia/Magadan",clientId:"Asia/Magadan",score:100,standard:{
offset:660,tzname:"+11"}}
,{
serverId:"Asia/Sakhalin",clientId:"Asia/Sakhalin",score:100,standard:{
offset:660,tzname:"+11"}}
,{
serverId:"Asia/Srednekolymsk",clientId:"Asia/Srednekolymsk",score:100,standard:{
offset:660,tzname:"+11"}}
,{
serverId:"Pacific/Bougainville",clientId:"Pacific/Bougainville",score:100,standard:{
offset:660,tzname:"+11"}}
,{
serverId:"Pacific/Guadalcanal",clientId:"Pacific/Guadalcanal",score:100,standard:{
offset:660,tzname:"+11"}}
,{
serverId:"Pacific/Norfolk",clientId:"Pacific/Norfolk",score:100,standard:{
offset:660,tzname:"+11"}}
,{
serverId:"Asia/Kamchatka",clientId:"Asia/Kamchatka",score:100,standard:{
offset:720,tzname:"+12"}}
,{
serverId:"Pacific/Auckland",clientId:"Pacific/Auckland",score:100,standard:{
offset:720,mon:4,week:1,wkday:1,hour:3,min:0,sec:0,trans:[2020,4,5],tzname:"NZST"}
,daylight:{
offset:780,mon:9,week:-1,wkday:1,hour:2,min:0,sec:0,trans:[2020,9,27],tzname:"NZDT"}}
,{
serverId:"Pacific/Fiji",clientId:"Pacific/Fiji",score:100,standard:{
offset:720,mon:1,week:3,wkday:1,hour:3,min:0,sec:0,trans:[2020,1,19],tzname:"+12/+13"}
,daylight:{
offset:780,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"+12/+13"}}
,{
serverId:"Pacific/Chatham",clientId:"Pacific/Chatham",score:100,standard:{
offset:765,mon:4,week:1,wkday:1,hour:3,min:45,sec:0,trans:[2020,4,5],tzname:"+1245/+1345"}
,daylight:{
offset:825,mon:9,week:-1,wkday:1,hour:2,min:45,sec:0,trans:[2020,9,27],tzname:"+1245/+1345"}}
,{
serverId:"Pacific/Apia",clientId:"Pacific/Apia",score:100,standard:{
offset:780,mon:4,week:1,wkday:1,hour:4,min:0,sec:0,trans:[2020,4,5],tzname:"+13/+14"}
,daylight:{
offset:840,mon:9,week:-1,wkday:1,hour:3,min:0,sec:0,trans:[2020,9,27],tzname:"+13/+14"}}
,{
serverId:"Pacific/Tongatapu",clientId:"Pacific/Tongatapu",score:100,standard:{
offset:780,mon:1,week:3,wkday:1,hour:3,min:0,sec:0,trans:[2020,1,19],tzname:"+13/+14"}
,daylight:{
offset:840,mon:11,week:1,wkday:1,hour:2,min:0,sec:0,trans:[2020,11,1],tzname:"+13/+14"}}
,{
serverId:"Pacific/Kiritimati",clientId:"Pacific/Kiritimati",score:100,standard:{
offset:840,tzname:"+14"}}
]
}
if(AjxPackage.define("ajax.util.AjxTimezone")){
AjxTimezone=function(){};
AjxTimezone.convertTimezone=function(t,e,o){
if(e==o){
return t
}
var i=AjxTimezone.getOffset(o,t);
var a=AjxTimezone.getOffset(e,t);
return new Date(t.getTime()+(i-a)*60*1000)
};
AjxTimezone.getTransition=function(i,a){
var t=[a||new Date().getFullYear(),i.mon,1];
if(i.mday){
t[2]=i.mday
}else{
if(i.wkday){
var e=new Date(a,i.mon-1,1,i.hour,i.min,i.sec);
if(i.week==-1){
var n=new Date(new Date(e.getTime()).setMonth(i.mon,0));
var o=n.getDate();
var r=n.getDay()+1;
var s=r>=i.wkday?r-i.wkday:7-i.wkday-r;
t[2]=o-s
}else{
var r=e.getDay()+1;
var s=i.wkday==r?1:0;
t[2]=i.wkday+7*(i.week-s)-r+1
}}}
return t
};
AjxTimezone.createMDayTransition=function(e,a){
if(e instanceof Date){
a=a!=null?a:e.getTimezoneOffset();
e=[e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()]
}
var t={
offset:a,trans:e};
return AjxTimezone.addMDayTransition(t)
};
AjxTimezone.addMDayTransition=function(t){
var e=t.trans;
t.mon=e[1];
t.mday=e[2];
t.hour=e[3];
t.min=e[4];
t.sec=e[5];
return t
};
AjxTimezone.createWkDayTransition=function(e,a){
if(e instanceof Date){
a=a!=null?a:e.getTimezoneOffset();
e=[e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()]
}
var t={
offset:a,trans:e};
return AjxTimezone.addWkDayTransition(t)
};
AjxTimezone.addWkDayTransition=function(o){
var a=o.trans;
var i=a[1];
var r=a[2];
var t=Math.floor((r-1)/7);
var e=new Date(a[0],a[1]-1,a[2],12,0,0);
var s=new Date(new Date(e.getTime()).setMonth(i-1,0)).getDate();
var n=s-r<7;
o.mon=i;
o.week=n?-1:t+1;
o.wkday=e.getDay()+1;
o.hour=a[3];
o.min=a[4];
o.sec=a[5];
return o
};
AjxTimezone.createTransitionDate=function(o){
var e=new Date(AjxTimezoneData.TRANSITION_YEAR,o.mon-1,1,12,0,0);
if(o.mday){
e.setDate(o.mday)
}else{
if(o.week==-1){
e.setMonth(e.getMonth()+1,0);
for(var a=0;
a<7;
a++){
if(e.getDay()+1==o.wkday){
break
}
e.setDate(e.getDate()-1)
}}else{
for(var a=0;
a<7;
a++){
if(e.getDay()+1==o.wkday){
break
}
e.setDate(e.getDate()+1)
}
e.setDate(e.getDate()+7*(o.week-1))
}}
var t=[e.getFullYear(),e.getMonth()+1,e.getDate()];
return t
};
AjxTimezone.getZonePreferences=function(){
if(AjxTimezone._PREF_ZONE_DISPLAY){
var a=AjxTimezone._PREF_ZONE_DISPLAY.length;
var t=AjxTimezone.STANDARD_RULES.length+AjxTimezone.DAYLIGHT_RULES.length;
if(a!=t){
AjxTimezone._PREF_ZONE_DISPLAY=null
}}
if(!AjxTimezone._PREF_ZONE_DISPLAY){
AjxTimezone._PREF_ZONE_DISPLAY=[];
AjxTimezone.getAbbreviatedZoneChoices();
for(var e=0;
e<AjxTimezone._ABBR_ZONE_OPTIONS.length;
e++){
AjxTimezone._PREF_ZONE_DISPLAY.push(AjxTimezone._ABBR_ZONE_OPTIONS[e].displayValue)
}}
return AjxTimezone._PREF_ZONE_DISPLAY
};
AjxTimezone.getZonePreferencesOptions=function(){
if(AjxTimezone._PREF_ZONE_OPTIONS){
var a=AjxTimezone._PREF_ZONE_OPTIONS.length;
var t=AjxTimezone.STANDARD_RULES.length+AjxTimezone.DAYLIGHT_RULES.length;
if(a!=t){
AjxTimezone._PREF_ZONE_OPTIONS=null
}}
if(!AjxTimezone._PREF_ZONE_OPTIONS){
AjxTimezone._PREF_ZONE_OPTIONS=[];
AjxTimezone.getAbbreviatedZoneChoices();
for(var e=0;
e<AjxTimezone._ABBR_ZONE_OPTIONS.length;
e++){
AjxTimezone._PREF_ZONE_OPTIONS.push(AjxTimezone._ABBR_ZONE_OPTIONS[e].value)
}}
return AjxTimezone._PREF_ZONE_OPTIONS
};
AjxTimezone.getServerId=function(e){
return AjxTimezone._CLIENT2SERVER[e]||e
};
AjxTimezone.getClientId=function(e){
return AjxTimezone._SERVER2CLIENT[e]||e
};
AjxTimezone.getShortName=function(t){
var a=AjxTimezone.getRule(t);
if(a&&a.shortName){
return a.shortName
}
var e=["GMT",AjxTimezone._SHORT_NAMES[t]].join("");
if(a){
a.shortName=e
}
return e
};
AjxTimezone.getMediumName=function(e){
var a=AjxTimezone.getRule(e);
if(a&&a.mediumName){
return a.mediumName
}
var t=AjxMsg[e]||["(",AjxTimezone.getShortName(e),") ",e].join("");
if(a){
a.mediumName=t
}
return t
};
AjxTimezone.getLongName=AjxTimezone.getMediumName;
AjxTimezone.addRule=function(a){
var t=a.serverId;
var e=a.clientId;
AjxTimezone._CLIENT2SERVER[e]=t;
AjxTimezone._SERVER2CLIENT[t]=e;
AjxTimezone._SHORT_NAMES[e]=AjxTimezone._generateShortName(a.standard.offset);
AjxTimezone._CLIENT2RULE[e]=a;
var i=a.daylight?AjxTimezone.DAYLIGHT_RULES:AjxTimezone.STANDARD_RULES;
i.push(a)
};
AjxTimezone.getRule=function(e,o){
var c=AjxTimezone._CLIENT2RULE[e];
if(!c){
e=AjxTimezone._SERVER2CLIENT[e];
c=AjxTimezone._CLIENT2RULE[e]
}
if(!c&&o){
var l=["standard","daylight"];
var d=o.daylight?AjxTimezone.DAYLIGHT_RULES:AjxTimezone.STANDARD_RULES;
for(var s=0;
s<d.length;
s++){
c=d[s];
var u=true;
for(var n=0;
n<l.length;
n++){
var t=l[n];
var r=c[t];
if(!r){
continue
}
var h=false;
for(var a in o[t]){
if(o[t][a]!=r[a]){
u=false;
h=true;
break
}}
if(h){
break
}}
if(u){
return c
}}
return null
}
return c
};
AjxTimezone.getOffset=function(e,o){
var u=AjxTimezone.getRule(e||AjxTimezone.DEFAULT);
if(u&&u.daylight){
var c=o.getFullYear();
var s=u.standard,t=u.daylight;
var l=AjxTimezone.getTransition(s,c);
var f=AjxTimezone.getTransition(t,c);
var h=o.getMonth()+1,d=o.getDate();
var n=l[1],m=l[2];
var r=f[1],i=f[2];
var a=false;
if(r<n){
a=h>r&&h<n;
a=a||(h==r&&d>=i);
a=a||(h==n&&d<m)
}else{
a=h<n||h>r;
a=a||(h==r&&d>=i);
a=a||(h==n&&d<m)
}
return a?t.offset:s.offset
}
return u?u.standard.offset:-(new Date().getTimezoneOffset())
};
AjxTimezone.guessMachineTimezone=function(){
return AjxTimezone._guessMachineTimezone().clientId
};
AjxTimezone.getAbbreviatedZoneChoices=function(){
if(AjxTimezone._ABBR_ZONE_OPTIONS){
var o=AjxTimezone._ABBR_ZONE_OPTIONS.length;
var i=AjxTimezone.STANDARD_RULES.length+AjxTimezone.DAYLIGHT_RULES.length;
if(o!=i){
AjxTimezone._ABBR_ZONE_OPTIONS=null
}}
if(!AjxTimezone._ABBR_ZONE_OPTIONS){
AjxTimezone._ABBR_ZONE_OPTIONS=[];
for(var e in AjxTimezone._CLIENT2SERVER){
var n=AjxTimezone._CLIENT2RULE[e];
var t=n.serverId;
var a={
displayValue:AjxTimezone.getMediumName(e),value:t,standard:n.standard,serverId:t,clientId:e};
AjxTimezone._ABBR_ZONE_OPTIONS.push(a)
}
AjxTimezone._ABBR_ZONE_OPTIONS.sort(AjxTimezone._BY_OFFSET)
}
return AjxTimezone._ABBR_ZONE_OPTIONS
};
AjxTimezone.getMatchingTimezoneChoices=function(){
if(AjxTimezone._MATCHING_ZONE_OPTIONS){
var s=AjxTimezone._MATCHING_ZONE_OPTIONS.length;
var n=AjxTimezone.STANDARD_RULES.length+AjxTimezone.DAYLIGHT_RULES.length;
if(s!=n){
AjxTimezone._MATCHING_ZONE_OPTIONS=null
}}
if(!AjxTimezone._MATCHING_ZONE_OPTIONS){
AjxTimezone._MATCHING_ZONE_OPTIONS=[];
for(var a in AjxTimezone.MATCHING_RULES){
var r=AjxTimezone.MATCHING_RULES[a];
var e=r.clientId;
var t=r.serverId;
if(e==AjxTimezone.AUTO_DETECTED){
continue
}
var o={
displayValue:AjxTimezone.getMediumName(e),value:t,standard:r.standard,serverId:t,clientId:e};
AjxTimezone._MATCHING_ZONE_OPTIONS.push(o)
}
AjxTimezone._MATCHING_ZONE_OPTIONS.sort(AjxTimezone._BY_OFFSET)
}
return AjxTimezone._MATCHING_ZONE_OPTIONS
};
AjxTimezone._BY_OFFSET=function(a,t){
var o=a.standard.offset-t.standard.offset;
if(o==0){
var e=a.serverId;
var i=t.serverId;
if(e<i){
o=-1
}else{
if(e>i){
o=1
}}}
return o
};
AjxTimezone.GMT="Europe/London";
AjxTimezone.GMT_NO_DST="UTC";
AjxTimezone.AUTO_DETECTED="Auto-Detected";
AjxTimezone._CLIENT2SERVER={};
AjxTimezone._SERVER2CLIENT={};
AjxTimezone._SHORT_NAMES={};
AjxTimezone._CLIENT2RULE={};
AjxTimezone.STANDARD_RULES=[];
AjxTimezone.DAYLIGHT_RULES=[];
(function(){
for(var e=0;
e<AjxTimezoneData.TIMEZONE_RULES.length;
e++){
var t=AjxTimezoneData.TIMEZONE_RULES[e];
var a=t.daylight?AjxTimezone.DAYLIGHT_RULES:AjxTimezone.STANDARD_RULES;
a.push(t)
}}
)();
AjxTimezone._guessMachineTimezone=function(f){
var u=new Date(AjxTimezoneData.TRANSITION_YEAR,11,1,0,0,0);
var v=new Date(AjxTimezoneData.TRANSITION_YEAR,5,1,0,0,0);
var t=-u.getTimezoneOffset();
var g=-v.getTimezoneOffset();
AjxTimezone.MATCHING_RULES=[];
AjxTimezone.TIMEZONE_CONFLICT=false;
var c=[];
var s={};
var r=[];
var p=false;
if(g==t){
var m=AjxTimezone.STANDARD_RULES;
for(var y=0;
y<m.length;
++y){
var h=m[y];
if(h.standard.offset==g){
if(!s[h.serverId]){
c.push(h);
s[h.serverId]=true
}
AjxTimezone.MATCHING_RULES.push(h)
}}}else{
var m=AjxTimezone.DAYLIGHT_RULES;
var q=Math.max(t,g);
var k=Math.min(t,g);
var o=new Date();
var w=-o.getTimezoneOffset();
for(var y=0;
y<m.length;
++y){
var h=m[y];
if(h.standard.offset==k&&h.daylight.offset==q){
var l=h.standard.trans;
var d=h.daylight.trans;
var n=new Date(l[0],l[1]-1,l[2]-1);
var a=new Date(l[0],l[1]-1,l[2]+2);
var e=new Date(d[0],d[1]-1,d[2]-1);
var x=new Date(d[0],d[1]-1,d[2]+2);
if(-a.getTimezoneOffset()==k&&-x.getTimezoneOffset()==q&&-n.getTimezoneOffset()==q&&-e.getTimezoneOffset()==k){
if(!s[h.serverId]){
c.push(h);
s[h.serverId]=true
}
p=true
}}
if(h.standard.offset==w||h.daylight.offset==w){
AjxTimezone.MATCHING_RULES.push(h)
}}}
if((c.length>0)&&f!=null){
var m=c;
for(var y in m){
if(m[y].serverId==f){
return m[y]
}}}
if(c.length>0){
if(c.length>1){
c.sort(AjxTimezone.__BY_SCORE);
if(c[0].score!=c[1].score){
c.length=1
}}
AjxTimezone.TIMEZONE_CONFLICT=(c.length>1);
return c[0]
}
if((AjxTimezone.MATCHING_RULES.length>0)&&f!=null){
var m=AjxTimezone.MATCHING_RULES;
for(var y in m){
if(m[y].serverId==f){
return m[y]
}}}
return AjxTimezone._generateDefaultRule()
};
AjxTimezone.__BY_SCORE=function(t,e){
return e.score-t.score
};
AjxTimezone._generateDefaultRule=function(){
var l=0;
var a=1;
var i=2;
var s=3;
var o=4;
function c(m,u,v,k){
var p=u.getTime();
var w=new Date();
w.setTime(m.getTime());
var y=new Date();
y.setTime(w.getTime());
var x=m.getTimezoneOffset()*-1;
if(!k){
k={
clientId:AjxTimezone.AUTO_DETECTED,autoDetected:true}
}
while(w.getTime()<=p){
if(v==l){
w.setUTCMonth(w.getUTCMonth()+1)
}else{
if(v==a){
w.setUTCDate(w.getUTCDate()+1)
}else{
if(v==i){
w.setUTCHours(w.getUTCHours()+1)
}else{
if(v==s){
w.setUTCMinutes(w.getUTCMinutes()+1)
}else{
if(v==o){
w.setUTCSeconds(w.getUTCSeconds()+1)
}else{
return k
}}}}}
var f=w.getTimezoneOffset()*-1;
if(f!=x){
if(v<o){
k=c(y,w,v+1,k)
}else{
var q=new Date();
q.setUTCFullYear(y.getFullYear(),y.getMonth(),y.getDate());
q.setUTCHours(y.getHours(),y.getMinutes(),y.getSeconds()+1);
var g=k[x<f?"daylight":"standard"]={
offset:f,trans:[q.getUTCFullYear(),q.getUTCMonth()+1,q.getUTCDate(),q.getUTCHours(),q.getUTCMinutes(),q.getUTCSeconds()]};
AjxTimezone.addWkDayTransition(g);
return k
}}
y.setTime(w.getTime());
x=f
}
return k
}
var t=new Date();
var e=new Date();
var r=t.getFullYear();
t.setUTCFullYear(r,t.getMonth(),t.getDate()-1);
t.setUTCHours(0,0,0,0);
e.setTime(t.getTime());
e.setUTCFullYear(r+1,t.getMonth(),t.getDate()+1);
var h=c(t,e,l);
if(!h.daylight||!h.standard){
h.standard={
offset:t.getTimezoneOffset()*-1};
delete h.daylight
}
h.serverId=["(GMT",AjxTimezone._generateShortName(h.standard.offset,true),") ",AjxTimezone.AUTO_DETECTED].join("");
if(h.daylight&&h.daylight.offset<h.standard.offset){
var n=h.daylight;
h.daylight=h.standard;
h.standard=n
}
return h
};
AjxTimezone._generateShortName=function(n,o){
if(n==0){
return""
}
var t=n<0?"-":"+";
var a=Math.abs(n);
var e=Math.floor(a/60);
var i=a%60;
e=e<10?"0"+e:e;
i=i<10?"0"+i:i;
return[t,e,o?".":"",i].join("")
};
AjxTimezone.DEFAULT_RULE=AjxTimezone._guessMachineTimezone();
(function(){
AjxTimezoneData.TIMEZONE_RULES.sort(AjxTimezone._BY_OFFSET);
for(var e=0;
e<AjxTimezoneData.TIMEZONE_RULES.length;
e++){
var t=AjxTimezoneData.TIMEZONE_RULES[e];
AjxTimezone.addRule(t)
}}
)();
AjxTimezone.DEFAULT=AjxTimezone.getClientId(AjxTimezone.DEFAULT_RULE.serverId)
}
if(AjxPackage.define("ajax.util.AjxEmailAddress")){
AjxEmailAddress=function(t,o,a,i,n,e){
this.address=t;
this.name=this._setName(a);
this.dispName=i;
this.type=o||AjxEmailAddress.TO;
this.isGroup=n;
this.canExpand=e
};
AjxEmailAddress.prototype.isAjxEmailAddress=true;
AjxEmailAddress.customInvalidEmailPats=[];
AjxEmailAddress.FROM="FROM";
AjxEmailAddress.TO="TO";
AjxEmailAddress.CC="CC";
AjxEmailAddress.BCC="BCC";
AjxEmailAddress.REPLY_TO="REPLY_TO";
AjxEmailAddress.SENDER="SENDER";
AjxEmailAddress.READ_RECEIPT="READ_RECEIPT";
AjxEmailAddress.RESENT_FROM="RESENT_FROM";
AjxEmailAddress.TYPE_STRING={};
AjxEmailAddress.TYPE_STRING[AjxEmailAddress.FROM]="from";
AjxEmailAddress.TYPE_STRING[AjxEmailAddress.TO]="to";
AjxEmailAddress.TYPE_STRING[AjxEmailAddress.CC]="cc";
AjxEmailAddress.TYPE_STRING[AjxEmailAddress.BCC]="bcc";
AjxEmailAddress.TYPE_STRING[AjxEmailAddress.REPLY_TO]="replyTo";
AjxEmailAddress.TYPE_STRING[AjxEmailAddress.SENDER]="sender";
AjxEmailAddress.TYPE_STRING[AjxEmailAddress.READ_RECEIPT]="readReceipt";
AjxEmailAddress.TYPE_STRING[AjxEmailAddress.RESENT_FROM]="resentFrom";
AjxEmailAddress.fromSoapType={};
AjxEmailAddress.fromSoapType.f=AjxEmailAddress.FROM;
AjxEmailAddress.fromSoapType.t=AjxEmailAddress.TO;
AjxEmailAddress.fromSoapType.c=AjxEmailAddress.CC;
AjxEmailAddress.fromSoapType.b=AjxEmailAddress.BCC;
AjxEmailAddress.fromSoapType.r=AjxEmailAddress.REPLY_TO;
AjxEmailAddress.fromSoapType.s=AjxEmailAddress.SENDER;
AjxEmailAddress.fromSoapType.n=AjxEmailAddress.READ_RECEIPT;
AjxEmailAddress.fromSoapType.rf=AjxEmailAddress.RESENT_FROM;
AjxEmailAddress.toSoapType={};
AjxEmailAddress.toSoapType[AjxEmailAddress.FROM]="f";
AjxEmailAddress.toSoapType[AjxEmailAddress.TO]="t";
AjxEmailAddress.toSoapType[AjxEmailAddress.CC]="c";
AjxEmailAddress.toSoapType[AjxEmailAddress.BCC]="b";
AjxEmailAddress.toSoapType[AjxEmailAddress.REPLY_TO]="r";
AjxEmailAddress.toSoapType[AjxEmailAddress.SENDER]="s";
AjxEmailAddress.toSoapType[AjxEmailAddress.READ_RECEIPT]="n";
AjxEmailAddress.SEPARATOR="; ";
AjxEmailAddress.DELIMS=[";",",","\n"," "];
AjxEmailAddress.IS_DELIM=AjxUtil.arrayAsHash(AjxEmailAddress.DELIMS);
AjxEmailAddress.addrAnglePat=/(\s*<(((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*"(([^\\"])|(\\([^\x0A\x0D])))+"\s*))\@((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*\[(\s*(([^\[\]\\])|(\\([^\x0A\x0D])))+)*\s*\]\s*)))>\s*)/;
AjxEmailAddress.addrOnlyPat=/^((((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*"(([^\\"])|(\\([^\x0A\x0D])))+"\s*))\@((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*\[(\s*(([^\[\]\\])|(\\([^\x0A\x0D])))+)*\s*\]\s*))))$/;
AjxEmailAddress.addrAngleQuotePat=/(\s*<'(((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*"(([^\\"])|(\\([^\x0A\x0D])))+"\s*))\@((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*\[(\s*(([^\[\]\\])|(\\([^\x0A\x0D])))+)*\s*\]\s*)))'>\s*)/;
AjxEmailAddress.addrPat=/(((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*"(([^\\"])|(\\([^\x0A\x0D])))+"\s*))\@((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*\[(\s*(([^\[\]\\])|(\\([^\x0A\x0D])))+)*\s*\]\s*)))/;
AjxEmailAddress.addrPat1=/(^|"|\s)(((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*"(([^\\"])|(\\([^\x0A\x0D])))+"\s*))\@((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*\[(\s*(([^\[\]\\])|(\\([^\x0A\x0D])))+)*\s*\]\s*)))/;
AjxEmailAddress.accountPat=/^([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)$/;
AjxEmailAddress.commentPat=/\((.*)\)/g;
AjxEmailAddress.phrasePat=/(((\s*[^\x00-\x1F\x7F()<>\[\]:;@\"\s]+\s*)|(\s*"(([^\\"])|(\\([^\x0A\x0D])))+"\s*))+)/;
AjxEmailAddress.boundAddrPat=/(\s*<?(((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*"(([^\\"])|(\\([^\x0A\x0D])))+"\s*))\@((\s*([^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+(\.[^\x00-\x1F\x7F()<>\[\]:;@\,."\s]+)*)\s*)|(\s*\[(\s*(([^\[\]\\])|(\\([^\x0A\x0D])))+)*\s*\]\s*)))>?\s*)$/;
AjxEmailAddress.validateAddress=function(e){
e=AjxStringUtil.trim(e);
return AjxEmailAddress._prelimCheck(e)&&AjxEmailAddress.addrOnlyPat.test(e)
};
AjxEmailAddress.parse=function(s){
var r,t;
var s=AjxStringUtil.trim(s);
var o=AjxEmailAddress._prelimCheck(s);
if(!(o&&s.match(AjxEmailAddress.addrPat))){
return null
}
var n=s.match(AjxEmailAddress.addrAngleQuotePat)||s.match(AjxEmailAddress.addrAnglePat);
if(n&&n.length){
r=n[2];
s=s.replace(AjxEmailAddress.addrAnglePat,"")
}else{
n=s.match(AjxEmailAddress.addrPat1);
if(n&&n.length){
if(n[1]==='"'){
return null
}
var e=s.match(AjxEmailAddress.addrPat);
r=e&&e.length&&e[0]?AjxStringUtil.trim(e[0]):n[0];
s=s.replace(AjxEmailAddress.addrPat,"")
}}
if(!r||!AjxEmailAddress.validateAddress(r)){
return null
}
for(var a=0;
a<AjxEmailAddress.customInvalidEmailPats.length;
a++){
if(AjxEmailAddress.customInvalidEmailPats[a].test(r)){
return null
}}
if(s){
t=AjxStringUtil.trim(s);
t=t.replace(/\\"/g,"&quot;");
t=AjxStringUtil.trim(t,null,'"');
t=t.replace(/&quot;/g,'"')
}
return new AjxEmailAddress(r,null,t)
};
AjxEmailAddress.parseEmailString=function(a,d,u){
var n=new AjxVector();
var t=new AjxVector();
var m=new AjxVector();
var h=AjxEmailAddress.split(a);
for(var r=0;
r<h.length;
r++){
var l=AjxStringUtil.trim(h[r]);
if(l){
var c=AjxEmailAddress.parse(l);
if(!c&&!u){
var f=l;
var s=f.match(AjxEmailAddress.addrAnglePat);
if(s&&s.length){
var e=f.replace(AjxEmailAddress.addrAnglePat,"");
var o=['"',e,'" ',s[0]].join("");
c=AjxEmailAddress.parse(o);
if(c){
c.name=e
}}}
if(c){
c.type=d;
n.add(c);
m.add(c)
}else{
t.add(l);
m.add(new AjxEmailAddress(l))
}}}
return{
good:n,bad:t,all:m}
};
AjxEmailAddress.getValidAddresses=function(t,a,e){
return AjxEmailAddress.parseEmailString(t,a,e).good
};
AjxEmailAddress.isValid=function(e){
return AjxEmailAddress.parse(e)!=null
};
AjxEmailAddress._prelimCheck=function(a){
var e=a.indexOf("@");
var t=a.lastIndexOf(".");
return((e!=-1)&&(t!=-1)&&(t>e)&&(t!=a.length-1))
};
AjxEmailAddress.split=function(p){
p=AjxStringUtil.trim(p);
var f=[];
var g=0,u=0;
var y="",s="";
var r=false;
while(g<p.length){
var a=p.charAt(g);
if((a=='"'||a=="(")&&y!="\\"){
r=true;
s=a;
u=g;
g++;
while(r&&g<p.length){
var a=p.charAt(g);
if(((s=='"'&&a=='"')||(s=="("&&a==")"))&&(y!="\\")){
f.push({
start:u,end:g}
);
r=false
}
g++;
y=a
}}else{
g++
}
y=a
}
if(f.length){
AjxEmailAddress.IS_DELIM[" "]=false
}
u=0;
var d=[];
while(u<p.length){
var t=p.substring(u,p.length);
g=0;
var n=t.length;
while((n==t.length)&&(g<t.length)){
var a=t.charAt(g);
if(AjxEmailAddress.IS_DELIM[a]){
var o=false;
if(a!="\n"){
for(var l=0;
l<f.length;
l++){
var c=f[l];
var e=u+g;
o=(e>=c.start&&e<=c.end);
if(o){
break
}}}
if(!o){
var h=true;
var m=t.substring(0,g);
if(a==","||a==" "){
h=m.match(AjxEmailAddress.boundAddrPat)
}
if(h){
d.push(AjxStringUtil.trim(m));
n=g;
u+=m.length+1
}}
a=p.charAt(u);
while((u<p.length)&&AjxEmailAddress.IS_DELIM[a]){
u++;
a=p.charAt(u)
}
g++
}else{
g++
}}
if(n==t.length){
d.push(AjxStringUtil.trim(t));
u+=t.length+1
}}
AjxEmailAddress.IS_DELIM[" "]=true;
return d
};
AjxEmailAddress.prototype.toString=function(a,i){
if(this.name){
var t=this.name;
if(!a&&!i){
t=t.replace(/\\+"/g,'"');
t=t.replace(/"/g,'\\"')
}
var e=(a||i)?[t]:['"',t,'"'];
if(this.address&&!a){
e.push(" <",this.address,">")
}
return e.join("")
}else{
return this.address
}};
AjxEmailAddress.prototype.getAddress=function(){
return this.address
};
AjxEmailAddress.prototype.setAddress=function(e){
this.address=e
};
AjxEmailAddress.prototype.getType=function(){
return this.type
};
AjxEmailAddress.prototype.setType=function(e){
this.type=e
};
AjxEmailAddress.prototype.getTypeAsString=function(){
return AjxEmailAddress.TYPE_STRING[this.type]
};
AjxEmailAddress.prototype.getName=function(){
return this.name
};
AjxEmailAddress.prototype.getDispName=function(){
return this.dispName
};
AjxEmailAddress.prototype.clone=function(){
var e=new AjxEmailAddress(this.address,this.type,this.name,this.dispName,this.isGroup,this.canExpand);
e.icon=this.icon;
return e
};
AjxEmailAddress.copy=function(e){
var t=new AjxEmailAddress(e.address,e.type,e.name,e.dispName,e.isGroup,e.canExpand);
t.icon=e.icon;
return t
};
AjxEmailAddress.prototype._setName=function(e){
if(!e){
return""
}
if(e&&e.charAt(0)=="'"&&e.charAt(e.length-1)=="'"){
e=e.substring(1,e.length-1)
}
return e
};
AjxEmailAddress.sortCompareByAddress=function(i,t){
var e=i.getAddress()||"";
var o=t.getAddress()||"";
if(e.toLowerCase()>o.toLowerCase()){
return 1
}
if(e.toLowerCase()<o.toLowerCase()){
return -1
}
return 0
};
AjxEmailAddress.dedup=function(a){
var o=[],t={};
if(a&&a.length){
for(var e=0;
e<a.length;
e++){
var n=a[e];
if(!t[n.address]){
o.push(n)
}
t[n.address]=true
}}
return o
}
}
if(AjxPackage.define("ajax.util.AjxHistoryMgr")){
AjxHistoryMgr=function(){
this.currentLocation=null;
this.listener=null;
this.iframe=null;
this.ignoreLocationChange=null;
this.WAIT_TIME=AjxEnv.isIE?400:200;
this.currentWaitTime=0;
this.ieAtomicLocationChange=null;
this._eventMgr=new AjxEventMgr();
this._evt=new AjxEvent();
this._initialize()
};
AjxHistoryMgr.BLANK_FILE="blankHistory.html";
AjxHistoryMgr.IFRAME_ID="DhtmlHistoryFrame";
AjxHistoryMgr.prototype.addListener=function(e){
return this._eventMgr.addListener(AjxEvent.HISTORY,e)
};
AjxHistoryMgr.prototype.removeListener=function(e){
return this._eventMgr.removeListener(AjxEvent.HISTORY,e)
};
AjxHistoryMgr.prototype.add=function(a){
var e=this;
var t=function(){
if(e.currentWaitTime>0){
e.currentWaitTime=e.currentWaitTime-e.WAIT_TIME
}
a=e._removeHash(a);
if(AjxEnv.isIE){
if(document.getElementById(a)){
throw new DwtException("AjxHistoryMgr: location has same ID as DOM element")
}}
e.ignoreLocationChange=true;
this.ieAtomicLocationChange=true;
e.currentLocation=a;
window.location.hash=a;
if(AjxEnv.isIE){
e.iframe.src=AjxHistoryMgr.BLANK_FILE+"?"+a
}
this.ieAtomicLocationChange=false
};
window.setTimeout(t,this.currentWaitTime);
this.currentWaitTime=this.currentWaitTime+e.WAIT_TIME
};
AjxHistoryMgr.prototype.getCurrentLocation=function(){
return this._removeHash(window.location.hash)
};
AjxHistoryMgr.prototype._initialize=function(){
var e=this.getCurrentLocation();
this.currentLocation=e;
if(AjxEnv.isIE){
var n=[];
var o=0;
n[o++]="<iframe style='border: 0px; width: 1px; ";
n[o++]="height: 1px; position: absolute; bottom: 0px; ";
n[o++]="right: 0px; visibility: visible;' ";
n[o++]="id='"+AjxHistoryMgr.IFRAME_ID+"' ";
n[o++]="src='"+AjxHistoryMgr.BLANK_FILE+"?"+e+"'>";
n[o++]="</iframe>";
var s=document.createElement("div");
document.body.appendChild(s);
s.innerHTML=n.join("")
}
if(AjxEnv.isIE){
this.iframe=document.getElementById(AjxHistoryMgr.IFRAME_ID)
}
var t=this;
var a=function(){
t._checkLocation()
};
window.onhashchange=a
};
AjxHistoryMgr.prototype._checkLocation=function(){
if(!AjxEnv.isIE&&this.ignoreLocationChange){
this.ignoreLocationChange=false;
return
}
if(!AjxEnv.isIE&&this.ieAtomicLocationChange){
return
}
var e=this.getCurrentLocation();
if(e==this.currentLocation){
return
}
this.ieAtomicLocationChange=true;
if(AjxEnv.isIE&&this._getIFrameHash()!=e){
this.iframe.src=AjxHistoryMgr.BLANK_FILE+"?"+e
}else{
if(AjxEnv.isIE){
return
}}
this.currentLocation=e;
this.ieAtomicLocationChange=false;
this._evt.data=e;
this._eventMgr.notifyListeners(AjxEvent.HISTORY,this._evt)
};
AjxHistoryMgr.prototype._getIFrameHash=function(){
var e=document.getElementById(AjxHistoryMgr.IFRAME_ID);
var a=e.contentWindow.document;
var t=new String(a.location.search);
if(t.length==1&&t.charAt(0)=="?"){
t=""
}else{
if(t.length>=2&&t.charAt(0)=="?"){
t=t.substring(1)
}}
return t
};
AjxHistoryMgr.prototype._removeHash=function(e){
if(e==null||e==undefined){
return null
}else{
if(e==""){
return""
}else{
if(e.length==1&&e.charAt(0)=="#"){
return""
}else{
if(e.length>1&&e.charAt(0)=="#"){
return e.substring(1)
}else{
return e
}}}}};
AjxHistoryMgr.prototype.iframeLoaded=function(e){
if(this.ignoreLocationChange){
this.ignoreLocationChange=false;
return
}
var t=new String(e.search);
if(t.length==1&&t.charAt(0)=="?"){
t=""
}else{
if(t.length>=2&&t.charAt(0)=="?"){
t=t.substring(1)
}}
window.location.hash=t;
this._evt.data=t;
this._eventMgr.notifyListeners(AjxEvent.HISTORY,this._evt)
}
}
if(AjxPackage.define("ajax.xml.AjxSerializer")){
AjxSerializer=function(){
if(arguments.length==0){
return
}};
AjxSerializer.prototype.serialize=function(e){
throw"NOT IMPLEMENTED"
};
AjxJsonSerializer=function(e){
AjxSerializer.call(this,null);
this._minimize=Boolean(e)
};
AjxJsonSerializer.prototype=new AjxSerializer;
AjxJsonSerializer.prototype.constructor=AjxJsonSerializer;
AjxJsonSerializer.E_ATTRS="_attrs";
AjxJsonSerializer.A_CONTENT="_content";
AjxJsonSerializer.A_NAMESPACE="_jsns";
AjxJsonSerializer.prototype.serialize=function(r){
var t={};
var f=0;
var d=null;
for(var o=r.firstChild;
o;
o=o.nextSibling){
var u=o.nodeType;
if(u==1){
var e=o.nodeName;
if(!t[e]){
t[e]=[];
f++
}
t[e].push(o);
continue
}
if(u==3||u==4){
if(!d){
d=[]
}
d.push(o.nodeValue);
continue
}}
var g={};
var s=0;
if(r.attributes){
for(var l=0;
l<r.attributes.length;
l++){
var c=r.attributes[l];
var e=c.nodeName;
var p=this.quote(c.nodeValue);
if(t[e]){
g[e]=p;
s++
}else{
t[e]=p;
f++
}}}
d=d&&d.join("");
if(d&&d.match(/^\s*$/)){
d=null
}
if(d){
d=this.quote(d);
if(s==0&&f==0){
return d
}}
if(d==null&&f==0&&s==0){
return"{}"
}
var m=["{"];
if(d){
m.push(this.quote(AjxJsonSerializer.A_CONTENT),":",d);
if(s>0||f>0){
m.push(",")
}}
if(s>0){
m.push(this.quote(AjxJsonSerializer.E_ATTRS),": { ");
var l=0;
for(var e in g){
if(l>0){
m.push(",")
}
m.push(this.quote(e),":",g[e]);
l++
}
m.push("}");
if(f>0){
m.push(", ")
}}
var h=0;
for(var e in t){
if(h>0){
m.push(",")
}
var n=t[e];
if(typeof n=="string"){
m.push(this.quote(e),":",n);
h++;
continue
}
m.push(this.quote(e),":");
if(!this._minimize||n.length>1){
m.push("[")
}
for(var l=0;
l<n.length;
l++){
if(l>0){
m.push(",")
}
m.push(this.serialize(n[l]))
}
if(!this._minimize||n.length>1){
m.push("]")
}
h++
}
m.push("}");
return m.join("")
};
AjxJsonSerializer.prototype.quote=function(e){
return['"',this.escape(e),'"'].join("")
};
AjxJsonSerializer.prototype.escape=function(e){
return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")
}
}
if(AjxPackage.define("ajax.debug.AjxDebug")){
AjxDebug=function(e){
if(arguments.length==0){
e={}
}else{
if(typeof arguments[0]=="number"){
e={
level:arguments[0],name:arguments[1],showTime:arguments[2]}
}}
this._showTime=e.showTime;
this._target=e.target||AjxDebug.TGT_WINDOW;
this._showTiming=false;
this._startTimePt=this._lastTimePt=0;
this._dbgWindowInited=false;
this._msgQueue=[];
this._isPrevWinOpen=false;
this.setDebugLevel(e.level)
};
AjxDebug.NONE=0;
AjxDebug.DBG1=1;
AjxDebug.DBG2=2;
AjxDebug.DBG3=3;
AjxDebug.TGT_WINDOW="window";
AjxDebug.TGT_CONSOLE="console";
AjxDebug.BUFFER={};
AjxDebug.BUFFER_MAX={};
AjxDebug.DEFAULT_TYPE="debug";
AjxDebug.RPC="rpc";
AjxDebug.NOTIFY="notify";
AjxDebug.EXCEPTION="exception";
AjxDebug.CALENDAR="calendar";
AjxDebug.REPLY="reply";
AjxDebug.SCROLL="scroll";
AjxDebug.BAD_JSON="bad_json";
AjxDebug.PREFS="prefs";
AjxDebug.PROGRESS="progress";
AjxDebug.REMINDER="reminder";
AjxDebug.OFFLINE="offline";
AjxDebug.TAG_ICON="tagIcon";
AjxDebug.DATA_URI="dataUri";
AjxDebug.MSG_DISPLAY="msgDisplay";
AjxDebug.ZIMLET="zimlet";
AjxDebug.KEYBOARD="kbnav";
AjxDebug.FOCUS="focus";
AjxDebug.FOCUS1="focus1";
AjxDebug.ACCESSIBILITY="a11y";
AjxDebug.BUFFER_MAX[AjxDebug.DEFAULT_TYPE]=0;
AjxDebug.BUFFER_MAX[AjxDebug.RPC]=200;
AjxDebug.BUFFER_MAX[AjxDebug.NOTIFY]=400;
AjxDebug.BUFFER_MAX[AjxDebug.EXCEPTION]=100;
AjxDebug.BUFFER_MAX[AjxDebug.CALENDAR]=400;
AjxDebug.BUFFER_MAX[AjxDebug.REPLY]=400;
AjxDebug.BUFFER_MAX[AjxDebug.SCROLL]=100;
AjxDebug.BUFFER_MAX[AjxDebug.BAD_JSON]=200;
AjxDebug.BUFFER_MAX[AjxDebug.PREFS]=200;
AjxDebug.BUFFER_MAX[AjxDebug.REMINDER]=200;
AjxDebug.BUFFER_MAX[AjxDebug.OFFLINE]=400;
AjxDebug.BUFFER_MAX[AjxDebug.TAG_ICON]=200;
AjxDebug.BUFFER_MAX[AjxDebug.PROGRESS]=200;
AjxDebug.BUFFER_MAX[AjxDebug.DATA_URI]=200;
AjxDebug.BUFFER_MAX[AjxDebug.MSG_DISPLAY]=200;
AjxDebug.BUFFER_MAX[AjxDebug.ZIMLET]=200;
AjxDebug.BUFFER_MAX[AjxDebug.KEYBOARD]=null;
AjxDebug.BUFFER_MAX[AjxDebug.FOCUS]=null;
AjxDebug.BUFFER_MAX[AjxDebug.ACCESSIBILITY]=null;
AjxDebug.MAX_OUT=25000;
AjxDebug._CONTENT_FRAME_ID="AjxDebug_CF";
AjxDebug._LINK_FRAME_ID="AjxDebug_LF";
AjxDebug._BOTTOM_FRAME_ID="AjxDebug_BFI";
AjxDebug._BOTTOM_FRAME_NAME="AjxDebug_BFN";
AjxDebug.prototype.toString=function(){
return"AjxDebug"
};
AjxDebug.prototype.setTitle=function(e){
if(this._document&&!AjxEnv.isIE){
this._document.title=e
}};
AjxDebug.prototype.setDebugLevel=function(e){
this._level=parseInt(e)||e;
this._enable(this._level!=AjxDebug.NONE)
};
AjxDebug.prototype.getDebugLevel=function(){
return this._level
};
AjxDebug.prototype.println=function(n,o,i){
if(!this._isWriteable()){
return
}
try{
var e=this._handleArgs(arguments);
if(!e){
return
}
o=e.args.join("");
var a=(this._target!=AjxDebug.TGT_CONSOLE)?"<br>":"";
this._add({
msg:this._timestamp()+o+a,linkName:e.linkName,level:n}
)
}
catch(t){}};
AjxDebug.prototype.isDisabled=function(){
return !this._enabled
};
AjxDebug.prototype.dumpObj=function(o,a,t,i){
if(!this._isWriteable()){
return
}
var e=this._handleArgs(arguments);
if(!e){
return
}
a=e.args[0];
if(!a){
return
}
t=e.args[1];
this._add({
obj:a,linkName:e.linkName,showFuncs:t,level:o}
)
};
AjxDebug.prototype.printRaw=function(i,a,t){
if(!this._isWriteable()){
return
}
var e=this._handleArgs(arguments);
if(!e){
return
}
this._add({
obj:e.args[0],isRaw:true,linkName:e.linkName,level:i}
)
};
AjxDebug.prototype.printXML=function(i,a,t){
if(!this._isWriteable()){
return
}
var e=this._handleArgs(arguments);
if(!e){
return
}
a=e.args[0];
if(!a){
return
}
if(a.length>AjxDebug.MAX_OUT){
this.printRaw(a);
return
}
this._add({
obj:a,isXml:true,linkName:e.linkName,level:i}
)
};
AjxDebug.prototype.display=function(i,a,t){
if(!this._isWriteable()){
return
}
var e=this._handleArgs(arguments);
if(!e){
return
}
a=e.args[0];
a=a.replace(/\r?\n/g,"[crlf]");
a=a.replace(/ /g,"[space]");
a=a.replace(/\t/g,"[tab]");
this.printRaw(i,a,t)
};
AjxDebug.prototype.showTiming=function(t,o){
this._showTiming=t;
if(t){
this._enable(true)
}
var a=t?"on":"off";
var i="Turning timing info "+a;
if(o){
i=i+": "+o
}
var e=new DebugMessage({
msg:i}
);
this._addMessage(e);
this._startTimePt=this._lastTimePt=new Date().getTime()
};
AjxDebug.prototype.timePt=function(r,a){
if(!this._showTiming||!this._isWriteable()){
return
}
if(a){
this._startTimePt=this._lastTimePt=new Date().getTime()
}
var o=new Date().getTime();
var e=o-this._startTimePt;
var t=o-this._lastTimePt;
this._lastTimePt=o;
var i=a?"<br/>":"";
r=r?" "+r:"";
var s=[i,"[",e," / ",t,"]",r].join("");
var n="<div>"+s+"</div>";
this._addMessage(new DebugMessage({
msg:n}
));
return t
};
AjxDebug.prototype.getContentFrame=function(){
if(this._contentFrame){
return this._contentFrame
}
if(this._debugWindow&&this._debugWindow.document){
return this._debugWindow.document.getElementById(AjxDebug._CONTENT_FRAME_ID)
}
return null
};
AjxDebug.prototype.getLinkFrame=function(e){
if(this._linkFrame){
return this._linkFrame
}
if(this._debugWindow&&this._debugWindow.document){
return this._debugWindow.document.getElementById(AjxDebug._LINK_FRAME_ID)
}
if(!e){
this._openDebugWindow();
return this.getLinkFrame(true)
}
return null
};
AjxDebug.prototype._enable=function(e){
this._enabled=e;
if(this._target==AjxDebug.TGT_WINDOW){
if(e){
if(!this._dbgName){
this._dbgName="AjxDebugWin_"+location.hostname.replace(/\./g,"_")
}
if(this._debugWindow==null||this._debugWindow.closed){
this._openDebugWindow()
}}else{
if(this._debugWindow){
this._debugWindow.close();
this._debugWindow=null
}}}};
AjxDebug.prototype._isWriteable=function(){
if(this.isDisabled()){
return false
}
if(this._target==AjxDebug.TGT_WINDOW){
try{
return(!this._isPaused&&this._debugWindow&&!this._debugWindow.closed)
}
catch(e){
return false
}}
return true
};
AjxDebug.prototype._getHtmlForObject=function(o,n){
n=n||{};
var a=[];
var t=0;
if(o===undefined){
a[t++]="<span>Undefined</span>"
}else{
if(o===null){
a[t++]="<span>NULL</span>"
}else{
if(AjxUtil.isBoolean(o)){
a[t++]="<span>"+o+"</span>"
}else{
if(AjxUtil.isNumber(o)){
a[t++]="<span>"+o+"</span>"
}else{
if(n.isRaw){
a[t++]=this._timestamp();
a[t++]="<textarea rows='25' style='width:100%' readonly='true'>";
a[t++]=o;
a[t++]="</textarea><p></p>"
}else{
if(n.isXml){
var e=new AjxDebugXmlDocument;
var i=e.create();
if(i&&("loadXML" in i)){
i.loadXML(o);
a[t++]="<div style='border-width:2px; border-style:inset; width:100%; height:300px; overflow:auto'>";
a[t++]=this._createXmlTree(i,0,{
authToken:true}
);
a[t++]="</div>"
}else{
a[t++]="<span>Unable to create XmlDocument to show XML</span>"
}}else{
a[t++]="<div style='border-width:2px; border-style:inset; width:100%; height:300px; overflow:auto'><pre>";
a[t++]=this._dump(o,true,n.showFuncs,{
ZmAppCtxt:true,authToken:true}
);
a[t++]="</div></pre>"
}}}}}}
return a.join("")
};
AjxDebug.prototype._dump=function(i,a,e,t){
return AjxStringUtil.prettyPrint(i,a,e,t)
};
AjxDebug.prototype._handleArgs=function(n){
if(this._level==AjxDebug.NONE||this._showTiming||n.length==0){
return
}
var e=new Array(n.length);
for(var a=0;
a<n.length;
a++){
e[a]=n[a]
}
var l={
args:null,linkName:null};
var r=e.length;
if(e.length>1){
var h=e[e.length-1];
if(h&&h.indexOf&&(h.indexOf("DebugWarn")!=-1||((h.indexOf(" ")==-1)&&(/Request|Response$/.test(h))))){
l.linkName=h;
e.pop()
}}
var s=null;
var t=e[0];
var o=(typeof t=="number"||((r>1)&&t.length<=8&&/^[a-z0-9]+$/.test(t)));
if(o){
s=t;
e.shift()
}
if(s&&(AjxDebug.BUFFER_MAX[s]==null)){
if(typeof this._level=="number"){
if(typeof s!="number"||(s>this._level)){
return
}}else{
if(s!=this._level){
return
}}}
l.args=e;
return l
};
AjxDebug.prototype._openDebugWindow=function(i){
var t=AjxEnv.isIE?"_blank":this._dbgName;
this._debugWindow=window.open("",t,"width=600,height=400,resizable=yes,scrollbars=yes");
if(this._debugWindow==null){
this._enabled=false;
return
}
this._enabled=true;
this._isPrevWinOpen=this._debugWindow.debug;
this._debugWindow.debug=true;
try{
this._document=this._debugWindow.document;
this.setTitle("Debug");
if(!this._isPrevWinOpen){
this._document.write("<html>","<head>","<script>","function blank() {return [","'<html><head><style type=\"text/css\">',","'P, TD, DIV, SPAN, SELECT, INPUT, TEXTAREA, BUTTON {',","'font-family: Tahoma, Arial, Helvetica, sans-serif;',","'font-size:11px;}',","'.Content {display:block;margin:0.25em 0em;}',","'.Link {cursor: pointer;color:blue;text-decoration:underline;white-space:nowrap;width:100%;}',","'.DebugWarn {color:red;font-weight:bold;}',","'.Run {color:black; background-color:red;width:100%;font-size:18px;font-weight:bold;}',","'.RunLink {display:block;color:black;background-color:red;font-weight:bold;white-space:nowrap;width:100%;}',","'</style></head><body></body></html>'].join(\"\");}","<\/script>","</head>","<frameset cols='125, *'>","<frameset rows='*,40'>","<frame name='",AjxDebug._LINK_FRAME_ID,"' id='",AjxDebug._LINK_FRAME_ID,"' src='javascript:parent.parent.blank();'>","<frame name='",AjxDebug._BOTTOM_FRAME_NAME,"' id='",AjxDebug._BOTTOM_FRAME_ID,"' src='javascript:parent.parent.blank();' scrolling=no frameborder=0>","</frameset>","<frame name='",AjxDebug._CONTENT_FRAME_ID,"' id='",AjxDebug._CONTENT_FRAME_ID,"' src='javascript:parent.blank();'>","</frameset>","</html>");
this._document.close();
var e=new AjxTimedAction(this,AjxDebug.prototype._finishInitWindow);
AjxTimedAction.scheduleAction(e,2500)
}else{
this._finishInitWindow();
this._contentFrame=this._document.getElementById(AjxDebug._CONTENT_FRAME_ID);
this._linkFrame=this._document.getElementById(AjxDebug._LINK_FRAME_ID);
this._createLinkNContent("RunLink","NEW RUN","Run","NEW RUN");
this._attachHandlers();
this._dbgWindowInited=true;
this._showMessages()
}}
catch(a){
if(this._debugWindow){
this._debugWindow.close()
}
this._openDebugWindow(true)
}};
AjxDebug.prototype._finishInitWindow=function(){
try{
this._contentFrame=this._debugWindow.document.getElementById(AjxDebug._CONTENT_FRAME_ID);
this._linkFrame=this._debugWindow.document.getElementById(AjxDebug._LINK_FRAME_ID);
var n=this._debugWindow.document.getElementById(AjxDebug._BOTTOM_FRAME_ID);
var o=n.contentWindow.document;
var a=[];
var t=0;
a[t++]="<table><tr><td><button id='";
a[t++]=AjxDebug._BOTTOM_FRAME_ID;
a[t++]="_clear'>Clear</button></td><td><button id='";
a[t++]=AjxDebug._BOTTOM_FRAME_ID;
a[t++]="_pause'>Pause</button></td></tr></table>";
if(o.body){
o.body.innerHTML=a.join("")
}}
catch(e){}
if(o){
this._clearBtn=o.getElementById(AjxDebug._BOTTOM_FRAME_ID+"_clear");
this._pauseBtn=o.getElementById(AjxDebug._BOTTOM_FRAME_ID+"_pause")
}
this._attachHandlers();
this._dbgWindowInited=true;
this._showMessages()
};
AjxDebug.prototype._attachHandlers=function(){
var e=AjxCallback.simpleClosure(this._unloadHandler,this);
if(this._debugWindow.attachEvent){
this._unloadHandler=e;
this._debugWindow.attachEvent("onunload",e)
}else{
this._debugWindow.onunload=e
}
if(this._clearBtn){
this._clearBtn.onclick=AjxCallback.simpleClosure(this._clear,this)
}
if(this._pauseBtn){
this._pauseBtn.onclick=AjxCallback.simpleClosure(this._pause,this)
}};
AjxDebug.prototype._scrollToBottom=function(){
var t=this.getContentFrame();
var e=t?t.contentWindow.document.body:null;
var i=this.getLinkFrame();
var a=i?i.contentWindow.document.body:null;
if(e&&a){
e.scrollTop=e.scrollHeight;
a.scrollTop=a.scrollHeight
}};
AjxDebug.prototype._timestamp=function(){
return this._showTime?this._getTimeStamp()+": ":""
};
AjxDebug.prototype.setShowTimestamps=function(e){
this._showTime=e
};
AjxDebug.prototype._createXmlTree=function(o,a,e){
if(o==null){
return""
}
var h="";
var r;
switch(o.nodeType){
case 1:h+="<div style='color: blue; padding-left: 16px;'>&lt;<span style='color: DarkRed;'>"+o.nodeName+"</span>";
if(e&&e[o.nodeName]){
return h+"/&gt;</div>"
}
var l=o.attributes;
r=l.length;
for(var n=0;
n<r;
n++){
h+=this._createXmlAttribute(l[n])
}
if(!o.hasChildNodes()){
return h+"/&gt;</div>"
}
h+="&gt;<br />";
var s=o.childNodes;
r=s.length;
for(var n=0;
n<r;
n++){
h+=this._createXmlTree(s[n],a+3,e)
}
h+="&lt;/<span style='color: DarkRed;'>"+o.nodeName+"</span>&gt;</div>";
break;
case 9:var s=o.childNodes;
r=s.length;
for(var n=0;
n<r;
n++){
h+=this._createXmlTree(s[n],a,e)
}
break;
case 3:if(!/^\s*$/.test(o.nodeValue)){
var t=o.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;");
h+="<span style='color: WindowText; padding-left: 16px;'>"+t+"</span><br />"
}
break;
case 7:h+="&lt;?"+o.nodeName;
var l=o.attributes;
r=l.length;
for(var n=0;
n<r;
n++){
h+=this._createXmlAttribute(l[n])
}
h+="?&gt;<br />";
break;
case 4:h="<div style=''>&lt;![CDATA[<span style='color: WindowText; font-family: \"Courier New\"; white-space: pre; display: block; border-left: 1px solid Gray; padding-left: 16px;'>"+o.nodeValue+"</span>]]></div>";
break;
case 8:h="<div style='color: blue; padding-left: 16px;'>&lt;!--<span style='white-space: pre; font-family: \"Courier New\"; color: Gray; display: block;'>"+o.nodeValue+"</span>--></div>";
break;
case 10:h="<div style='color: blue; padding-left: 16px'>&lt;!DOCTYPE "+o.name;
if(o.publicId){
h+=' PUBLIC "'+o.publicId+'"';
if(o.systemId){
h+=' "'+o.systemId+'"'
}}else{
if(o.systemId){
h+=' SYSTEM "'+o.systemId+'"'
}}
h+="&gt;</div>";
break;
default:this._inspect(o)
}
return h
};
AjxDebug.prototype._createXmlAttribute=function(e){
return[" <span style='color: red'>",e.nodeName,"</span><span style='color: blue'>=\"",e.nodeValue,'"</span>'].join("")
};
AjxDebug.prototype._inspect=function(t){
var a="";
for(var e in t){
a+="obj."+e+" = "+t[e]+"\n"
}
window.alert(a)
};
AjxDebug.prototype._add=function(e){
e.extraHtml=e.obj&&this._getHtmlForObject(e.obj,e);
this._addMessage(new DebugMessage(e))
};
AjxDebug.prototype._addMessage=function(e){
this._msgQueue.push(e);
this._showMessages()
};
AjxDebug.prototype._showMessages=function(){
switch(this._target){
case AjxDebug.TGT_WINDOW:this._showMessagesInWindow();
break;
case AjxDebug.TGT_CONSOLE:this._showMessagesInConsole()
}
this._addMessagesToBuffer();
this._msgQueue=[]
};
AjxDebug.prototype._showMessagesInWindow=function(){
if(!this._dbgWindowInited){
return
}
try{
if(this._msgQueue.length>0){
var e=this.getContentFrame();
var o=this.getLinkFrame();
if(!e||!o){
return
}
var c=e.contentWindow.document;
var r=o.contentWindow.document;
var t=new Date();
for(var n=0,s=this._msgQueue.length;
n<s;
++n){
var a=this._msgQueue[n];
var d=a.linkName;
var l=[a.message,a.extraHtml].join("");
this._createLinkNContent("Link",d,"Content",l,t)
}}
this._scrollToBottom()
}
catch(h){}};
AjxDebug.prototype._addMessagesToBuffer=function(){
var a=(this._target==AjxDebug.TGT_CONSOLE)?"<br>":"";
for(var t=0,e=this._msgQueue.length;
t<e;
++t){
var o=this._msgQueue[t];
AjxDebug._addMessageToBuffer(o.type,o.message+o.extraHtml+a)
}};
AjxDebug._addMessageToBuffer=function(a,i){
a=a||AjxDebug.DEFAULT_TYPE;
var e=AjxDebug.BUFFER_MAX[a];
if(e>0){
var t=AjxDebug.BUFFER[a]=AjxDebug.BUFFER[a]||[];
while(t.length>=e){
t.shift()
}
t.push(i)
}};
AjxDebug.prototype._showMessagesInConsole=function(){
if(!window.console){
return
}
var t=new Date();
for(var a=0,e=this._msgQueue.length;
a<e;
++a){
var o=this._msgQueue[a];
if(window.console&&window.console.log){
window.console.log(AjxStringUtil.stripTags(o.message+o.extraHtml))
}}};
AjxDebug.prototype._getTimeStamp=function(e){
if(!AjxDebug._timestampFormatter){
AjxDebug._timestampFormatter=new AjxDateFormat("HH:mm:ss.SSS")
}
e=e||new Date();
return AjxStringUtil.htmlEncode(AjxDebug._timestampFormatter.format(e),true)
};
AjxDebug.prototype._createLinkNContent=function(s,u,i,h,a){
var o=this.getLinkFrame();
if(!o){
return
}
a=a||new Date();
var n=["[",this._getTimeStamp(a),"]"].join("");
var t="Lnk_"+a.getTime();
if(u){
var r=o.contentWindow.document;
var d=r.createElement("DIV");
d.className=s;
d.innerHTML=[u,n].join(" - ");
d._targetId=t;
d._dbg=this;
d.onclick=AjxDebug._linkClicked;
var c=r.body;
c.appendChild(d)
}
var l=this.getContentFrame().contentWindow.document;
var e=l.createElement("DIV");
e.className=i;
e.id=t;
e.innerHTML=h;
l.body.appendChild(e);
this._scrollToBottom()
};
AjxDebug._linkClicked=function(){
var t=this._dbg.getContentFrame();
var e=t.contentWindow.document.getElementById(this._targetId);
var a=0;
while(e){
a+=e.offsetTop;
e=e.offsetParent
}
t.contentWindow.scrollTo(0,a)
};
AjxDebug.prototype._clear=function(){
this.getContentFrame().contentWindow.document.body.innerHTML="";
this.getLinkFrame().contentWindow.document.body.innerHTML=""
};
AjxDebug.prototype._pause=function(){
this._isPaused=!this._isPaused;
this._pauseBtn.innerHTML=this._isPaused?"Resume":"Pause"
};
AjxDebug.prototype._unloadHandler=function(){
if(!this._debugWindow){
return
}
if(this._debugWindow.detachEvent){
this._debugWindow.detachEvent("onunload",this._unloadHandler)
}else{
this._debugWindow.onunload=null
}};
AjxDebug.println=function(e,t){
AjxDebug._addMessageToBuffer(e,t+"<br>")
};
AjxDebug.dumpObj=function(e,t){
AjxDebug._addMessageToBuffer(e,"<pre>"+AjxStringUtil.prettyPrint(t,true)+"</pre>")
};
AjxDebug.logSoapMessage=function(o){
if(o.methodNameStr=="NoOpRequest"||o.methodNameStr=="NoOpResponse"){
return
}
var t=AjxDebug._getTimeStamp();
var i=["<b>",o.methodNameStr,o.asyncMode?"":" (SYNCHRONOUS)"," - ",t,"</b>"].join("");
for(var e in AjxDebug.BUFFER){
if(e==AjxDebug.DEFAULT_TYPE){
continue
}
AjxDebug.println(e,i)
}
if(window.DBG){
var a=o.methodNameStr;
if(!o.asyncMode){
a="<span class='DebugWarn'>SYNCHRONOUS </span>"+a
}
window.DBG.println(window.DBG._level,i,a)
}};
AjxDebug._getTimeStamp=function(e){
return AjxDebug.prototype._getTimeStamp.apply(null,arguments)
};
AjxDebug.getDebugLog=function(t){
t=t||AjxDebug.DEFAULT_TYPE;
var e=AjxDebug.BUFFER[t];
return e?e.join(""):""
};
DebugMessage=function(e){
e=e||{};
this.message=e.msg||"";
this.type=e.type||null;
this.category=e.category||"";
this.time=e.time||(new Date().getTime());
this.extraHtml=e.extraHtml||"";
this.linkName=e.linkName;
this.type=(e.level&&typeof(e.level)=="string")?e.level:AjxDebug.DEFAULT_TYPE
}
}
if(AjxPackage.define("ajax.debug.AjxDebugXmlDocument")){
AjxDebugXmlDocument=function(){};
getDomDocumentPrefix=function(){
if(getDomDocumentPrefix.prefix){
return getDomDocumentPrefix.prefix
}
var n=["MSXML2","Microsoft","MSXML","MSXML3"];
var s;
var e=n.length;
for(var a=0;
a<e;
a++){
try{
s=new ActiveXObject(n[a]+".DomDocument");
return getDomDocumentPrefix.prefix=n[a]
}
catch(t){}}
throw new Error("Could not find an installed XML parser")
};
AjxDebugXmlDocument.prototype.create=function(){
try{
if(document.implementation&&document.implementation.createDocument){
var t=document.implementation.createDocument("","",null);
if(t.readyState==null){
t.readyState=1;
t.addEventListener("load",function(){
t.readyState=4;
if(typeof t.onreadystatechange=="function"){
t.onreadystatechange()
}}
,false)
}
return t
}
if(window.ActiveXObject){
return new ActiveXObject(getDomDocumentPrefix()+".DomDocument")
}}
catch(e){}
throw new Error("Your browser does not support XmlDocument objects")
};
if(window.DOMParser&&window.XMLSerializer&&window.Node&&Node.prototype&&Node.prototype.__defineGetter__){
if(AjxEnv.isSafari){
Document.prototype.loadXML=function(a){
var o=(new DOMParser()).parseFromString(a,"text/xml");
while(this.hasChildNodes()){
this.removeChild(this.lastChild)
}
var e=o.childNodes.length;
for(var t=0;
t<e;
t++){
this.appendChild(this.importNode(o.childNodes[t],true))
}};
Document.prototype.__defineGetter__("xml",function(){
return(new XMLSerializer()).serializeToString(this)
}
)
}else{
AjxDebugXmlDocument.prototype.loadXML=function(a){
var o=(new DOMParser()).parseFromString(a,"text/xml");
while(this.hasChildNodes()){
this.removeChild(this.lastChild)
}
var e=o.childNodes.length;
for(var t=0;
t<e;
t++){
this.appendChild(this.importNode(o.childNodes[t],true))
}};
AjxDebugXmlDocument.prototype.__defineGetter__("xml",function(){
return(new XMLSerializer()).serializeToString(this)
}
)
}}}
if(AjxPackage.define("ajax.dwt.core.DwtId")){
DwtId=function(){};
DwtId.SEP="__";
DwtId.WIDGET_LIST_VIEW="zl";
DwtId.WIDGET_HDR="zlh";
DwtId.WIDGET_HDR_TABLE="zlht";
DwtId.WIDGET_HDR_ICON="zlhi";
DwtId.WIDGET_HDR_LABEL="zlhl";
DwtId.WIDGET_HDR_ARROW="zlha";
DwtId.WIDGET_HDR_SASH="zlhs";
DwtId.WIDGET_ITEM="zli";
DwtId.WIDGET_ITEM_ROW="zlir";
DwtId.WIDGET_ITEM_CELL="zlic";
DwtId.WIDGET_ITEM_FIELD="zlif";
DwtId.LIST_VIEW_HEADERS="headers";
DwtId.LIST_VIEW_ROWS="rows";
DwtId.IFRAME="iframe";
DwtId.DND_PLUS_ID="z__roundPlus";
DwtId.makeId=function(){
var a=[];
for(var t=0;
t<arguments.length;
t++){
var e=arguments[t];
if(e!=null&&e!=""){
a.push(e)
}}
return a.join(DwtId.SEP)
};
DwtId._makeId=DwtId.makeId;
DwtId.getListViewId=function(t,e){
return DwtId.makeId(DwtId.WIDGET_LIST_VIEW,t,e)
};
DwtId.getListViewHdrId=function(t,e,a){
return DwtId.makeId(t,e,a)
};
DwtId.getListViewItemId=function(t,e,i,a){
return DwtId.makeId(t,e,i,a)
};
DwtId.getIframeId=function(e){
return DwtId.makeId(e,DwtId.IFRAME)
}
}
if(AjxPackage.define("ajax.dwt.core.Dwt")){
Dwt=function(){};
Dwt.STATIC_STYLE="static";
Dwt.ABSOLUTE_STYLE="absolute";
Dwt.RELATIVE_STYLE="relative";
Dwt.FIXED_STYLE="fixed";
Dwt.NO_REPEAT="no-repeat";
Dwt.REPEAT="repeat";
Dwt.REPEAT_X="repeat-x";
Dwt.REPEAT_Y="repeat-y";
Dwt.DISPLAY_INLINE="inline";
Dwt.DISPLAY_BLOCK="block";
Dwt.DISPLAY_NONE="none";
Dwt.DISPLAY_TABLE_ROW="table-row";
Dwt.DISPLAY_TABLE_CELL="table-cell";
Dwt.CLIP=1;
Dwt.VISIBLE=2;
Dwt.SCROLL=3;
Dwt.FIXED_SCROLL=4;
Dwt.SCROLL_Y=5;
Dwt.SCROLL_X=6;
Dwt.Z_HIDDEN=100;
Dwt.Z_CURTAIN=200;
Dwt.Z_VIEW=300;
Dwt.Z_MENU=500;
Dwt.Z_VEIL=600;
Dwt.Z_DIALOG=700;
Dwt.Z_DIALOG_MENU=750;
Dwt.Z_TOOLTIP=775;
Dwt.Z_DND=800;
Dwt.Z_BUSY=900;
Dwt.Z_TOAST=950;
Dwt.Z_SPLASH=1000;
Dwt.DEFAULT=-123456789;
Dwt.CLEAR=-20000;
Dwt.LOC_NOWHERE=-10000;
Dwt.DND_DROP_NONE=0;
Dwt.DND_DROP_COPY=1;
Dwt.DND_DROP_MOVE=2;
Dwt.SCROLLBAR_WIDTH=22;
Dwt.HTML="text/html";
Dwt.TEXT="text/plain";
Dwt.KEY_OBJECT="_object_";
Dwt.KEY_ID="_id_";
Dwt._Z_INC=1;
Dwt.__nextId={};
Dwt.getNextId=function(e){
e=e||"DWT";
if(!Dwt.__nextId[e]){
Dwt.__nextId[e]=1
}
return e+Dwt.__nextId[e]++
};
Dwt.associateElementWithObject=function(a,e,t){
a[t||"dwtObj"]=e.__internalId=AjxCore.assignId(e)
};
Dwt.disassociateElementFromObject=function(a,e,t){
if(a){
a.removeAttribute(t||"dwtObj")
}
if(e.__internalId){
AjxCore.unassignId(e.__internalId)
}};
Dwt.getObjectFromElement=function(t,e){
return AjxCore.objectWithId(t[e||"dwtObj"])
};
Dwt.getElement=function(e){
return(typeof(e)=="string")?document.getElementById(e):e
};
Dwt.findAncestor=function(a,t){
var e=Dwt.getAttr(a,t);
while(a&&(e==null||e=="")){
a=a.parentNode;
e=Dwt.getAttr(a,t)
}
return a
};
Dwt.isAncestor=function(t,e){
if(t==e){
return true
}
var a=e;
while(a){
a=a.parentNode;
if(a==t){
return true
}}
return false
};
Dwt.setHandler=function(a,t,e){
if(!(a=Dwt.getElement(a))){
return
}
if(t==DwtEvent.ONMOUSEWHEEL&&AjxEnv.isGeckoBased){
Dwt.clearHandler(a,t)
}
a[t]=e;
if(t==DwtEvent.ONMOUSEWHEEL&&AjxEnv.isGeckoBased){
a.addEventListener("DOMMouseScroll",e,true)
}};
Dwt.clearHandler=function(a,t){
if(!(a=Dwt.getElement(a))){
return
}
if(t==DwtEvent.ONMOUSEWHEEL&&AjxEnv.isGeckoBased){
if(a[t]){
var e=a[t];
a.removeEventListener("DOMMouseScroll",e,true)
}}
a[t]=null
};
Dwt.getBackgroundRepeat=function(e){
if(!(e=Dwt.getElement(e))){
return
}
return DwtCssStyle.getProperty(e,"background-repeat")
};
Dwt.setBackgroundRepeat=function(t,e){
if(!(t=Dwt.getElement(t))){
return
}
t.style.backgroundRepeat=e
};
Dwt.getBounds=function(o,a){
if(!(o=Dwt.getElement(o))){
return null
}
var i=DwtPoint.tmp;
Dwt.getLocation(o,i);
var t=i.x;
var e=i.y;
Dwt.getSize(o,i);
if(!a){
return new DwtRectangle(t,e,i.x,i.y)
}else{
a.set(t,e,i.x,i.y);
return a
}};
Dwt.setBounds=function(i,t,o,a,e){
if(!(i=Dwt.getElement(i))){
return
}
Dwt.setLocation(i,t,o);
Dwt.setSize(i,a,e)
};
Dwt.getCursor=function(e){
if(!(e=Dwt.getElement(e))){
return""
}
return DwtCssStyle.getProperty(e,"cursor")
};
Dwt.setCursor=function(t,e){
if(!(t=Dwt.getElement(t))){
return
}
t.style.cursor=e
};
Dwt.getLocation=function(t,e){
if(!(t=Dwt.getElement(t))){
return null
}
e=e||new DwtPoint(0,0);
if(t.style.position==Dwt.ABSOLUTE_STYLE){
e.set(parseInt(DwtCssStyle.getProperty(t,"left")),parseInt(DwtCssStyle.getProperty(t,"top")));
return e
}
return Dwt.toWindow(t,0,0,null,null,e)
};
Dwt.setLocation=function(a,t,i){
if(!(a=Dwt.getElement(a))){
return
}
var e=DwtCssStyle.getProperty(a,"position");
if(e!=Dwt.ABSOLUTE_STYLE&&e!=Dwt.RELATIVE_STYLE&&e!=Dwt.FIXED_STYLE){
throw new DwtException("Static widgets may not be positioned",DwtException.INVALID_OP,"Dwt.setLocation")
}
if(t=Dwt.__checkPxVal(t)){
a.style.left=t
}
if(i=Dwt.__checkPxVal(i)){
a.style.top=i
}};
Dwt.getPosition=function(e){
if(!(e=Dwt.getElement(e))){
return
}
return e.style.position
};
Dwt.setPosition=function(t,e){
if(!(t=Dwt.getElement(t))){
return
}
t.style.position=e
};
Dwt.getScrollStyle=function(a){
if(!(a=Dwt.getElement(a))){
return""
}
var i=DwtCssStyle.getProperty(a,"overflow");
if(i=="hidden"){
return Dwt.CLIP
}
if(i=="auto"){
return Dwt.SCROLL
}
if(i=="scroll"){
return Dwt.FIXED_SCROLL
}
if(i==""){
var t=DwtCssStyle.getProperty(a,"overflowX");
var e=DwtCssStyle.getProperty(a,"overflowY");
if(t=="scroll"){
return Dwt.SCROLL_X
}
if(e=="scroll"){
return Dwt.SCROLL_Y
}}
return Dwt.VISIBLE
};
Dwt.setScrollStyle=function(t,e){
if(!(t=Dwt.getElement(t))){
return
}
if(e==Dwt.CLIP){
t.style.overflow="hidden"
}else{
if(e==Dwt.SCROLL){
t.style.overflow="auto"
}else{
if(e==Dwt.FIXED_SCROLL){
t.style.overflow="scroll"
}else{
if(e==Dwt.SCROLL_Y){
t.style.overflowX="hidden";
t.style.overflowY="auto"
}else{
if(e==Dwt.SCROLL_X){
t.style.overflowY="hidden";
t.style.overflowX="auto"
}else{
t.style.overflow="visible"
}}}}}};
Dwt.getSize=function(i,e,t){
if(!(i=Dwt.getElement(i))){
return
}
var a;
if(!e){
a=new DwtPoint(0,0)
}else{
a=e;
a.set(0,0)
}
if(!i){
return a
}
if(t){
if(i.style.width){
a.x=parseInt(i.style.width)
}
if(i.style.height){
a.y=parseInt(i.style.height)
}
return a
}
a.x=i.offsetWidth;
if(a.x!=null){
a.y=i.offsetHeight
}else{
if(i.clip&&i.clip.width!=null){
a.x=parseInt(i.clip.width);
a.y=parseInt(i.clip.height)
}else{
if(i.style&&i.style.pixelWidth!=null){
a.x=parseInt(i.style.pixelWidth);
a.y=parseInt(i.style.pixelHeight)
}}}
return a
};
Dwt.getOuterSize=function(i,e){
var a=Dwt.getSize(i,e);
if(a&&Dwt.getVisible(i)){
var t=Dwt.getMargins(i);
a.x+=t.left+t.right;
a.y+=t.top+t.bottom
}
return a
};
Dwt.setSize=function(a,t,e){
if(!(a=Dwt.getElement(a))){
return
}
if(!a.style){
return
}
if(t==Dwt.CLEAR){
a.style.width=null
}else{
if(t=Dwt.__checkPxVal(t,true)){
a.style.width=t
}}
if(e==Dwt.CLEAR){
a.style.height=null
}else{
if(e=Dwt.__checkPxVal(e,true)){
a.style.height=e
}}};
Dwt.getHtmlExtent=function(e){
var t=AjxStringUtil.calcDIV();
t.innerHTML=e;
return Dwt.getSize(t)
};
Dwt.toDocumentFragment=function(a,n){
var o=AjxStringUtil.calcDIV();
o.innerHTML=a;
var t=document.createDocumentFragment();
var e=n&&document.getElementById(n);
if(e){
t.appendChild(e)
}else{
for(var i=o.firstChild;
i;
i=o.firstChild){
t.appendChild(i)
}}
return t
};
Dwt.getAttr=function(a,e,t){
if(!t){
return a&&a.tagName?(a.getAttribute(e)||a[e]):null
}else{
while(a){
if(Dwt.getAttr(a,e)!=null){
return a
}
a=a.parentNode
}
return null
}};
Dwt.getVisible=function(t){
if(!(t=Dwt.getElement(t))){
return
}
var e=DwtCssStyle.getProperty(t,"display");
return(e!=Dwt.DISPLAY_NONE)
};
Dwt.setVisible=function(t,a){
if(!(t=Dwt.getElement(t))){
return
}
if(a){
if(t.nodeName.match(/tr/i)){
t.style.display=Dwt.DISPLAY_TABLE_ROW
}else{
if(t.nodeName.match(/td|th/i)){
t.style.display=Dwt.DISPLAY_TABLE_CELL
}else{
t.style.display=t.getAttribute("x-display")||Dwt.DISPLAY_BLOCK
}}}else{
var e=DwtCssStyle.getComputedStyleObject(t).display;
if(e!="none"){
t.setAttribute("x-display",e)
}
t.style.display=Dwt.DISPLAY_NONE
}};
Dwt.getVisibility=function(t){
if(!(t=Dwt.getElement(t))){
return
}
var e=DwtCssStyle.getProperty(t,"visibility");
return(e=="visible")
};
Dwt.setVisibility=function(e,t){
if(!(e=Dwt.getElement(e))){
return
}
e.style.visibility=t?"visible":"hidden"
};
Dwt.__MSIE_OPACITY_RE=/alpha\(opacity=(\d+)\)/;
Dwt.getOpacity=function(a){
if(!(a=Dwt.getElement(a))){
return
}
if(AjxEnv.isIE&&!AjxEnv.isIE9up){
var t=Dwt.getIEFilter(a,"alpha");
var e=Dwt.__MSIE_OPACITY_RE.exec(t)||[t,"100"];
return Number(e[1])
}
return Number(a.style.opacity||1)*100
};
Dwt.setOpacity=function(t,e){
if(!(t=Dwt.getElement(t))){
return
}
if(AjxEnv.isIE&&!AjxEnv.isIE9up){
Dwt.alterIEFilter(t,"alpha","alpha(opacity="+e+")")
}else{
t.style.opacity=e/100
}};
Dwt.getZIndex=function(t,e){
if(!(t=Dwt.getElement(t))){
return
}
if(e){
while(t.style.zIndex===""&&t.parentNode){
t=t.parentNode
}
return t.style.zIndex
}
return DwtCssStyle.getProperty(t,"z-index")
};
Dwt.setZIndex=function(t,e){
if(!(t=Dwt.getElement(t))){
return
}
t.style.zIndex=e;
if(e<Dwt.Z_VIEW){
t.setAttribute("aria-hidden",true)
}else{
t.removeAttribute("aria-hidden")
}};
Dwt.getDisplay=function(e){
DwtCssStyle.getProperty(e,"display")
};
Dwt.setDisplay=function(t,e){
if(!(t=Dwt.getElement(t))){
return
}
t.style.display=e
};
Dwt.getWindowSize=function(e){
var t=(!e)?new DwtPoint(0,0):e;
if(window.innerWidth){
t.x=window.innerWidth;
t.y=window.innerHeight
}else{
if(AjxEnv.isIE6CSS){
t.x=document.body.parentElement.clientWidth;
t.y=document.body.parentElement.clientHeight
}else{
if(document.body&&document.body.clientWidth){
t.x=document.body.clientWidth;
t.y=document.body.clientHeight
}}}
return t
};
Dwt.toWindow=function(i,s,n,l,r,h){
var t;
if(!h){
t=new DwtPoint(s,n)
}else{
t=h;
t.set(s,n)
}
i=Dwt.getElement(i);
var e=i;
while(e&&e!=l){
t.x+=e.offsetLeft-e.scrollLeft;
t.y+=e.offsetTop;
if(!r){
var a=AjxEnv.isOpera?e.pageYOffset:e.scrollTop;
if(a){
t.y-=a
}
var o=e.parentNode;
while(o!=e.offsetParent&&o!=l){
a=AjxEnv.isOpera?o.pageYOffset:o.scrollTop;
if(a){
t.y-=a
}
o=o.parentNode
}}
e=e.offsetParent
}
return t
};
Dwt.getInsets=function(i){
if(!(i=Dwt.getElement(i))){
return
}
var t=DwtCssStyle.getComputedStyleObject(i);
var a=parseInt(t.borderLeftWidth)||0;
var r=parseInt(t.borderTopWidth)||0;
var h=parseInt(t.borderRightWidth)||0;
var n=parseInt(t.borderBottomWidth)||0;
var o=parseInt(t.paddingLeft)||0;
var l=parseInt(t.paddingTop)||0;
var e=parseInt(t.paddingRight)||0;
var s=parseInt(t.paddingBottom)||0;
return{
left:a+o,top:r+l,right:h+e,bottom:n+s}
};
Dwt.insetBounds=function(t,e){
if(isNaN(t.x)||isNaN(e.left)){
return t
}
t.x+=e.left;
t.y+=e.top;
t.width-=e.left+e.right;
t.height-=e.top+e.bottom;
return t
};
Dwt.getInsetBounds=function(a){
if(!(a=Dwt.getElement(a))){
return
}
var t=Dwt.getBounds(a);
var e=Dwt.getInsets(a);
return Dwt.insetBounds(t,e)
};
Dwt.getMargins=function(t){
if(!(t=Dwt.getElement(t))){
return
}
var e=DwtCssStyle.getComputedStyleObject(t);
return{
left:parseInt(e.marginLeft)||0,top:parseInt(e.marginTop)||0,right:parseInt(e.marginRight)||0,bottom:parseInt(e.marginBottom)||0}
};
Dwt.getAncestors=function(a,e,t){
var i=[];
if(!e){
e=document.documentElement
}
if(t){
i.push(a)
}
while(a&&a!=e){
i.push(a.parentNode);
a=a.parentNode
}
if(i[i.length-1]!=e){
return null
}
return i
};
Dwt.setStatus=function(e){
window.status=e
};
Dwt.getTitle=function(){
return window.document.title
};
Dwt.setTitle=function(e){
window.document.title=e
};
Dwt.getIframeDoc=function(e){
if(e){
return AjxEnv.isIE?e.contentWindow.document:e.contentDocument
}
return null
};
Dwt.getIframeWindow=function(e){
return e.contentWindow
};
Dwt.parseHtmlFragment=function(o,a){
if(!Dwt._div){
Dwt._div=document.createElement("div")
}
if(a){
o="<table style='table-layout:fixed'>"+o+"</table>"
}
Dwt._div.innerHTML=o;
if(a){
var e=document.createDocumentFragment();
var n=Dwt._div.firstChild.rows;
for(var t=n.length-1;
t>=0;
t--){
e.appendChild(n[0])
}
return e.childNodes.length>1?e:e.firstChild
}
return Dwt._div.firstChild
};
Dwt.contains=function(a,t){
var i=false;
if(a.compareDocumentPosition){
var e=a.compareDocumentPosition(t);
if((e==(document.DOCUMENT_POSITION_CONTAINED_BY|document.DOCUMENT_POSITION_FOLLOWING))){
i=true
}}else{
if(a.contains){
i=a.contains(t)
}}
return i
};
Dwt.removeChildren=function(e){
while(e.hasChildNodes()){
e.removeChild(e.firstChild)
}};
Dwt.getCellIndex=function(t){
if(AjxEnv.isOpera){
if(t.tagName&&t.tagName.toLowerCase()=="td"){
var a=t.parentNode.cells;
var e=a.length;
for(var o=0;
o<e;
o++){
if(a[o]==t){
return o
}}}}else{
return t.cellIndex
}
return -1
};
Dwt.delClass=function(a,e,i){
if(a==null){
return
}
if(!e&&!i){
return
}
if(typeof e=="string"&&e.length){
e=Dwt._DELCLASS_CACHE[e]||(Dwt._DELCLASS_CACHE[e]=new RegExp("\\b"+e+"\\b","ig"))
}
var t=a.className||"";
t=t.replace(e," ");
t=AjxStringUtil.trim(t);
a.className=i?t+" "+i:t
};
Dwt._DELCLASS_CACHE={};
Dwt.addClass=function(e,t){
Dwt.delClass(e,t,t)
};
Dwt.condClass=function(i,o,t,e){
if(!!o){
if(e){
Dwt.delClass(i,e)
}
Dwt.addClass(i,t)
}else{
Dwt.delClass(i,t);
if(e){
Dwt.addClass(i,e)
}}};
Dwt.hasClass=function(t,e){
if(!t||!e){
return false
}
return t.className.match(new RegExp("\\b"+e+"\\b"))
};
Dwt.setSelectionRange=function(a,i,e){
if(a.setSelectionRange){
a.focus();
a.setSelectionRange(i,e)
}else{
if(a.createTextRange){
var t=a.createTextRange();
t.collapse(true);
t.moveStart("character",i);
t.moveEnd("character",e-i);
t.select()
}else{
if(a.select){
a.select()
}}}};
Dwt.getSelectionStart=function(i){
if(AjxUtil.isSpecified(i.selectionStart)){
return i.selectionStart
}else{
if(document.selection){
var a=document.selection.createRange();
var t=a.compareEndPoints("StartToEnd",a)==0;
if(!t){
a.collapse(true)
}
var e=a.getBookmark();
var o=i.createTextRange().getBookmark().charCodeAt(2);
return Math.max(e.charCodeAt(2)-o,0)
}}
return i.value.length
};
Dwt.getSelectionEnd=function(i){
if(AjxUtil.isSpecified(i.selectionEnd)){
return i.selectionEnd
}else{
if(document.selection){
var a=document.selection.createRange();
var t=a.compareEndPoints("StartToEnd",a)==0;
if(!t){
a.collapse(false)
}
var e=a.getBookmark();
var o=i.createTextRange().getBookmark().charCodeAt(2);
return Math.max(e.charCodeAt(2)-o,0)
}}
return i.value.length
};
Dwt.setSelectionText=function(t,o){
var n=Dwt.getSelectionStart(t);
var e=Dwt.getSelectionEnd(t);
var i=t.value;
var a=[i.substr(0,n),o,i.substr(e)].join("");
if(typeof t.setValue=="function"){
t.setValue(a)
}else{
t.value=a
}
Dwt.setSelectionRange(t,n,n+o.length)
};
Dwt.moveCursorToEnd=function(e){
Dwt.setSelectionRange(e,e.value.length,e.value.length)
};
Dwt.instanceOf=function(t,e){
if(typeof t=="string"){
return window[t]&&(t==e||window[t].prototype instanceof window[e])
}
return(window[e]&&t instanceof window[e])
};
Dwt.getParams=function(e,n,a){
if(!AjxUtil.isArrayLike(e)){
return{}
}
if(e.length>1||!AjxUtil.isHash(e[0])||a){
var o={};
for(var t=0;
t<e.length;
t++){
o[n[t]]=e[t]
}
return o
}
if(e.length===1){
return e[0]
}
return{}
};
Dwt.__REM_RE=/^(-?[0-9]+(?:\.[0-9]*)?)rem$/;
Dwt.__checkPxVal=function(t,e){
if(t==Dwt.DEFAULT){
return false
}
if(isNaN(parseInt(t))){
return false
}
if(e&&t<0&&t!=Dwt.LOC_NOWHERE){
t=0
}
if(typeof(t)=="number"){
t=t+"px"
}
if(!AjxEnv.supportsCSS3RemUnits&&Dwt.__REM_RE.test(t)){
t=DwtCssStyle.asPixelCount(t)+"px"
}
return t
};
Dwt.byId=function(o,t){
if(!t){
return(typeof o=="string"?document.getElementById(o):o)
}
if(t==o||t.id==o){
return t
}
for(var e=0;
e<t.childNodes.length;
e++){
if(t.childNodes[e].nodeType==1){
var a=Dwt.byId(o,t.childNodes[e]);
if(a){
return a
}}}
return null
};
Dwt.byTag=function(t,e){
if(!e){
e=document
}
return AjxUtil.toArray(e.getElementsByTagName(t))
};
Dwt.byClassName=function(t,e){
if(!e){
e=document
}
if(e.getElementsByClassName){
return AjxUtil.toArray(e.getElementsByClassName(t))
}else{
var i=new RegExp("\\b"+t+"\\b");
var a=function(s,o){
if(s.className&&s.className.match(i)){
o.push(s)
}
for(var n=0;
n<s.childNodes.length;
n++){
a(s.childNodes[n],o)
}
return o
};
return a(e,[])
}};
Dwt.show=function(t){
var e=Dwt.byId(t);
if(e){
Dwt.setVisible(e,true)
}};
Dwt.hide=function(t){
var e=Dwt.byId(t);
if(e){
Dwt.setVisible(e,false)
}};
Dwt.setText=function(e,t){
e.appendChild(document.createTextNode(t))
};
Dwt.populateText=function(){
if(arguments.length==0){
return
}
var a,e=0,t=arguments.length;
while(e<t){
a=document.getElementById(arguments[e]);
if(a){
Dwt.setText(a,arguments[e+1])
}
e+=2
}};
Dwt.setInnerHtml=function(t,e){
t.innerHTML=e
};
Dwt.setFavIcon=function(r){
var e=null;
if(Dwt._favIconId){
e=document.getElementById(Dwt._favIconId)
}else{
var h=document.getElementsByTagName("head")[0];
var t=h.getElementsByTagName("link");
for(var o=0;
o<t.length;
o++){
var s=t[o];
if(s.rel.toUpperCase()=="SHORTCUT ICON"){
if(!s.id){
s.id=Dwt._favIconId=Dwt.getNextId()
}
e=s;
break
}}}
if(e){
e.href=r;
e.type="image/x-icon";
var n=e.parentNode;
n.removeChild(e);
n.appendChild(e)
}else{
var a=document.createElement("link");
a.id=Dwt._favIconId=Dwt.getNextId();
a.rel="SHORTCUT ICON";
a.href=r;
a.type="image/x-icon";
h=h||document.getElementsByTagName("head")[0];
h.appendChild(a)
}};
Dwt.enableDesignMode=function(a,e){
if(!AjxEnv.isIE){
a.designMode=e?"on":"off"
}else{
var t=a.body;
if(!t||t.contentEditable===undefined){
a.designMode=e?"on":"off"
}else{
t.contentEditable=e?true:false
}}};
Dwt.ffScrollbarCheck=function(a){
if(AjxEnv.isFirefox3_6up||AjxEnv.isDesktop2up){
var e=a.target;
if(e&&(e.clientHeight&&e.scrollHeight&&(e.clientHeight!=e.scrollHeight))||(e.clientWidth&&e.scrollWidth&&(e.clientWidth!=e.scrollWidth))){
a._dontCallPreventDefault=true;
a._stopPropagation=false;
a._returnValue=true;
return true
}}
return false
};
Dwt.selectText=function(t){
if(!t){
Dwt.deselectText();
return
}
if(document.selection){
var e=t.parentTextEdit.createTextRange();
e.moveToElementText(t);
e.select()
}else{
if(window.getSelection){
var e=document.createRange();
e.selectNode(t);
var a=window.getSelection();
a.addRange(e)
}}};
Dwt.deselectText=function(){
if(document.selection){
document.selection.empty()
}else{
if(window.getSelection){
window.getSelection().removeAllRanges()
}}};
Dwt.doOverlap=function(n,o){
if(!n||!o){
return false
}
var r=Dwt.getLocation(n),s=Dwt.getLocation(o);
var d=Dwt.getSize(n),c=Dwt.getSize(o);
var m=r.x,u=s.x,l=r.y,h=s.y;
var i=m+d.x,t=u+c.x;
var a=l+d.y,e=h+c.y;
return !(m>t||i<u||l>e||a<h)
};
Dwt.scrollIntoView=function(a,t){
if(!a||!t){
return
}
var e=Dwt.toWindow(a,0,0,null,null,DwtPoint.tmp).y;
var s=Dwt.toWindow(t,0,0,null,null,DwtPoint.tmp).y+t.scrollTop;
var n=e-s;
if(n<0){
t.scrollTop+=n
}else{
var o=Dwt.getSize(t,DwtPoint.tmp).y;
var i=Dwt.getSize(a,DwtPoint.tmp).y;
n=(e+i)-(s+o);
if(n>0){
t.scrollTop+=n
}}};
Dwt.setLoadingTime=function(a,e){
if(!window.isPerfMetric){
return
}
e=e||new Date();
a+="_loading";
var t=document.getElementById(a);
if(!t){
t=document.createElement("div");
t.id=a;
t.style.display="none";
document.body.appendChild(t)
}
t.innerHTML=e.getTime();
if(window.appDevMode){
console.profile(a)
}};
Dwt.setLoadedTime=function(a,e){
if(!window.isPerfMetric){
return
}
e=e||new Date();
a+="_loaded";
var t=document.getElementById(a);
if(!t){
t=document.createElement("div");
t.id=a;
t.style.display="none";
document.body.appendChild(t)
}
t.innerHTML=e.getTime();
if(window.appDevMode){
console.profileEnd()
}};
Dwt.printPerfMetric=function(){
$.each($('div[id*="_loaded"]'),function(a,n){
var e=$(n).attr("id");
var s=e.substring(0,e.indexOf("_"));
var t=$("#"+s+"_launched");
if(t&&t.length>0){
var i=$("#"+s+"_launched").html()
}else{
i=$("#"+s+"_loading").html()
}
var o="Load time for "+s+" is "+($(n).html()-i);
if(console){
console.log(o)
}}
)
};
Dwt.createLinearGradientCss=function(o,t,i){
var e=null;
var a=this.createLinearGradientInfo(o,t,i);
if(a.field){
e=a.field+":"+a.css+";"
}
return e
};
Dwt.createLinearGradientInfo=function(n,a,r){
var s;
var h={};
if(AjxEnv.isIE&&!AjxEnv.isIE9up){
s=(r=="v")?0:1;
h.field="filter";
h.name="DXImageTransform.Microsoft.Gradient";
h.css="progid:"+h.name+"(GradientType="+s+",startColorstr="+n+",endColorstr="+a+"); zoom:1;"
}else{
if(AjxEnv.isIE9){
var i={
x1:"0%",x2:r=="v"?"0%":"100%",y1:"0%",y2:r=="v"?"100%":"0%",startColor:n,endColor:a};
var e=AjxTemplate.expand("dwt.Widgets#SVGGradient",i);
h.field="background";
h.css=("url(data:image/svg+xml,"+escape(e.replace(/\s+/g," "))+")")
}else{
if(AjxEnv.isFirefox3_6up){
s=(r=="v")?"top":"left";
h.field="background";
h.css="-moz-linear-gradient("+s+","+n+", "+a+")"
}else{
if((AjxEnv.isSafari&&AjxEnv.isSafari5_1up)||AjxEnv.isChrome10up){
s=(r=="v")?"top":"left";
h.field="background";
h.css="-webkit-linear-gradient("+s+","+n+", "+a+")"
}else{
if((AjxEnv.isSafari&&AjxEnv.isSafari4up)||AjxEnv.isChrome2up){
var t="left top";
var o=(r=="v")?"left bottom":"right top";
h.field="background";
h.css="-webkit-gradient(linear, "+t+", "+o+", color-stop(0%, "+n+"), color-stop(100%, "+a+"))"
}else{
s=(r=="v")?"to bottom":"to right";
h.field="background";
h.css="linear-gradient("+s+","+n+", "+a+")"
}}}}}
return h
};
Dwt.setLinearGradient=function(o,i,e,a){
var t=Dwt.createLinearGradientInfo(i,e,a);
if(t.field=="filter"){
Dwt.alterIEFilter(o,t.name,t.css)
}else{
o.style[t.field]=t.css
}};
Dwt.alterIEFilter=function(s,t,o){
if(s.style.filter){
var n=false;
var a=s.style.filter.split(" ");
for(var e=0;
e<a.length;
e++){
if(a[e].indexOf(t)!=-1){
a[e]=o;
n=true;
break
}}
if(!n){
a[a.length]=o
}
s.style.filter=a.join(" ")
}else{
s.style.filter=o
}};
Dwt.getIEFilter=function(n,t){
var a="";
if(n.style.filter){
var o=n.style.filter.split(" ");
for(var e=0;
e<o.length;
e++){
if(o[e].indexOf(t)!=-1){
a=o[e];
break
}}}
return a
};
Dwt.getDescendant=function(a,n){
var t=null;
for(var e=0;
e<a.childNodes.length;
e++){
var o=a.childNodes[e];
if(o.id==n){
t=o
}else{
t=Dwt.getDescendant(o,n)
}
if(t!=null){
break
}}
return t
};
Dwt.getScrollbarSizes=function(i){
var o=Dwt.getInsets(i);
var e=DwtCssStyle.getComputedStyleObject(i);
var a=parseInt(e.borderLeftWidth)||0;
var s=parseInt(e.borderTopWidth)||0;
var h=parseInt(e.borderRightWidth)||0;
var n=parseInt(e.borderBottomWidth)||0;
var t=i.offsetWidth-i.clientWidth-a-h;
var r=i.offsetHeight-i.clientHeight-s-n;
return new DwtPoint(t,r)
}
}
if(AjxPackage.define("ajax.dwt.core.DwtException")){
DwtException=function(a,t,i,e){
if(arguments.length===0){
return
}
AjxException.call(this,a,t,i,e)
};
DwtException.prototype=new AjxException();
DwtException.prototype.constructor=DwtException;
DwtException.prototype.toString=function(){
return"DwtException"
};
DwtException.INVALIDPARENT=-1;
DwtException.INVALID_OP=-2;
DwtException.INTERNAL_ERROR=-3;
DwtException.INVALID_PARAM=-4
}
if(AjxPackage.define("ajax.dwt.core.DwtDraggable")){
DwtDraggable=function(){};
DwtDraggable.dragEl=null;
DwtDraggable.init=function(i,u,n,t,o,e,r,c,d,h,s,l,a){
i.onmousedown=DwtDraggable.__start;
i.__hMode=h?false:true;
i.__vMode=s?false:true;
i.__root=(u&&u!=null)?u:i;
if(i.__hMode&&isNaN(parseInt(i.__root.style.left))){
i.__root.style.left="0px"
}
if(i.__vMode&&isNaN(parseInt(i.__root.style.top))){
i.__root.style.top="0px"
}
if(!i.__hMode&&isNaN(parseInt(i.__root.style.right))){
i.__root.style.right="0px"
}
if(!i.__vMode&&isNaN(parseInt(i.__root.style.bottom))){
i.__root.style.bottom="0px"
}
i.__minX=(typeof n!="undefined")?n:null;
i.__minY=(typeof o!="undefined")?o:null;
i.__maxX=(typeof t!="undefined")?t:null;
i.__maxY=(typeof e!="undefined")?e:null;
i.__xMapper=l?l:null;
i.__yMapper=a?a:null;
i.__root.onDragStart=r;
i.__root.onDragEnd=d;
i.__root.onDrag=c
};
DwtDraggable.setDragBoundaries=function(t,e,i,o,a){
if(t!=null){
if(e!=null){
t.__minX=e
}
if(i!=null){
t.__maxX=i
}
if(o!=null){
t.__minY=o
}
if(a!=null){
t.__maxY=a
}}};
DwtDraggable.__start=function(i){
var a=DwtDraggable.dragEl=this;
i=DwtDraggable.__fixE(i);
var t=parseInt(a.__hMode?a.__root.style.left:a.__root.style.right);
var o=parseInt(a.__vMode?a.__root.style.top:a.__root.style.bottom);
if(a.__root.onDragStart){
a.__root.onDragStart.run([t,o])
}
a.__lastMouseX=i.clientX;
a.__lastMouseY=i.clientY;
if(a.__hMode){
if(a.__minX!=null){
a.__minMouseX=i.clientX-t+a.__minX
}
if(a.__maxX!=null){
a.__maxMouseX=a.__minMouseX+a.__maxX-a.__minX
}}else{
if(a.__minX!=null){
a.__maxMouseX=-a.__minX+i.clientX+t
}
if(a.__maxX!=null){
a.__minMouseX=-a.__maxX+i.clientX+t
}}
if(a.__vMode){
if(a.__minY!=null){
a.__minMouseY=i.clientY-o+a.__minY
}
if(a.__maxY!=null){
a.__maxMouseY=a.__minMouseY+a.__maxY-a.__minY
}}else{
if(a.__minY!=null){
a.__maxMouseY=-a.__minY+i.clientY+o
}
if(a.__maxY!=null){
a.__minMouseY=-a.__maxY+i.clientY+o
}}
document.onmousemove=DwtDraggable.__drag;
document.onmouseup=DwtDraggable.__end;
return false
};
DwtDraggable.__drag=function(s){
s=DwtDraggable.__fixE(s);
var i=DwtDraggable.dragEl;
var o=s.clientY;
var n=s.clientX;
var a=parseInt(i.__hMode?i.__root.style.left:i.__root.style.right);
var h=parseInt(i.__vMode?i.__root.style.top:i.__root.style.bottom);
var t,r;
if(!i.__xMapper){
if(i.__minX!=null){
n=i.__hMode?Math.max(n,i.__minMouseX):Math.min(n,i.__maxMouseX)
}
if(i.__maxX!=null){
n=i.__hMode?Math.min(n,i.__maxMouseX):Math.max(n,i.__minMouseX)
}
t=a+((n-i.__lastMouseX)*(i.__hMode?1:-1))
}else{
t=i.__xMapper(a,n)
}
if(!i.__yMapper){
if(i.__minY!=null){
o=i.__vMode?Math.max(o,i.__minMouseY):Math.min(o,i.__maxMouseY)
}
if(i.__maxY!=null){
o=i.__vMode?Math.min(o,i.__maxMouseY):Math.max(o,i.__minMouseY)
}
r=h+((o-i.__lastMouseY)*(i.__vMode?1:-1))
}else{
r=i.__yMapper(h,o)
}
DwtDraggable.dragEl.__root.style[i.__hMode?"left":"right"]=t+"px";
DwtDraggable.dragEl.__root.style[i.__vMode?"top":"bottom"]=r+"px";
DwtDraggable.dragEl.__lastMouseX=n;
DwtDraggable.dragEl.__lastMouseY=o;
if(DwtDraggable.dragEl.__root.onDrag){
DwtDraggable.dragEl.__root.onDrag.run([t,r])
}
return false
};
DwtDraggable.__end=function(){
document.onmousemove=null;
document.onmouseup=null;
if(DwtDraggable.dragEl.__root.onDragEnd){
DwtDraggable.dragEl.__root.onDragEnd.run([parseInt(DwtDraggable.dragEl.__root.style[DwtDraggable.dragEl.__hMode?"left":"right"]),parseInt(DwtDraggable.dragEl.__root.style[DwtDraggable.dragEl.__vMode?"top":"bottom"])])
}
DwtDraggable.dragEl=null
};
DwtDraggable.__fixE=function(t){
if(typeof t=="undefined"){
t=window.event
}
if(!AjxEnv.isWebKitBased){
if(typeof t.layerX=="undefined"){
t.layerX=t.offsetX
}
if(typeof t.layerY=="undefined"){
t.layerY=t.offsetY
}}
return t
}
}
if(AjxPackage.define("ajax.dwt.graphics.DwtCssStyle")){
DwtCssStyle=function(){};
DwtCssStyle.HOVER="hover";
DwtCssStyle.ACTIVE="active";
DwtCssStyle.SELECTED="selected";
DwtCssStyle.ALT_SELECTED="altSelected";
DwtCssStyle.DISABLED="disabled";
DwtCssStyle.FOCUSED="focused";
DwtCssStyle.ACTIONED="actioned";
DwtCssStyle.MATCHED="matched";
DwtCssStyle.DRAG_OVER="dragOver";
DwtCssStyle.DROPPABLE="droppable";
DwtCssStyle.NOT_DROPPABLE="notDroppable";
DwtCssStyle.DRAG_PROXY="dragProxy";
DwtCssStyle.LINUX="linux";
DwtCssStyle.getProperty=function(r,t){
var e;
if(r.ownerDocument==null){
for(var a=r.parentNode;
a.parentNode!=null;
a=a.parentNode){}
var s=a
}else{
var s=r.ownerDocument
}
if(s.defaultView&&s.defaultView.getComputedStyle){
var n=s.defaultView.getComputedStyle(r,"");
if(n&&n.length>0){
return n.getPropertyValue(t)
}}
var o=t.split("-");
var i=o.shift()+AjxUtil.map(o,AjxStringUtil.capitalize).join("");
if(r.currentStyle){
return r.currentStyle[i]
}else{
if(r.style){
return r.style[i]
}}};
DwtCssStyle.getComputedStyleObject=function(i){
if(i.ownerDocument==null){
for(var t=i.parentNode;
t.parentNode!=null;
t=t.parentNode){}
var a=t
}else{
var a=i.ownerDocument
}
if(a.defaultView){
var e=a.defaultView.getComputedStyle(i,null);
if(!e&&i.style){
i.style.display="";
e=a.defaultView.getComputedStyle(i,null)
}
return e||{}
}else{
if(i.currentStyle){
return i.currentStyle
}else{
if(i.style){
return i.style
}}}};
DwtCssStyle.removeProperty=function(t,a){
if(a instanceof Array){
for(var e=a.length;
--e>=0;
){
DwtCssStyle.removeProperty(t,a[e])
}}else{
if(AjxEnv.isIE){
t.style.removeAttribute(a,true)
}else{
a=a.replace(/([A-Z])/g,"-$1");
t.style.removeProperty(a)
}}};
DwtCssStyle.addRule=function(a,e,i,t){
if(a.addRule){
t=t||(a.rules.length);
a.addRule(e,i,t)
}else{
t=t||(a.cssRules.length);
a.insertRule(e+"{"+i+"}",t)
}
return t
};
DwtCssStyle.removeRule=function(t,e){
if(t.removeRule){
t.removeRule(e)
}else{
t.deleteRule(e)
}};
DwtCssStyle.__PIXEL_RE=/^(-?[0-9]+(?:\.[0-9]*)?)px$/;
DwtCssStyle.__DIMENSION_RE=/^(-?[0-9]+(?:\.[0-9]*)?)([a-z]*|%)$/;
DwtCssStyle.__NUMBER_RE=/^(-?[0-9]+(?:\.[0-9]*)?)+$/;
DwtCssStyle.__getRootFontSize=function(){
var e=DwtCssStyle.getProperty(document.documentElement,"font-size");
if(!DwtCssStyle.__PIXEL_RE.test(e)){
return -1
}
return parseInt(e)
};
DwtCssStyle.asPixelCount=function(o){
if(!o){
return -1
}
var i,a,t;
if(typeof o==="number"||DwtCssStyle.__NUMBER_RE.test(o)){
i=Number(o);
a="px"
}else{
if((t=DwtCssStyle.__DIMENSION_RE.exec(o))){
i=Number(t[1]);
a=t[2]
}else{
return -1
}}
switch(a){
case"rem":var e=DwtCssStyle.__getRootFontSize();
return e!==-1?i*e:-1;
case"mm":i/=10;
case"cm":i/=2.54;
case"in":i*=6;
case"pc":i*=12;
case"pt":i/=0.75;
case"px":return i;
case"ch":case"em":case"ex":return -1;
default:return -1
}}
}
if(AjxPackage.define("ajax.dwt.graphics.DwtPoint")){
DwtPoint=function(e,t){
this.x=e||0;
this.y=t||0
};
DwtPoint.tmp=new DwtPoint(0,0);
DwtPoint.prototype.toString=function(){
return"DwtPoint"
};
DwtPoint.prototype.set=function(e,t){
this.x=e;
this.y=t
}
}
if(AjxPackage.define("ajax.dwt.graphics.DwtRectangle")){
DwtRectangle=function(t,i,a,e){
this.x=t;
this.y=i;
this.width=a;
this.height=e
};
DwtRectangle.prototype.toString=function(){
return"DwtRectangle"
};
DwtRectangle.prototype.set=function(t,i,a,e){
this.x=t;
this.y=i
}
}
if(AjxPackage.define("ajax.dwt.events.DwtEvent")){
DwtEvent=function(e){
if(arguments.length==0){
return
}
this.dwtObj=null
};
DwtEvent.prototype.toString=function(){
return"DwtEvent"
};
DwtEvent.ONCHANGE="onchange";
DwtEvent.ONCLICK="onclick";
DwtEvent.ONCONTEXTMENU="oncontextmenu";
DwtEvent.ONDBLCLICK="ondblclick";
DwtEvent.ONFOCUS="onfocus";
DwtEvent.ONBLUR="onblur";
DwtEvent.ONKEYDOWN="onkeydown";
DwtEvent.ONKEYPRESS="onkeypress";
DwtEvent.ONKEYUP="onkeyup";
DwtEvent.ONMOUSEDOWN="onmousedown";
DwtEvent.ONMOUSEENTER="onmouseenter";
DwtEvent.ONMOUSELEAVE="onmouseleave";
DwtEvent.ONMOUSEMOVE="onmousemove";
DwtEvent.ONMOUSEOUT="onmouseout";
DwtEvent.ONMOUSEOVER="onmouseover";
DwtEvent.ONMOUSEUP="onmouseup";
DwtEvent.ONMOUSEWHEEL="onmousewheel";
DwtEvent.ONSELECTSTART="onselectstart";
DwtEvent.ONSCROLL="onscroll";
DwtEvent.ONPASTE="onpaste";
DwtEvent.ONCUT="oncut";
DwtEvent.ONINPUT="input";
DwtEvent.ACTION="ACTION";
DwtEvent.CONTROL="CONTROL";
DwtEvent.DATE_RANGE="DATE_RANGE";
DwtEvent.DISPOSE="DISPOSE";
DwtEvent.ENTER="ENTER";
DwtEvent.HOVEROVER="HOVEROVER";
DwtEvent.HOVEROUT="HOVEROUT";
DwtEvent.POPDOWN="POPDOWN";
DwtEvent.POPUP="POPUP";
DwtEvent.SELECTION="SELECTION";
DwtEvent.TREE="TREE";
DwtEvent.STATE_CHANGE="STATE_CHANGE";
DwtEvent.TAB="TAB";
DwtEvent.XFORMS_READY="xforms-ready";
DwtEvent.XFORMS_DISPLAY_UPDATED="xforms-display-updated";
DwtEvent.XFORMS_VALUE_CHANGED="xforms-value-changed";
DwtEvent.XFORMS_FORM_DIRTY_CHANGE="xforms-form-dirty-change";
DwtEvent.XFORMS_CHOICES_CHANGED="xforms-choices-changed";
DwtEvent.XFORMS_VALUE_ERROR="xforms-value-error";
DwtEvent.XFORMS_INSTANCE_CHANGED="xforms-instance-cahnged";
DwtEvent.KEY_EVENTS=[DwtEvent.ONKEYDOWN,DwtEvent.ONKEYPRESS,DwtEvent.ONKEYUP];
DwtEvent.MOUSE_EVENTS=[DwtEvent.ONCONTEXTMENU,DwtEvent.ONCLICK,DwtEvent.ONDBLCLICK,DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEMOVE,DwtEvent.ONMOUSEUP,DwtEvent.ONSELECTSTART,DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEOUT]
}
if(AjxPackage.define("ajax.dwt.events.DwtEventManager")){
DwtEventManager=function(){};
DwtEventManager._instance=new AjxEventMgr();
DwtEventManager._domEventToDwtMap={
ondblclick:DwtEvent.ONDBLCLICK,onmousedown:DwtEvent.ONMOUSEDOWN,onmouseup:DwtEvent.ONMOUSEUP,onmousemove:DwtEvent.ONMOUSEMOVE,onmouseout:DwtEvent.ONMOUSEOUT,onmouseover:DwtEvent.ONMOUSEOVER,onselectstart:DwtEvent.ONSELECTSTART,onchange:DwtEvent.ONCHANGE};
DwtEventManager.addListener=function(e,t){
DwtEventManager._instance.addListener(e,t)
};
DwtEventManager.notifyListeners=function(e,t){
DwtEventManager._instance.notifyListeners(e,t)
};
DwtEventManager.removeListener=function(e,t){
DwtEventManager._instance.removeListener(e,t)
}
}
if(AjxPackage.define("ajax.dwt.events.DwtUiEvent")){
DwtUiEvent=function(e){
if(arguments.length==0){
return
}
DwtEvent.call(this,true);
this.reset()
};
DwtUiEvent.prototype=new DwtEvent;
DwtUiEvent.prototype.constructor=DwtUiEvent;
DwtUiEvent.prototype.isDwtUiEvent=true;
DwtUiEvent.prototype.toString=function(){
return"DwtUiEvent"
};
DwtUiEvent.prototype.reset=function(){
this.dwtObj=null;
this.altKey=false;
this.ctrlKey=false;
this.metaKey=false;
this.shiftKey=false;
this.target=null;
this.type=null;
this.docX=-1;
this.docY=-1;
this.elementX=-1;
this.elementY=-1;
this.ersatz=false;
this._stopPropagation=false;
this._returnValue=true;
this._dontCallPreventDefault=false
};
DwtUiEvent.getEvent=function(t,a){
t=t||window.event;
if(t){
return t
}
if(a){
var e=(a.ownerDocument||a.document||a).parentWindow;
return e?e.event:null
}};
DwtUiEvent.getTarget=function(e,t){
e=DwtUiEvent.getEvent(e);
if(!e){
return null
}
if(!t){
if(e.target){
return(e.target.nodeType==3)?e.target.parentNode:e.target
}else{
if(e.srcElement){
return e.srcElement
}}}else{
if(e.relatedTarget){
return e.relatedTarget
}else{
if(e.toElement){
return e.toElement
}else{
if(e.fromElement){
return e.fromElement
}}}}
return null
};
DwtUiEvent.getTargetWithProp=function(t,n,o,i){
var a=DwtUiEvent.getTarget(t,o);
while(a){
var e=Dwt.getAttr(a,n);
if(e!=null&&e!==""&&(!i||(e==i))){
return a
}
a=a.parentNode
}
return null
};
DwtUiEvent.getTargetWithClass=function(t,e,i){
var a=DwtUiEvent.getTarget(t,i);
while(a&&a.nodeType===1){
if(Dwt.hasClass(a,e)){
return a
}
a=a.parentNode
}
return null
};
DwtUiEvent.getTargetWithProps=function(o,a){
var n=DwtUiEvent.getTarget(o);
while(n){
var t=true;
for(var e in a){
var s=Dwt.getAttr(n,a[e]);
if(s==null||s===""){
n=n.parentNode;
t=false;
break
}}
if(t){
return n
}}
return null
};
DwtUiEvent.copy=function(e,t){
e.altKey=t.altKey;
e.ctrlKey=t.ctrlKey;
e.metaKey=t.metaKey;
e.shiftKey=t.shiftKey;
e.target=t.target;
e.type=t.type;
e.dwtObj=t.dwtObj;
e.docX=t.docX;
e.docY=t.docY;
e.elementX=t.elementX;
e.elementY=t.elementY;
e.ersatz=t.ersatz;
e._stopPropagation=t._stopPropagation;
e._returnValue=t._returnValue
};
DwtUiEvent.prototype.setFromDhtmlEvent=function(t,a){
t=DwtUiEvent.getEvent(t);
if(!t){
return
}
this.altKey=t.altKey;
this.ctrlKey=t.ctrlKey;
this.metaKey=t.metaKey;
this.shiftKey=t.shiftKey;
this.type=t.type;
this.target=DwtUiEvent.getTarget(t);
this.dwtObj=(a===true)?DwtControl.getTargetControl(t):a;
if(t.pageX!=null){
this.docX=t.pageX;
this.docY=t.pageY
}else{
if(t.clientX!=null){
this.docX=t.clientX+document.body.scrollLeft-document.body.clientLeft;
this.docY=t.clientY+document.body.scrollTop-document.body.clientTop;
if(document.body.parentElement){
var e=document.body.parentElement;
this.docX+=e.scrollLeft-e.clientLeft;
this.docY+=e.scrollTop-e.clientTop
}}}
if(t.offsetX!=null){
this.elementX=t.offsetX;
this.elementY=t.offsetY
}else{
if(!AjxEnv.isWebKitBased&&t.layerX!=null){
this.elementX=t.layerX;
this.elementY=t.layerY
}else{
this.elementX=Dwt.DEFAULT;
this.elementY=Dwt.DEFAULT
}}
this.ersatz=false;
return t
};
DwtUiEvent.prototype.setToDhtmlEvent=function(e){
DwtUiEvent.setBehaviour(e,this._stopPropagation,this._returnValue,this._dontCallPreventDefault)
};
DwtUiEvent.setBehaviour=function(o,e,t,a){
var i=DwtUiEvent.getEvent(o);
DwtUiEvent.setDhtmlBehaviour(i,e,t,a)
};
DwtUiEvent.setDhtmlBehaviour=function(i,e,t,a){
i=DwtUiEvent.getEvent(i);
if(!i){
return
}
if(i.stopPropagation!=null){
if(e){
i.stopPropagation()
}
if(!t&&!a){
i.preventDefault()
}}else{
i.returnValue=t;
i.cancelBubble=e
}};
DwtUiEvent.getDwtObjFromEvent=function(e,a){
var t=DwtUiEvent.getTargetWithProp(e,"dwtObj",a);
return t?Dwt.getObjectFromElement(t):null
};
DwtUiEvent.getDwtObjWithProp=function(e,a){
var t=DwtUiEvent.getTargetWithProps(e,["dwtObj",a]);
return t?Dwt.getObjectFromElement(t):null
}
}
if(AjxPackage.define("ajax.dwt.events.DwtDisposeEvent")){
DwtDisposeEvent=function(e){
if(arguments.length==0){
return
}
DwtEvent.call(this,true)
};
DwtDisposeEvent.prototype=new DwtEvent;
DwtDisposeEvent.prototype.constructor=DwtDisposeEvent;
DwtDisposeEvent.prototype.toString=function(){
return"DwtDisposeEvent"
}
}
if(AjxPackage.define("ajax.dwt.events.DwtControlEvent")){
DwtControlEvent=function(){
this.reset()
};
DwtControlEvent.prototype=new DwtEvent;
DwtControlEvent.prototype.constructor=DwtControlEvent;
DwtControlEvent.RESIZE=1;
DwtControlEvent.MOVE=2;
DwtControlEvent.prototype.toString=function(){
return"DwtControlEvent"
};
DwtControlEvent.prototype.reset=function(e){
this.oldX=Dwt.DEFAULT;
this.oldY=Dwt.DEFAULT;
this.oldWidth=Dwt.DEFAULT;
this.oldHeight=Dwt.DEFAULT;
this.newX=Dwt.DEFAULT;
this.newY=Dwt.DEFAULT;
this.newWidth=Dwt.DEFAULT;
this.newHeight=Dwt.DEFAULT;
this.type=e||null
}
}
if(AjxPackage.define("ajax.dwt.events.DwtFocusEvent")){
DwtFocusEvent=function(e){
if(arguments.length==0){
return
}
DwtEvent.call(this,true);
this.reset()
};
DwtFocusEvent.prototype=new DwtEvent;
DwtFocusEvent.prototype.constructor=DwtFocusEvent;
DwtFocusEvent.FOCUS=1;
DwtFocusEvent.BLUR=2;
DwtFocusEvent.prototype.toString=function(){
return"DwtFocusEvent"
};
DwtFocusEvent.prototype.reset=function(){
this.dwtObj=null;
this.state=DwtFocusEvent.FOCUS
}
}
if(AjxPackage.define("ajax.dwt.events.DwtKeyEvent")){
DwtKeyEvent=function(){
DwtUiEvent.call(this,true);
this.reset(true)
};
DwtKeyEvent.KEY_END_OF_TEXT=3;
DwtKeyEvent.KEY_TAB=9;
DwtKeyEvent.KEY_RETURN=13;
DwtKeyEvent.KEY_ENTER=13;
DwtKeyEvent.KEY_ESCAPE=27;
DwtKeyEvent.MAC_FF_CODE={};
DwtKeyEvent.MAC_FF_CODE["~"]=192;
DwtKeyEvent.MAC_FF_CODE["!"]=49;
DwtKeyEvent.MAC_FF_CODE["@"]=50;
DwtKeyEvent.MAC_FF_CODE["#"]=51;
DwtKeyEvent.MAC_FF_CODE["$"]=52;
DwtKeyEvent.MAC_FF_CODE["%"]=53;
DwtKeyEvent.MAC_FF_CODE["^"]=54;
DwtKeyEvent.MAC_FF_CODE["&"]=55;
DwtKeyEvent.MAC_FF_CODE["*"]=56;
DwtKeyEvent.MAC_FF_CODE["("]=57;
DwtKeyEvent.MAC_FF_CODE[")"]=48;
DwtKeyEvent.MAC_FF_CODE["-"]=189;
DwtKeyEvent.MAC_FF_CODE._=189;
DwtKeyEvent.MAC_FF_CODE["+"]=187;
DwtKeyEvent.MAC_FF_CODE["|"]=220;
DwtKeyEvent.MAC_FF_CODE[":"]=186;
DwtKeyEvent.MAC_FF_CODE["<"]=188;
DwtKeyEvent.MAC_FF_CODE[">"]=190;
DwtKeyEvent.MAC_FF_CODE["?"]=191;
DwtKeyEvent.prototype=new DwtUiEvent;
DwtKeyEvent.prototype.constructor=DwtKeyEvent;
DwtKeyEvent.prototype.toString=function(){
return"DwtKeyEvent"
};
DwtKeyEvent.isKeyEvent=function(e){
return e.type&&e.type.search(/^key/i)!=-1
};
DwtKeyEvent.isKeyPressEvent=function(e){
return(AjxEnv.isIE&&e.type=="keydown")||(e.type=="keypress")
};
DwtKeyEvent.prototype.reset=function(e){
if(!e){
DwtUiEvent.prototype.reset.call(this)
}
this.keyCode=0;
this.charCode=0
};
DwtKeyEvent.prototype.isCommand=function(e){
return AjxEnv.isMac&&this.metaKey||this.ctrlKey
};
DwtKeyEvent.prototype.setFromDhtmlEvent=function(e,t){
e=DwtUiEvent.prototype.setFromDhtmlEvent.apply(this,arguments);
if(!e){
return
}
this.charCode=e.charCode||e.keyCode;
this.keyCode=e.keyCode
};
DwtKeyEvent.getCharCode=function(t){
t=DwtUiEvent.getEvent(t);
var e=AjxEnv.isSafari?t.keyCode:(t.charCode||t.keyCode);
if(e==0&&AjxEnv.isMac&&AjxEnv.isGeckoBased&&t.type=="keyup"&&DwtKeyEvent._geckoCode){
e=DwtKeyEvent._geckoCode;
DwtKeyEvent._geckoCode=null
}
return e
};
DwtKeyEvent.copy=function(e,t){
DwtUiEvent.copy(e,t);
e.charCode=t.charCode;
e.keyCode=t.keyCode
};
DwtKeyEvent.geckoCheck=function(t){
t=DwtUiEvent.getEvent(t);
if(t.type=="keypress"){
DwtKeyEvent._geckoCode=null;
if(AjxEnv.isMac&&AjxEnv.isGeckoBased){
var e=String.fromCharCode(t.charCode);
DwtKeyEvent._geckoCode=DwtKeyEvent.MAC_FF_CODE[e]
}}}
}
if(AjxPackage.define("ajax.dwt.events.DwtMouseEvent")){
DwtMouseEvent=function(){
DwtUiEvent.call(this,true);
this.reset(true)
};
DwtMouseEvent.prototype=new DwtUiEvent;
DwtMouseEvent.prototype.constructor=DwtMouseEvent;
DwtMouseEvent.prototype.toString=function(){
return"DwtMouseEvent"
};
DwtMouseEvent.NONE=0;
DwtMouseEvent.LEFT=1;
DwtMouseEvent.MIDDLE=2;
DwtMouseEvent.RIGHT=3;
DwtMouseEvent.prototype.reset=function(e){
if(!e){
DwtUiEvent.prototype.reset.call(this)
}
this.button=0
};
DwtMouseEvent.prototype.setFromDhtmlEvent=function(e,t){
e=DwtUiEvent.prototype.setFromDhtmlEvent.apply(this,arguments);
if(!e){
return
}
if(e.which){
switch(e.which){
case 1:this.button=DwtMouseEvent.LEFT;
break;
case 2:this.button=DwtMouseEvent.MIDDLE;
break;
case 3:this.button=DwtMouseEvent.RIGHT;
break;
default:this.button=DwtMouseEvent.NONE
}}else{
if(e.button){
if((e.button&1)!=0){
this.button=DwtMouseEvent.LEFT
}else{
if((e.button&2)!=0){
this.button=DwtMouseEvent.RIGHT
}else{
if((e.button&4)!=0){
this.button=DwtMouseEvent.MIDDLE
}else{
this.button=DwtMouseEvent.NONE
}}}}}
if(AjxEnv.isMac&&this.button){
if(this.ctrlKey&&(this.button==DwtMouseEvent.LEFT||this.button==DwtMouseEvent.RIGHT)){
this.button=DwtMouseEvent.RIGHT;
this.ctrlKey=false
}
if(this.altKey){
this.ctrlKey=true;
this.altKey=false
}}}
}
if(AjxPackage.define("ajax.dwt.events.DwtMouseEventCapture")){
DwtMouseEventCapture=function(e){
e=Dwt.getParams(arguments,DwtMouseEventCapture.PARAMS);
this.targetObj=e.targetObj;
this._id=e.id;
this._mouseOverHdlr=e.mouseOverHdlr||DwtMouseEventCapture.emptyHdlr;
this._mouseDownHdlr=e.mouseDownHdlr||DwtMouseEventCapture.emptyHdlr;
this._mouseMoveHdlr=e.mouseMoveHdlr||DwtMouseEventCapture.emptyHdlr;
this._mouseUpHdlr=e.mouseUpHdlr||DwtMouseEventCapture.emptyHdlr;
this._mouseOutHdlr=e.mouseOutHdlr||DwtMouseEventCapture.emptyHdlr;
this._mouseWheelHdlr=e.mouseWheelHdlr||DwtMouseEventCapture.emptyHdlr;
this._hardCapture=(e.hardCapture!==false);
this._supportsCapture=(document.body&&document.body.setCapture&&AjxEnv.isIE&&!AjxEnv.isIE9up)
};
DwtMouseEventCapture.PARAMS=["targetObj","id","mouseOverHdlr","mouseDownHdlr","mouseMoveHdlr","mouseUpHdlr","mouseOutHdlr","mouseWheelHdlr","hardCapture"];
DwtMouseEventCapture._capturing=false;
DwtMouseEventCapture.getCaptureObj=function(){
return window._mouseEventCaptureObj
};
DwtMouseEventCapture.getTargetObj=function(){
return window._mouseEventCaptureObj?window._mouseEventCaptureObj.targetObj:null
};
DwtMouseEventCapture.getId=function(){
return window._mouseEventCaptureObj?window._mouseEventCaptureObj._id:null
};
DwtMouseEventCapture.prototype.toString=function(){
return"DwtMouseEventCapture"
};
DwtMouseEventCapture.prototype.capturing=function(){
return DwtMouseEventCapture._capturing
};
DwtMouseEventCapture.prototype.capture=function(){
if(window._mouseEventCaptureObj){
window._mouseEventCaptureObj.release()
}
if(document.body!=null&&document.body.addEventListener!=null){
document.body.addEventListener("mouseover",this._mouseOverHdlr,true);
document.body.addEventListener("mousedown",this._mouseDownHdlr,true);
document.body.addEventListener("mousemove",this._mouseMoveHdlr,true);
document.body.addEventListener("mouseup",this._mouseUpHdlr,true);
document.body.addEventListener("mouseout",this._mouseOutHdlr,true);
document.body.addEventListener("DOMMouseScroll",this._mouseWheelHdlr,true)
}else{
this._savedMouseOverHdlr=document.onmouseover;
this._savedMouseDownHdlr=document.onmousedown;
this._savedMouseMoveHdlr=document.onmousemove;
this._savedMouseUpHdlr=document.onmouseup;
this._savedMouseOutHdlr=document.onmouseout;
this._savedMouseWheelHdlr=document.onmousewheel;
document.onmouseover=this._mouseOverHdlr;
document.onmousedown=this._mouseDownHdlr;
document.onmousemove=this._mouseMoveHdlr;
document.onmouseup=this._mouseUpHdlr;
document.onmouseout=this._mouseOutHdlr;
document.onmousewheel=this._mouseWheelHdlr
}
if(this._hardCapture&&this._supportsCapture){
document.body.setCapture(true)
}
window._mouseEventCaptureObj=this;
DwtMouseEventCapture._capturing=true
};
DwtMouseEventCapture.prototype.release=function(){
if(window._mouseEventCaptureObj==null){
return
}
var e=window._shellCaptureObj;
if(document.body&&document.body.addEventListener){
document.body.removeEventListener("mouseover",this._mouseOverHdlr,true);
document.body.removeEventListener("mousedown",this._mouseDownHdlr,true);
document.body.removeEventListener("mousemove",this._mouseMoveHdlr,true);
document.body.removeEventListener("mouseup",this._mouseUpHdlr,true);
document.body.removeEventListener("mouseout",this._mouseOutHdlr,true);
document.body.removeEventListener("DOMMouseScroll",this._mouseWheelHdlr,true)
}else{
document.onmouseover=this._savedMouseOverHdlr;
document.onmousedown=this._savedMouseDownHdlr;
document.onmousemove=this._savedMouseMoveHdlr;
document.onmouseup=this._savedMouseUpHdlr;
document.onmouseout=this._savedMouseOutHdlr;
document.onmousewheel=this._savedMouseWheelHdlr
}
if(this._hardCapture&&this._supportsCapture){
document.body.releaseCapture()
}
window._mouseEventCaptureObj=null;
DwtMouseEventCapture._capturing=false
};
DwtMouseEventCapture.emptyHdlr=function(t){
var a=DwtMouseEventCapture.getCaptureObj();
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t);
if(a._hardCapture){
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
}else{
e._stopPropagation=false;
e._returnValue=true;
e.setToDhtmlEvent(t);
return true
}}
}
if(AjxPackage.define("ajax.dwt.events.DwtListViewActionEvent")){
DwtListViewActionEvent=function(){
DwtMouseEvent.call(this);
this.reset(true)
};
DwtListViewActionEvent.prototype=new DwtMouseEvent;
DwtListViewActionEvent.prototype.constructor=DwtListViewActionEvent;
DwtListViewActionEvent.prototype.toString=function(){
return"DwtListViewActionEvent"
};
DwtListViewActionEvent.prototype.reset=function(e){
if(!e){
DwtMouseEvent.prototype.reset.call(this)
}
this.field=null;
this.item=null;
this.detail=null
}
}
if(AjxPackage.define("ajax.dwt.events.DwtSelectionEvent")){
DwtSelectionEvent=function(e){
if(arguments.length==0){
return
}
DwtUiEvent.call(this,true);
this.reset(true)
};
DwtSelectionEvent.prototype=new DwtUiEvent;
DwtSelectionEvent.prototype.constructor=DwtSelectionEvent;
DwtSelectionEvent.prototype.toString=function(){
return"DwtSelectionEvent"
};
DwtSelectionEvent.prototype.reset=function(e){
if(!e){
DwtUiEvent.prototype.reset.call(this)
}
this.button=0;
this.detail=null;
this.item=null
}
}
if(AjxPackage.define("ajax.dwt.events.DwtTreeEvent")){
DwtTreeEvent=function(){
DwtSelectionEvent.call(this,true)
};
DwtTreeEvent.prototype=new DwtSelectionEvent;
DwtTreeEvent.prototype.constructor=DwtTreeEvent;
DwtTreeEvent.prototype.toString=function(){
return"DwtTreeEvent"
};
DwtTreeEvent.prototype.setFromDhtmlEvent=function(e,t){
e=DwtSelectionEvent.prototype.setFromDhtmlEvent.apply(this,arguments)
}
}
if(AjxPackage.define("ajax.dwt.events.DwtHoverEvent")){
DwtHoverEvent=function(i,a,t,e,o){
if(arguments.length==0){
return
}
DwtEvent.call(this,true);
this.type=i;
this.delay=a;
this.object=t;
this.x=e||-1;
this.y=o||-1
};
DwtHoverEvent.prototype=new DwtEvent;
DwtHoverEvent.prototype.constructor=DwtHoverEvent;
DwtHoverEvent.prototype.toString=function(){
return"DwtHoverEvent"
};
DwtHoverEvent.prototype.reset=function(){
this.type=0;
this.delay=0;
this.object=null;
this.x=-1;
this.y=-1
}
}
if(AjxPackage.define("ajax.dwt.events.DwtOutsideMouseEventMgr")){
DwtOutsideMouseEventMgr=function(){
this._reset();
this._mouseEventListener=DwtOutsideMouseEventMgr._mouseEventHdlr.bind();
DwtOutsideMouseEventMgr.INSTANCE=this;
this.id="DwtOutsideMouseEventMgr"
};
DwtOutsideMouseEventMgr.prototype.isDwtOutsideMouseEventMgr=true;
DwtOutsideMouseEventMgr.prototype.toString=function(){
return"DwtOutsideMouseEventMgr"
};
DwtOutsideMouseEventMgr.EVENTS=[DwtEvent.ONMOUSEDOWN];
DwtOutsideMouseEventMgr.EVENTS_HASH=AjxUtil.arrayAsHash(DwtOutsideMouseEventMgr.EVENTS);
DwtOutsideMouseEventMgr.prototype.startListening=function(o){
if(!(o&&o.outsideListener)){
return
}
var e=o.id;
if(!this._menuCapObj){
var a={
id:this.id,hardCapture:false,mouseDownHdlr:DwtOutsideMouseEventMgr._mouseEventHdlr};
this._menuCapObj=new DwtMouseEventCapture(a)
}
var s=o.elementId||(o.obj&&o.obj.getHTMLElId&&o.obj.getHTMLElId());
var t=this._byId[e];
if(t){
if(s){
t.elementIds.push(s)
}
return
}else{
t=this._byId[e]={
id:e,obj:o.obj,elementIds:[s],outsideListener:o.outsideListener}
}
if(this._numIds==0){
if(AjxEnv.isIE){
var r=DwtShell.getShell(window);
var l=DwtOutsideMouseEventMgr.EVENTS;
r._setEventHdlrs(l);
for(var n=0;
n<l.length;
n++){
var h=l[n];
r.addListener(h,this._mouseEventListener);
DwtEventManager.addListener(h,this._mouseEventListener)
}}
if(!AjxEnv.isIE&&!o.noWindowBlur){
this._savedWindowBlurHandler=window.onblur;
window.onblur=DwtOutsideMouseEventMgr._mouseEventHdlr
}
this._menuCapObj.capture();
this._capturing=true
}
this._numIds++
};
DwtOutsideMouseEventMgr.prototype.stopListening=function(o){
if(typeof o=="string"){
o={
id:o}
}
var e=o.id;
var a=this._byId[e];
if(!a){
return
}
var t=a.elementIds;
var s=o.elementId||(o.obj&&o.obj.getHTMLElId());
if(s){
AjxUtil.arrayRemove(t,s);
if(t.length>0){
return
}}
delete this._byId[e];
this._numIds--;
if(this._numIds==0){
if(AjxEnv.isIE){
var r=DwtShell.getShell(window);
var l=DwtOutsideMouseEventMgr.EVENTS;
r._setEventHdlrs(l,true);
for(var n=0;
n<l.length;
n++){
var h=l[n];
r.removeListener(h,this._mouseEventListener);
DwtEventManager.removeListener(h,this._mouseEventListener)
}}
if(!AjxEnv.isIE&&!o.noWindowBlur){
window.onblur=this._savedWindowBlurHandler
}
this._reset()
}};
DwtOutsideMouseEventMgr.prototype._reset=function(){
if(this._capturing&&(DwtMouseEventCapture.getId()==this.id)){
this._menuCapObj.release();
this._capturing=false
}
this._byId={};
this._numIds=0
};
DwtOutsideMouseEventMgr.forwardEvent=function(a){
if(!a){
return
}
var t=DwtOutsideMouseEventMgr.INSTANCE;
if(!t._numIds){
return
}
var e="on"+a.type;
if(DwtOutsideMouseEventMgr.EVENTS_HASH[e]){
DwtOutsideMouseEventMgr._mouseEventHdlr(a)
}};
DwtOutsideMouseEventMgr._mouseEventHdlr=function(r){
r=DwtUiEvent.getEvent(r);
if(!r){
return
}
var h=DwtOutsideMouseEventMgr.INSTANCE;
var l=DwtUiEvent.getTarget(r);
if(AjxEnv.isGeckoBased&&r&&(r.type=="blur")&&r.target&&r.explicitOriginalTarget&&(r.target!=r.explicitOriginalTarget)){
DwtUiEvent.setBehaviour(r,false,true);
return true
}
for(var e in h._byId){
var s=true;
var t=h._byId[e];
var n=t.elementIds;
for(var o=0;
o<n.length;
o++){
var a=document.getElementById(n[o]);
if(a&&l&&Dwt.isAncestor(a,l)){
s=false;
break
}}
if(s){
t.outsideListener.run(r,t)
}}
DwtUiEvent.setBehaviour(r,false,true);
return true
};
new DwtOutsideMouseEventMgr()
}
if(AjxPackage.define("ajax.dwt.keyboard.DwtTabGroupEvent")){
DwtTabGroupEvent=function(){
this.tabGroup=null;
this.newFocusMember=null
};
DwtTabGroupEvent.prototype.toString=function(){
return"DwtTabGroupEvent"
};
DwtTabGroupEvent.prototype.reset=function(){
this.tabGroup=null;
this.newFocusMember=null
}
}
if(AjxPackage.define("ajax.dwt.keyboard.DwtKeyMap")){
DwtKeyMap=function(e){
if(e){
return
}
this._map={};
this._args={};
this._checkedMap={};
this._load(this._map,AjxKeys);
DwtKeyMap.MOD_ORDER[DwtKeyMap.ALT]=1;
DwtKeyMap.MOD_ORDER[DwtKeyMap.CTRL]=2;
DwtKeyMap.MOD_ORDER[DwtKeyMap.META]=3;
DwtKeyMap.MOD_ORDER[DwtKeyMap.SHIFT]=4
};
DwtKeyMap.prototype.isDwtKeyMap=true;
DwtKeyMap.prototype.toString=function(){
return"DwtKeyMap"
};
DwtKeyMap.deserialize=function(e){
alert("DwtKeyMap.deserialize: NOT IMPLEMENTED")
};
DwtKeyMap.serialize=function(e){
alert("DwtKeyMap.serialize: NOT IMPLEMENTED")
};
DwtKeyMap.MAP_DIALOG="dialog";
DwtKeyMap.MAP_BUTTON="button";
DwtKeyMap.MAP_LIST="list";
DwtKeyMap.MAP_MENU="menu";
DwtKeyMap.MAP_EDITOR="editor";
DwtKeyMap.MAP_TOOLBAR_HORIZ="toolbarHorizontal";
DwtKeyMap.MAP_TOOLBAR_VERT="toolbarVertical";
DwtKeyMap.MAP_TAB_VIEW="tabView";
DwtKeyMap.MAP_TREE="tree";
DwtKeyMap.IS_MODIFIER={};
DwtKeyMap.MOD_ORDER={};
DwtKeyMap.ARROW_DOWN="ArrowDown";
DwtKeyMap.ARROW_LEFT="ArrowLeft";
DwtKeyMap.ARROW_RIGHT="ArrowRight";
DwtKeyMap.ARROW_UP="ArrowUp";
DwtKeyMap.BACKSLASH="Backslash";
DwtKeyMap.BACKSPACE="Backspace";
DwtKeyMap.COMMA="Comma";
DwtKeyMap.DELETE="Del";
DwtKeyMap.END="End";
DwtKeyMap.ENTER="Enter";
DwtKeyMap.ESC="Esc";
DwtKeyMap.HOME="Home";
DwtKeyMap.PGDOWN="PgDown";
DwtKeyMap.PGUP="PgUp";
DwtKeyMap.SEMICOLON="Semicolon";
DwtKeyMap.SPACE="Space";
DwtKeyMap.TAB="Tab";
DwtKeyMap.ADD_SELECT_NEXT="AddNext";
DwtKeyMap.ADD_SELECT_PREV="AddPrevious";
DwtKeyMap.CANCEL="Cancel";
DwtKeyMap.COLLAPSE="Collapse";
DwtKeyMap.DBLCLICK="DoubleClick";
DwtKeyMap.DELETE="Delete";
DwtKeyMap.EXPAND="Expand";
DwtKeyMap.GOTO_TAB="GoToTab";
DwtKeyMap.HEADER1="Header1";
DwtKeyMap.HEADER2="Header2";
DwtKeyMap.HEADER3="Header3";
DwtKeyMap.HEADER4="Header4";
DwtKeyMap.HEADER5="Header5";
DwtKeyMap.HEADER6="Header6";
DwtKeyMap.INSERT_LINK="InsertLink";
DwtKeyMap.JUSTIFY_CENTER="CenterJustify";
DwtKeyMap.JUSTIFY_LEFT="LeftJustify";
DwtKeyMap.JUSTIFY_RIGHT="RightJustify";
DwtKeyMap.NEXT="Next";
DwtKeyMap.NEXT_TAB="NextTab";
DwtKeyMap.NO="No";
DwtKeyMap.PAGE_UP="PageUp";
DwtKeyMap.PAGE_DOWN="PageDown";
DwtKeyMap.PARENTMENU="ParentMenu";
DwtKeyMap.PREV="Previous";
DwtKeyMap.PREV_TAB="PreviousTab";
DwtKeyMap.SELECT_ALL="SelectAll";
DwtKeyMap.SELECT="Select";
DwtKeyMap.SELECT_CURRENT="SelectCurrent";
DwtKeyMap.SELECT_FIRST="SelectFirst";
DwtKeyMap.SELECT_LAST="SelectLast";
DwtKeyMap.SELECT_NEXT="SelectNext";
DwtKeyMap.SELECT_PREV="SelectPrevious";
DwtKeyMap.SUBMENU="SubMenu";
DwtKeyMap.SWITCH_MODE="SwitchMode";
DwtKeyMap.TEXT_BOLD="Bold";
DwtKeyMap.TEXT_ITALIC="Italic";
DwtKeyMap.TEXT_UNDERLINE="Underline";
DwtKeyMap.TEXT_STRIKETHRU="Strikethru";
DwtKeyMap.YES="Yes";
DwtKeyMap.GOTO_TAB_RE=new RegExp(DwtKeyMap.GOTO_TAB+"(\\d+)");
DwtKeyMap.JOIN="+";
DwtKeyMap.SEP=",";
DwtKeyMap.INHERIT="INHERIT";
DwtKeyMap.prototype.getMap=function(){
return this._map
};
DwtKeyMap.prototype._load=function(w,h){
var m=AjxEnv.platform.toLowerCase();
for(var r in h){
var d=r.split(".");
var s=d[d.length-1];
if(s=="win"||s=="mac"||s=="linux"){
if(s==m){
var g=d.slice(0,d.length-1).join(".");
h[g]=h[r]
}
h[r]=null
}}
for(var r in h){
var n=AjxStringUtil.trim(h[r]);
if(!n||(typeof h[r]!="string")){
continue
}
var d=r.split(".");
var e=d[d.length-1];
var t=(d.length==2);
var u=t?null:d[1];
if(d[0]=="keys"){
this._processKeyDef(u,e,n);
continue
}
if(e!=DwtKeyMap.INHERIT&&e!="keycode"){
continue
}
var c=d[0];
if((this._checkedMap[c]===false)||(!this._checkedMap[c]&&!this._checkMap(c))){
continue
}
if(!w[c]){
w[c]={}
}
if(!this._checkAction(c,u)){
continue
}
var o=n.split(/\s*;\s*/);
for(var f=0;
f<o.length;
f++){
var v=this._canonicalize(o[f]);
if(e==DwtKeyMap.INHERIT){
var y=v.split(/\s*,\s*/);
var a=[];
for(var l=0;
l<y.length;
l++){
a[l]=y[l]
}
w[c][d[1]]=a.join(",")
}else{
if(e=="keycode"){
w[c][v]=u
}}}}};
DwtKeyMap.prototype._checkMap=function(t){
var e=true;
this._checkedMap[t]=e;
return e
};
DwtKeyMap.prototype._checkAction=function(e,t){
return true
};
DwtKeyMap.prototype._processKeyDef=function(e,a,t){
if(!e||!a||!t){
return
}
if(a=="display"){
DwtKeyMap[e.toUpperCase()]=t
}else{
if(a=="keycode"){
DwtKeyMap.IS_MODIFIER[t]=true
}}};
DwtKeyMap.prototype._canonicalize=function(r){
var n=r.split(DwtKeyMap.SEP);
var e=[];
for(var a=0;
a<n.length;
a++){
var t=n[a];
var s=t.split(DwtKeyMap.JOIN);
if(s.length>2){
var o=s.slice(0,s.length-1);
o.sort(function(c,h){
var l=DwtKeyMap.MOD_ORDER[c]||0;
var i=DwtKeyMap.MOD_ORDER[h]||0;
return Number(l-i)
}
);
o.push(s[s.length-1]);
e.push(o.join(DwtKeyMap.JOIN))
}else{
e.push(t)
}}
return e.join(",")
}
}
if(AjxPackage.define("ajax.dwt.keyboard.DwtKeyMapMgr")){
DwtKeyMapMgr=function(a){
var t=this._map=a.getMap();
this._args=a._args;
this._fsas={};
for(var e in t){
this._fsas[e]=DwtKeyMapMgr.__buildFSA({}
,t[e],e)
}};
DwtKeyMapMgr.NOT_A_TERMINAL=-999;
DwtKeyMapMgr.TAB_KEYCODE=9;
DwtKeyMapMgr.prototype.toString=function(){
return"DwtKeyMapMgr"
};
DwtKeyMapMgr.prototype.getActionCode=function(a,s,r){
var e=this._fsas[s];
if(!e){
return null
}
var n=a.length;
var l=e;
var h;
for(var t=0;
t<n&&l;
t++){
h=a[t];
if(!l||!l[h]){
break
}
if(t<n-1){
l=l[h].subMap
}}
if(l&&l[h]){
var o=l[h];
if(!o.subMap||r){
var i=this.__getInheritedActionCode(a,e,r);
return i==DwtKeyMapMgr.NOT_A_TERMINAL?DwtKeyMapMgr.NOT_A_TERMINAL:(o.actionCode||i)
}else{
return DwtKeyMapMgr.NOT_A_TERMINAL
}}else{
return this.__getInheritedActionCode(a,e,r)
}};
DwtKeyMapMgr.prototype.getAction=function(t,e){
return this._map[t][e]
};
DwtKeyMapMgr.prototype.getKeySequences=function(t,a){
var e=[];
for(var i in this._map[t]){
if(this._map[t][i]==a){
e.push(i)
}}
return e
};
DwtKeyMapMgr.prototype.setMapping=function(t,e,a){
this._map[t][e]=a
};
DwtKeyMapMgr.prototype.removeMapping=function(t,e){
delete this._map[t][e]
};
DwtKeyMapMgr.prototype.replaceMapping=function(a,e,t){
var i=this._map[a][e];
if(!i){
return
}
this.removeMapping(a,e);
this.setMapping(a,t,i)
};
DwtKeyMapMgr.prototype.setArg=function(t,a,e){
if(!this._args[t]){
this._args[t]={}
}
this._args[t][a]=e
};
DwtKeyMapMgr.prototype.removeArg=function(e,t){
delete this._args[e][t]
};
DwtKeyMapMgr.prototype.getArg=function(e,t){
return this._args[e]?this._args[e][t]:null
};
DwtKeyMapMgr.prototype.reloadMap=function(e){
this._fsas[e]=DwtKeyMapMgr.__buildFSA({}
,this._map[e],e)
};
DwtKeyMapMgr.prototype.getAncestors=function(o,n){
n=n||[];
var e=this._fsas[o];
var t=e&&e.inherit;
if(t&&t.length){
for(var a=0;
a<t.length;
a++){
n.push(t[a]);
n=this.getAncestors(t[a],n)
}}
return n
};
DwtKeyMapMgr.isInputElement=function(a){
if(!a){
return false
}
var t=a.ownerDocument?a.ownerDocument.designMode:null;
if(t&&(t.toLowerCase()=="on")){
return true
}
var e=a.tagName.toUpperCase();
return(e=="INPUT"||e=="TEXTAREA")
};
DwtKeyMapMgr.__buildFSA=function(l,e,n){
for(var a in e){
if(a==DwtKeyMap.INHERIT){
l.inherit=e[a].split(/\s*,\s*/);
continue
}
var o=a.split(DwtKeyMap.SEP);
var s=o.length;
var h=l;
for(var t=0;
t<s;
t++){
var r=o[t];
if(!h[r]){
h[r]={}
}
if(t==s-1){
h[r].actionCode=e[a]
}else{
if(!h[r].subMap){
h[r].subMap={}
}
h=h[r].subMap
}}}
return l
};
DwtKeyMapMgr.prototype.__getInheritedActionCode=function(s,t,n){
if(t.inherit&&t.inherit.length){
var o=null;
var e=t.inherit.length;
for(var a=0;
a<e;
a++){
o=this.getActionCode(s,t.inherit[a],n);
if(o!=null){
return o
}}}
return null
};
DwtKeyMapMgr.hasModifier=function(e){
return(e.altKey||e.ctrlKey||e.metaKey)
}
}
if(AjxPackage.define("ajax.dwt.keyboard.DwtKeyboardMgr")){
DwtKeyboardMgr=function(e){
DwtKeyboardMgr.__shell=e;
this.__tabGrpStack=[];
this.__defaultHandlerStack=[];
this.__tabGroupChangeListenerObj=new AjxListener(this,this.__tabGrpChangeListener);
this.__kbEventStatus=DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED;
this.__keyTimeout=750;
this.__currTabGroup=null;
this.__currDefaultHandler=null;
this._evtMgr=new AjxEventMgr()
};
DwtKeyboardMgr.prototype.isDwtKeyboardMgr=true;
DwtKeyboardMgr.prototype.toString=function(){
return"DwtKeyboardMgr"
};
DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED=1;
DwtKeyboardMgr.__KEYSEQ_HANDLED=2;
DwtKeyboardMgr.__KEYSEQ_PENDING=3;
DwtKeyboardMgr.FOCUS_FIELD_ID="kbff";
DwtKeyboardMgr.isPossibleInputShortcut=function(e){
var t=DwtUiEvent.getTarget(e);
return(!DwtKeyMap.IS_MODIFIER[e.keyCode]&&(e.keyCode==27||DwtKeyMapMgr.hasModifier(e))||(t&&t.nodeName.toUpperCase()=="INPUT"&&(e.keyCode==13||e.keyCode==3)))
};
DwtKeyboardMgr.prototype.pushTabGroup=function(t,a){
if(!this.__keyboardHandlingInited||!t){
return
}
this.__tabGrpStack.push(t);
this.__currTabGroup=t;
var e=t.getFocusMember();
if(!e){
e=t.resetFocusMember(true)
}
if(!e){
return
}
t.addFocusChangeListener(this.__tabGroupChangeListenerObj);
if(!a){
this.grabFocus(e)
}};
DwtKeyboardMgr.prototype.popTabGroup=function(r){
if(!this.__keyboardHandlingInited){
return
}
if(!r){
return
}
if(this.__tabGrpStack.length<=1){
return null
}
if(r&&this.__tabGrpStack[this.__tabGrpStack.length-1]!=r){
var t=this.__tabGrpStack;
var e=t.length;
for(var s=e-1;
s>=0;
s--){
if(r==t[s]){
t[s].dump(AjxDebug.DBG1);
break
}}
if(s<0){
return null
}else{
if(s!=e-1){
t.splice(s,1);
return r
}}}
var r=this.__tabGrpStack.pop();
r.removeFocusChangeListener(this.__tabGroupChangeListenerObj);
var n=null;
if(this.__tabGrpStack.length>0){
n=this.__tabGrpStack[this.__tabGrpStack.length-1];
var o=n.getFocusMember();
if(!o){
o=n.resetFocusMember(true)
}
if(o){
this.grabFocus(o)
}}
this.__currTabGroup=n;
return r
};
DwtKeyboardMgr.prototype.setTabGroup=function(t){
var e=this.popTabGroup();
this.pushTabGroup(t);
return e
};
DwtKeyboardMgr.prototype.getCurrentTabGroup=function(){
return this.__currTabGroup
};
DwtKeyboardMgr.prototype.pushDefaultHandler=function(e){
if(!this.__enabled||!this.__keyboardHandlingInited||!e){
return
}
this.__defaultHandlerStack.push(e);
this.__currDefaultHandler=e
};
DwtKeyboardMgr.prototype.popDefaultHandler=function(){
if(!this.__keyboardHandlingInited||(this.__defaultHandlerStack.length<=1)){
return
}
var e=this.__defaultHandlerStack.pop();
this.__currDefaultHandler=this.__defaultHandlerStack[this.__defaultHandlerStack.length-1];
return e
};
DwtKeyboardMgr.prototype.grabFocus=function(e){
if(typeof e=="string"){
e=document.getElementById(e)
}
if(!e){
return
}
if(this.__currTabGroup){
this.__currTabGroup.setFocusMember(e,false,true)
}
this.__doGrabFocus(e)
};
DwtKeyboardMgr.prototype.inputGotFocus=function(e){
this.__focusObj=e;
this.__inputElement=true;
this.__dwtCtrlHasFocus=false;
if(this.__currTabGroup){
this.__currTabGroup.setFocusMember(e.getTabGroupMember(),false,true)
}};
DwtKeyboardMgr.prototype.getFocusObj=function(e){
return this.__focusObj
};
DwtKeyboardMgr.prototype.dwtControlHasFocus=function(e){
return(this.__dwtCtrlHasFocus&&this.__focusObj==e)
};
DwtKeyboardMgr.prototype.registerDefaultKeyActionHandler=function(e){
if(!this.__enabled){
return
}
this.__defaultKeyActionHdlr=e
};
DwtKeyboardMgr.prototype.registerKeyMap=function(e){
if(!this.__checkStatus()){
return
}
this.__keyMapMgr=new DwtKeyMapMgr(e)
};
DwtKeyboardMgr.prototype.setKeyTimeout=function(e){
this.__keyTimeout=e
};
DwtKeyboardMgr.prototype.clearKeySeq=function(){
this.__killKeySeqTimedActionId=-1;
this.__keySequence=[]
};
DwtKeyboardMgr.prototype.enable=function(e){
this.__enabled=e;
if(e){
this.__checkStatus();
Dwt.setHandler(document,DwtEvent.ONKEYDOWN,DwtKeyboardMgr.__keyDownHdlr);
Dwt.setHandler(document,DwtEvent.ONKEYUP,DwtKeyboardMgr.__keyUpHdlr);
Dwt.setHandler(document,DwtEvent.ONKEYPRESS,DwtKeyboardMgr.__keyPressHdlr)
}else{
Dwt.clearHandler(document,DwtEvent.ONKEYDOWN);
Dwt.clearHandler(document,DwtEvent.ONKEYUP);
Dwt.clearHandler(document,DwtEvent.ONKEYPRESS)
}};
DwtKeyboardMgr.prototype.isEnabled=function(){
return this.__enabled
};
DwtKeyboardMgr.prototype.addListener=function(e,t){
this._evtMgr.addListener(e,t)
};
DwtKeyboardMgr.prototype.removeListener=function(e,t){
this._evtMgr.removeListener(e,t)
};
DwtKeyboardMgr.prototype.__initKeyboardHandling=function(){
var e=this._kbFocusField=document.createElement("textarea");
e.id=DwtKeyboardMgr.FOCUS_FIELD_ID;
e.title=AjxMsg.kbffTitle;
Dwt.setPosition(e,Dwt.ABSOLUTE_STYLE);
Dwt.setLocation(e,Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE);
e.onblur=DwtKeyboardMgr.__onBlurHdlr;
e.onfocus=DwtKeyboardMgr.__onFocusHdlr;
e.setAttribute("aria-hidden",true);
document.body.appendChild(e);
this.__killKeySeqTimedAction=new AjxTimedAction(this,this.__killKeySequenceAction);
this.__killKeySeqTimedActionId=-1;
this.__keySequence=[];
this.__keyboardHandlingInited=true
};
DwtKeyboardMgr.prototype.__checkStatus=function(){
if(!this.__enabled){
return false
}
if(!this.__keyboardHandlingInited){
this.__initKeyboardHandling()
}
return true
};
DwtKeyboardMgr.prototype.__doGrabFocus=function(e){
if(!e){
return
}
var t=e instanceof DwtControl?e.getInputElement():e;
if(t){
if(this.__focusObj instanceof DwtControl&&!this.__inputElement){
this.__oldFocusObj=this.__focusObj
}
this.__focusObj=e;
this.__dwtCtrlHasFocus=false;
this.__inputElement=t;
if((!AjxEnv.isIE&&t.focus)||(AjxEnv.isIE&&t.focus&&!t.disabled&&Dwt.getVisible(t))){
t.focus()
}}else{
if(this.__dwtCtrlHasFocus&&(this.__focusObj instanceof DwtControl)){
DwtKeyboardMgr.__onBlurHdlr();
this.__dwtCtrlHasFocus=true
}
this.__focusObj=e;
this.__inputElement=false;
if(this.__dwtCtrlHasFocus){
DwtKeyboardMgr.__onFocusHdlr()
}else{
DwtKeyboardMgr.__onFocusHdlr();
if(this.__enabled){
this.__warnFocus();
this._kbFocusField.focus()
}}}};
DwtKeyboardMgr.__onFocusHdlr=function(t){
var a=DwtKeyboardMgr.__shell.getKeyboardMgr();
a.__dwtCtrlHasFocus=true;
var e=(t&&DwtControl.findControl(t.target))||a.__focusObj;
if(e&&e.__doFocus){
e.__doFocus()
}};
DwtKeyboardMgr.__onBlurHdlr=function(t){
var a=DwtKeyboardMgr.__shell.getKeyboardMgr();
var e=a.__oldFocusObj||a.__focusObj;
if(e&&e.__doBlur){
e.__doBlur()
}
a.__oldFocusObj=null;
a.__dwtCtrlHasFocus=false
};
DwtKeyboardMgr.__keyUpHdlr=function(e){
e=DwtUiEvent.getEvent(e);
var t=DwtKeyboardMgr.__shell.getKeyboardMgr();
if(t._evtMgr.notifyListeners(DwtEvent.ONKEYUP,e)===false){
return false
}
if(AjxEnv.isMac&&AjxEnv.isGeckoBased&&e.keyCode==0){
return DwtKeyboardMgr.__keyDownHdlr(e)
}else{
return DwtKeyboardMgr.__handleKeyEvent(e)
}};
DwtKeyboardMgr.__keyPressHdlr=function(e){
e=DwtUiEvent.getEvent(e);
var t=DwtKeyboardMgr.__shell.getKeyboardMgr();
if(t._evtMgr.notifyListeners(DwtEvent.ONKEYPRESS,e)===false){
return false
}
DwtKeyEvent.geckoCheck(e);
return DwtKeyboardMgr.__handleKeyEvent(e)
};
DwtKeyboardMgr.__handleKeyEvent=function(e){
if(DwtKeyboardMgr.__shell._blockInput){
return false
}
e=DwtUiEvent.getEvent(e,this);
var a=DwtKeyboardMgr.__shell.getKeyboardMgr();
var t=DwtShell.keyEvent;
t.setFromDhtmlEvent(e);
if(a.__kbEventStatus!=DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED){
return a.__processKeyEvent(e,t,false)
}};
DwtKeyboardMgr.__syncFocus=function(t,e){
DBG.println(AjxDebug.FOCUS,"sync focus ----- obj: "+e+", __focusObj: "+t.__focusObj+", __dwtCtrlHasFocus: "+t.__dwtCtrlHasFocus+", __inputElement: "+t.__inputElement+", __oldFocusObj: "+t.__oldFocusObj);
if((e!=t._kbFocusField)&&t.__dwtCtrlHasFocus){
t.__warnFocus();
t._kbFocusField.focus()
}
if(!t.__dwtCtrlHasFocus){
if((e!=t.__focusObj)&&!t.__inputElement){
if(t.__currTabGroup&&t.__currTabGroup.setFocusMember(e)){
t.__focusObj=e;
t.__oldFocusObj=null
}else{
return false
}}}
return true
};
DwtKeyboardMgr.prototype.__warnFocus=function(){
var a,t;
if(!this.__focusObj){
return
}
if(this.__focusObj.isDwtControl){
a=this.__focusObj.getHTMLElId();
t=this.__focusObj.toString()
}else{
a=this.__focusObj.id;
t=String(this.__focusObj)
}
var e=AjxMessageFormat.format("KBFF focused for {0} ({1})",[t,a]);
if(window.console&&console.log){
console.log(e)
}};
DwtKeyboardMgr.__keyDownHdlr=function(r){
try{
r=DwtUiEvent.getEvent(r,this);
var e=DwtKeyboardMgr.__shell.getKeyboardMgr();
r.focusObj=null;
if(e._evtMgr.notifyListeners(DwtEvent.ONKEYDOWN,r)===false){
return false
}
if(DwtKeyboardMgr.__shell._blockInput){
return false
}
if(e&&!e.isEnabled()){
return true
}
if(!e||!e.__checkStatus()){
return false
}
var l=DwtShell.keyEvent;
l.setFromDhtmlEvent(r);
var h=DwtKeyEvent.getCharCode(r);
DwtKeyboardMgr.__shell.getToolTip().popdown();
var i=DwtKeyboardMgr.__syncFocus(e,l.target);
if(!i){}
if(h==DwtKeyMapMgr.TAB_KEYCODE){
if(e.__currTabGroup&&!DwtKeyMapMgr.hasModifier(l)){
if(i||e.__currTabGroup.getFocusMember()){
if(!l.shiftKey){
e.__currTabGroup.dump(AjxDebug.FOCUS);
e.__currTabGroup.getNextFocusMember(true)
}else{
e.__currTabGroup.getPrevFocusMember(true)
}}else{
e.__currTabGroup.resetFocusMember(true)
}
return e.__processKeyEvent(r,l,false,DwtKeyboardMgr.__KEYSEQ_HANDLED)
}else{
return e.__processKeyEvent(r,l,true,DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED)
}}else{
if(e.__currTabGroup&&!i&&AjxEnv.isGecko&&l.target instanceof HTMLHtmlElement){
e.__currTabGroup.resetFocusMember(true)
}}
if(e.__dwtCtrlHasFocus){
e._kbFocusField.value=""
}
if(DwtKeyMap.IS_MODIFIER[h]||(!e.__dwtCtrlHasFocus&&(e.__killKeySeqTimedActionId==-1)&&l.target&&DwtKeyMapMgr.isInputElement(l.target)&&!l.target["data-hidden"]&&!DwtKeyboardMgr.isPossibleInputShortcut(l))){
return e.__processKeyEvent(r,l,true,DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED)
}
if(e.__killKeySeqTimedActionId!=-1){
AjxTimedAction.cancelAction(e.__killKeySeqTimedActionId);
e.__killKeySeqTimedActionId=-1
}
var t=[];
if(l.altKey){
t.push(DwtKeyMap.ALT)
}
if(l.ctrlKey){
t.push(DwtKeyMap.CTRL)
}
if(l.metaKey){
t.push(DwtKeyMap.META)
}
if(l.shiftKey){
t.push(DwtKeyMap.SHIFT)
}
t.push(h);
e.__keySequence[e.__keySequence.length]=t.join(DwtKeyMap.JOIN);
var n=DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED;
var a=r.focusObj||e.__focusObj;
if(a&&(a.handleKeyAction)&&(e.__dwtCtrlHasFocus||e.__inputElement||(a.hasFocus&&a.hasFocus()))){
n=e.__dispatchKeyEvent(a,l);
while((n==DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED)&&a.parent&&a.parent.getKeyMapName){
a=a.parent;
n=e.__dispatchKeyEvent(a,l)
}}
if(n===DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED&&e.__currDefaultHandler){
n=e.__dispatchKeyEvent(e.__currDefaultHandler,l)
}
if(l.forcePropagate){
n=DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED;
l.forcePropagate=false
}
e.__kbEventStatus=n;
var o=(n==DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED);
if(n!=DwtKeyboardMgr.__KEYSEQ_PENDING){
e.clearKeySeq()
}
return e.__processKeyEvent(r,l,o)
}
catch(s){
AjxException.reportScriptError(s)
}};
DwtKeyboardMgr.prototype.__dispatchKeyEvent=function(o,n,a){
if(o&&o.handleKeyEvent){
var s=o.handleKeyEvent(n);
return s?DwtKeyboardMgr.__KEYSEQ_HANDLED:DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED
}
var i=(o&&o.getKeyMapName)?o.getKeyMapName():null;
if(!i){
return DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED
}
var t=this.__keyMapMgr.getActionCode(this.__keySequence,i,a);
if(t==DwtKeyMapMgr.NOT_A_TERMINAL){
this.__hdlr=o;
this.__mapName=i;
this.__ev=n;
this.__killKeySeqTimedActionId=AjxTimedAction.scheduleAction(this.__killKeySeqTimedAction,this.__keyTimeout);
return DwtKeyboardMgr.__KEYSEQ_PENDING
}else{
if(t!=null){
if(!o.handleKeyAction){
return DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED
}
var e=o.handleKeyAction(t,n);
return e?DwtKeyboardMgr.__KEYSEQ_HANDLED:DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED
}else{
return DwtKeyboardMgr.__KEYSEQ_NOT_HANDLED
}}};
DwtKeyboardMgr.prototype.__killKeySequenceAction=function(){
this.__dispatchKeyEvent(this.__hdlr,this.__ev,true);
this.clearKeySeq()
};
DwtKeyboardMgr.prototype.__tabGrpChangeListener=function(e){
this.__doGrabFocus(e.newFocusMember)
};
DwtKeyboardMgr.prototype.__processKeyEvent=function(a,i,e,t){
if(t){
this.__kbEventStatus=t
}
i._stopPropagation=!e;
i._returnValue=e;
i.setToDhtmlEvent(a);
return e
}
}
if(AjxPackage.define("ajax.dwt.keyboard.DwtTabGroup")){
DwtTabGroup=function(e){
this.__members=new AjxVector();
this.__parent=null;
this.__name=e;
this.__currFocusMember=null;
this.__evtMgr=new AjxEventMgr()
};
DwtTabGroup.prototype.isDwtTabGroup=true;
DwtTabGroup.NOT_ROOT_TABGROUP="NOT ROOT TAB GROUP";
DwtTabGroup.__changeEvt=new DwtTabGroupEvent();
DwtTabGroup.prototype.toString=function(){
return"DwtTabGroup"
};
DwtTabGroup.prototype.getName=function(){
return this.__name
};
DwtTabGroup.prototype.addFocusChangeListener=function(e){
this.__checkRoot();
this.__evtMgr.addListener(DwtEvent.STATE_CHANGE,e)
};
DwtTabGroup.prototype.removeFocusChangeListener=function(e){
this.__checkRoot();
this.__evtMgr.removeListener(DwtEvent.STATE_CHANGE,e)
};
DwtTabGroup.prototype.addMember=function(n,a){
if(!n){
return
}
var t=(n instanceof Array)?n:[n];
if(AjxUtil.isUndefined(a)){
a=this.__members.size()
}
for(var o=0,e=t.length;
o<e;
o++){
if(!t[o]){
a-=1;
continue
}
this.__members.add(t[o],a+o);
if(t[o].isDwtTabGroup){
t[o].newParent(this)
}}};
DwtTabGroup.prototype.addMemberAfter=function(e,t){
this.addMember(e,this.__indexOfMember(t)+1)
};
DwtTabGroup.prototype.addMemberBefore=function(e,t){
this.addMember(e,this.__indexOfMember(t))
};
DwtTabGroup.prototype.removeMember=function(a,e,t){
return this.replaceMember(a,null,e,t)
};
DwtTabGroup.prototype.removeAllMembers=function(){
this.__members.removeAll()
};
DwtTabGroup.prototype.replaceMember=function(o,n,h,s,e,i){
var t=this.__getTabGroupForMember(o);
if(!t){
this.addMember(n);
return null
}
var r=this.__getRootTabGroup();
var a;
if(e){
a=e
}else{
if(r.__currFocusMember==o||(o&&o.isDwtTabGroup&&o.contains(r.__currFocusMember))){
if(n){
a=(n.isDwtTabGroup)?n.getFirstMember():n
}else{
a=this.__getPrevMember(o,h);
if(!a){
a=this.__getNextMember(o,h)
}}}}
if(a&&!i){
r.__currFocusMember=a;
this.__showFocusedItem(this.__currFocusMember,"replaceMember");
if(!s){
this.__notifyListeners(a)
}}
if(n&&n.isDwtTabGroup){
n.newParent(this)
}
return n?this.__members.replaceObject(o,n):this.__members.remove(o)
};
DwtTabGroup.prototype.contains=function(e){
return(Boolean(this.__getTabGroupForMember(e)))
};
DwtTabGroup.prototype.newParent=function(e){
this.__parent=e
};
DwtTabGroup.prototype.getFirstMember=function(e){
return this.__getLeftMostMember(e)
};
DwtTabGroup.prototype.getTabGroupMemberByName=function(t){
var e=this.__members.getArray();
for(var a=0;
a<e.length;
a++){
var o=e[a];
if(o.isDwtTabGroup&&o.getName()==t){
return o
}}};
DwtTabGroup.prototype.getLastMember=function(e){
return this.__getRightMostMember(e)
};
DwtTabGroup.prototype.getFocusMember=function(){
this.__checkRoot();
return this.__currFocusMember
};
DwtTabGroup.prototype.setFocusMember=function(i,e,t){
this.__checkRoot();
if(!this.__checkEnabled(i,e)){
return false
}
var a=this.__getTabGroupForMember(i);
if(a){
this.__currFocusMember=i;
this.__showFocusedItem(this.__currFocusMember,"setFocusMember");
if(!t){
this.__notifyListeners(this.__currFocusMember)
}
return true
}
return false
};
DwtTabGroup.prototype.getNextFocusMember=function(e,t){
this.__checkRoot();
return this.__setFocusMember(true,e,t)
};
DwtTabGroup.prototype.getPrevFocusMember=function(e,t){
this.__checkRoot();
return this.__setFocusMember(false,e,t)
};
DwtTabGroup.prototype.resetFocusMember=function(t,a){
this.__checkRoot();
var e=this.__getLeftMostMember(t);
if((e!=this.__currFocusMember)&&!a){
this.__notifyListeners(this.__currFocusMember)
}
this.__showFocusedItem(this.__currFocusMember,"resetFocusMember");
this.__currFocusMember=e;
return this.__currFocusMember
};
DwtTabGroup.prototype.dump=function(e){
if(e){
if(!window.AjxDebug||!window.DBG){
return
}
var t=function(i){
var i=AjxStringUtil.convertToHtml(i)
};
DwtTabGroup.__dump(this,t,0)
}else{
if(window.console&&window.console.log){
var a=[];
DwtTabGroup.__dump(this,a.push.bind(a),0);
console.log(a.join("\n"))
}}};
DwtTabGroup.prototype.size=function(){
return this.__members.size()
};
DwtTabGroup.prototype.__getPrevMember=function(s,t){
var e=this.__members.getArray();
for(var o=this.__lastIndexOfMember(s)-1;
o>-1;
o--){
var n=e[o];
if(!(n.isDwtTabGroup)){
if(this.__checkEnabled(n,t)){
return n
}}else{
n=n.__getRightMostMember(t);
if(n&&this.__checkEnabled(n,t)){
return n
}}}
return this.__parent?this.__parent.__getPrevMember(this,t):null
};
DwtTabGroup.prototype.__checkEnabled=function(i,e){
if(!e){
return true
}
if(!i||i.noTab){
return false
}
if(i.isDwtControl?!i.getEnabled():i.disabled){
return false
}
if(i.isDwtControl){
i=i.getHtmlElement()
}
var a=Dwt.getLocation(i);
if(a.x===null||a.x===Dwt.LOC_NOWHERE||a.y===Dwt.LOC_NOWHERE||a.y===null){
return false
}
var t=Dwt.getSize(i);
if(!t||t.x===0||t.y===0){
return false
}
if(i.nodeName==="BODY"){
return true
}
return Dwt.getZIndex(i,true)>Dwt.Z_HIDDEN&&Dwt.getVisible(i)
};
DwtTabGroup.__memberKeyFunc=function(e){
e=e||this;
if(e.getInputElement){
return e.getInputElement()||e
}else{
return e
}};
DwtTabGroup.prototype.__indexOfMember=function(t){
var e=DwtTabGroup.__memberKeyFunc;
return this.__members.indexOfLike(t,e)
};
DwtTabGroup.prototype.__lastIndexOfMember=function(t){
var e=DwtTabGroup.__memberKeyFunc;
return this.__members.lastIndexOfLike(t,e)
};
DwtTabGroup.prototype.__getNextMember=function(r,t){
var e=this.__members.getArray();
var s=this.__members.size();
for(var n=this.__indexOfMember(r)+1;
n<s;
n++){
var o=e[n];
if(!(o.isDwtTabGroup)){
if(this.__checkEnabled(o,t)){
return o
}}else{
o=o.__getLeftMostMember(t);
if(o&&this.__checkEnabled(o,t)){
return o
}}}
return this.__parent?this.__parent.__getNextMember(this,t):null
};
DwtTabGroup.prototype.__getRightMostMember=function(t){
var e=this.__members.getArray();
var n=null;
for(var o=this.__members.size()-1;
o>=0;
o--){
n=e[o];
if(!(n.isDwtTabGroup)){
if(this.__checkEnabled(n,t)){
break
}}else{
n=n.__getRightMostMember(t);
if(n&&this.__checkEnabled(n,t)){
break
}}}
return(n&&this.__checkEnabled(n,t))?n:null
};
DwtTabGroup.prototype.__getLeftMostMember=function(t){
var n=this.__members.size();
var e=this.__members.getArray();
var s=null;
for(var o=0;
o<n;
o++){
s=e[o];
if(!(s.isDwtTabGroup)){
if(this.__checkEnabled(s,t)){
break
}}else{
s=s.__getLeftMostMember(t);
if(s&&this.__checkEnabled(s,t)){
break
}}}
return(s&&this.__checkEnabled(s,t))?s:null
};
DwtTabGroup.prototype.__notifyListeners=function(t){
var a=this.__getRootTabGroup();
if(a.__evtMgr){
var e=DwtTabGroup.__changeEvt;
e.reset();
e.tabGroup=this;
e.newFocusMember=t;
a.__evtMgr.notifyListeners(DwtEvent.STATE_CHANGE,e)
}};
DwtTabGroup.prototype.__getRootTabGroup=function(){
var e=this;
while(e.__parent){
e=e.__parent
}
return e
};
DwtTabGroup.DUMP_INDENT="|\t";
DwtTabGroup.__dump=function(s,o,l){
var t=AjxStringUtil.repeat(DwtTabGroup.DUMP_INDENT,l);
o(t+"TABGROUP: "+s.__name);
t+=DwtTabGroup.DUMP_INDENT;
var r=s.__members.size();
var e=s.__members.getArray();
for(var n=0;
n<r;
n++){
if(e[n].isDwtTabGroup){
DwtTabGroup.__dump(e[n],o,l+1)
}else{
var h=e[n].nodeName?(e[n].nodeName+" "+e[n].outerHTML):(String(e[n])+" "+e[n]._htmlElId);
o(t+h)
}}};
DwtTabGroup.prototype.__setFocusMember=function(o,t,a){
if(!this.__currFocusMember){
return this.resetFocusMember(t,a)
}
var i=this.__getTabGroupForMember(this.__currFocusMember);
if(!i){
return null
}
var e=(o)?i.__getNextMember(this.__currFocusMember,t):i.__getPrevMember(this.__currFocusMember,t);
if(!e){
e=(o)?this.__getLeftMostMember(t):this.__getRightMostMember(t);
if(e==this.__currFocusMember){
return null
}}
this.__currFocusMember=e;
this.__showFocusedItem(this.__currFocusMember,"_setFocusMember");
if(!a){
this.__notifyListeners(this.__currFocusMember)
}
return this.__currFocusMember
};
DwtTabGroup.prototype.__getTabGroupForMember=function(s){
if(!s){
return null
}
var n=this.__members.size();
var t=this.__members.getArray();
var e;
for(var o=0;
o<n;
o++){
e=t[o];
if(e==s||(DwtTabGroup.__memberKeyFunc(s)==DwtTabGroup.__memberKeyFunc(e))){
return this
}else{
if(e.isDwtTabGroup&&(e=e.__getTabGroupForMember(s))){
return e
}}}
return null
};
DwtTabGroup.prototype.__checkRoot=function(){
if(this.__parent){
throw DwtTabGroup.NOT_ROOT_TABGROUP
}};
DwtTabGroup.prototype.__showFocusedItem=function(i,t){
if(i&&window.AjxDebug&&window.DBG){
var e=t?"DwtTabGroup."+t+": ":"",n=" ["+(i.isDwtControl?i._htmlElId:i.id)+"] ",o=(i.getTitle&&i.getTitle())||(i.getText&&i.getText())||"",a=i+n+o
}}
}
if(AjxPackage.define("ajax.dwt.dnd.DwtDragEvent")){
DwtDragEvent=function(){
this.operation=null;
this.srcControl=null;
this.action=null;
this.doIt=false;
this.srcData=null
};
DwtDragEvent.DRAG_INIT="INIT";
DwtDragEvent.DRAG_START="START";
DwtDragEvent.SET_DATA="SET_DATA";
DwtDragEvent.DRAG_MOVE="MOVE";
DwtDragEvent.DRAG_END="END";
DwtDragEvent.DRAG_CANCEL="CANCEL"
}
if(AjxPackage.define("ajax.dwt.dnd.DwtDragSource")){
DwtDragSource=function(e){
this.__supportedOps=e;
this.__evtMgr=new AjxEventMgr()
};
DwtDragSource.__DRAG_LISTENER="DwtDragSource.__DRAG_LISTENER";
DwtDragSource.__dragEvent=new DwtDragEvent();
DwtDragSource.prototype.toString=function(){
return"DwtDragSource"
};
DwtDragSource.prototype.addDragListener=function(e){
this.__evtMgr.addListener(DwtDragSource.__DRAG_LISTENER,e)
};
DwtDragSource.prototype.removeDragListener=function(e){
this.__evtMgr.removeListener(DwtDragSource.__DRAG_LISTENER,e)
};
DwtDragSource.prototype._beginDrag=function(e,t){
if(!(this.__supportedOps&e)){
return Dwt.DND_DROP_NONE
}
DwtDragSource.__dragEvent.operation=e;
DwtDragSource.__dragEvent.srcControl=t;
DwtDragSource.__dragEvent.action=DwtDragEvent.DRAG_START;
DwtDragSource.__dragEvent.srcData=null;
DwtDragSource.__dragEvent.doit=true;
this.__evtMgr.notifyListeners(DwtDragSource.__DRAG_LISTENER,DwtDragSource.__dragEvent);
return DwtDragSource.__dragEvent.operation
};
DwtDragSource.prototype._getData=function(){
DwtDragSource.__dragEvent.action=DwtDragEvent.SET_DATA;
this.__evtMgr.notifyListeners(DwtDragSource.__DRAG_LISTENER,DwtDragSource.__dragEvent);
return DwtDragSource.__dragEvent.srcData
};
DwtDragSource.prototype._endDrag=function(){
DwtDragSource.__dragEvent.action=DwtDragEvent.DRAG_END;
DwtDragSource.__dragEvent.doit=false;
this.__evtMgr.notifyListeners(DwtDragSource.__DRAG_LISTENER,DwtDragSource.__dragEvent);
return DwtDragSource.__dragEvent.doit
};
DwtDragSource.prototype._cancelDrag=function(){
DwtDragSource.__dragEvent.action=DwtDragEvent.DRAG_CANCEL;
DwtDragSource.__dragEvent.doit=false;
this.__evtMgr.notifyListeners(DwtDragSource.__DRAG_LISTENER,DwtDragSource.__dragEvent);
return DwtDragSource.__dragEvent.doit
}
}
if(AjxPackage.define("ajax.dwt.dnd.DwtDropEvent")){
DwtDropEvent=function(){
this.operation=null;
this.targetControl=null;
this.action=null;
this.srcData=null;
this.doIt=false
};
DwtDropEvent.DRAG_ENTER=1;
DwtDropEvent.DRAG_LEAVE=2;
DwtDropEvent.DRAG_OP_CHANGED=3;
DwtDropEvent.DRAG_DROP=4
}
if(AjxPackage.define("ajax.dwt.dnd.DwtDropTarget")){
DwtDropTarget=function(t){
this._evtMgr=new AjxEventMgr();
this.__hasMultiple=false;
this._types={};
if(typeof t=="string"){
t=[t]
}
if(t&&t.length){
for(var e=0;
e<t.length;
e++){
this.addTransferType(t[e])
}}};
DwtDropTarget.__DROP_LISTENER="DwtDropTarget.__DROP_LISTENER";
DwtDropTarget.__dropEvent=new DwtDropEvent();
DwtDropTarget.prototype.toString=function(){
return"DwtDropTarget"
};
DwtDropTarget.prototype.addDropListener=function(e){
this._evtMgr.addListener(DwtDropTarget.__DROP_LISTENER,e)
};
DwtDropTarget.prototype.removeDropListener=function(e){
this._evtMgr.removeListener(DwtDropTarget.__DROP_LISTENER,e)
};
DwtDropTarget.prototype.isValidTarget=function(t){
if(t instanceof Array){
var e=t.length;
for(var a=0;
a<e;
a++){
if(!this.__checkTarget(t[a])){
return false
}}
return true
}else{
return this.__checkTarget(t)
}};
DwtDropTarget.prototype.markAsMultiple=function(){
this.__hasMultiple=true
};
DwtDropTarget.prototype.hasMultipleTargets=function(){
return this.__hasMultiple
};
DwtDropTarget.prototype.getTransferTypes=function(){
return this._types
};
DwtDropTarget.prototype.addTransferType=function(e){
this._types[e]=null
};
DwtDropTarget.prototype._dragEnter=function(e,a,o,t,i){
DwtDropTarget.__dropEvent.operation=e;
DwtDropTarget.__dropEvent.targetControl=a;
DwtDropTarget.__dropEvent.action=DwtDropEvent.DRAG_ENTER;
DwtDropTarget.__dropEvent.srcData=o;
DwtDropTarget.__dropEvent.uiEvent=t;
DwtDropTarget.__dropEvent.doIt=true;
DwtDropTarget.__dropEvent.dndProxy=i;
this._evtMgr.notifyListeners(DwtDropTarget.__DROP_LISTENER,DwtDropTarget.__dropEvent);
return DwtDropTarget.__dropEvent.doIt
};
DwtDropTarget.prototype._dragLeave=function(){
DwtDropTarget.__dropEvent.action=DwtDropEvent.DRAG_LEAVE;
this._evtMgr.notifyListeners(DwtDropTarget.__DROP_LISTENER,DwtDropTarget.__dropEvent)
};
DwtDropTarget.prototype._dragOpChanged=function(e){
DwtDropTarget.__dropEvent.operation=e;
DwtDropTarget.__dropEvent.action=DwtDropEvent.DRAG_OP_CHANGED;
this._evtMgr.notifyListeners(DwtDropTarget.__DROP_LISTENER,DwtDropTarget.__dropEvent);
return DwtDropTarget.__dropEvent.doIt
};
DwtDropTarget.prototype._drop=function(t,e){
DwtDropTarget.__dropEvent.action=DwtDropEvent.DRAG_DROP;
DwtDropTarget.__dropEvent.srcData=t;
DwtDropTarget.__dropEvent.uiEvent=e;
this._evtMgr.notifyListeners(DwtDropTarget.__DROP_LISTENER,DwtDropTarget.__dropEvent);
return DwtDropTarget.__dropEvent.doIt
};
DwtDropTarget.prototype.__checkTarget=function(item){
if(this._types){
for(var i in this._types){
var ctor;
if(this._types[i]){
ctor=this._types[i]
}else{
ctor=this._types[i]=eval(i)
}
if(ctor&&(typeof ctor=="function")&&(item instanceof ctor)){
return true
}}
return false
}}
}
if(AjxPackage.define("ajax.dwt.dnd.DwtDragBox")){
DwtDragBox=function(){
this.__evtMgr=new AjxEventMgr()
};
DwtDragBox.__DRAG_LISTENER="DwtDragBox.__DRAG_LISTENER";
DwtDragBox.__dragEvent=new DwtDragEvent();
DwtDragBox.prototype.toString=function(){
return"DwtDragBox"
};
DwtDragBox.prototype.addDragListener=function(e){
this.__evtMgr.addListener(DwtDragBox.__DRAG_LISTENER,e)
};
DwtDragBox.prototype.removeDragListener=function(e){
this.__evtMgr.removeListener(DwtDragBox.__DRAG_LISTENER,e)
};
DwtDragBox.prototype._setStart=function(e,t){
this._startX=e.docX;
this._startY=e.docY;
this._dragObj=DwtDragBox.__dragEvent.srcControl=t;
DwtDragBox.__dragEvent.action=DwtDragEvent.DRAG_INIT;
DwtDragBox.__dragEvent.target=e.target;
return(this.__evtMgr.notifyListeners(DwtDragBox.__DRAG_LISTENER,DwtDragBox.__dragEvent)!==false)
};
DwtDragBox.prototype._beginDrag=function(e){
e._dragging=DwtControl._DRAGGING;
DwtDragBox.__dragEvent.srcControl=e;
DwtDragBox.__dragEvent.action=DwtDragEvent.DRAG_START;
this.__evtMgr.notifyListeners(DwtDragBox.__DRAG_LISTENER,DwtDragBox.__dragEvent)
};
DwtDragBox.prototype._dragMove=function(n,s){
var i=n.docX-this._startX;
var t=n.docY-this._startY;
var a=(i>0)?this._startX:n.docX;
var e=(t>0)?this._startY:n.docY;
var o=s.getDragSelectionBox();
Dwt.setLocation(o,a,e);
Dwt.setSize(o,Math.abs(i),Math.abs(t));
DwtDragBox.__dragEvent.srcControl=s;
DwtDragBox.__dragEvent.action=DwtDragEvent.DRAG_MOVE;
this.__evtMgr.notifyListeners(DwtDragBox.__DRAG_LISTENER,DwtDragBox.__dragEvent)
};
DwtDragBox.prototype._endDrag=function(e){
e._dragging=DwtControl._NO_DRAG;
DwtDragBox.__dragEvent.action=DwtDragEvent.DRAG_END;
if(!this.__evtMgr.notifyListeners(DwtDragBox.__DRAG_LISTENER,DwtDragBox.__dragEvent)){
e.destroyDragSelectionBox()
}
this._dragObj=null
};
DwtDragBox.prototype.getStartX=function(){
return this._startX
};
DwtDragBox.prototype.getStartY=function(){
return this._startY
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtHoverMgr")){
DwtHoverMgr=function(){
this._hoverOverAction=new AjxTimedAction(this,this._notifyHoverOver);
this._hoverOutAction=new AjxTimedAction(this,this._notifyHoverOut);
this._ignoreHoverOverOnClickAction=new AjxTimedAction(this,this._resetIgnoreHoverOverOnClick)
};
DwtHoverMgr.prototype.isDwtHoverMgr=true;
DwtHoverMgr.prototype.toString=function(){
return"DwtHoverMgr"
};
DwtHoverMgr.prototype._hoverOverDelay=750;
DwtHoverMgr.prototype._hoverOverActionId=-1;
DwtHoverMgr.prototype._hoverOutDelay=50;
DwtHoverMgr.prototype._ignoreHoverOverOnClickDelay=750;
DwtHoverMgr.prototype._hoverOutActionId=-1;
DwtHoverMgr.prototype._isHovering=false;
DwtHoverMgr.prototype.setHoverObject=function(e){
this._hoverObject=e
};
DwtHoverMgr.prototype.getHoverObject=function(){
return this._hoverObject
};
DwtHoverMgr.prototype.reset=function(){
this._hoverObject=null;
this._hoverOverDelay=DwtHoverMgr.prototype._hoverOverDelay;
this._hoverOverData=null;
if(this._hoverOverActionId!=-1){
AjxTimedAction.cancelAction(this._hoverOverActionId)
}
this._hoverOverActionId=-1;
this._hoverOverListener=null;
this._hoverOutDelay=DwtHoverMgr.prototype._hoverOutDelay;
this._hoverOutData=null;
if(this._hoverOutActionId!=-1){
AjxTimedAction.cancelAction(this._hoverOutActionId);
this._notifyHoverOut()
}
this._hoverOutActionId=-1;
this._hoverOutListener=null
};
DwtHoverMgr.prototype.isHovering=function(){
return this._isHovering
};
DwtHoverMgr.prototype.setHoverOverDelay=function(e){
this._hoverOverDelay=e
};
DwtHoverMgr.prototype.setHoverOverData=function(e){
this._hoverOverData=e
};
DwtHoverMgr.prototype.setHoverOverListener=function(e){
this._hoverOverListener=e
};
DwtHoverMgr.prototype.setHoverOutDelay=function(e){
this._hoverOutDelay=e
};
DwtHoverMgr.prototype.setHoverOutData=function(e){
this._hoverOutData=e
};
DwtHoverMgr.prototype.setHoverOutListener=function(e){
this._hoverOutListener=e
};
DwtHoverMgr.prototype.ignoreHoverOverOnClick=function(){
this._ignoreHoverOverOnClick=true;
AjxTimedAction.scheduleAction(this._ignoreHoverOverOnClickAction,this._ignoreHoverOverOnClickDelay)
};
DwtHoverMgr.prototype._resetIgnoreHoverOverOnClick=function(){
this._ignoreHoverOverOnClick=false
};
DwtHoverMgr.prototype.hoverOver=function(e,t){
if(this._ignoreHoverOverOnClick){
return
}
this._isHovering=true;
if(this._hoverOverActionId!=-1){
AjxTimedAction.cancelAction(this._hoverOverActionId)
}
this._hoverOverAction.args=[e,t];
this._hoverOverActionId=AjxTimedAction.scheduleAction(this._hoverOverAction,this._hoverOverDelay)
};
DwtHoverMgr.prototype.hoverOut=function(){
this._isHovering=false;
if(this._hoverOverActionId!=-1){
AjxTimedAction.cancelAction(this._hoverOverActionId)
}
if(this._hoverOutActionId==-1){
if(this._hoverOutDelay>0){
this._hoverOutActionId=AjxTimedAction.scheduleAction(this._hoverOutAction,this._hoverOutDelay)
}else{
this._notifyHoverOut()
}}};
DwtHoverMgr.prototype._notifyHoverOver=function(){
this._hoverOverActionId=-1;
if(this._hoverOverListener!=null){
var e=this._hoverOverAction.args[0];
var a=this._hoverOverAction.args[1];
var t=new DwtHoverEvent(DwtEvent.HOVEROVER,this._hoverOverDelay,this._hoverOverData,e,a);
this._hoverOverListener.handleEvent(t)
}};
DwtHoverMgr.prototype._notifyHoverOut=function(){
this._hoverOutActionId=-1;
if(this._hoverOutListener!=null){
var e=new DwtHoverEvent(DwtEvent.HOVEROUT,this._hoverOutDelay,this._hoverOutData);
this._hoverOutListener.handleEvent(e)
}}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtControl")){
DwtControl=function(t){
if(arguments.length==0){
return
}
t=Dwt.getParams(arguments,DwtControl.PARAMS);
var e=this.parent=t.parent;
if(e&&!(e.isDwtComposite)){
throw new DwtException("Parent must be a subclass of Composite",DwtException.INVALIDPARENT,"DwtControl")
}
this.shell=null;
this._data={};
this._eventMgr=new AjxEventMgr();
this._disposed=false;
this._propagateEvent={};
this._propagateEvent[DwtEvent.ONMOUSEWHEEL]=true;
if(!e){
return
}
this._className=t.className||"DwtControl";
this.__posStyle=t.posStyle;
if(t.id){
this._htmlElId=t.id
}
if(t.isFocusable!=null){
this.isFocusable=t.isFocusable
}
if(t.role!=null){
this.role=t.role
}
this.__index=t.index;
this.__parentElement=t.parentElement;
this._enabled=false;
this._dragging=null;
this._dndProxy=null;
this._hasFocus=false;
if(!t.deferred){
this.__initCtrl()
}
this._hoverOverListener=new AjxListener(this,this.__handleHoverOver);
this._hoverOutListener=new AjxListener(this,this.__handleHoverOut);
this._dblClickIsolation=false;
this._ignoreInternalOverOut=false;
this.TEMPLATE=t.template||this.TEMPLATE
};
DwtControl.prototype.isDwtControl=true;
DwtControl.prototype.toString=function(){
return"DwtControl"
};
DwtControl.prototype.isFocusable=null;
DwtControl.PARAMS=["parent","className","posStyle","deferred","id","index","template"];
DwtControl.ALL_BY_ID={};
DwtControl.NORMAL="";
DwtControl.ACTIVE="ZActive";
DwtControl.FOCUSED="ZFocused";
DwtControl.DISABLED="ZDisabled";
DwtControl.HOVER="ZHover";
DwtControl.SELECTED="ZSelected";
DwtControl.DEFAULT="ZDefault";
DwtControl.ERROR="ZError";
DwtControl._STATES=[DwtControl.ACTIVE,DwtControl.FOCUSED,DwtControl.DISABLED,DwtControl.HOVER,DwtControl.SELECTED,DwtControl.DEFAULT,DwtControl.ERROR];
DwtControl._RE_STATES=new RegExp("\\b("+DwtControl._STATES.join("|")+")\\b","g");
DwtControl._RE_STATE=AjxUtil.arrayAsHash(DwtControl._STATES,function(e){
return new RegExp("\\b"+e+"\\b","g")
}
);
DwtControl._ARIA_STATES={};
DwtControl._ARIA_STATES[DwtControl.DISABLED]="aria-disabled";
DwtControl._ARIA_STATES[DwtControl.SELECTED]="aria-selected";
DwtControl._ARIA_STATES[DwtControl.ERROR]="aria-invalid";
DwtControl.useBrowserTooltips=false;
DwtControl.STATIC_STYLE=Dwt.STATIC_STYLE;
DwtControl.ABSOLUTE_STYLE=Dwt.ABSOLUTE_STYLE;
DwtControl.RELATIVE_STYLE=Dwt.RELATIVE_STYLE;
DwtControl.FIXED_STYLE=Dwt.FIXED_STYLE;
DwtControl.CLIP=Dwt.CLIP;
DwtControl.VISIBLE=Dwt.VISIBLE;
DwtControl.SCROLL=Dwt.SCROLL;
DwtControl.FIXED_SCROLL=Dwt.FIXED_SCROLL;
DwtControl._NO_DRAG="NO_DRAG";
DwtControl._DRAGGING="DRAGGING";
DwtControl._DRAG_REJECTED="DRAG_REJECTED";
DwtControl.__DRAG_THRESHOLD=3;
DwtControl.__TOOLTIP_THRESHOLD=5;
DwtControl.__DND_HOVER_DELAY=750;
DwtControl.__controlEvent=new DwtControlEvent();
DwtControl.__DBL_CLICK_TIMEOUT=300;
DwtControl.prototype._displayState="";
DwtControl.prototype.addControlListener=function(e){
this.addListener(DwtEvent.CONTROL,e)
};
DwtControl.prototype.removeControlListener=function(e){
this.removeListener(DwtEvent.CONTROL,e)
};
DwtControl.prototype.addDisposeListener=function(e){
this.addListener(DwtEvent.DISPOSE,e)
};
DwtControl.prototype.removeDisposeListener=function(e){
this.removeListener(DwtEvent.DISPOSE,e)
};
DwtControl.prototype.addListener=function(t,a,e){
return this._eventMgr.addListener(t,a,e)
};
DwtControl.prototype.removeListener=function(e,t){
return this._eventMgr.removeListener(e,t)
};
DwtControl.prototype.removeAllListeners=function(e){
return this._eventMgr.removeAll(e)
};
DwtControl.prototype.isListenerRegistered=function(e){
return this._eventMgr.isListenerRegistered(e)
};
DwtControl.prototype.notifyListeners=function(e,t){
return this._eventMgr.notifyListeners(e,t)
};
DwtControl.prototype.dispose=function(){
if(this._disposed){
return
}
if(this.parent&&this.parent.isDwtComposite){
this.parent.removeChild(this)
}
this._elRef=null;
if(DwtControl.ALL_BY_ID){
DwtControl.ALL_BY_ID[this._htmlElId]=null;
delete DwtControl.ALL_BY_ID[this._htmlElId]
}
this._disposed=true;
var e=new DwtDisposeEvent();
e.dwtObj=this;
this.notifyListeners(DwtEvent.DISPOSE,e);
this._eventMgr.clearAllEvents()
};
DwtControl.prototype.getDocument=function(){
return document
};
DwtControl.prototype.getTabGroupMember=function(){
if(this.isFocusable){
return this.getInputElement()
}else{
return this
}};
DwtControl.prototype.getData=function(e){
return this._data[e]
};
DwtControl.prototype.setData=function(e,t){
this._data[e]=t
};
DwtControl.prototype.isDisposed=function(){
return this._disposed
};
DwtControl.prototype.isInitialized=function(){
return this.__ctrlInited
};
DwtControl.prototype.focus=function(){
DwtShell.getShell(window).getKeyboardMgr().grabFocus(this);
this.__doFocus()
};
DwtControl.prototype.blur=function(){
this.__doBlur()
};
DwtControl.prototype.hasFocus=function(){
return this._hasFocus
};
DwtControl.prototype.handleKeyAction=function(e,t){
return false
};
DwtControl.prototype.reparent=function(t,e){
if(!this._checkState()){
return
}
var a=this.getHtmlElement();
this.parent.removeChild(this,true);
DwtComposite._pendingElements[this._htmlElId]=a;
t.addChild(this,e);
this.parent=t
};
DwtControl.prototype.reparentHtmlElement=function(a,e){
if(typeof a=="string"){
a=document.getElementById(a)
}
if(!a){
return
}
var t=this.getHtmlElement();
if(e==null){
a.appendChild(t)
}else{
if(typeof e=="object"){
a.insertBefore(t,e)
}else{
if(a.childNodes[e]){
a.insertBefore(t,a.childNodes[e])
}else{
a.appendChild(t)
}}}};
DwtControl.prototype.setHandler=function(t,e){
if(!this._checkState()){
return
}
var a=this.getHtmlElement();
Dwt.setHandler(a,t,e)
};
DwtControl.prototype.clearHandler=function(e){
if(!this._checkState()){
return
}
var t=this.getHtmlElement();
Dwt.clearHandler(t,e)
};
DwtControl.prototype.setEventPropagation=function(e,a){
a=AjxUtil.toArray(a);
for(var t=0;
t<a.length;
t++){
this._propagateEvent[a[t]]=e
}};
DwtControl.prototype.getBounds=function(){
if(!this._checkState()){
return
}
return Dwt.getBounds(this.getHtmlElement())
};
DwtControl.prototype.getInsetBounds=function(){
if(!this._checkState()){
return
}
return Dwt.getInsetBounds(this.getHtmlElement())
};
DwtControl.prototype.getInsets=function(){
if(!this._checkState()){
return
}
return Dwt.getInsets(this.getHtmlElement())
};
DwtControl.prototype.setBounds=function(a,n,i,t){
if(!this._checkState()){
return
}
var o=this.getHtmlElement();
if(this.isListenerRegistered(DwtEvent.CONTROL)){
this.__controlEvent.reset(DwtControlEvent.RESIZE|DwtControlEvent.MOVE);
var e=Dwt.getBounds(o);
this.__controlEvent.oldX=e.x;
this.__controlEvent.oldY=e.y;
this.__controlEvent.oldWidth=e.width;
this.__controlEvent.oldHeight=e.height;
this.setLocation(a,n);
this.setSize(i,t);
e=Dwt.getBounds(o);
this.__controlEvent.newX=e.x;
this.__controlEvent.newY=e.y;
this.__controlEvent.newWidth=(AjxUtil.isNumber(i))?i:e.width;
this.__controlEvent.newHeight=(AjxUtil.isNumber(t))?t:e.height;
this.__controlEvent.requestedWidth=i;
this.__controlEvent.requestedHeight=t;
this.notifyListeners(DwtEvent.CONTROL,this.__controlEvent)
}else{
this.setLocation(a,n);
this.setSize(i,t)
}
return this
};
DwtControl.prototype.getClassName=function(){
return this._className
};
DwtControl.prototype.setClassName=function(t){
if(!this._checkState()){
return
}
this._className=t;
var e=this.getHtmlElement();
e.className=t;
Dwt.addClass(e,this._displayState)
};
DwtControl.prototype.addClassName=function(e){
Dwt.addClass(this.getHtmlElement(),e)
};
DwtControl.prototype.delClassName=function(e,t){
Dwt.delClass(this.getHtmlElement(),e,t)
};
DwtControl.prototype.condClassName=function(a,e,t){
Dwt.condClass(this.getHtmlElement(),a,e,t)
};
DwtControl.prototype.setDisplayState=function(o){
if(!this._enabled){
o=DwtControl.DISABLED
}
if(arguments.length>1){
var e=[];
for(var t=0;
t<arguments.length;
t++){
e.push(arguments[t])
}
o=e.join(" ")
}
if(this._displayState==o){
return
}
this._displayState=o;
Dwt.delClass(this.getHtmlElement(),DwtControl._RE_STATES,o);
AjxUtil.foreach(DwtControl._ARIA_STATES,(function(a,i){
if(DwtControl._RE_STATE[i].test(this._displayState)){
this.setAttribute(a,true)
}else{
this.removeAttribute(a)
}}
).bind(this))
};
DwtControl.prototype.showAlert=function(e){
if(e&&!this._alert){
this.delClassName(null,"ZAlert")
}else{
if(!e&&this._alert){
this.delClassName("ZAlert",null)
}}
this._alert=e
};
DwtControl.prototype.isAlertShown=function(){
return this._alert
};
DwtControl.prototype._createHtmlFromTemplate=function(e,a){
this.getHtmlElement().innerHTML=AjxTemplate.expand(e,a);
var i=AjxTemplate.getParams(e);
var t=i&&i["class"];
if(t){
t=[this._className,t].join(" ");
this.setClassName(t)
}};
DwtControl.prototype.getCursor=function(){
if(!this._checkState()){
return
}
return Dwt.getCursor(this.getHtmlElement())
};
DwtControl.prototype.setCursor=function(e){
if(!this._checkState()){
return
}
Dwt.setCursor(this.getHtmlElement(),e)
};
DwtControl.prototype.getDragSource=function(){
return this._dragSource
};
DwtControl.prototype.setDragSource=function(e){
this._dragSource=e;
if(e&&!this._ctrlCaptureObj){
this.__initCapture();
this._dndHoverAction=new AjxTimedAction(null,this.__dndDoHover)
}};
DwtControl.prototype.getDropTarget=function(){
return this._dropTarget
};
DwtControl.prototype.setDropTarget=function(e){
this._dropTarget=e
};
DwtControl.prototype.getDragBox=function(){
return this._dragBox
};
DwtControl.prototype.setDragBox=function(e){
this._dragBox=e;
if(e&&!this._ctrlCaptureObj){
this.__initCapture()
}};
DwtControl.prototype.__initCapture=function(e){
this._ctrlCaptureObj=new DwtMouseEventCapture({
targetObj:this,id:"DwtControl",mouseOverHdlr:DwtControl.__mouseOverHdlr,mouseDownHdlr:DwtControl.__mouseDownHdlr,mouseMoveHdlr:DwtControl.__mouseMoveHdlr,mouseUpHdlr:DwtControl.__mouseUpHdlr,mouseOutHdlr:DwtControl.__mouseOutHdlr}
)
};
DwtControl.prototype.getEnabled=function(){
if(!this._checkState()){
return
}
return this._enabled
};
DwtControl.prototype.setEnabled=function(e,t){
if(!this._checkState()){
return
}
if(e!=this._enabled){
this._enabled=e;
this.setDisplayState(e?DwtControl.NORMAL:DwtControl.DISABLED);
if(t){
this.getHtmlElement().disabled=!e
}}};
DwtControl.prototype.getHTMLElId=function(){
return this._htmlElId
};
DwtControl.prototype.getHtmlElement=function(){
if(!this._checkState()){
return
}
var e=this._elRef||document.getElementById(this._htmlElId);
if(e==null){
e=DwtComposite._pendingElements[this._htmlElId]
}else{
if(!e._rendered){
delete DwtComposite._pendingElements[this._htmlElId];
e._rendered=true
}}
return this._elRef=e
};
DwtControl.prototype.getInputElement=function(){
if(this.isFocusable){
return this.getHtmlElement()
}else{
return null
}};
DwtControl.fromElement=function(e){
return DwtControl.ALL_BY_ID&&DwtControl.ALL_BY_ID[e.id]
};
DwtControl.fromElementId=function(e){
return DwtControl.ALL_BY_ID&&DwtControl.ALL_BY_ID[e]
};
DwtControl.findControl=function(a){
if(AjxEnv.isFirefox3_5up&&!AjxEnv.isFirefox3_6up){
var t=HTMLElement.prototype.toString.call(a);
if(t=="[xpconnect wrapped native prototype]"||t=="[object XULElement]"){
return null
}}
try{
while(a){
if(a.id&&DwtControl.ALL_BY_ID&&DwtControl.ALL_BY_ID[a.id]){
return DwtControl.ALL_BY_ID[a.id]
}
a=a.parentNode
}}
catch(i){}
return null
};
DwtControl.getTargetControl=function(e,a){
var t=DwtUiEvent.getTarget(e,a);
return t?DwtControl.findControl(t):null
};
DwtControl.prototype.setHtmlElementId=function(t){
if(this._disposed){
return
}
if(this.__ctrlInited){
var e=this.getHtmlElement();
if(!e._rendered){
delete DwtComposite._pendingElements[this._htmlElId];
DwtComposite._pendingElements[t]=e
}else{
delete DwtControl.ALL_BY_ID[this._htmlElId];
DwtControl.ALL_BY_ID[t]=this
}
e.id=t
}
this._htmlElId=t
};
DwtControl.prototype.getX=function(){
if(!this._checkState()){
return
}
return Dwt.getLocation(this.getHtmlElement()).x
};
DwtControl.prototype.getXW=function(){
if(!this._checkState()){
return
}
var e=this.getBounds();
return e.x+e.width
};
DwtControl.prototype.getY=function(){
if(!this._checkState()){
return
}
return Dwt.getLocation(this.getHtmlElement()).y
};
DwtControl.prototype.getYH=function(){
if(!this._checkState()){
return
}
var e=this.getBounds();
return e.y+e.height
};
DwtControl.prototype.getPosition=function(){
if(!this._checkState()){
return
}
return Dwt.getPosition(this.getHtmlElement())
};
DwtControl.prototype.setPosition=function(e){
if(!this._checkState()){
return
}
return Dwt.setPosition(this.getHtmlElement(),e)
};
DwtControl.prototype.getLocation=function(){
if(!this._checkState()){
return
}
return Dwt.getLocation(this.getHtmlElement())
};
DwtControl.prototype.setLocation=function(e,i){
if(!this._checkState()){
return
}
if(this.isListenerRegistered(DwtEvent.CONTROL)){
var t=this.getHtmlElement();
this.__controlEvent.reset(DwtControlEvent.MOVE);
var a=Dwt.getLocation(t);
this.__controlEvent.oldX=a.x;
this.__controlEvent.oldY=a.y;
Dwt.setLocation(t,e,i);
a=Dwt.getLocation(t);
this.__controlEvent.newX=a.x;
this.__controlEvent.newY=a.y;
this.notifyListeners(DwtEvent.CONTROL,this.__controlEvent)
}else{
Dwt.setLocation(this.getHtmlElement(),e,i)
}
return this
};
DwtControl.prototype.getScrollStyle=function(){
if(!this._checkState()){
return
}
return Dwt.getScrollStyle(this.getHtmlElement())
};
DwtControl.prototype.setScrollStyle=function(e){
if(!this._checkState()){
return
}
Dwt.setScrollStyle(this.getHtmlElement(),e)
};
DwtControl.prototype.setPosition=function(e){
if(!this._checkState()){
return
}
if(e==DwtControl.STATIC_STYLE||e==DwtControl.ABSOLUTE_STYLE||e==DwtControl.RELATIVE_STYLE){
this.__posStyle=e;
Dwt.setPosition(this.getHtmlElement(),e)
}};
DwtControl.prototype.getW=function(){
if(!this._checkState()){
return
}
return Dwt.getSize(this.getHtmlElement()).x
};
DwtControl.prototype.getH=function(){
if(!this._checkState()){
return
}
return Dwt.getSize(this.getHtmlElement()).y
};
DwtControl.prototype.getSize=function(e){
if(!this._checkState()){
return
}
return Dwt.getSize(this.getHtmlElement(),null,e)
};
DwtControl.prototype.setSize=function(t,e){
if(!this._checkState()){
return
}
if(this.isListenerRegistered(DwtEvent.CONTROL)){
var i=this.getHtmlElement();
this.__controlEvent.reset(DwtControlEvent.RESIZE);
var a=Dwt.getSize(i);
this.__controlEvent.oldWidth=a.x;
this.__controlEvent.oldHeight=a.y;
Dwt.setSize(i,t,e);
a=Dwt.getSize(i);
this.__controlEvent.newWidth=a.x;
this.__controlEvent.newHeight=a.y;
this.notifyListeners(DwtEvent.CONTROL,this.__controlEvent)
}else{
Dwt.setSize(this.getHtmlElement(),t,e)
}
return this
};
DwtControl.prototype.getToolTipContent=function(e){
if(this._disposed){
return null
}
return this.__toolTipContent
};
DwtControl.prototype.setToolTipContent=function(t,e){
if(this._disposed){
return
}
if(t&&(typeof(t)=="string")&&DwtControl.useBrowserTooltips){
if(!t||(!t.match(/[\n\r\t]/)&&!t.match(/<[a-zA-Z]+/))){
var a=this.getHtmlElement();
if(a){
a.title=t;
this._browserToolTip=true;
return
}}}
this._browserToolTip=false;
this.__toolTipContent=t
};
DwtControl.prototype.getVisible=function(){
if(!this._checkState()){
return
}
return Dwt.getVisible(this.getHtmlElement())
};
DwtControl.prototype.setVisible=function(e){
if(!this._checkState()){
return
}
Dwt.setVisible(this.getHtmlElement(),e)
};
DwtControl.prototype.setVisibility=function(e){
if(!this._checkState()){
return
}
Dwt.setVisibility(this.getHtmlElement(),e)
};
DwtControl.prototype.getVisibility=function(){
if(!this._checkState()){
return
}
return Dwt.getVisibility(this.getHtmlElement())
};
DwtControl.prototype.getZIndex=function(e){
if(!this._checkState()){
return
}
return Dwt.getZIndex(this.getHtmlElement(),e)
};
DwtControl.prototype.setZIndex=function(e){
if(!this._checkState()){
return
}
Dwt.setZIndex(this.getHtmlElement(),e)
};
DwtControl.prototype.zShow=function(e){
this.setZIndex(e?Dwt.Z_VIEW:Dwt.Z_HIDDEN)
};
DwtControl.prototype.setDisplay=function(e){
if(!this._checkState()){
return
}
Dwt.setDisplay(this.getHtmlElement(),e)
};
DwtControl.prototype.setOpacity=function(e){
if(!this._checkState()){
return
}
Dwt.setOpacity(this.getHtmlElement(),e)
};
DwtControl.prototype.getOpacity=function(){
if(!this._checkState()){
return
}
return Dwt.getOpacity(this.getHtmlElement())
};
DwtControl.prototype.preventSelection=function(e){
return !this.__isInputEl(e)
};
DwtControl.prototype.preventContextMenu=function(e){
return e?(!this.__isInputEl(e)):true
};
DwtControl.prototype.getContent=function(){
return this.getHtmlElement().innerHTML
};
DwtControl.prototype.setContent=function(e){
if(e){
this.getHtmlElement().innerHTML=e
}};
DwtControl.prototype.clearContent=function(){
this.getHtmlElement().innerHTML=""
};
DwtControl.prototype.appendElement=function(t){
var e=AjxUtil.isString(t)?document.getElementById(t):t;
if(e){
e.appendChild(this.getHtmlElement(),e)
}};
DwtControl.prototype.replaceElement=function(i,e,o){
var t=AjxUtil.isString(i)?document.getElementById(i):i;
if(t){
var a=this.getHtmlElement();
t.parentNode.replaceChild(a,t);
this._replaceElementHook(t,a,e,o)
}};
DwtControl.prototype._replaceElementHook=function(a,o,t,r){
if((t==null||t)&&a.className){
Dwt.addClass(o,a.className)
}
if(r==null||r){
var i=a.getAttribute("style")||a.style;
if(i){
if(AjxUtil.isString(i)){
o.setAttribute("style",[o.getAttribute("style"),i].join(";"))
}else{
if(AjxUtil.isString(i.cssText)){
if(i.cssText){
o.setAttribute("style",[o.getAttribute("style"),i.cssText].join(";"))
}}else{
for(var n in i){
if(i[n]){
try{
o.style[n]=i[n]
}
catch(s){}}}}}}}};
DwtControl.prototype._blur=function(){};
DwtControl.prototype._focus=function(){};
DwtControl.prototype._focusByMouseUpEvent=function(e){
if(this.getEnabled()){
this.focus()
}};
DwtControl.prototype._focusByMouseDownEvent=function(e){
this._duringFocusByMouseDown=true;
this._focusByMouseUpEvent(e);
this._duringFocusByMouseDown=false
};
DwtControl.prototype._getDragOp=function(e){
return e.ctrlKey?Dwt.DND_DROP_COPY:Dwt.DND_DROP_MOVE
};
DwtControl.prototype._getDragProxy=function(e){
return null
};
DwtControl.prototype.getDragSelectionBox=function(e){
if(!this._dragSelectionBox){
var t=this._dragSelectionBox=document.createElement("div");
t.className="dndSelectionBox";
Dwt.setPosition(t,Dwt.ABSOLUTE_STYLE);
this.shell.getHtmlElement().appendChild(t);
Dwt.setZIndex(t,Dwt.Z_DND)
}
return this._dragSelectionBox
};
DwtControl.prototype._setDragProxyState=function(e){
if(this._dndProxy){
Dwt.condClass(this._dndProxy,e,DwtCssStyle.DROPPABLE,DwtCssStyle.NOT_DROPPABLE)
}};
DwtControl.__junkIconId=0;
DwtControl.prototype._destroyDragProxy=function(e){
if(e){
if(e.parentNode){
e.parentNode.removeChild(e)
}else{
e.style.zIndex=-100;
e.id="DwtJunkIcon"+DwtControl.__junkIconId++;
e=null
}}};
DwtControl.prototype.destroyDragSelectionBox=function(){
var e=this._dragSelectionBox;
if(e&&e.parentNode){
e.parentNode.removeChild(e)
}
this._dragSelectionBox=null
};
DwtControl.prototype._isValidDragObject=function(e){
return true
};
DwtControl.prototype._dragEnter=function(e){};
DwtControl.prototype._dragOver=function(e){};
DwtControl.prototype._dragHover=function(e){};
DwtControl.prototype._dragLeave=function(e){};
DwtControl.prototype._drop=function(e){};
DwtControl.prototype._makeFocusable=function(e){
if(!e){
e=this.getHtmlElement()
}
e.tabIndex=0;
this._setEventHdlrs(AjxUtil.keys(DwtControl.__HANDLER),true,e);
this._setEventHdlrs(AjxUtil.keys(DwtControl.__HANDLER),false,e)
};
DwtControl.prototype._setKeyPressEventHdlr=function(e,t){
this._setEventHdlrs([DwtEvent.ONKEYPRESS],e,t)
};
DwtControl.prototype._setMouseEventHdlrs=function(e,t){
this._setEventHdlrs(DwtEvent.MOUSE_EVENTS,e,t)
};
DwtControl.prototype._setKeyEventHdlrs=function(e,t){
this._setEventHdlrs(DwtEvent.KEY_EVENTS,e,t)
};
DwtControl.prototype._setEventHdlrs=function(o,e,a){
if(!this._checkState()){
return
}
var n=a||this.getHtmlElement();
for(var t=0;
t<o.length;
t++){
if(e!==true){
Dwt.setHandler(n,o[t],DwtControl.__HANDLER[o[t]])
}else{
Dwt.clearHandler(n,o[t])
}}};
DwtControl.prototype._setMouseEvents=function(){
var e=[DwtEvent.ONCONTEXTMENU,DwtEvent.ONCLICK,DwtEvent.ONDBLCLICK,DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEMOVE,DwtEvent.ONMOUSEUP,DwtEvent.ONSELECTSTART];
if(AjxEnv.isIE){
e.push(DwtEvent.ONMOUSEENTER,DwtEvent.ONMOUSELEAVE)
}else{
e.push(DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEOUT)
}
this._setEventHdlrs(e)
};
DwtControl.prototype._setMouseEvent=function(t,e){
t.reset();
e.ersatz=true;
DwtUiEvent.copy(t,e);
t.button=e.button
};
DwtControl.prototype._getStopPropagationValForMouseEv=function(e){
return true
};
DwtControl.prototype._getEventReturnValForMouseEv=function(e){
return false
};
DwtControl.prototype._checkState=function(){
if(this._disposed){
return false
}
if(!this.__ctrlInited){
this.__initCtrl()
}
return true
};
DwtControl.prototype._position=function(i){
this._checkState();
var a=this.shell.getSize();
var t=this.getSize();
var e,o;
if(!i){
e=Math.round((a.x-t.x)/2);
o=Math.round((a.y-t.y)/2)
}else{
e=i.x;
o=i.y
}
if((e+t.x)>a.x){
e=a.x-t.x
}
if((o+t.y)>a.y){
o=a.y-t.y
}
this.setLocation(e,o)
};
DwtControl._dndScrollCallback=function(a,s){
var t=a.container;
if(!t){
return
}
var c=s.dwtObj&&s.dwtObj._dndScrollId;
if(s.type=="mouseup"||!c||(a.id&&c!=a.id)){
if(t._dndScrollActionId!=-1){
AjxTimedAction.cancelAction(t._dndScrollActionId);
t._dndScrollActionId=-1
}
return
}
t._scrollAmt=0;
if(t.clientHeight<t.scrollHeight){
var i=Dwt.toWindow(t,0,0,null,null,DwtPoint.tmp).y;
var d=i+t.scrollTop;
var r=t.scrollTop;
var h=s.docY-d;
var o=(t.clientWidth<t.scrollWidth)?a.threshold+Dwt.SCROLLBAR_WIDTH:a.threshold;
var n=(h<=o)?-1*a.amount:0;
if(n==0){
var e=Dwt.getSize(t,DwtPoint.tmp).y;
var l=d+e;
h=l-s.docY;
n=(h<=o)?a.amount:0
}
t._scrollAmt=n;
if(n){
if(!t._dndScrollAction){
t._dndScrollAction=new AjxTimedAction(null,DwtControl._dndScroll,[a]);
t._dndScrollActionId=-1
}
if(t._dndScrollActionId==-1){
t._dndScrollActionId=AjxTimedAction.scheduleAction(t._dndScrollAction,0)
}}else{
if(t._dndScrollActionId!=-1){
AjxTimedAction.cancelAction(t._dndScrollActionId);
t._dndScrollActionId=-1
}}}};
DwtControl._dndScroll=function(o){
var t=o.container;
var i=Dwt.toWindow(t,0,0,null,null,DwtPoint.tmp).y;
var a=Dwt.getSize(t,DwtPoint.tmp).y;
var e=t.scrollTop;
if((t._scrollAmt<0&&e>0)||(t._scrollAmt>0&&(e+a<t.scrollHeight))){
t.scrollTop+=t._scrollAmt;
t._dndScrollActionId=AjxTimedAction.scheduleAction(t._dndScrollAction,o.interval)
}};
DwtControl.__keyPressHdlr=function(a){
var i=i?i:DwtControl.getTargetControl(a);
if(!i){
return false
}
if(i.__hasToolTipContent()){
var t=DwtShell.getShell(window);
var e=t.getHoverMgr();
e.setHoverOutListener(i._hoverOutListener);
e.hoverOut();
i.__tooltipClosed=false
}};
DwtControl.__keyUpHdlr=function(e){
return DwtKeyboardMgr.__keyUpHdlr.apply(this,arguments);
var t=t?t:DwtControl.getTargetControl(e);
if(!t){
return false
}};
DwtControl.__keyDownHdlr=function(e){
return DwtKeyboardMgr.__keyDownHdlr.apply(this,arguments);
var t=t?t:DwtControl.getTargetControl(e);
if(!t){
return false
}};
DwtControl.__focusHdlr=function(e){
var t=t?t:DwtControl.getTargetControl(e);
if(!t){
return false
}
t.__doFocus(e)
};
DwtControl.__blurHdlr=function(e){
var t=t?t:DwtControl.getTargetControl(e);
if(!t){
return false
}
t.__doBlur(e)
};
DwtControl.prototype.__hasToolTipContent=function(){
if(this._disposed){
return false
}
return Boolean(!this._browserToolTip&&(this.__toolTipContent||(this.getToolTipContent!=DwtControl.prototype.getToolTipContent)))
};
DwtControl.prototype.__doBlur=function(e){
if(!this._checkState()){
return
}
this._hasFocus=false;
if(this.isListenerRegistered(DwtEvent.ONBLUR)){
if(!e){
e=DwtShell.focusEvent
}
e.dwtObj=this;
e.state=DwtFocusEvent.BLUR;
this.notifyListeners(DwtEvent.ONBLUR,e)
}
this._blur()
};
DwtControl.prototype.__doFocus=function(e){
if(!this._checkState()){
return
}
this._hasFocus=true;
if(this.isFocusable){
this.getHtmlElement().focus()
}
if(this.isListenerRegistered(DwtEvent.ONFOCUS)){
if(!e){
e=DwtShell.focusEvent
}
e.dwtObj=this;
e.state=DwtFocusEvent.FOCUS;
this.notifyListeners(DwtEvent.ONFOCUS,e)
}
this._focus()
};
DwtControl.__clickHdlr=function(t){
var a=DwtControl.getTargetControl(t);
if(a&&a._clickPending){
return
}
try{
return DwtControl.__mouseEvent(t,DwtEvent.ONCLICK)
}
catch(e){
AjxException.reportScriptError(e)
}};
DwtControl.__dblClickHdlr=function(t){
try{
var a=DwtControl.getTargetControl(t);
if(a&&a._dblClickIsolation){
a._clickPending=false;
AjxTimedAction.cancelAction(a._dblClickActionId)
}
return DwtControl.__mouseEvent(t,DwtEvent.ONDBLCLICK)
}
catch(e){
AjxException.reportScriptError(e)
}};
DwtControl.__mouseOverHdlr=function(n,s){
try{
var a=(DwtMouseEventCapture.getId()=="DwtControl")?DwtMouseEventCapture.getCaptureObj():null;
if(a!=null){
n=DwtUiEvent.getEvent(n);
n._stopPropagation=true;
return false
}
var t=DwtControl.getTargetControl(n);
if(!t){
return false
}
s=s||DwtEvent.ONMOUSEOVER;
if((s==DwtEvent.ONMOUSEOVER)&&t._ignoreInternalOverOut){
var h=DwtControl.getTargetControl(n,true);
if(t==h){
return false
}}
var r=DwtShell.mouseEvent;
if(t._dragging==DwtControl._NO_DRAG){
r.setFromDhtmlEvent(n,t);
r.hoverStarted=false;
if(t.isListenerRegistered(s)){
t.notifyListeners(s,r)
}
if(t.__hasToolTipContent(r)&&!r.hoverStarted){
var i=DwtShell.getShell(window);
var e=i.getHoverMgr();
if((!e.isHovering()||e.getHoverObject()!=t)&&!DwtMenu.menuShowing()){
e.reset();
e.setHoverObject(t);
e.setHoverOverData(r);
e.setHoverOverDelay(DwtToolTip.TOOLTIP_DELAY);
e.setHoverOverListener(t._hoverOverListener);
e.hoverOver(r.docX,r.docY)
}}}
r._stopPropagation=true;
r._returnValue=false;
r.setToDhtmlEvent(n);
return false
}
catch(o){
AjxException.reportScriptError(o)
}};
DwtControl.__mouseEnterHdlr=function(e){
return DwtControl.__mouseOverHdlr(e,DwtEvent.ONMOUSEENTER)
};
DwtControl.__mouseDownHdlr=function(o){
try{
var n=DwtControl.getTargetControl(o);
if(!n){
return false
}
o=DwtUiEvent.getEvent(o);
var i=DwtShell.mouseEvent;
i.setFromDhtmlEvent(o,n);
if(i.button==DwtMouseEvent.LEFT){
n._focusByMouseDownEvent(o);
i.setFromDhtmlEvent(o,n)
}
if(n.__hasToolTipContent()){
var a=DwtShell.getShell(window);
var t=a.getHoverMgr();
t.setHoverOutListener(n._hoverOutListener);
t.hoverOut()
}
if(n._dragSource&&(i.button==DwtMouseEvent.LEFT)&&n._isValidDragObject(i)){
try{
n._ctrlCaptureObj.capture()
}
catch(e){}
n._dragOp=n._getDragOp(i);
n.__dragStartX=i.docX;
n.__dragStartY=i.docY
}else{
if(n._dragBox){
if(n._dragBox._setStart(i,n)){
try{
n._ctrlCaptureObj.capture()
}
catch(e){}}}}
return DwtControl.__mouseEvent(o,DwtEvent.ONMOUSEDOWN,n,i)
}
catch(e){
AjxException.reportScriptError(e)
}};
DwtControl.__mouseMoveHdlr=function(u){
try{
var s=(DwtMouseEventCapture.getId()=="DwtControl")?DwtMouseEventCapture.getCaptureObj():null;
var n=s?s.targetObj:DwtControl.getTargetControl(u);
if(!n){
return false
}
if(n.__dndHoverActionId!=-1){
AjxTimedAction.cancelAction(n.__dndHoverActionId);
n.__dndHoverActionId=-1
}
var m=DwtShell.mouseEvent;
m.setFromDhtmlEvent(u,s?true:n);
if(m.docX<0||m.docY<0){
m._stopPropagation=true;
m._returnValue=false;
m.setToDhtmlEvent(u);
return false
}
var c=(n._dragSource&&s&&(Math.abs(n.__dragStartX-m.docX)>=DwtControl.__DRAG_THRESHOLD||Math.abs(n.__dragStartY-m.docY)>=DwtControl.__DRAG_THRESHOLD));
var f=(s&&n._dragBox&&n._dragBox._dragObj==n);
if(!c&&!f){
if(n.__hasToolTipContent()){
var h=DwtShell.getShell(window);
var a=h.getHoverMgr();
if(!n.__tooltipClosed&&!DwtMenu.menuShowing()){
a.hoverOver(m.docX,m.docY)
}else{
var i=n.__lastTooltipX?Math.abs(m.docX-n.__lastTooltipX):null;
var t=n.__lastTooltipY?Math.abs(m.docY-n.__lastTooltipY):null;
if((i!=null&&i>DwtControl.__TOOLTIP_THRESHOLD)||(t!=null&&t>DwtControl.__TOOLTIP_THRESHOLD)){
a.setHoverOutListener(n._hoverOutListener);
a.hoverOut();
n.__tooltipClosed=true
}}}
return DwtControl.__mouseEvent(u,DwtEvent.ONMOUSEMOVE,n,m)
}else{
if(n._dragging==DwtControl._NO_DRAG){
if(n._dragSource){
n._dragOp=n._dragSource._beginDrag(n._dragOp,n);
if(n._dragOp!=Dwt.DND_DROP_NONE){
n._dragging=DwtControl._DRAGGING;
n._dndProxy=n._getDragProxy(n._dragOp);
Dwt.addClass(n._dndProxy,"DwtDragProxy");
if(!n._dndProxy){
n._dragging=DwtControl._DRAG_REJECTED
}}else{
n._dragging=DwtControl._DRAG_REJECTED
}}else{
if(n._dragBox){
n._dragging=DwtControl._DRAGGING;
n._dragBox._beginDrag(n)
}}}
if(n._dragging!=DwtControl._DRAG_REJECTED){
var l=m.dwtObj;
if(n._dragSource){
var e=l&&l._dropTarget;
var p=n.__lastTargetObj;
if(l){
n._dndHoverAction.args=[l];
n.__dndHoverActionId=AjxTimedAction.scheduleAction(n._dndHoverAction,DwtControl.__DND_HOVER_DELAY)
}
if(l&&e&&((l!=n)||e.hasMultipleTargets())){
if(l!=p||e.hasMultipleTargets()){
var o=n._dragSource._getData();
if(e._dragEnter(n._dragOp,l,o,m,n._dndProxy)){
n._setDragProxyState(true);
n.__dropAllowed=true;
l._dragEnter(m)
}else{
n._setDragProxyState(false);
n.__dropAllowed=false
}}else{
if(n.__dropAllowed){
l._dragOver(m)
}}}else{
n._setDragProxyState(false)
}
if(p&&p!=l&&p._dropTarget&&p!=n){
if(l&&!l._dndScrollCallback&&p._dndScrollCallback){
p._dndScrollCallback.run(m)
}
p._dragLeave(m);
p._dropTarget._dragLeave()
}
n.__lastTargetObj=l;
if((l!=n)&&l&&l._dndScrollCallback){
l._dndScrollCallback.run(m)
}
Dwt.setLocation(n._dndProxy,m.docX+2,m.docY+2)
}else{
if(n._dragBox){
var r=DwtUiEvent.getTarget(u);
if(l&&(Dwt.isAncestor(n.getHtmlElement(),r)||r==n._dragSelectionBox)){
n._dragBox._dragMove(m,n)
}}}}else{
DwtControl.__mouseEvent(u,DwtEvent.ONMOUSEMOVE,n,m)
}
m._stopPropagation=true;
m._returnValue=false;
m.setToDhtmlEvent(u);
return false
}}
catch(d){
AjxException.reportScriptError(d)
}};
DwtControl.__mouseUpHdlr=function(i){
try{
var n=(DwtMouseEventCapture.getId()=="DwtControl")?DwtMouseEventCapture.getCaptureObj():null;
var o=n?n.targetObj:DwtControl.getTargetControl(i);
if(!o){
return false
}
if(o.__dndHoverActionId!=-1){
AjxTimedAction.cancelAction(o.__dndHoverActionId);
o.__dndHoverActionId=-1
}
var a=DwtShell.mouseEvent;
a.setFromDhtmlEvent(i,n?true:o);
if(!(n&&(o._dragSource||o._dragBox))){
return DwtControl.__processMouseUpEvent(i,o,a)
}else{
n.release();
if(o._dragging!=DwtControl._DRAGGING){
o._dragging=DwtControl._NO_DRAG;
return DwtControl.__processMouseUpEvent(i,o,a)
}
if(o._dragSource){
o.__lastTargetObj=null;
var t=a.dwtObj;
var s=t&&t._dropTarget;
if(t&&s&&o.__dropAllowed&&((t!=o)||s.hasMultipleTargets())){
t._drop(a);
s._drop(o._dragSource._getData(),a);
o._dragSource._endDrag();
o._destroyDragProxy(o._dndProxy);
o._dragging=DwtControl._NO_DRAG
}else{
DwtControl.__badDrop(o,a)
}
if(t&&t._dndScrollCallback){
t._dndScrollCallback.run(a)
}}else{
if(o._dragBox){
o._dragBox._endDrag(o)
}}
a._stopPropagation=true;
a._returnValue=false;
a.setToDhtmlEvent(i);
return false
}}
catch(e){
AjxException.reportScriptError(e)
}};
DwtControl.__badDrop=function(i,a){
if(i._dragSource){
i._dragSource._cancelDrag()
}
var t=a.dwtObj;
if(t){
t._drop(a)
}
i.__dragEndX=a.docX;
i.__dragEndY=a.docY;
if(i.__badDropAction==null){
i.__badDropAction=new AjxTimedAction(i,i.__badDropEffect)
}
var e=(i.__dragEndY-i.__dragStartY)/(i.__dragEndX-i.__dragStartX);
i.__badDropAction.args=[e,i.__dragStartY-(e*i.__dragStartX),(i.__dragStartX-i.__dragEndX<0)?-1:1];
AjxTimedAction.scheduleAction(i.__badDropAction,0)
};
DwtControl.__processMouseUpEvent=function(i,n,a){
var t=DwtShell.getShell(window);
var o=t.getHoverMgr();
o.ignoreHoverOverOnClick();
if(n._dblClickIsolation&&a&&(a.button==DwtMouseEvent.LEFT)){
if(n._clickPending){
return false
}else{
n._clickPending=true;
var e=new AjxTimedAction(null,DwtControl.__timedClick,[i,n,a]);
n._dblClickActionId=AjxTimedAction.scheduleAction(e,DwtControl.__DBL_CLICK_TIMEOUT);
DwtUiEvent.setBehaviour(i,true,false);
n._st=new Date();
return false
}}else{
n._clickPending=false;
return DwtControl.__mouseEvent(i,DwtEvent.ONMOUSEUP,n,a)
}};
DwtControl.__timedClick=function(t,a,e){
a._clickPending=false;
DwtControl.__mouseEvent(t,DwtEvent.ONMOUSEUP,a,e)
};
DwtControl.__mouseOutHdlr=function(n,o){
try{
var s=DwtControl.getTargetControl(n);
if(!s){
return false
}
o=o||DwtEvent.ONMOUSEOUT;
if((o==DwtEvent.ONMOUSEOUT)&&s._ignoreInternalOverOut){
var e=DwtControl.getTargetControl(n,true);
if(s==e){
return false
}}
if(s.__hasToolTipContent()){
var i=DwtShell.getShell(window);
var a=i.getHoverMgr();
a.setHoverOutListener(s._hoverOutListener);
a.hoverOut();
s.__tooltipClosed=false
}
return DwtControl.__mouseEvent(n,o||DwtEvent.ONMOUSEOUT,s)
}
catch(t){
AjxException.reportScriptError(t)
}};
DwtControl.__mouseLeaveHdlr=function(e){
return DwtControl.__mouseOutHdlr(e,DwtEvent.ONMOUSELEAVE)
};
DwtControl.__mouseWheelHdlr=function(t){
try{
return DwtControl.__mouseEvent(t,DwtEvent.ONMOUSEWHEEL)
}
catch(e){
AjxException.reportScriptError(e)
}};
DwtControl.__selectStartHdlr=function(t){
try{
return DwtControl.__mouseEvent(t,DwtEvent.ONSELECTSTART)
}
catch(e){
AjxException.reportScriptError(e)
}};
DwtControl.__contextMenuHdlr=function(a){
try{
if(AjxEnv.isSafari){
var i=DwtControl.getTargetControl(a);
var e=i?i.preventContextMenu():true;
if(e){
DwtControl.__mouseEvent(a,DwtEvent.ONMOUSEDOWN);
return DwtControl.__mouseEvent(a,DwtEvent.ONMOUSEUP)
}}
return DwtControl.__mouseEvent(a,DwtEvent.ONCONTEXTMENU)
}
catch(t){
AjxException.reportScriptError(t)
}};
DwtControl.__mouseEvent=function(o,a,n,i){
var n=n?n:DwtControl.getTargetControl(o);
if(!n){
return false
}
if(!i){
i=DwtShell.mouseEvent;
i.setFromDhtmlEvent(o,n)
}
var t=i.target.tagName&&i.target.tagName.toLowerCase();
var e=n._propagateEvent[a]||(t==="input"||t==="textarea"||t==="a");
i._stopPropagation=!e;
i._dontCallPreventDefault=e;
i._returnValue=e;
DwtEventManager.notifyListeners(a,i);
if(n.isListenerRegistered&&n.isListenerRegistered(a)){
n.notifyListeners(a,i)
}
i.setToDhtmlEvent(o);
if(a==DwtEvent.ONMOUSELEAVE||a==DwtEvent.ONMOUSEOUT){
n.__ignoreNextClick=false
}else{
if(a==DwtEvent.ONMOUSEUP){
n.__ignoreNextClick=true
}else{
if(a==DwtEvent.ONCLICK){
if(n.__ignoreNextClick){
DBG.println(AjxDebug.ACCESSIBILITY,"DwtControl: ignoring a click!");
n.__ignoreNextClick=false;
return true
}
if(n.isListenerRegistered&&!n.isListenerRegistered(DwtEvent.ONCLICK)){
DBG.println(AjxDebug.ACCESSIBILITY,"DwtControl: faking a click!");
a=DwtEvent.ONMOUSEDOWN;
if(o){
o.type=a
}
DwtControl.__mouseEvent(o,a,n,DwtShell.mouseEvent);
a=DwtEvent.ONMOUSEUP;
if(o){
o.type=a
}
DwtControl.__mouseEvent(o,a,n,DwtShell.mouseEvent);
return DwtShell.mouseEvent._returnValue
}else{
DBG.println(AjxDebug.ACCESSIBILITY,"DwtControl: skipping a click!");
window.console&&console.warn("skipping a click!")
}}}}
return i._returnValue
};
DwtControl.__HANDLER={};
DwtControl.__HANDLER[DwtEvent.ONCONTEXTMENU]=DwtControl.__contextMenuHdlr;
DwtControl.__HANDLER[DwtEvent.ONCLICK]=DwtControl.__clickHdlr;
DwtControl.__HANDLER[DwtEvent.ONDBLCLICK]=DwtControl.__dblClickHdlr;
DwtControl.__HANDLER[DwtEvent.ONMOUSEDOWN]=DwtControl.__mouseDownHdlr;
DwtControl.__HANDLER[DwtEvent.ONMOUSEENTER]=DwtControl.__mouseEnterHdlr;
DwtControl.__HANDLER[DwtEvent.ONMOUSELEAVE]=DwtControl.__mouseLeaveHdlr;
DwtControl.__HANDLER[DwtEvent.ONMOUSEMOVE]=DwtControl.__mouseMoveHdlr;
DwtControl.__HANDLER[DwtEvent.ONMOUSEOUT]=DwtControl.__mouseOutHdlr;
DwtControl.__HANDLER[DwtEvent.ONMOUSEOVER]=DwtControl.__mouseOverHdlr;
DwtControl.__HANDLER[DwtEvent.ONMOUSEUP]=DwtControl.__mouseUpHdlr;
DwtControl.__HANDLER[DwtEvent.ONMOUSEWHEEL]=DwtControl.__mouseWheelHdlr;
DwtControl.__HANDLER[DwtEvent.ONSELECTSTART]=DwtControl.__selectStartHdlr;
DwtControl.__HANDLER[DwtEvent.ONKEYPRESS]=DwtControl.__keyPressHdlr;
DwtControl.__HANDLER[DwtEvent.ONKEYUP]=DwtControl.__keyUpHdlr;
DwtControl.__HANDLER[DwtEvent.ONKEYDOWN]=DwtControl.__keyDownHdlr;
DwtControl.__HANDLER[DwtEvent.ONFOCUS]=DwtControl.__focusHdlr;
DwtControl.__HANDLER[DwtEvent.ONBLUR]=DwtControl.__blurHdlr;
DwtControl.prototype.__initCtrl=function(){
this.shell=this.parent.shell||this.parent;
this._htmlElId=this.__internalId=this._htmlElId||Dwt.getNextId();
var e=this._elRef=this._createElement(this._htmlElId);
e.id=this._htmlElId;
if(DwtControl.ALL_BY_ID){
if(DwtControl.ALL_BY_ID[this._htmlElId]){
this._htmlElId=e.id=this.__internalId=DwtId.makeId(this._htmlElId,Dwt.getNextId())
}
DwtControl.ALL_BY_ID[this._htmlElId]=this
}
DwtComposite._pendingElements[this._htmlElId]=e;
e.style.position=this.__posStyle||DwtControl.STATIC_STYLE;
e.className=this._className;
e.style.overflow="visible";
if(this.role){
e.setAttribute("role",this.role)
}
this._enabled=true;
this.__controlEvent=DwtControl.__controlEvent;
this._dragging=DwtControl._NO_DRAG;
this.__ctrlInited=true;
if(this.isFocusable){
this._makeFocusable(e)
}
this.parent.addChild(this,this.__index)
};
DwtControl.prototype._createElement=function(e){
return document.createElement("DIV")
};
DwtControl.prototype.__dndDoHover=function(e){
e._dragHover()
};
DwtControl.prototype.__badDropEffect=function(e,o,a){
var t=(Math.abs(e)<=1);
var i=t?this.__dragStartX-this.__dragEndX:this.__dragStartY-this.__dragEndY;
if(i*a>0&&!(this.__dragEndY==this.__dragStartY||this.__dragEndX==this.__dragStartX)){
if(t){
this.__dragEndX+=(30*a);
this._dndProxy.style.top=e*this.__dragEndX+o;
this._dndProxy.style.left=this.__dragEndX
}else{
this.__dragEndY+=(30*a);
this._dndProxy.style.top=this.__dragEndY;
this._dndProxy.style.left=(this.__dragEndY-o)/e
}
AjxTimedAction.scheduleAction(this.__badDropAction,0)
}else{
this._destroyDragProxy(this._dndProxy);
this._dragging=DwtControl._NO_DRAG
}};
DwtControl.prototype.__handleHoverOver=function(i){
if(this._eventMgr.isListenerRegistered(DwtEvent.HOVEROVER)){
this._eventMgr.notifyListeners(DwtEvent.HOVEROVER,i)
}
var a=i&&i.object;
var o=this.getToolTipContent(a);
var t,n;
if(!o){
t=""
}else{
if(typeof(o)=="string"){
t=o
}else{
if(o.isAjxCallback||AjxUtil.isFunction(o)){
n=o
}else{
if(typeof(o)=="object"){
t=o.content;
n=o.callback
}}}}
if(!t&&n&&o.loading){
t=AjxMsg.loading
}
if(t){
this.__showToolTip(i,t)
}
if(n){
var e=new AjxCallback(this,this.__showToolTip,[i]);
AjxTimedAction.scheduleAction(new AjxTimedAction(null,function(){
n.run(e)
}
),0)
}};
DwtControl.prototype.__showToolTip=function(t,e){
if(!e){
return
}
DwtControl.showToolTip(e,t.x,t.y,this,t);
this.__lastTooltipX=t.x;
this.__lastTooltipY=t.y;
this.__tooltipClosed=false
};
DwtControl.prototype.__handleHoverOut=function(e){
if(this._eventMgr.isListenerRegistered(DwtEvent.HOVEROUT)){
this._eventMgr.notifyListeners(DwtEvent.HOVEROUT,e)
}
DwtControl.hideToolTip();
this.__lastTooltipX=null;
this.__lastTooltipY=null
};
DwtControl.prototype.__isInputEl=function(a){
var i=false;
if(!a||!a.tagName){
return i
}
var e=a.tagName.toLowerCase();
var t=e=="input"?a.type.toLowerCase():null;
if(e=="textarea"||(t&&(t=="text"||t=="password"))){
i=true
}
return i
};
DwtControl.ON_UNLOAD=function(){
var t=DwtControl.ALL_BY_ID,e;
for(e in t){
t[e]._elRef=null
}
DwtControl.ALL_BY_ID=null
};
if(window.attachEvent){
window.attachEvent("onunload",DwtControl.ON_UNLOAD)
}else{
if(window.addEventListener){
window.addEventListener("unload",DwtControl.ON_UNLOAD,false)
}}
DwtControl.showToolTip=function(t,e,n,i,o){
if(!t){
return
}
var a=DwtShell.getShell(window).getToolTip();
a.setContent(t);
a.popup(e,n,false,false,i,o)
};
DwtControl.hideToolTip=function(){
DwtShell.getShell(window).getToolTip().popdown()
};
DwtControl.prototype.getTooltipBase=function(e){
return this.getHtmlElement()
};
DwtControl.prototype.boundsForChild=function(a){
if(a&&a.getHtmlElement){
a=a.getHtmlElement()
}
var e=function(o,i){
var n=Dwt.getMargins(i);
var o=Dwt.insetBounds(o,Dwt.getInsets(i));
o.width=Math.max(o.width-n.left-n.right,0);
o.height=Math.max(o.height-n.top-n.bottom,0);
return o
};
var t=new DwtRectangle(0,0,this.getHtmlElement().clientWidth,this.getHtmlElement().clientHeight);
return AjxUtil.reduce(Dwt.getAncestors(a,this.getHtmlElement(),true),e,t)
};
DwtControl.prototype.hasAttribute=function(e){
return this.getHtmlElement().hasAttribute(e)
};
DwtControl.prototype.getAttribute=function(e){
return this.getHtmlElement().getAttribute(e)
};
DwtControl.prototype.setAttribute=function(e,t){
this.getHtmlElement().setAttribute(e,t)
};
DwtControl.prototype.removeAttribute=function(e){
this.getHtmlElement().removeAttribute(e)
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtComposite")){
DwtComposite=function(e){
if(arguments.length==0){
return
}
e=Dwt.getParams(arguments,DwtComposite.PARAMS);
e.className=e.className||"DwtComposite";
DwtControl.call(this,e);
this._compositeTabGroup=new DwtTabGroup(Dwt.getNextId("DwtCompositeTabGroup"));
this._children=new AjxVector()
};
DwtComposite.PARAMS=DwtControl.PARAMS.concat();
DwtComposite.prototype=new DwtControl;
DwtComposite.prototype.constructor=DwtComposite;
DwtComposite.prototype.isDwtComposite=true;
DwtComposite.prototype.toString=function(){
return"DwtComposite"
};
DwtComposite._pendingElements=new Object();
DwtComposite.prototype.dispose=function(){
if(this._disposed){
return
}
var e=this._children.getArray();
while(e.length>0){
e.pop().dispose()
}
if(this._compositeTabGroup){
this._compositeTabGroup.removeAllMembers()
}
this._compositeTabGroup=null;
DwtControl.prototype.dispose.call(this)
};
DwtComposite.prototype.getChildren=function(){
return this._children.getArray().slice(0)
};
DwtComposite.prototype.cleanupSeparators=function(){
var t=this.getChildren();
var a=true;
var n;
for(var o=0;
o<t.length;
o++){
var s=t[o];
var e=s.isStyle&&s.isStyle(DwtMenuItem.SEPARATOR_STYLE);
if(e){
s.setVisible(!a);
if(!a||!n){
a=true;
n=s
}
continue
}
if(s.getVisible()){
a=false
}}
if(a&&n){
n.setVisible(false)
}};
DwtComposite.prototype.getNumChildren=function(){
return this._children.size()
};
DwtComposite.prototype.removeChildren=function(){
var e=this._children.getArray();
while(e.length>0){
e[0].dispose()
}
if(this._compositeTabGroup){
this._compositeTabGroup.removeAllMembers()
}};
DwtComposite.prototype.clear=function(){
this.removeChildren();
this.getHtmlElement().innerHTML=""
};
DwtComposite.prototype.addChild=function(a,e){
this._children.add(a,e);
this._compositeTabGroup.addMember(a,e);
var t=a.getHtmlElement();
t.setAttribute("parentId",this._htmlElId);
if(this instanceof DwtShell&&this.isVirtual()){
document.body.appendChild(t)
}else{
a.reparentHtmlElement(a.__parentElement||this.getHtmlElement(),e);
a.__parentElement=null
}};
DwtComposite.prototype.removeChild=function(a){
if(a.isInitialized()){
this._children.remove(a);
this._compositeTabGroup.removeMember(a);
var t=a.getHtmlElement();
if(t){
t.removeAttribute("parentId");
if(t.parentNode){
var e=t.parentNode.removeChild(t)
}}}};
DwtComposite.prototype.getTabGroupMember=function(){
return this._compositeTabGroup
};
DwtComposite.prototype._setAllowSelection=function(){
if(!this._allowSelection){
this._allowSelection=true;
this.addListener(DwtEvent.ONMOUSEDOWN,new AjxListener(this,this._mouseDownListener));
this.addListener(DwtEvent.ONCONTEXTMENU,new AjxListener(this,this._contextMenuListener))
}};
DwtComposite.prototype.preventSelection=function(e){
return this._allowSelection?false:DwtControl.prototype.preventSelection.call(this,e)
};
DwtComposite.prototype.preventContextMenu=function(a){
if(!this._allowSelection){
return DwtControl.prototype.preventContextMenu.apply(this,arguments)
}
var e=a?(a.id.indexOf("OBJ_")==0):false;
var t=false;
if(document.selection){
t=document.selection.type=="Text"
}else{
if(getSelection()){
t=getSelection().toString().length>0
}}
return(t&&!e)?false:true
};
DwtComposite.prototype._focusByMouseUpEvent=function(){
if(!this._allowSelection){
DwtControl.prototype._focusByMouseUpEvent.apply(this,arguments)
}};
DwtComposite.prototype._mouseDownListener=function(e){
if(e.button==DwtMouseEvent.LEFT){
e._stopPropagation=true;
e._returnValue=true
}};
DwtComposite.prototype._contextMenuListener=function(e){
e._stopPropagation=false;
e._returnValue=true
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtShell")){
DwtShell=function(o){
if(window._dwtShellId){
throw new DwtException("DwtShell already exists for window",DwtException.INVALID_OP,"DwtShell")
}
var a=o.className||"DwtShell";
DwtComposite.call(this,{
className:a}
);
this.__ctrlInited=true;
document.body.style.margin=0;
if(!o.docBodyScrollable){
if(AjxEnv.isIE){
document.body.onscroll=DwtShell.__onBodyScroll
}
document.body.style.overflow="hidden"
}
document.body.onselect=DwtShell._preventDefaultSelectPrt;
document.body.onselectstart=DwtShell._preventDefaultSelectPrt;
document.body.oncontextmenu=DwtShell._preventDefaultPrt;
window.onresize=DwtShell._resizeHdlr;
var i=document.createElement("div");
this._htmlElId=window._dwtShellId=i.id=o.id||Dwt.getNextId();
DwtControl.ALL_BY_ID[this._htmlElId]=this;
i.className=a;
i.style.width=i.style.height="100%";
Dwt.setPosition(i,DwtControl.ABSOLUTE_STYLE);
if(i.style.overflow){
i.style.overflow=null
}
try{
if(o.userShell){
document.body.removeChild(o.userShell)
}}
catch(t){}
document.body.appendChild(i);
if(o.userShell){
var e=new DwtControl({
parent:this,posStyle:Dwt.ABSOLUTE_STYLE}
);
e.getHtmlElement().appendChild(o.userShell);
e.setSize("100%","100%");
e.zShow(true);
this._userShell=o.userShell
}else{
this._userShell=null
}
this.shell=this;
this._createBusyOverlay(i);
this._veilOverlay=document.createElement("div");
this._veilOverlay.className=(!AjxEnv.isLinux)?"VeilOverlay":"VeilOverlay-linux";
this._veilOverlay.style.position="absolute";
this._veilOverlay.style.cursor=AjxEnv.isIE6up?"not-allowed":"wait";
Dwt.setBounds(this._veilOverlay,0,0,"100%","100%");
Dwt.setZIndex(this._veilOverlay,Dwt.Z_HIDDEN);
this._veilOverlay.veilZ=new Array();
this._veilOverlay.veilZ.push(Dwt.Z_HIDDEN);
this._veilOverlay.dialogZ=new Array();
this._veilOverlay.activeDialogs=new Array();
this._veilOverlay.innerHTML="<table cellspacing=0 cellpadding=0 style='width:100%; height:100%'><tr><td>&nbsp;</td></tr></table>";
i.appendChild(this._veilOverlay);
if(o.useCurtain){
this._curtainOverlay=document.createElement("div");
this._curtainOverlay.className="CurtainOverlay";
this._curtainOverlay.style.position="absolute";
Dwt.setBounds(this._curtainOverlay,0,0,"100%","100%");
Dwt.setZIndex(this._curtainOverlay,Dwt.Z_CURTAIN);
this._curtainOverlay.innerHTML="<table cellspacing=0 cellpadding=0 style='width:100%; height:100%'><tr><td>&nbsp;</td></tr></table>";
i.appendChild(this._curtainOverlay)
}
this._uiEvent=new DwtUiEvent(true);
this.relayout();
this._toolTip=new DwtToolTip(this);
this._hoverMgr=new DwtHoverMgr();
this._keyboardMgr=new DwtKeyboardMgr(this)
};
DwtShell.prototype=new DwtComposite;
DwtShell.prototype.constructor=DwtShell;
DwtShell.CANCEL_BUTTON=-1;
DwtShell.controlEvent=new DwtControlEvent();
DwtShell.focusEvent=new DwtFocusEvent();
DwtShell.keyEvent=new DwtKeyEvent();
DwtShell.mouseEvent=new DwtMouseEvent();
DwtShell.selectionEvent=new DwtSelectionEvent(true);
DwtShell.treeEvent=new DwtTreeEvent();
DwtShell._GLOBAL_SELECTION="GlobalSelection";
DwtShell.prototype.toString=function(){
return"DwtShell"
};
DwtShell.getShell=function(e){
return DwtControl.fromElementId(e._dwtShellId)
};
DwtShell.prototype.getKeyboardMgr=function(){
return this._keyboardMgr
};
DwtShell.prototype.setBusy=function(i,o,t,a,e){
if(i){
this._setBusyCount++
}else{
if(this._setBusyCount>0){
this._setBusyCount--
}}
if(!this._setBusy&&(this._setBusyCount>0)){
Dwt.setCursor(this._busyOverlay,"wait");
Dwt.setVisible(this._busyOverlay,true);
this._setBusy=this._blockInput=true
}else{
if(this._setBusy&&(this._setBusyCount<=0)){
Dwt.setCursor(this._busyOverlay,"default");
Dwt.setVisible(this._busyOverlay,false);
this._setBusy=this._blockInput=false
}}
if(i&&t){
if(a&&a>0){
this._busyActionId[o]=AjxTimedAction.scheduleAction(this._busyTimedAction,a)
}else{
this._showBusyDialogAction(o)
}
this._cancelBusyCallback=e;
if(this._busyDialog){
this._busyDialog.setButtonEnabled(DwtShell.CANCEL_BUTTON,(e!=null))
}}else{
if(this._busyActionId[o]&&(this._busyActionId[o]!=-1)){
AjxTimedAction.cancelAction(this._busyActionId[o]);
this._busyActionId[o]=-1
}
if(this._busyDialog&&this._busyDialog.isPoppedUp){
this._busyDialog.popdown()
}}};
DwtShell.prototype.getBusy=function(){
return this._setBusy
};
DwtShell.prototype.setBusyDialogText=function(e){
this._busyDialogText=e;
if(this._busyDialogTxt){
this._busyDialogTxt.innerHTML=(e)?e:""
}};
DwtShell.prototype.setBusyDialogTitle=function(e){
this._busyDialogTitle=e;
if(this._busyDialog){
this._busyDialog.setTitle((e)?e:AjxMsg.workInProgress)
}};
DwtShell.prototype.getHoverMgr=function(){
return this._hoverMgr
};
DwtShell.prototype.getToolTip=function(){
return this._toolTip
};
DwtShell.prototype.getH=function(e){
return(!this._virtual)?Dwt.getSize(this.getHtmlElement(),e).y:Dwt.getSize(document.body,e).y
};
DwtShell.prototype.getW=function(e){
return(!this._virtual)?Dwt.getSize(this.getHtmlElement(),e).x:Dwt.getSize(document.body,e).x
};
DwtShell.prototype.getSize=function(e){
return(!this._virtual)?Dwt.getSize(this.getHtmlElement(),e):Dwt.getSize(document.body,e)
};
DwtShell.prototype.getLocation=function(){
return(!this._virtual)?Dwt.getLocation(this.getHtmlElement()):Dwt.getLocation(document.body)
};
DwtShell.prototype.getX=function(){
return(!this._virtual)?Dwt.getLocation(this.getHtmlElement()).x:Dwt.getLocation(document.body).x
};
DwtShell.prototype.getY=function(){
return(!this._virtual)?Dwt.getLocation(this.getHtmlElement()).y:Dwt.getLocation(document.body).y
};
DwtShell.prototype.getBounds=function(e){
return(!this._virtual)?Dwt.getBounds(this.getHtmlElement(),e):Dwt.getBounds(document.body,e)
};
DwtShell.prototype.setVirtual=function(){
this._virtual=true;
this.setVisible(false)
};
DwtShell.prototype.addFocusListener=function(e){
if(!this._hasFocusHandler){
var t=document;
if((typeof t.onfocusin!="undefined")&&t.attachEvent){
t.attachEvent("onfocusin",DwtShell.__focusHdlr)
}else{
if(window.addEventListener){
window.addEventListener("focus",DwtShell.__focusHdlr,false)
}}
this._hasFocusHandler=true
}
this.addListener(DwtEvent.ONFOCUS,e)
};
DwtShell.prototype.addBlurListener=function(e){
if(!this._hasBlurHandler){
var t=document;
if((typeof t.onfocusin!="undefined")&&t.attachEvent){
t.attachEvent("onfocusout",DwtShell.__blurHdlr)
}else{
if(window.addEventListener){
window.addEventListener("blur",DwtShell.__blurHdlr,false)
}}
this._hasBlurHandler=true
}
this.addListener(DwtEvent.ONBLUR,e)
};
DwtShell.prototype.addGlobalSelectionListener=function(e){
this.addListener(DwtShell._GLOBAL_SELECTION,e)
};
DwtShell.prototype.removeGlobalSelectionListener=function(e){
this.removeListener(DwtShell._GLOBAL_SELECTION,e)
};
DwtShell.prototype.notifyGlobalSelection=function(e){
this.notifyListeners(DwtShell._GLOBAL_SELECTION,e)
};
DwtShell.prototype.isVirtual=function(){
return this._virtual
};
DwtShell.prototype._showBusyDialogAction=function(t){
var e=this._getBusyDialog();
e.popup();
this._busyActionId[t]=-1
};
DwtShell.prototype._createBusyOverlay=function(e){
this._busyOverlay=document.createElement("div");
this._busyOverlay.className=(!AjxEnv.isLinux)?"BusyOverlay":"BusyOverlay-linux";
this._busyOverlay.style.position="absolute";
Dwt.setBounds(this._busyOverlay,0,0,"100%","100%");
Dwt.setZIndex(this._busyOverlay,Dwt.Z_VEIL);
this._busyOverlay.innerHTML="<table cellspacing=0 cellpadding=0 style='width:100%; height:100%'><tr><td>&nbsp;</td></tr></table>";
e.appendChild(this._busyOverlay);
Dwt.setVisible(this._busyOverlay,false);
this._busyTimedAction=new AjxTimedAction(this,this._showBusyDialogAction);
this._busyActionId={};
this._setBusyCount=0;
this._setBusy=false
};
DwtShell.prototype._getBusyDialog=function(a){
if(!this._busyDialog){
var i=new DwtDialog_ButtonDescriptor(DwtShell.CANCEL_BUTTON,AjxMsg.cancelRequest,DwtDialog.ALIGN_CENTER);
this._busyDialog=new DwtDialog({
parent:this,className:"DwtShellBusyDialog",title:AjxMsg.workInProgress,standardButtons:DwtDialog.NO_BUTTONS,extraButtons:[i],zIndex:Dwt.BUSY+10}
);
this._busyDialog.registerCallback(DwtShell.CANCEL_BUTTON,this._busyCancelButtonListener,this);
var t=Dwt.getNextId();
var e=["<table class='DialogContent'><tr>","<td><div class='WaitIcon'></div></td><td class='MsgText' id='",t,"'>&nbsp;</td>","</tr></table>"].join("");
this._busyDialog.setContent(e);
this._busyDialogTxt=document.getElementById(t);
if(this._busyDialogText){
this._busyDialogTxt.innerHTML=this._busyDialogText
}
if(this._busyDialogTitle){
this._busyDialog.setTitle(this._busyDialogTitle)
}
this._busyDialog.setButtonEnabled(DwtShell.CANCEL_BUTTON,(this._cancelBusyCallback!=null))
}
return this._busyDialog
};
DwtShell.prototype.relayout=function(){
this._currWinSize=Dwt.getWindowSize();
if(this._userShell){
var e=Dwt.byClassName("skin_layout_filler",this._userShell);
AjxUtil.foreach(e,function(a){
if(Dwt.hasClass(a,"skin_layout_row")){
var l=a;
var h=l.parentNode;
var r=Dwt.getSize(h).y;
var o=0;
var i=Dwt.getInsets(h);
r-=i.top+i.bottom;
var n=Dwt.getMargins(l);
r-=n.top+n.bottom;
AjxUtil.foreach(h.children,function(d){
var u=Dwt.getMargins(d);
r-=u.top+u.bottom;
if(Dwt.hasClass(d,"skin_layout_filler")){
o+=1
}else{
var c=Dwt.getSize(d).y;
AjxUtil.foreach(d.children,function(f){
var p=Dwt.getMargins(f);
var m=Dwt.getSize(f).y+p.top+p.bottom;
c=Math.max(c,m)
}
);
r-=c
}}
);
l.style.height=Math.max(r/o,0)+"px"
}else{
if(Dwt.hasClass(a,"skin_layout_cell")){
var s=a;
var l=s.parentNode;
var h=l.parentNode;
var t=Dwt.getSize(h).x;
var o=0;
var i=Dwt.getInsets(h);
t-=i.left+i.right;
var n=Dwt.getMargins(l);
t-=n.left+n.right;
AjxUtil.foreach(l.children,function(c){
var d=Dwt.getMargins(c);
t-=d.left+d.right;
if(Dwt.hasClass(c,"skin_layout_filler")){
o+=1
}else{
if(s.id==="skin_td_main"&&c.id==="skin_td_tree_app_sash"&&AjxEnv.isChrome&&!AjxUtil.isInt(window.devicePixelRatio)){
t-=3
}
t-=Dwt.getSize(c).x
}}
);
s.style.width=Math.max(t/o,0)+"px"
}else{
if(window.console){
console.warn("not fixing sizes for element!",a)
}}}}
)
}};
DwtShell.prototype._busyCancelButtonListener=function(e){
this._cancelBusyCallback.run();
if(this._busyDialog){
this._busyDialog.popdown()
}};
DwtShell._preventDefaultSelectPrt=function(t){
var e=DwtControl.fromElementId(window._dwtShellId)._uiEvent;
e.setFromDhtmlEvent(t,true);
if(e.dwtObj&&e.dwtObj instanceof DwtControl&&!e.dwtObj.preventSelection(e.target)){
e._stopPropagation=false;
e._returnValue=true
}else{
e._stopPropagation=true;
e._returnValue=false
}
e.setToDhtmlEvent(t);
return !e._stopPropagation
};
DwtShell._preventDefaultPrt=function(t){
t=DwtUiEvent.getEvent(t);
var a=t.target?t.target:t.srcElement;
var e=DwtControl.fromElementId(window._dwtShellId)._uiEvent;
e.setFromDhtmlEvent(t,true);
e._stopPropagation=true;
e._returnValue=false;
if(e.dwtObj&&e.dwtObj instanceof DwtControl&&!e.dwtObj.preventContextMenu(e.target)){
e._stopPropagation=false;
e._returnValue=true
}else{
if(a!=null&&typeof(a)=="object"){
if((a.tagName=="A"||a.tagName=="a")&&a.href){
e._stopPropagation=false;
e._returnValue=true
}}}
e.setToDhtmlEvent(t);
return e._returnValue
};
DwtShell._resizeHdlr=function(a){
var t=DwtControl.fromElementId(window._dwtShellId);
if(t.isListenerRegistered(DwtEvent.CONTROL)){
var e=DwtShell.controlEvent;
e.reset();
e.oldWidth=t._currWinSize.x;
e.oldHeight=t._currWinSize.y;
t.relayout();
e.newWidth=t._currWinSize.x;
e.newHeight=t._currWinSize.y;
t.notifyListeners(DwtEvent.CONTROL,e)
}else{
t.relayout()
}};
DwtShell.__onBodyScroll=function(){
document.body.scrollTop=0;
document.body.scrollLeft=0
};
DwtShell.__focusHdlr=function(){
var t=DwtShell.focusEvent;
var e=DwtShell.getShell(window);
t.dwtObj=e;
t.state=DwtFocusEvent.FOCUS;
e.notifyListeners(DwtEvent.ONFOCUS,t)
};
DwtShell.__blurHdlr=function(){
var t=DwtShell.focusEvent;
var e=DwtShell.getShell(window);
t.dwtObj=e;
t.state=DwtFocusEvent.BLUR;
e.notifyListeners(DwtEvent.ONBLUR,t)
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtLabel")){
DwtLabel=function(e){
if(arguments.length==0){
return
}
e=Dwt.getParams(arguments,DwtLabel.PARAMS);
e.className=e.className||"DwtLabel";
DwtComposite.call(this,e);
this._style=e.style||(DwtLabel.IMAGE_LEFT|DwtLabel.ALIGN_CENTER);
this._textBackground=null;
this._textForeground=null;
this._createHtml(e.template)
};
DwtLabel.PARAMS=["parent","style","className","posStyle","id","index"];
DwtLabel.prototype=new DwtComposite;
DwtLabel.prototype.constructor=DwtLabel;
DwtLabel.prototype.isFocusable=true;
DwtLabel.prototype.toString=function(){
return"DwtLabel"
};
DwtLabel.IMAGE_LEFT=1;
DwtLabel.IMAGE_RIGHT=2;
DwtLabel.IMAGE_BOTH=4;
DwtLabel.ALIGN_LEFT=8;
DwtLabel.ALIGN_RIGHT=16;
DwtLabel.ALIGN_CENTER=32;
DwtLabel._LAST_STYLE=32;
DwtLabel.LEFT="left";
DwtLabel.RIGHT="right";
DwtLabel.prototype.TEMPLATE="dwt.Widgets#ZLabel";
DwtLabel.prototype.dispose=function(){
delete this._dropDownEl;
delete this._iconEl;
delete this._textEl;
DwtControl.prototype.dispose.call(this)
};
DwtLabel.prototype.setEnabled=function(e){
if(e!=this._enabled){
DwtControl.prototype.setEnabled.call(this,e);
var t=this._style&DwtLabel.IMAGE_RIGHT?DwtLabel.RIGHT:DwtLabel.LEFT;
this.__imageInfo=this.__imageInfo||{};
this.__setImage(this.__imageInfo[t])
}};
DwtLabel.prototype.getImage=function(e){
e=e||(this._style&DwtLabel.IMAGE_RIGHT?DwtLabel.RIGHT:DwtLabel.LEFT);
return this.__imageInfo[e]
};
DwtLabel.prototype.setImage=function(e,t){
t=t||(this._style&DwtLabel.IMAGE_RIGHT?DwtLabel.RIGHT:DwtLabel.LEFT);
this.__imageInfo=this.__imageInfo||{};
this.__imageInfo[t]=e;
this.__setImage(e,t)
};
DwtLabel.prototype.setIconEl=function(e,t){
this._iconEl=this._iconEl||{};
t=t||(this._style&DwtLabel.IMAGE_RIGHT?DwtLabel.RIGHT:DwtLabel.LEFT);
this._iconEl[t]=e
};
DwtLabel.prototype.setDisabledImage=function(e){};
DwtLabel.prototype.getText=function(){
return(this.__text!=null)?this.__text:null
};
DwtLabel.prototype.setText=function(e){
if(!this._textEl){
return
}
if(e==null||e==""){
this.__text=null;
this._textEl.innerHTML=""
}else{
this.__text=e;
this._textEl.innerHTML=e
}
this._textSet(e)
};
DwtLabel.prototype.setTextBackground=function(e){
this._textBackground=e;
if(this._textEl){
this._textEl.style.backgroundColor=e
}};
DwtLabel.prototype.setTextForeground=function(e){
this._textForeground=e;
if(this._textEl){
this._textEl.style.color=e
}};
DwtLabel.prototype.setAlign=function(e){
this._style=e;
var t=this._style&DwtLabel.IMAGE_RIGHT?DwtLabel.RIGHT:DwtLabel.LEFT;
this.__imageInfo=this.__imageInfo||{};
this.__setImage(this.__imageInfo[t])
};
DwtLabel.prototype.isStyle=function(e){
return this._style&e
};
DwtLabel.prototype._createHtml=function(e){
var t={
id:this._htmlElId};
this._createHtmlFromTemplate(e||this.TEMPLATE,t)
};
DwtLabel.prototype._createHtmlFromTemplate=function(e,t){
DwtControl.prototype._createHtmlFromTemplate.call(this,e,t);
this._textEl=document.getElementById(t.id+"_title")
};
DwtLabel.prototype._getIconEl=function(t){
var e=this._style&DwtLabel.IMAGE_RIGHT?DwtLabel.RIGHT:DwtLabel.LEFT;
t=typeof t==="boolean"?e:(t||e);
this._iconEl=this._iconEl||{};
return this._iconEl[t]||(this._iconEl[t]=document.getElementById(this._htmlElId+"_"+t+"_icon"))
};
DwtLabel.prototype.__setImage=function(t,a){
var e=this._getIconEl(a);
if(e){
if(t){
AjxImg.setImage(e,t,null,!this._enabled);
var i=(this._style&DwtLabel.IMAGE_RIGHT?"ZHasRightIcon":"ZHasLeftIcon");
Dwt.addClass(this.getHtmlElement(),i)
}else{
e.innerHTML=""
}}};
DwtLabel.prototype._textSet=function(e){
if(!this.hasAttribute("aria-labelledby")){
if(e){
this.setAttribute("aria-label",e)
}else{
this.removeAttribute("aria-label")
}}}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtListView")){
DwtListView=function(i){
if(arguments.length==0){
return
}
i=Dwt.getParams(arguments,DwtListView.PARAMS);
i.className=i.className||"DwtListView";
DwtComposite.call(this,i);
this._view=i.view||Dwt.getNextId();
if(i.headerList){
var a=this.getHtmlElement();
var n=new Array(50);
var h=0;
var r=Dwt.getNextId();
var e=Dwt.getNextId();
n[h++]="<table width='100%'><tr><td ";
n[h++]="id="+r;
n[h++]="></td></tr><tr><td ";
n[h++]="id="+e;
n[h++]="></td></tr></table>";
a.innerHTML=n.join("");
var l=document.getElementById(r);
this._listColDiv=document.createElement("div");
this._listColDiv.id=DwtId.getListViewId(this._view,DwtId.LIST_VIEW_HEADERS);
l.appendChild(this._listColDiv);
var t=document.getElementById(e);
this._listDiv=this.useListElement()?document.createElement("ul"):document.createElement("div");
this._listDiv.id=DwtId.getListViewId(this._view,DwtId.LIST_VIEW_ROWS);
this._listDiv.className="DwtListView-Rows";
t.appendChild(this._listDiv);
this._bSortAsc=false;
this._currentColId=null;
this.sortingEnabled=true
}else{
this._listDiv=document.getElementById(i.id);
this.setScrollStyle(DwtControl.SCROLL)
}
this._setMouseEventHdlrs();
this._listenerMouseOver=this._mouseOverListener.bind(this);
this._listenerMouseOut=this._mouseOutListener.bind(this);
this._listenerMouseDown=this._mouseDownListener.bind(this);
this._listenerMouseUp=this._mouseUpListener.bind(this);
this._listenerMouseMove=this._mouseMoveListener.bind(this);
this._listenerDoubleClick=this._doubleClickListener.bind(this);
this.addListener(DwtEvent.ONMOUSEOVER,this._listenerMouseOver);
this.addListener(DwtEvent.ONMOUSEOUT,this._listenerMouseOut);
this.addListener(DwtEvent.ONMOUSEDOWN,this._listenerMouseDown);
this.addListener(DwtEvent.ONMOUSEUP,this._listenerMouseUp);
this.addListener(DwtEvent.ONMOUSEMOVE,this._listenerMouseMove);
this.addListener(DwtEvent.ONDBLCLICK,this._listenerDoubleClick);
this._evtMgr=new AjxEventMgr();
this._selectedItems=new AjxVector();
this._selAnchor=null;
this._kbAnchor=null;
this._selEv=new DwtSelectionEvent(true);
this._actionEv=new DwtListViewActionEvent(true);
this._stateChangeEv=new DwtEvent(true);
this._headerList=i.headerList;
this._noMaximize=i.noMaximize;
if(this._headerList){
this._parentEl=this._listDiv
}else{
this._parentEl=this.getHtmlElement();
if(this.useListElement()){
var s=document.createElement("ul");
s.className="DwtListView-Rows";
this._parentEl.appendChild(s);
this._parentEl=s
}}
this._list=null;
this.offset=0;
this.headerColCreated=false;
this.setMultiSelect(true);
this.firstSelIndex=-1;
this._data={};
this._rowClass=[this._className,DwtListView.ROW_CLASS].join("");
var o=this._normalClass=DwtListView.ROW_CLASS;
this._selectedClass=[o,DwtCssStyle.SELECTED].join("-");
this._viewedButUnselectedClass=[o,DwtCssStyle.ALT_SELECTED].join("-");
this._disabledSelectedClass=[this._selectedClass,DwtCssStyle.DISABLED].join("-");
this._kbFocusClass=[o,DwtCssStyle.FOCUSED].join("-");
this._dndClass=[o,DwtCssStyle.DRAG_PROXY].join("-");
this._rightClickClass=[this._selectedClass,DwtCssStyle.ACTIONED].join("-");
this._styleRe=this._getStyleRegex()
};
DwtListView.prototype=new DwtComposite;
DwtListView.prototype.constructor=DwtListView;
DwtListView.prototype.isDwtListView=true;
DwtListView.prototype.toString=function(){
return"DwtListView"
};
DwtListView.prototype.role="list";
DwtListView.prototype.itemRole="listitem";
DwtListView.PARAMS=["parent","className","posStyle","headerList","noMaximize"];
DwtListView.ITEM_SELECTED=1;
DwtListView.ITEM_DESELECTED=2;
DwtListView.ITEM_DBL_CLICKED=3;
DwtListView._LAST_REASON=3;
DwtListView._TOOLTIP_DELAY=250;
DwtListView.HEADERITEM_HEIGHT=24;
DwtListView.TYPE_HEADER_ITEM="1";
DwtListView.TYPE_LIST_ITEM="2";
DwtListView.TYPE_HEADER_SASH="3";
DwtListView.DEFAULT_LIMIT=25;
DwtListView.MAX_REPLENISH_THRESHOLD=10;
DwtListView.MIN_COLUMN_WIDTH=20;
DwtListView.COL_MOVE_THRESHOLD=3;
DwtListView.ROW_CLASS="Row";
DwtListView.ROW_CLASS_ODD="RowEven";
DwtListView.ROW_CLASS_EVEN="RowOdd";
DwtListView._STYLE_CLASS="_sc";
DwtListView._SELECTED_STYLE_CLASS="_ssc";
DwtListView._SELECTED_DIS_STYLE_CLASS="_sdsc";
DwtListView._KBFOCUS_CLASS="_kfc";
DwtListView.prototype.dispose=function(){
this._listColDiv=null;
this._listDiv=null;
this._parentEl=null;
this._clickDiv=null;
this._selectedItems=null;
DwtComposite.prototype.dispose.call(this)
};
DwtListView.prototype.setEnabled=function(e){
DwtComposite.prototype.setEnabled.call(this,e);
this.removeListener(DwtEvent.ONMOUSEOVER,this._listenerMouseOver);
this.removeListener(DwtEvent.ONMOUSEOUT,this._listenerMouseOut);
this.removeListener(DwtEvent.ONMOUSEDOWN,this._listenerMouseDown);
this.removeListener(DwtEvent.ONMOUSEUP,this._listenerMouseUp);
this.removeListener(DwtEvent.ONMOUSEMOVE,this._listenerMouseMove);
this.removeListener(DwtEvent.ONDBLCLICK,this._listenerDoubleClick);
if(e){
this.addListener(DwtEvent.ONMOUSEOVER,this._listenerMouseOver);
this.addListener(DwtEvent.ONMOUSEOUT,this._listenerMouseOut);
this.addListener(DwtEvent.ONMOUSEDOWN,this._listenerMouseDown);
this.addListener(DwtEvent.ONMOUSEUP,this._listenerMouseUp);
this.addListener(DwtEvent.ONMOUSEMOVE,this._listenerMouseMove);
this.addListener(DwtEvent.ONDBLCLICK,this._listenerDoubleClick)
}
var a=this.getSelectedItems();
if(a){
var o=a.getArray();
for(var t=0;
t<o.length;
t++){
Dwt.delClass(o[t],this._styleRe,e?this._selectedClass:this._disabledSelectedClass)
}}};
DwtListView.prototype.createHeaderHtml=function(d,p){
if(!this._headerList||this.headerColCreated){
return
}
this._headerHash={};
this._headerIdHash={};
var u=0;
var f=[];
f[u++]="<table id='";
f[u++]=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_TABLE,this._view);
f[u++]="' height=100%";
f[u++]=this._noMaximize?">":" width=100%>";
f[u++]="<tr>";
var o=this._headerList.length;
for(var s=0;
s<o;
s++){
var l=this._headerList[s];
var c=l._field;
l._index=s;
var t=l._id=DwtId.getListViewHdrId(DwtId.WIDGET_HDR,this._view,c);
this._headerHash[c]=l;
this._headerIdHash[t]=l;
if(l._variable){
this._variableHeaderCol=l
}
if(l._visible){
u=this._createHeader(f,u,l,s,o,t,d)
}}
f[u++]="</tr></table>";
this._listColDiv.innerHTML=f.join("");
this._listColDiv.className="DwtListView-ColHeader"+(p?" FixedColumnHeaderTables":"");
setTimeout($.proxy(function(){
for(var g=0;
g<o;
g++){
var y=this._headerList[g];
if(y._cssClass&&y._resizeable&&y._width==="auto"){
this._createHeaderCssStyle(y,this._calcRelativeWidth(g))
}}}
,this),0);
var e=0,h;
for(var n=0;
n<this._headerList.length;
n++){
var l=this._headerList[n];
var m=document.getElementById(l._id);
if(!m){
continue
}
if(l._sortable&&l._field==d){
m.className="DwtListView-Column DwtListView-ColumnActive"
}
if(l._resizeable){
var r=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_SASH,this._view,l._field);
var a=document.getElementById(r);
if(a){
this.associateItemWithElement(l,a,DwtListView.TYPE_HEADER_SASH,r,{
index:n}
)
}
e++;
h=l
}
this.associateItemWithElement(l,m,DwtListView.TYPE_HEADER_ITEM,l._id,{
index:n}
)
}
if(e==1){
h._resizeable=false
}
this.headerColCreated=true
};
DwtListView.prototype._createHeader=function(m,u,l,n,o,t,d){
var c=l._field;
m[u++]="<td id='";
m[u++]=t;
m[u++]="' class='";
var r=(t==this._currentColId)?"DwtListView-Column DwtListView-ColumnActive":"DwtListView-Column";
r+=l._sortable?"":" DwtDefaultCursor";
m[u++]=r+"'";
if(l._width){
m[u++]=" width=";
m[u++]=l._width;
if(l._cssClass&&l._resizeable&&l._width!=="auto"){
this._createHeaderCssStyle(l,l._width)
}
if(l._widthUnits){
m[u++]=l._widthUnits
}}
if(l._tooltip&&DwtControl.useBrowserTooltips){
m[u++]=" title='"+l._tooltip+"'"
}
m[u++]=">";
m[u++]="<div";
var s=null;
if(l._width&&l._width!="auto"){
if(AjxEnv.isIE){
s=l._width
}else{
s=l._width+2
}
if(l._widthUnits){
s+=l._widthUnits
}}
if(!!s){
m[u++]=" style='overflow: hidden; width: ";
m[u++]=s;
m[u++]="'>"
}else{
m[u++]=">"
}
m[u++]="<table width=100%><tr>";
if(l._iconInfo){
var h=["id='",DwtId.getListViewHdrId(DwtId.WIDGET_HDR_ICON,this._view,c),"'"].join("");
m[u++]="<td><center>";
m[u++]=AjxImg.getImageHtml(l._iconInfo,null,h);
m[u++]="</center></td>"
}
if(l._label){
m[u++]="<td id='";
m[u++]=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_LABEL,this._view,c);
m[u++]="' class='DwtListHeaderItem-label'>";
m[u++]=l._label;
m[u++]="</td>"
}
if(l._sortable&&!l._noSortArrow){
var e=this._bSortAsc?"ColumnUpArrow":"ColumnDownArrow";
m[u++]="<td align=right style='padding-right:2px' width='8px' id='";
m[u++]=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_ARROW,this._view,c);
m[u++]="'>";
var a=(c==d);
m[u++]=AjxImg.getImageHtml(e,a?null:"visibility:hidden");
m[u++]="</td>";
if(a){
this._currentColId=t
}}
if(n<(o-1)){
m[u++]="<td width=6>";
m[u++]="<table align=right width=4 height=100% id='";
m[u++]=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_SASH,this._view,c);
m[u++]="'><tr>";
m[u++]="<td class='DwtListView-Sash'><div style='width: 1px; height: ";
m[u++]=(DwtListView.HEADERITEM_HEIGHT-2);
m[u++]="px; background-color: #8A8A8A;margin-left:2px'></div></td><td class='DwtListView-Sash'><div style='width: 1px; height: ";
m[u++]=(DwtListView.HEADERITEM_HEIGHT-2);
m[u++]="px;'></div></td></tr></table>";
m[u++]="</td>"
}
m[u++]="</tr></table>";
m[u++]="</div></td>";
return u
};
DwtListView.prototype._createHeaderCssStyle=function(i,t){
if(i._cssClass&&i._resizeable){
if(i._cssRuleIndex){
DwtCssStyle.removeRule(document.styleSheets[0],i._cssRuleIndex)
}
var e="";
if(this.parent&&this.parent._className){
e+="."+this.parent._className
}
e+=" ."+i._cssClass;
var a="width:"+t+($.isNumeric(t)?"px":"")+";";
i._cssRuleIndex=DwtCssStyle.addRule(document.styleSheets[0],e,a,i._cssRuleIndex)
}};
DwtListView.prototype.getItemIndex=function(a){
var o=this._list;
if(o){
var e=o.size();
for(var t=0;
t<e;
++t){
if(o.get(t).id==a.id){
return t
}}}
return null
};
DwtListView.prototype.setSize=function(t,e){
DwtComposite.prototype.setSize.call(this,t,e);
this._sizeChildren(e)
};
DwtListView.prototype.size=function(){
return this._list?this._list.size():0
};
DwtListView.prototype.set=function(a,t,e){
if(this._selectedItems){
this._selectedItems.removeAll()
}
this._curViewedItem=null;
this._rightSelItem=null;
this.sortingEnabled=true;
this._resetList();
this._list=a;
this.setUI(t,e)
};
DwtListView.prototype.setUI=function(t,e){
this.removeAll();
this.createHeaderHtml(t);
this._renderList(this._list,e)
};
DwtListView.prototype._renderList=function(r,s,a){
if(r instanceof AjxVector&&r.size()){
var t=new Date();
var c=r.size();
var h=[];
if(!a){
this._parentEl.innerHTML=""
}
for(var n=0;
n<c;
n++){
var l=r.get(n);
var e=this._createItemHtml(l,{
now:t}
,false,n);
if(e){
if(e instanceof Array){
for(var o=0;
o<e.length;
o++){
this._addRow(e[o])
}}else{
this._addRow(e)
}}}}else{
if(!s){
this._setNoResultsHtml()
}}};
DwtListView.prototype.addItems=function(e){
if(AjxUtil.isArray(e)){
if(!this._list){
this._list=new AjxVector()
}
if(this._list.size()==0){
this._resetList()
}
this._renderList(AjxVector.fromArray(e),null,true);
this._list.addList(e)
}};
DwtListView.prototype.addItem=function(o,t,a,i){
if(!this._list){
this._list=new AjxVector()
}
if(this._list.size()==0){
this._resetList()
}
this._list.add(o,(i!=null)?i:t);
var n=this._createItemHtml(o);
if(n){
if(n instanceof Array){
for(var e=0;
e<n.length;
e++){
this._addRow(n[e])
}}else{
this._addRow(n,t)
}}
if(!a&&this._evtMgr.isListenerRegistered(DwtEvent.STATE_CHANGE)){
this._evtMgr.notifyListeners(DwtEvent.STATE_CHANGE,this._stateChangeEv)
}};
DwtListView.prototype.removeItem=function(a,t,i){
var e=this._getElFromItem(a);
if(!e){
return
}
var o=this._getRowIndex(a);
this._selectedItems.remove(e);
if(this._rightSelItem===e){
this._rightSelItem=null
}
if(this._kbAnchor===e){
this._kbAnchor=null
}
if(e.parentNode===this._parentEl){
this._parentEl.removeChild(e)
}
if(this._list){
this._list.remove(a)
}
var n=e.id;
if(this._data[n]){
this._data[n]=null;
delete this._data[n]
}
if(!i){
this._fixAlternation(o)
}
if(!t&&this._evtMgr.isListenerRegistered(DwtEvent.STATE_CHANGE)){
this._evtMgr.notifyListeners(DwtEvent.STATE_CHANGE,this._stateChangeEv)
}};
DwtListView.prototype.redrawItem=function(t){
var a=this._getElFromItem(t);
if(a){
var e=a.className;
var i=this._createItemHtml(t);
i.className=e;
a.parentNode.replaceChild(i,a);
if(this._selectedItems.contains(a)){
this._selectedItems.remove(a);
this.selectItem(t)
}
if(this._kbAnchor===a){
this._setKbFocusElement(i)
}}};
DwtListView.prototype.addSelectionListener=function(e){
this._evtMgr.addListener(DwtEvent.SELECTION,e)
};
DwtListView.prototype.removeSelectionListener=function(e){
this._evtMgr.removeListener(DwtEvent.SELECTION,e)
};
DwtListView.prototype.addActionListener=function(e){
this._evtMgr.addListener(DwtEvent.ACTION,e)
};
DwtListView.prototype.removeActionListener=function(e){
this._evtMgr.removeListener(DwtEvent.ACTION,e)
};
DwtListView.prototype.addStateChangeListener=function(e){
this._evtMgr.addListener(DwtEvent.STATE_CHANGE,e)
};
DwtListView.prototype.removeStateChangeListener=function(e){
this._evtMgr.removeListener(DwtEvent.STATE_CHANGE,e)
};
DwtListView.prototype.removeAll=function(e){
if(this._parentEl){
this._parentEl.innerHTML=""
}
if(this._selectedItems){
this._selectedItems.removeAll()
}
this._rightSelItem=this._selAnchor=this._kbAnchor=null;
if(!e&&this._evtMgr.isListenerRegistered(DwtEvent.STATE_CHANGE)){
this._evtMgr.notifyListeners(DwtEvent.STATE_CHANGE,this._stateChangeEv)
}};
DwtListView.prototype.selectAll=function(){
if(this._list&&this._list.size()){
this.setSelectedItems(this._list.getArray())
}};
DwtListView.prototype.deselectAll=function(){
if(this._selectedItems){
var e=this._selectedItems.getArray();
var o=this._selectedItems.size();
for(var t=0;
t<o;
t++){
Dwt.delClass(e[t],this._styleRe);
e[t].removeAttribute("aria-selected")
}
this._selectedItems.removeAll();
this._rightSelItem=this._selAnchor=null;
if(this._kbAnchor!=null&&this.hasFocus()){
Dwt.addClass(this._kbAnchor,this._kbFocusClass)
}}};
DwtListView.prototype._markUnselectedViewedItem=function(e){
var t=this._curViewedItem;
var a=t&&this._getElFromItem(t);
if(!a){
return
}
if(e){
Dwt.delClass(a,this._styleRe,this._viewedButUnselectedClass)
}else{
Dwt.delClass(a,this._viewedButUnselectedClass)
}};
DwtListView.prototype.getDnDSelection=function(){
if(this._dndSelection instanceof AjxVector){
return this.getSelection()
}else{
return this.getItemFromElement(this._dndSelection)
}};
DwtListView.prototype.getSelection=function(){
var t=[];
if(this._rightSelItem){
t.push(this.getItemFromElement(this._rightSelItem))
}else{
if(this._selectedItems){
var e=this._selectedItems.getArray();
var n=this._selectedItems.size();
for(var o=0;
o<n;
o++){
t[o]=this.getItemFromElement(e[o])
}}}
return t
};
DwtListView.prototype.getSelectedItems=function(){
return this._selectedItems
};
DwtListView.prototype.setSelection=function(i,t,e){
if(!i){
return
}
var a=this._getElFromItem(i);
if(a){
if(this._selectedItems.size()==1&&this._selectedItems.get(0)==a&&!e){
return
}
this.deselectAll();
this._unmarkKbAnchorElement(true);
this._setKbFocusElement(a);
this._selAnchor=a;
this.selectItem(i,this.getEnabled());
this.firstSelIndex=(this._list&&this._list.size()>0)?this._list.indexOf(i):-1;
this._scrollList(a);
if(!t&&this._evtMgr.isListenerRegistered(DwtEvent.SELECTION)){
var o=new DwtSelectionEvent(true);
o.button=DwtMouseEvent.LEFT;
o.target=a;
o.item=this.getItemFromElement(a);
o.detail=DwtListView.ITEM_SELECTED;
o.ersatz=true;
this._evtMgr.notifyListeners(DwtEvent.SELECTION,o)
}}};
DwtListView.prototype.setMultiSelection=function(e,a,t){
if(a){
this._selectedItems.remove(e);
e.removeAttribute("aria-selected");
Dwt.delClass(e,this._styleRe);
this._selEv.detail=DwtListView.ITEM_DESELECTED
}else{
this._selectedItems.add(e,null,true);
e.setAttribute("aria-selected",true);
Dwt.delClass(e,this._styleRe,this._selectedClass);
this._selEv.detail=DwtListView.ITEM_SELECTED
}
if(this._kbAnchor&&this._kbAnchor!=e){
Dwt.delClass(this._kbAnchor,this._kbFocusClass)
}
this._setKbFocusElement(e);
this._selAnchor=e;
Dwt.addClass(this._kbAnchor,this._kbFocusClass)
};
DwtListView.prototype.setSelectedItems=function(a){
this.deselectAll();
var o=a.length,e=this.getEnabled();
for(var t=0;
t<o;
++t){
this.selectItem(a[t],e)
}};
DwtListView.prototype.selectItem=function(a,t){
var e=this._getElFromItem(a);
if(e){
Dwt.delClass(e,this._styleRe,t?this._selectedClass:this._disabledSelectedClass);
if(this._kbAnchor==e&&this.hasFocus()){
Dwt.addClass(e,this._kbFocusClass);
e.focus()
}
this._selectedItems.add(e);
e.setAttribute("aria-selected",true);
this.getTabGroupMember().removeAllMembers();
this.getTabGroupMember().addMember(e)
}};
DwtListView.prototype.getSelectionCount=function(){
return this._rightSelItem?1:this._selectedItems.size()
};
DwtListView.prototype.handleActionPopdown=function(){
this._clearRightSel()
};
DwtListView.prototype.associateItemWithElement=function(i,t,a,n,o){
n=n||this._getItemId(i);
if(t){
t.id=n
}
a=a||DwtListView.TYPE_LIST_ITEM;
this._data[n]={
item:i,id:n,type:a};
if(o){
for(var e in o){
this._data[n][e]=o[e]
}}
return n
};
DwtListView.prototype.getItemFromElement=function(e){
return this._getItemData(e,"item")
};
DwtListView.prototype.findItem=function(e){
if(!e){
return
}
var t=this.findItemDiv(e);
return this._getItemData(t,"item")
};
DwtListView.prototype.findItemDiv=function(e){
if(!e){
return
}
while(e&&(e.id!=this._htmlElId)){
if(e.id&&this._data[e.id]){
return e
}
e=e.parentNode
}
return null
};
DwtListView.prototype.getTargetItem=function(e){
return this.findItem(DwtUiEvent.getTarget(e))
};
DwtListView.prototype.getTargetItemDiv=function(e){
return this.findItemDiv(DwtUiEvent.getTarget(e))
};
DwtListView.prototype.dragSelect=function(t){
if(this._dragHighlight){
var e=document.getElementById(this._dragHighlight);
if(!t||(e&&(t.id!=e.id))){
this._updateDragSelection(e,false)
}}
if(!t){
return
}
if(this._getItemData(t,"type")!=DwtListView.TYPE_LIST_ITEM){
return
}
if(t.id!=this._dragHighlight){
this._dragHighlight=t.id;
this._updateDragSelection(t,true)
}};
DwtListView.prototype.dragDeselect=function(t){
if(this._dragHighlight){
var e=document.getElementById(this._dragHighlight);
this._updateDragSelection(e,false);
this._dragHighlight=null
}};
DwtListView.prototype.scrollToItem=function(t){
var e=this._getElFromItem(t);
if(e){
this._listDiv.scrollTop=e.offsetTop
}};
DwtListView.prototype.scrollToTop=function(){
this._listDiv.scrollTop=0
};
DwtListView.prototype.scrollPage=function(e){
var t=this._parentEl;
if(t.clientHeight>=t.scrollHeight){
return
}
t.scrollTop=e?Math.max(t.scrollTop-t.clientHeight,0):Math.min(t.scrollTop+t.clientHeight,t.scrollHeight-t.clientHeight)
};
DwtListView.prototype.setSortByAsc=function(a,t){
if(!this._headerList){
return
}
this._bSortAsc=t;
var o=null;
for(var e=0;
e<this._headerList.length;
e++){
if(this._headerList[e]._sortable&&this._headerList[e]._field==a){
o=this._headerList[e]._id;
break
}}
if(o){
this._setSortedColStyle(o)
}};
DwtListView.prototype.getNewOffset=function(t){
var e=this.getLimit();
var a=t?(this.offset+e):(this.offset-e);
return(a<0)?0:a
};
DwtListView.prototype.getLimit=function(){
return DwtListView.DEFAULT_LIMIT
};
DwtListView.prototype.getReplenishThreshold=function(){
return DwtListView.MAX_REPLENISH_THRESHOLD
};
DwtListView.prototype.getList=function(){
return this._list
};
DwtListView.prototype.getTabGroupMember=function(){
if(!this._tabGroup){
this._tabGroup=new DwtTabGroup(this.getHTMLElId())
}
return this._tabGroup
};
DwtListView.prototype.getEnabled=function(){
return DwtComposite.prototype.getEnabled.call(this)&&this.size()>0
};
DwtListView.prototype.getInputElement=function(){
if(!this._kbAnchor){
this._setKbFocusElement()
}
return this._kbAnchor
};
DwtListView.prototype.replenish=function(o){
this._list.addList(o);
var t=o.size();
for(var e=0;
e<t;
e++){
var a=o.get(e);
var n=this._createItemHtml(a);
if(n){
this._addRow(n)
}}};
DwtListView.prototype.getKeyMapName=function(){
return DwtKeyMap.MAP_LIST
};
DwtListView.prototype.handleKeyAction=function(n,h){
switch(n){
case DwtKeyMap.SELECT:this._emulateSingleClick({
target:this._kbAnchor,button:DwtMouseEvent.LEFT,kbNavEvent:true}
);
break;
case DwtKeyMap.SELECT_CURRENT:this._emulateSingleClick({
target:this._kbAnchor,button:DwtMouseEvent.LEFT,ctrlKey:true,kbNavEvent:true}
);
break;
case DwtKeyMap.SELECT_NEXT:this._selectItem(true,false,true);
break;
case DwtKeyMap.SELECT_PREV:this._selectItem(false,false,true);
break;
case DwtKeyMap.ADD_SELECT_NEXT:this._selectItem(true,true,true);
break;
case DwtKeyMap.ADD_SELECT_PREV:this._selectItem(false,true,true);
break;
case DwtKeyMap.PREV:this._setKbFocusElement(false);
break;
case DwtKeyMap.NEXT:this._setKbFocusElement(true);
break;
case DwtKeyMap.DBLCLICK:if(!this._kbAnchor){
break
}
var t=false;
var c=this.getSelectedItems().getArray();
for(var o=0;
o<c.length;
o++){
if(c[o]==this._kbAnchor){
t=true;
break
}}
if(t){
this.emulateDblClick(this.getItemFromElement(this._kbAnchor),true)
}else{
this._emulateSingleClick({
target:this._kbAnchor,button:DwtMouseEvent.LEFT,kbNavEvent:true}
)
}
break;
case DwtKeyMap.SELECT_ALL:this.selectAll();
break;
case DwtKeyMap.SELECT_FIRST:case DwtKeyMap.SELECT_LAST:var d=(n==DwtKeyMap.SELECT_FIRST)?this._getFirstItem():this._getLastItem();
if(d){
this.setSelection(d);
this._scrollList(this._kbAnchor)
}
break;
case DwtKeyMap.SUBMENU:if(this._evtMgr.isListenerRegistered(DwtEvent.ACTION)){
var e=Dwt.toWindow(this._kbAnchor,0,0);
var u=Dwt.getSize(this._kbAnchor);
var l=e.x+u.x/4;
var r=e.y+u.y/2;
this._emulateSingleClick({
target:this._kbAnchor,button:DwtMouseEvent.RIGHT,docX:l,docY:r,kbNavEvent:true}
)
}
break;
case DwtKeyMap.PAGE_UP:case DwtKeyMap.PAGE_DOWN:this.scrollPage(n==DwtKeyMap.PAGE_UP);
break;
default:return false
}
return true
};
DwtListView.prototype.setMultiSelect=function(e){
this.setAttribute("aria-multiselectable",Boolean(e))
};
DwtListView.prototype.isMultiSelectEnabled=function(){
return this.getAttribute("aria-multiselectable")==="true"
};
DwtListView.prototype.setListDivHeight=function(a){
if(this._listDiv&&this._listColDiv){
var t=Dwt.getSize(this._listColDiv).y;
var e=a-t-25;
Dwt.setSize(this._listDiv,Dwt.DEFAULT,e)
}};
DwtListView.prototype._getStyleRegex=function(){
return new RegExp("\\bRow(-("+[DwtCssStyle.ALT_SELECTED,DwtCssStyle.SELECTED,DwtCssStyle.ACTIONED,DwtCssStyle.FOCUSED,DwtCssStyle.DISABLED,DwtCssStyle.DRAG_PROXY].join("|")+"))+\\b","g")
};
DwtListView.prototype._addRow=function(a,t){
if(!a||!this._parentEl){
return
}
var e=this._parentEl.childNodes.length;
if(t!=null&&e>0&&t!=e){
this._parentEl.insertBefore(a,this._parentEl.childNodes[t])
}else{
this._parentEl.appendChild(a)
}
this._fixAlternation((t!=null)?t:e);
this._makeFocusable(a);
a.setAttribute("role",this.itemRole)
};
DwtListView.prototype._fixAlternation=function(e){
var o=this._parentEl.childNodes;
if(!(o&&o.length)){
return
}
if(!(this._list&&this._list.size())){
return
}
var i=o[e];
if(!i){
return
}
var a=Boolean(e%2);
this._setAlternatingRowClass(i,a);
var t=i.nextSibling;
while(t){
a=!a;
this._setAlternatingRowClass(t,a);
t=t.nextSibling
}};
DwtListView.prototype._setAlternatingRowClass=function(i,e){
var t=e?DwtListView.ROW_CLASS_ODD:DwtListView.ROW_CLASS_EVEN;
var a=e?DwtListView.ROW_CLASS_EVEN:DwtListView.ROW_CLASS_ODD;
Dwt.delClass(i,t,a)
};
DwtListView.prototype._createItemHtml=function(d,i,r,s){
i=i||{};
this._addParams(d,i,c,l);
var e;
var c=[];
var l=0;
if(r){
l=this._getDivHtml(d,i,c,l,s)
}else{
if(i.div){
var a=[this._getDivClass(i.divClass||this._normalClass,d,i),(s%2)?DwtListView.ROW_CLASS_EVEN:DwtListView.ROW_CLASS_ODD];
i.div.className=a.join(" ")
}
e=i.div||this._getDiv(d,i)
}
var o=this.useListElement();
if(!o){
l=this._getTable(c,l,i)
}
l=this._getRow(c,l,d,i);
var t=i.headerList||this._headerList;
if(t&&t.length){
for(var n=0;
n<t.length;
n++){
if(!t[n]._visible){
continue
}
var h=t[n]._field;
l=this._getCell(c,l,d,h,n,i)
}}else{
l=this._getCell(c,l,d,null,null,i)
}
c[l++]=o?"</div>":"</tr></table>";
if(r){
c[l++]=o?"</li>":"</div>";
return c.join("")
}
e.innerHTML=c.join("");
return e
};
DwtListView.prototype._addParams=function(e,t){};
DwtListView.prototype._getDiv=function(t,a){
var i=document.createElement("div");
var e=[];
this._getDivHtml(t,a,e,0,0);
i.innerHTML=e.join("");
return i.firstChild
};
DwtListView.prototype._getExtraStyle=function(e){
return null
};
DwtListView.prototype._getDivHtml=function(h,o,n,r,s,i){
n[r++]=this.useListElement()?"<li ":"<div ";
i=i||[];
i.push(this._getDivClass(o.divClass||this._normalClass,h,o));
i.push((s%2)?DwtListView.ROW_CLASS_EVEN:DwtListView.ROW_CLASS_ODD);
n[r++]=AjxUtil.getClassAttr(i);
var t=[];
if(o.isDragProxy&&AjxEnv.isMozilla){
t.push("overflow:visible")
}
if(o.isDragProxy){
t.push("position:absolute");
t.push("width:"+this.getSize().x+"px")
}
var e=this._getExtraStyle(h);
if(e){
t.push(e)
}
if(t.length){
n[r++]=" style='";
n[r++]=t.join(";");
n[r++]="'"
}
var a=o.isDragProxy?this._getItemId(h)+"_dnd":null;
n[r++]=" id='";
n[r++]=this.associateItemWithElement(h,null,null,a);
n[r++]="'>";
return r
};
DwtListView.prototype._getDivClass=function(t,e,a){
return a.isDragProxy?([t," ",t,"-",DwtCssStyle.DRAG_PROXY].join("")):t
};
DwtListView.prototype._getTable=function(t,e,a){
t[e++]="<table width=";
t[e++]=!a.isDragProxy?"100%>":(this.getSize().x+">");
return e
};
DwtListView.prototype._getRow=function(t,e,o,s,a){
var n=this._getRowId(o,s)||Dwt.getNextId();
var i=this._getRowClass(o,s);
if(this.useListElement()){
t[e++]="<div ";
a=a||[];
if(i){
a.push(i)
}
if(n){
t[e++]=["id='",n,"'"].join("")
}
t[e++]=AjxUtil.getClassAttr(a)+">"
}else{
t[e++]=n?["<tr id='",n,"'"].join(""):"<tr";
t[e++]=i?([" class='",i,"'>"].join("")):">"
}
return e
};
DwtListView.prototype.useListElement=function(){
return false
};
DwtListView.prototype._getRowClass=function(e,t){
return null
};
DwtListView.prototype._getRowId=function(e,t){
return null
};
DwtListView.prototype._getCell=function(f,m,g,u,n,o){
if(this.useListElement()){
var i=[];
var l=this._getCellClass(g,u,o);
if(l){
i.push(l)
}
m=this._getCellContents(f,m,g,u,n,o,[l||""])
}else{
var a=this._getCellId(g,u,o);
var d=a?[" id=","'",a,"'"].join(""):"";
var t=this._getCellWidth(n,o);
var h=t?([" width=",t].join("")):(" width='100%'");
var l=this._getCellClass(g,u,o);
var s=l?[" class=",l].join(""):"";
var p=this._getCellAlign(n,o);
var c=p?[" align=",p].join(""):"";
var e=(this._getCellAttrText(g,u,o))||"";
var r=[d,h,s,c,e].join(" ");
f[m++]="<td";
f[m++]=r?(" "+r):"";
f[m++]=">";
m=this._getCellContents(f,m,g,u,n,o);
f[m++]="</td>"
}
return m
};
DwtListView.prototype._getCellWidth=function(i,a){
if(i==null){
return null
}
var e=a.headerList||this._headerList;
var t=e[i]._width;
if(t){
if(t!="auto"&&t>0){
if(AjxEnv.isIE){
return(t+2)
}
if(AjxEnv.isSafari&&!AjxEnv.isSafari6up&&!AjxEnv.isChrome19up){
return(t+5)
}}
return t
}
return null
};
DwtListView.prototype._getCellAlign=function(a,t){
if(a==null){
return null
}
var e=t.headerList||this._headerList;
return e[a]._align
};
DwtListView.prototype._getCellId=function(e,t,a){
return null
};
DwtListView.prototype._getCellClass=function(e,t,a){
return null
};
DwtListView.prototype._getCellAttrText=function(e,t,a){
return null
};
DwtListView.prototype._getCellContents=function(t,e,a,i,n,o){
t[e++]=a.toString?a.toString():a;
return e
};
DwtListView.prototype._getFieldId=function(e,t){
return DwtId.getListViewItemId(DwtId.WIDGET_ITEM_FIELD,this._view,e.id,t)
};
DwtListView.prototype._getElement=function(e,t){
return document.getElementById(this._getFieldId(e,t))
};
DwtListView.prototype._getDragProxy=function(i){
var o=this.getDnDSelection();
if(!o){
return null
}
var s;
var e;
var t;
this._dndImg=null;
if(!(o instanceof Array)||o.length==1){
var h=(o instanceof Array)?o[0]:o;
s=this._createItemHtml(h,{
now:new Date(),isDragProxy:true}
);
this._setItemData(s,"origClassName",s.className);
Dwt.setPosition(s,Dwt.ABSOLUTE_STYLE);
t="position:absolute;top:18;left:-11;visibility:hidden"
}else{
s=document.createElement("div");
s.className="DragProxy";
Dwt.setPosition(s,Dwt.ABSOLUTE_STYLE);
AjxImg.setImage(s,"DndMultiYes_48");
this._dndImg=s;
e=document.createElement("div");
Dwt.setPosition(e,Dwt.ABSOLUTE_STYLE);
var r=this.allSelected?ZmMsg.all:o.length;
e.innerHTML="<table><tr><td class='DragProxyTextLabel'>"+r+"</td></tr></table>";
s.appendChild(e);
t="position:absolute;top:30;left:0;visibility:hidden";
Dwt.setBounds(s,Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE,43+32-16,36+32-20)
}
var a=AjxImg.getImageHtml("RoundPlus",t,"id="+DwtId.DND_PLUS_ID);
if(!this._noDndPlusImage){
s.appendChild(Dwt.parseHtmlFragment(a))
}
this.shell.getHtmlElement().appendChild(s);
if(e){
var n=Dwt.getSize(e);
Dwt.setLocation(e,16+(32-n.x)/2,19+(32-n.y)/2)
}
Dwt.setZIndex(s,Dwt.Z_DND);
return s
};
DwtListView.prototype._setDragProxyState=function(t){
if(this._dndImg){
AjxImg.setImage(this._dndImg,t?"DndMultiYes_48":"DndMultiNo_48")
}else{
if(this._dndProxy){
var a=t?DwtCssStyle.DROPPABLE:DwtCssStyle.NOT_DROPPABLE;
var e=this._getItemData(this._dndProxy,"origClassName");
this._dndProxy.className=[e,a].join(" ")
}}};
DwtListView.prototype._setNoResultsHtml=function(){
var t=document.createElement("div");
var e={
message:this._getNoResultsMessage(),type:this.type};
t.innerHTML=AjxTemplate.expand("dwt.Widgets#DwtListView-NoResults",e);
this._addRow(t)
};
DwtListView.prototype._getNoResultsMessage=function(){
return AjxMsg.noResults
};
DwtListView.prototype._clearRightSel=function(){
if(!this._rightSelItem){
return
}
Dwt.delClass(this._rightSelItem,this._rightClickClass);
this._rightSelItem=null;
if(!this._curViewedItem){
return
}
this.deselectAll();
this.selectItem(this._curViewedItem,true)
};
DwtListView.prototype._getItemId=function(e){
return DwtId.getListViewItemId(DwtId.WIDGET_ITEM,this._view,(e&&e.id)?e.id:Dwt.getNextId())
};
DwtListView.prototype._getElFromItem=function(e){
return Dwt.byId(this._getItemId(e))
};
DwtListView.prototype._getRowIndex=function(t){
var o=this._getItemId(t);
var a=this._parentEl.childNodes;
for(var e=0;
e<a.length;
e++){
if(a[e].id==o){
return e
}}
return null
};
DwtListView.prototype._getItemData=function(e,a,i){
i=i||(e?e.id:null);
var t=this._data[i];
return t?t[a]:null
};
DwtListView.prototype._setItemData=function(e,i,a,o){
o=o||(e?e.id:null);
var t=this._data[o];
if(t){
t[i]=a
}};
DwtListView.prototype._isValidDragObject=function(e){
return(this.getTargetItemDiv(e)!=null)
};
DwtListView.prototype._updateDragSelection=function(t,e){
if(!t){
return
}
if(!e){
t.className=this._getItemData(t,"origClassName")
}else{
this._setItemData(t,"origClassName",t.className);
Dwt.delClass(t,this._styleRe,this._dndClass)
}};
DwtListView.prototype._mouseOverAction=function(t,i){
var e=this._getItemData(i,"type");
if(e==DwtListView.TYPE_HEADER_ITEM){
var a=this.getItemFromElement(i);
if(a&&this.sortingEnabled&&a._sortable&&!this._headerClone){
i.className+=" DwtListView-ColumnHover"
}}else{
if(e==DwtListView.TYPE_HEADER_SASH){
i.style.cursor=AjxEnv.isIE?"col-resize":"e-resize"
}}
return true
};
DwtListView.prototype._mouseOutAction=function(t,i){
var e=this._getItemData(i,"type");
if(e==DwtListView.TYPE_HEADER_ITEM&&!this._headerClone){
i.className=(i.id!=this._currentColId)?"DwtListView-Column":"DwtListView-Column DwtListView-ColumnActive";
var a=this.getItemFromElement(i);
if(!a._sortable){
i.className+=" DwtDefaultCursor"
}}else{
if(e==DwtListView.TYPE_HEADER_SASH){
i.style.cursor="auto"
}}
return true
};
DwtListView.prototype._mouseOverListener=function(e){
var t=this.getTargetItemDiv(e);
if(!t){
return
}
this._mouseOverAction(e,t)
};
DwtListView.prototype._mouseOutListener=function(e){
var t=this.getTargetItemDiv(e);
if(!t){
return
}
this.setToolTipContent(null);
this._mouseOutAction(e,t)
};
DwtListView.prototype._mouseMoveListener=function(t){
if(!this._clickDiv){
return
}
var e=this._getItemData(this._clickDiv,"type");
if(e==DwtListView.TYPE_HEADER_ITEM){
this._handleColHeaderMove(t)
}else{
if(e==DwtListView.TYPE_HEADER_SASH){
this._handleColHeaderResize(t)
}}};
DwtListView.prototype._mouseDownListener=function(e){
var t=this.getTargetItemDiv(e);
if(!t){
this._dndSelection=null
}else{
this._clickDiv=t;
if(this._getItemData(t,"type")!=DwtListView.TYPE_LIST_ITEM){
this._dndSelection=null
}else{
this._dndSelection=(this._selectedItems.contains(t))?this._selectedItems:t
}}
this._mouseDownAction(e,t)
};
DwtListView.prototype._mouseUpListener=function(a){
var n=this.getTargetItemDiv(a);
var o=this._handleColHeaderDrop(a);
var e=this._handleColSashDrop(a);
if(!n||n!=this._clickDiv||o||e){
delete this._clickDiv;
this._mouseUpAction(a,n);
return
}
delete this._clickDiv;
var t=this._getItemData(n,"type");
if(this._headerList&&t==DwtListView.TYPE_HEADER_ITEM){
if(a.button==DwtMouseEvent.LEFT){
this._columnClicked(n,a)
}else{
if(a.button==DwtMouseEvent.RIGHT){
var i=this._colHeaderActionMenu=this._getActionMenuForColHeader();
if(i&&i instanceof DwtMenu){
i.popup(0,a.docX,a.docY)
}}}}else{
if(t==DwtListView.TYPE_LIST_ITEM){
if(a.button==DwtMouseEvent.LEFT||a.button==DwtMouseEvent.RIGHT){
this._itemClicked(n,a)
}}}
this._mouseUpAction(a,n)
};
DwtListView.prototype._mouseDownAction=function(e,t){};
DwtListView.prototype._mouseUpAction=function(e,t){};
DwtListView.prototype._doubleClickAction=function(e,t){
return true
};
DwtListView.prototype._doubleClickListener=function(t){
var a=this.getTargetItemDiv(t);
if(!a){
return
}
var e=this._getItemData(a,"type");
if(e==DwtListView.TYPE_LIST_ITEM){
if(!this._doubleClickAction(t,a)){
return
}
if(this._evtMgr.isListenerRegistered(DwtEvent.SELECTION)){
DwtUiEvent.copy(this._selEv,t);
this._selEv.item=this.getItemFromElement(a);
this._selEv.detail=DwtListView.ITEM_DBL_CLICKED;
this._evtMgr.notifyListeners(DwtEvent.SELECTION,this._selEv)
}}};
DwtListView.prototype.emulateDblClick=function(e,t){
var i=document.getElementById(this._getItemId(e));
if(i){
var a=new DwtMouseEvent();
this._setMouseEvent(a,{
target:i,button:DwtMouseEvent.LEFT}
);
a.kbNavEvent=t;
this._itemClicked(i,a);
this._doubleClickListener(a)
}};
DwtListView.prototype._selectItem=function(a,e,i){
if(!this.size()){
return
}
var t=(this._kbAnchor)?this._getSiblingElement(this._kbAnchor,a):this._parentEl.firstChild;
this._scrollList(t);
this._emulateSingleClick({
target:t,button:DwtMouseEvent.LEFT,shiftKey:e,kbNavEvent:i}
)
};
DwtListView.prototype._getSiblingElement=function(e,a){
if(!e){
return null
}
var t=a?e.nextSibling:e.previousSibling;
while(this._hasHiddenRows&&t&&!Dwt.getVisible(t)){
t=a?t.nextSibling:t.previousSibling
}
return(!t||(this._hasHiddenRows&&!Dwt.getVisible(t)))?e:t
};
DwtListView.prototype._scrollList=function(e){
Dwt.scrollIntoView(e,e.parentNode)
};
DwtListView.prototype._setRowHeight=function(){
if(!this._rowHeight){
var e=this._parentEl.firstChild;
this._rowHeight=e&&Dwt.getSize(e).y
}};
DwtListView.prototype._emulateSingleClick=function(e){
this._clickDiv=this.findItemDiv(e.target);
var t=new DwtMouseEvent();
this._setMouseEvent(t,e);
t.kbNavEvent=e.kbNavEvent;
this.notifyListeners(DwtEvent.ONMOUSEUP,t)
};
DwtListView.prototype._setKbFocusElement=function(e){
if(!this._list){
return
}
var t=this._kbAnchor;
if(t){
this._unmarkKbAnchorElement()
}
if(e&&e!==true){
this._kbAnchor=e
}else{
if(this._kbAnchor){
this._kbAnchor=this._getSiblingElement(this._kbAnchor,e)
}else{
this._kbAnchor=this._parentEl.firstChild
}}
if(this._kbAnchor){
Dwt.addClass(this._kbAnchor,this._kbFocusClass);
if(!this._duringFocusByMouseDown){
this._scrollList(this._kbAnchor)
}
if(this.hasFocus()){
this._kbAnchor.focus()
}}};
DwtListView.prototype._itemSelected=function(e,a){
if(this._allowLeftSelection(e,a,a&&a.button)){
this._unmarkKbAnchorElement(true);
this.deselectAll();
this._selectedItems.add(e);
e.setAttribute("aria-selected",true);
this._setKbFocusElement(e);
this._selAnchor=e;
Dwt.delClass(e,this._styleRe,this._selectedClass);
if(this.hasFocus()){
Dwt.addClass(e,this._kbFocusClass)
}
var t=this.getItemFromElement(e);
this._markUnselectedViewedItem(false);
this._curViewedItem=t;
this.firstSelIndex=(this._list&&t)?this._list.indexOf(t):-1
}};
DwtListView.prototype._itemClicked=function(s,d){
if(this._rightSelItem){
Dwt.delClass(this._rightSelItem,this._styleRe);
this._rightSelItem=null
}
var n=this._selectedItems.size();
var a=this._selectedItems.contains(s);
if((!d.shiftKey&&!d.ctrlKey)||!this.isMultiSelectEnabled()){
if(d.button==DwtMouseEvent.LEFT||d.button==DwtMouseEvent.RIGHT){
this._selEv.detail=DwtListView.ITEM_SELECTED
}
if(d.button==DwtMouseEvent.LEFT){
this._itemSelected(s,d)
}else{
if(d.button==DwtMouseEvent.RIGHT&&!a&&this._evtMgr.isListenerRegistered(DwtEvent.ACTION)){
this.deselectAll();
this._markUnselectedViewedItem(true);
this._rightSelItem=s;
Dwt.delClass(s,this._styleRe,this._rightClickClass);
if(this._kbAnchor==s){
Dwt.addClass(s,this._kbFocusClass)
}}}}else{
if(d.button==DwtMouseEvent.LEFT){
if(d.ctrlKey){
this.setMultiSelection(s,a,d)
}else{
if(!this._selAnchor){
return
}
var r=this._getChildren()||s.parentNode.childNodes;
var l=r.length;
var o;
var e=0;
for(var h=0;
h<l;
h++){
o=r[h];
var u=this.getItemFromElement(o);
if(u===null){
continue
}
if(o==this._rightSelItem){
this._rightSelItem=null
}
if(o==s){
e++
}
var t=this._selectedClass;
if(o==this._selAnchor){
e++;
if(o.className.indexOf(t)==-1){
this._selectedItems.add(o);
o.setAttribute("aria-selected",true)
}
Dwt.delClass(o,this._styleRe,t);
continue
}
if(e!=1&&o.className.indexOf(t)!=-1&&o!=s){
Dwt.delClass(o,this._styleRe);
this._selectedItems.remove(o);
o.removeAttribute("aria-selected")
}else{
if(e==1||o==s){
if(o.className.indexOf(t)==-1){
this._selectedItems.add(o)
}
o.setAttribute("aria-selected",true);
Dwt.delClass(o,this._styleRe,t)
}}}
this._setKbFocusElement(s);
var c=this._selectedItems.size();
if(n<c){
this._selEv.detail=DwtListView.ITEM_SELECTED
}else{
if(n>c){
this._selEv.detail=DwtListView.ITEM_DESELECTED
}else{
return
}}}}}
if(d.button==DwtMouseEvent.LEFT&&this._evtMgr.isListenerRegistered(DwtEvent.SELECTION)){
if(this._setListEvent(d,this._selEv,s)){
this._evtMgr.notifyListeners(DwtEvent.SELECTION,this._selEv)
}
if(!this.hasFocus()){
this.focus()
}}else{
if(d.button==DwtMouseEvent.RIGHT&&!d.shiftKey&&!d.ctrlKey&&this._evtMgr.isListenerRegistered(DwtEvent.ACTION)){
if(this._setListEvent(d,this._actionEv,s)){
this._evtMgr.notifyListeners(DwtEvent.ACTION,this._actionEv)
}}}};
DwtListView.prototype._focusByMouseDownEvent=function(){};
DwtListView.prototype._setListEvent=function(t,a,e){
DwtUiEvent.copy(a,t);
a.kbNavEvent=t.kbNavEvent;
a.item=this.findItem(e);
return true
};
DwtListView.prototype._columnClicked=function(o,a){
var n=this.getItemFromElement(o);
if(!(n._sortable&&this.sortingEnabled)){
return
}
var i=this.getList();
var e=i?i.size():null;
var t=this._columnHasCustomQuery(n);
if(!e&&!t){
return
}
this._bSortAsc=(n._id==this._currentColId)?!this._bSortAsc:this._getDefaultSortbyForCol(n);
this._setSortedColStyle(n._id);
if(e>=1||t){
this._sortColumn(n,this._bSortAsc)
}};
DwtListView.prototype._columnHasCustomQuery=function(e){
return false
};
DwtListView.prototype._sortColumn=function(e,t){};
DwtListView.prototype._getActionMenuForColHeader=function(){
return null
};
DwtListView.prototype._getDefaultSortbyForCol=function(e){
return true
};
DwtListView.prototype._allowLeftSelection=function(t,a,e){
return true
};
DwtListView.prototype._setSortedColStyle=function(e){
if(this._currentColId&&(e!=this._currentColId)){
var n=this._headerIdHash[this._currentColId];
if(n&&!n._noSortArrow){
var s=n._field;
var r=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_ARROW,this._view,s);
var i=document.getElementById(r);
if(i&&i.firstChild){
var t=(AjxImg._mode==AjxImg.SINGLE_IMG)?i.firstChild:i.firstChild.firstChild;
if(t){
t.style.visibility="hidden"
}}}
var l=document.getElementById(this._currentColId);
if(l){
l.className="DwtListView-Column"
}}
this._currentColId=e;
var n=this._headerIdHash[this._currentColId];
if(!n._noSortArrow){
var s=n._field;
var h=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_ARROW,this._view,s);
var a=document.getElementById(h);
if(a){
AjxImg.setImage(a,this._bSortAsc?"ColumnUpArrow":"ColumnDownArrow");
var t=(AjxImg._mode==AjxImg.SINGLE_IMG)?a.firstChild:a.firstChild.firstChild;
if(t){
t.style.visibility="visible"
}}}
var o=document.getElementById(e);
if(o){
o.className="DwtListView-Column DwtListView-ColumnActive"
}};
DwtListView.prototype._resetList=function(){
if(this._list&&this._list.size()){
this._list.removeAll()
}
this._resetListView()
};
DwtListView.prototype._resetListView=function(){
var e;
while(this._parentEl&&this._parentEl.hasChildNodes()){
var e=this._parentEl.removeChild(this._parentEl.firstChild);
this._data[e.id]=null
}
if(this._selectedItems){
this._selectedItems.removeAll()
}
this._rightSelItem=null
};
DwtListView.prototype._destroyDragProxy=function(e){
this._data[e.id]=null;
DwtControl.prototype._destroyDragProxy.call(this,e)
};
DwtListView.prototype._handleColHeaderMove=function(s){
if(!this._headerClone){
if(!this._headerColX){
this._headerColX=s.docX;
return
}else{
var o=Math.abs(this._headerColX-s.docX);
if(o<DwtListView.COL_MOVE_THRESHOLD){
return
}}
this._headerClone=document.createElement("div");
var c=Dwt.getSize(this._clickDiv);
var t=AjxEnv.isIE?c.x:c.x-3;
var l=AjxEnv.isIE?c.y:c.y-5;
Dwt.setSize(this._headerClone,t,l);
Dwt.setPosition(this._headerClone,Dwt.ABSOLUTE_STYLE);
Dwt.setZIndex(this._headerClone,Dwt.Z_DND);
Dwt.setLocation(this._headerClone,Dwt.DEFAULT,s.docY);
this._headerClone.className=this._clickDiv.className+" DragProxy";
this._headerClone.innerHTML=this._clickDiv.innerHTML;
this._clickDiv.className="DwtListView-Column DwtListView-ColumnEmpty";
this._headerClone.style.borderTop="1px solid #777777";
var r=this._headerIdHash[this._clickDiv.id];
var h=r._field;
var i=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_LABEL,this._view,h);
var a=document.getElementById(i);
if(a){
a.style.color="#FFFFFF"
}
this.shell.getHtmlElement().appendChild(this._headerClone)
}else{
var e=this.getTargetItemDiv(s);
var n=this._getItemData(e,"type");
if(n==DwtListView.TYPE_HEADER_ITEM){
if(this._headerCloneTarget&&(this._headerCloneTarget==this._clickDiv)){
this._headerCloneTarget=null
}else{
if(this._headerCloneTarget!=e){
this._headerCloneTarget=e
}}}else{
this._headerCloneTarget=null
}}
if(this._headerClone){
Dwt.setLocation(this._headerClone,s.docX+2)
}};
DwtListView.prototype._handleColHeaderResize=function(t){
if(!this._headerSash){
this._headerSash=document.createElement("div");
Dwt.setSize(this._headerSash,Dwt.DEFAULT,this.getSize().y);
Dwt.setPosition(this._headerSash,Dwt.ABSOLUTE_STYLE);
Dwt.setZIndex(this._headerSash,Dwt.Z_DND);
var a=this._getHeaderSashLocation();
this._headerSashFudgeX=a.x;
Dwt.setLocation(this._headerSash,Dwt.DEFAULT,a.y);
this._headerSash.className="DwtListView-ColumnSash";
this.getHtmlElement().appendChild(this._headerSash);
this._headerSashX=t.docX
}
var e=this._getParentForColResize();
var i=Dwt.toWindow(e.getHtmlElement(),0,0);
Dwt.setLocation(this._headerSash,(t.docX-i.x)+this._headerSashFudgeX)
};
DwtListView.prototype._getHeaderSashLocation=function(){
if(!this._tmpPoint){
this._tmpPoint=new DwtPoint()
}
this._tmpPoint.x=0;
this._tmpPoint.y=0;
return this._tmpPoint
};
DwtListView.prototype._handleColHeaderDrop=function(h){
this._headerColX=null;
if(this._headerClone==null||h.button==DwtMouseEvent.RIGHT){
return false
}
if(this._headerCloneTarget){
var e=this._getItemData(this._clickDiv,"index");
var a=this._getItemData(this._headerCloneTarget,"index");
this._reIndexColumn(e,a)
}
this._clickDiv.className=(this._clickDiv.id!=this._currentColId)?"DwtListView-Column":"DwtListView-Column DwtListView-ColumnActive";
var c=this._headerClone.parentNode;
if(c){
c.removeChild(this._headerClone)
}
delete this._headerClone;
var s=this._data[this._clickDiv.id];
if(s.type!=DwtListView.TYPE_HEADER_ITEM){
var l=this._headerIdHash[this._currentColId];
var r=l._sortable?l._field:null;
this.headerColCreated=false;
this.createHeaderHtml(r)
}else{
var l=this._headerIdHash[this._clickDiv.id];
var o=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_LABEL,this._view,l._field);
var t=document.getElementById(o);
if(t){
t.style.color="#000000"
}}
for(var n=0;
n<this._headerList.length;
n++){
this._headerList[n]._width=this._calcRelativeWidth(n)
}
this._resetColWidth();
return true
};
DwtListView.prototype._reIndexColumn=function(i,a){
if(!this._headerList){
return
}
var e=this._headerList.length;
if(i<0||a<0||i>=e||a>=e||i==a){
return
}
var t=this._headerList.splice(i,1);
this._headerList.splice(a,0,t[0]);
this._relayout()
};
DwtListView.prototype._handleColSashDrop=function(c){
if(this._headerSash==null||c.button==DwtMouseEvent.RIGHT){
return false
}
var d=this._headerSash.parentNode;
if(d){
d.removeChild(this._headerSash)
}
delete this._headerSash;
for(var o=0;
o<this._headerList.length;
o++){
this._headerList[o]._width=this._calcRelativeWidth(o)
}
var a=this._getItemData(this._clickDiv,"index");
if(a==null){
return false
}
var u=c.docX-this._headerSashX;
var l=this._headerList[a];
var h=l;
var r;
var n=[];
if(u<0){
if((h==r)||!r){
r=this._getNextResizeableColumnHeader(h)
}
if(!r){
return false
}
u=Math.max(DwtListView.MIN_COLUMN_WIDTH-l._width,u);
l._width=Math.max(l._width+u,DwtListView.MIN_COLUMN_WIDTH);
r._width=Math.max(this._calcRelativeWidth(r._index)-u,DwtListView.MIN_COLUMN_WIDTH);
n.push(l._index,r._index)
}else{
if(u>0){
var s=u;
while(s>0){
if((h==r)||!r){
r=this._getNextResizeableColumnHeader(h,[],false)
}
if(!r){
u-=s;
break
}
var m=this._calcRelativeWidth(r._index);
var e=m-DwtListView.MIN_COLUMN_WIDTH;
if(s>e){
s-=e;
m=DwtListView.MIN_COLUMN_WIDTH
}else{
m-=s;
s=0
}
r._width=m;
n.push(r._index);
h=r
}
l._width=Math.max(l._width+u,DwtListView.MIN_COLUMN_WIDTH);
n.push(l._index)
}}
var t=this._getNextResizeableColumnHeader(l,n,true);
if(t){
t._width="auto"
}
this.recalculateCssStyle();
this._relayout();
this._resetColWidth();
return true
};
DwtListView.prototype.recalculateCssStyle=function(){
for(var e=0;
e<this._headerList.length;
e++){
var t=this._headerList[e];
if(t._cssClass&&t._resizeable){
this._createHeaderCssStyle(t,this._calcRelativeWidth(e))
}}};
DwtListView.prototype._calcRelativeWidth=function(a){
var t=this._headerList[a];
if(!t._width||(t._width&&t._width=="auto")){
var e=document.getElementById(t._id);
return(e)?(e.clientWidth-(AjxEnv.isIE?4:5)):null
}
return t._width
};
DwtListView.prototype._resetColWidth=function(){
if(!this.headerColCreated){
return
}
var n=this._getLastColumnIndex();
if(n){
var a=this._headerList[n];
var t=document.getElementById(a._id);
if(t){
var s=t.firstChild;
var e=16;
var o=this._listColDiv.clientWidth;
var i=this._listDiv.clientWidth;
if(o!=i){
t.style.width=s.style.width=(a._width!=null&&a._width!="auto")?(a._width+e):(t.clientWidth+e)
}else{
t.style.width=s.style.width=(a._width||"")
}}}};
DwtListView.prototype._getLastColumnIndex=function(){
var t=null;
if(this._headerList){
var e=this._headerList.length-1;
while(t==null&&e>=0){
if(this._headerList[e]._visible){
t=e
}
e--
}}
return t
};
DwtListView.prototype._getNextResizeableColumnIndex=function(n,e,o){
e=e?AjxUtil.arrayAsHash(e):{};
e[n]=true;
if(this._headerList){
for(var a=n+1;
a<this._headerList.length;
a++){
var t=this._headerList[a];
if(e[a]){
continue
}
if(t._visible&&t._resizeable){
return a
}}
if(o){
for(var a=0;
a<n;
a++){
if(e[a]){
continue
}
var t=this._headerList[a];
if(t._visible&&t._resizeable){
return a
}}}}
return null
};
DwtListView.prototype._getNextResizeableColumnHeader=function(i,e,a){
var t=this._getNextResizeableColumnIndex(i._index,e,a);
return(t!==null)?this._headerList[t]:false
};
DwtListView.prototype._relayout=function(){
this.headerColCreated=false;
var a=this._headerIdHash[this._currentColId];
var e=(a&&a._sortable)?a._field:null;
var t=this.getSelection()[0];
this.setUI(e);
this.setSelection(t,true)
};
DwtListView.prototype._getParentForColResize=function(){
return this
};
DwtListView.prototype._sizeChildren=function(e){
if(this.headerColCreated&&this._listDiv&&(e!=Dwt.DEFAULT)){
Dwt.setSize(this._listDiv,Dwt.DEFAULT,e-DwtListView.HEADERITEM_HEIGHT);
return true
}else{
return false
}};
DwtListView.prototype._getChildren=function(){
return null
};
DwtListView.prototype._focus=function(){
if(this.size()==0){
return
}
if(this._kbAnchor){
Dwt.addClass(this._kbAnchor,this._kbFocusClass)
}else{
this._setKbFocusElement()
}};
DwtListView.prototype._blur=function(){
this._unmarkKbAnchorElement()
};
DwtListView.prototype._unmarkKbAnchorElement=function(e){
if(this._kbAnchor){
Dwt.delClass(this._kbAnchor,this._kbFocusClass)
}
if(e){
this._kbAnchor=null
}};
DwtListView.prototype._getFirstItem=function(){
var e=this._list.getArray();
if(e&&e.length>1){
return e[0]
}
return null
};
DwtListView.prototype._getLastItem=function(){
var e=this._list.getArray();
if(e&&e.length>1){
return e[e.length-1]
}
return null
};
DwtListHeaderItem=function(t){
if(arguments.length==0){
return
}
t=Dwt.getParams(arguments,DwtListView.PARAMS);
this._field=t.field;
this._label=t.text;
this._iconInfo=t.icon;
this._sortable=t.sortable;
this._noSortArrow=t.noSortArrow;
this._resizeable=t.resizeable;
this._visible=(t.visible!==false);
this._name=t.name||t.text;
this._align=t.align;
this._noRemove=t.noRemove;
this._tooltip=t.tooltip;
this._cssClass=t.cssClass;
var e=parseInt(t.width);
if(isNaN(e)||!e){
this._width="auto";
this._variable=true;
this._resizeable=true
}else{
if(String(e)==String(t.width)){
this._width=e
}else{
this._width=parseInt(String(t.width).substr(0,String(e).length));
this._widthUnits=AjxStringUtil.getUnitsFromSizeString(t.width)
}}};
DwtListHeaderItem.prototype.isDwtListHeaderItem=true;
DwtListHeaderItem.prototype.toString=function(){
return"DwtListHeaderItem"
};
DwtListHeaderItem.PARAMS=["id","text","icon","width","sortable","resizeable","visible","name","align","noRemove","view"];
DwtListHeaderItem.sortCompare=function(t,e){
return t._index<e._index?-1:(t._index>e._index?1:0)
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtButton")){
DwtButton=function(a){
if(arguments.length==0){
return
}
a=Dwt.getParams(arguments,DwtButton.PARAMS);
a.className=a.className||"ZButton";
DwtLabel.call(this,a);
var t=a.parent;
if(!t._hasSetMouseEvents||AjxEnv.isIE){
this._setMouseEvents()
}
var e;
if(t._hasSetMouseEvents){
e=AjxEnv.isIE?[DwtEvent.ONMOUSEENTER,DwtEvent.ONMOUSELEAVE]:[]
}else{
e=AjxEnv.isIE?[DwtEvent.ONMOUSEENTER,DwtEvent.ONMOUSELEAVE]:[DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEOUT];
e.push(DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEUP,DwtEvent.ONCLICK)
}
if(e&&e.length){
this._setEventHdlrs(e)
}
this._listeners=a.listeners||DwtButton._listeners;
this._addMouseListeners();
this._ignoreInternalOverOut=true;
this._dropDownEvtMgr=new AjxEventMgr();
this._selected=false;
this._actionTiming=a.actionTiming||DwtButton.ACTION_MOUSEUP;
this.__preventMenuFocus=null;
this._menuPopupStyle=DwtButton.MENU_POPUP_STYLE_BELOW
};
DwtButton.prototype=new DwtLabel;
DwtButton.prototype.constructor=DwtButton;
DwtButton.prototype.isDwtButton=true;
DwtButton.prototype.toString=function(){
return"DwtButton"
};
DwtButton.prototype.role="button";
DwtButton.PARAMS=["parent","style","className","posStyle","actionTiming","id","index","listeners"];
DwtButton.TOGGLE_STYLE=DwtLabel._LAST_STYLE*2;
DwtButton.ALWAYS_FLAT=DwtLabel._LAST_STYLE*4;
DwtButton._LAST_STYLE=DwtButton.ALWAYS_FLAT;
DwtButton.ACTION_MOUSEUP=1;
DwtButton.ACTION_MOUSEDOWN=2;
DwtButton.NOTIFY_WINDOW=500;
DwtButton.MENU_POPUP_STYLE_BELOW="BELOW";
DwtButton.MENU_POPUP_STYLE_ABOVE="ABOVE";
DwtButton.MENU_POPUP_STYLE_RIGHT="RIGHT";
DwtButton.MENU_POPUP_STYLE_CASCADE="CASCADE";
DwtButton.MOUSE_EVENTS=[DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEUP];
if(AjxEnv.isIE){
DwtButton.MOUSE_EVENTS.push(DwtEvent.ONMOUSEENTER,DwtEvent.ONMOUSELEAVE)
}else{
DwtButton.MOUSE_EVENTS.push(DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEOUT)
}
DwtButton.prototype.TEMPLATE="dwt.Widgets#ZButton";
DwtButton.prototype.dispose=function(){
if(this._menu&&this._menu.isDwtMenu&&(this._menu.parent==this)){
this._menu.dispose();
this._menu=null
}
DwtLabel.prototype.dispose.call(this)
};
DwtButton.prototype.addSelectionListener=function(t,e){
this.addListener(DwtEvent.SELECTION,t,e)
};
DwtButton.prototype.removeSelectionListener=function(e){
this.removeListener(DwtEvent.SELECTION,e)
};
DwtButton.prototype.removeSelectionListeners=function(){
this.removeAllListeners(DwtEvent.SELECTION)
};
DwtButton.prototype.addDropDownSelectionListener=function(e){
return this._dropDownEvtMgr.addListener(DwtEvent.SELECTION,e)
};
DwtButton.prototype.removeDropDownSelectionListener=function(e){
this._dropDownEvtMgr.removeListener(DwtEvent.SELECTION,e)
};
DwtButton.prototype._dropDownImg="SelectPullDownArrow";
DwtButton.prototype._dropDownDepImg="SelectPullDownArrow";
DwtButton.prototype._dropDownHovImg="SelectPullDownArrowHover";
DwtButton.prototype.setDropDownImages=function(t,a,i,e){
this._dropDownImg=t;
this._dropDownHovImg=i;
this._dropDownDepImg=e
};
DwtButton.prototype.setDropDownHovImage=function(e){
this._dropDownHovImg=e
};
DwtButton.prototype._addMouseListeners=function(){
AjxUtil.foreach(DwtButton.MOUSE_EVENTS,(function(e){
this.addListener(e,this._listeners[e])
}
).bind(this))
};
DwtButton.prototype._removeMouseListeners=function(){
AjxUtil.foreach(DwtButton.MOUSE_EVENTS,(function(e){
this.removeListener(e,this._listeners[e])
}
).bind(this))
};
DwtButton.prototype.setDisplayState=function(t,e){
if(this._selected&&t!=DwtControl.SELECTED&&!e){
t=[DwtControl.SELECTED,t].join(" ")
}
DwtLabel.prototype.setDisplayState.call(this,t)
};
DwtButton.prototype.setEnabled=function(t){
if(t!=this._enabled){
DwtLabel.prototype.setEnabled.call(this,t);
if(t){
var a=(AjxEnv.isIE)?this.getHtmlElement().firstChild:null;
if(a){
var e=a.className;
a.className="";
a.className=e
}
this._addMouseListeners();
if(this._menu){
this._setDropDownCellMouseHandlers(true);
if(this._dropDownEl&&this._dropDownImg){
AjxImg.setImage(this._dropDownEl,this._dropDownImg)
}}}else{
this._removeMouseListeners();
if(this._menu){
this._setDropDownCellMouseHandlers(false);
if(this._dropDownEl&&this._dropDownImg){
AjxImg.setDisabledImage(this._dropDownEl,this._dropDownImg)
}}}}};
DwtButton.prototype.setImage=function(e,t){
if(this.whatToShow&&!this.whatToShow.showImage){
return
}
DwtLabel.prototype.setImage.call(this,e,t);
this._setMinWidth()
};
DwtButton.prototype.setText=function(e){
if(this.whatToShow&&!this.whatToShow.showText){
return
}
DwtLabel.prototype.setText.call(this,e);
this._setMinWidth()
};
DwtButton.prototype._setMinWidth=function(){
if(this.getText()!=null){
Dwt.addClass(this.getHtmlElement(),"ZHasText")
}else{
Dwt.delClass(this.getHtmlElement(),"ZHasText")
}};
DwtButton.prototype.setHoverImage=function(t,e){
e=e||(this._style&DwtLabel.IMAGE_RIGHT?DwtLabel.RIGHT:DwtLabel.LEFT);
this._hoverImageInfo=this._hoverImageInfo||{};
this._hoverImageInfo[e]=t
};
DwtButton.prototype.setMenu=function(e){
e=Dwt.getParams(arguments,DwtButton.setMenuParams,(arguments.length==1&&arguments[0]&&!arguments[0].menu));
if(e){
this._menu=e.menu
}
if(this._menu){
if(this._menu.isDwtMenu){
this._shouldToggleMenu=(e.shouldToggle===true);
if(e.popupAbove){
this._menuPopupStyle=DwtButton.MENU_POPUP_STYLE_ABOVE
}else{
if(e.popupRight){
this._menuPopupStyle=DwtButton.MENU_POPUP_STYLE_RIGHT
}else{
this._menuPopupStyle=e.menuPopupStyle||DwtButton.MENU_POPUP_STYLE_BELOW
}}
this._menuAdded(this._menu)
}else{
this._savedMenuParams=e
}
if(this._dropDownEl){
Dwt.addClass(this.getHtmlElement(),"ZHasDropDown");
if(this._dropDownImg){
AjxImg.setImage(this._dropDownEl,this._dropDownImg)
}
if(this._enabled){
this._setDropDownCellMouseHandlers(true)
}
if(this._menu.isDwtMenu){
this._menu.setAssociatedElementId(this._dropDownEl.id)
}}
if((this.__preventMenuFocus!=null)&&this._menu.isDwtMenu){
this._menu.dontStealFocus(this.__preventMenuFocus)
}}else{
if(this._dropDownEl){
Dwt.delClass(this.getHtmlElement(),"ZHasDropDown");
this._dropDownEl.innerHTML=""
}}};
DwtButton.setMenuParams=["menu","shouldToggle","followIconStyle","popupAbove","popupRight"];
DwtButton.prototype._setDropDownCellMouseHandlers=function(e){
this._dropDownEventsEnabled=e
};
DwtButton.prototype.getMenu=function(e){
if(this._menu&&this._menu.isAjxCallback){
if(e){
return null
}
var a=this._menu;
var t=this._savedMenuParams||{};
t.menu=a.run(this);
this.setMenu(t);
if((this.__preventMenuFocus!=null)&&(this._menu.isDwtMenu)){
this._menu.dontStealFocus(this.__preventMenuFocus)
}}
if(this._menu){
this.setAttribute("menuId",this._menu._htmlElId)
}
return this._menu
};
DwtButton.prototype.resetClassName=function(){
this.setDisplayState(DwtControl.NORMAL)
};
DwtButton.prototype.setActionTiming=function(e){
this._actionTiming=e
};
DwtButton.prototype.setHovered=function(e){
this.setDisplayState(e?DwtControl.HOVER:DwtControl.NORMAL)
};
DwtButton.prototype.setEnabledImage=function(e){
this._enabledImageInfo=e;
this.setImage(e)
};
DwtButton.prototype.setDepressedImage=function(e){
this._depressedImageInfo=e
};
DwtButton.prototype.setSelected=function(e){
if(this._selected!=e){
this._selected=e;
this.setDisplayState(e?DwtControl.SELECTED:DwtControl.NORMAL)
}};
DwtButton.prototype.isToggled=function(){
return this._selected
};
DwtButton.prototype.popup=function(o,t){
o=o||this.getMenu();
if(!o){
return
}
var c=o.parent;
var s=c.getBounds();
var l=o.shell.getSize();
var a=o.getSize();
var d=c.getHtmlElement();
var i=Dwt.toWindow(d,0,0);
var e=(d.style.borderLeftWidth=="")?0:parseInt(d.style.borderLeftWidth);
var u=Boolean(t&&DwtKeyEvent.isKeyEvent(t));
var h;
if(this._menuPopupStyle==DwtButton.MENU_POPUP_STYLE_RIGHT){
h=i.x+s.width-a.x
}else{
if(this._menuPopupStyle==DwtButton.MENU_POPUP_STYLE_CASCADE){
h=i.x+s.width
}else{
h=i.x+e;
h=((h+a.x)>=l.x)?l.x-a.x:h
}}
var r;
if(this._menuPopupStyle==DwtButton.MENU_POPUP_STYLE_ABOVE){
r=i.y-a.y
}else{
if(this._menuPopupStyle==DwtButton.MENU_POPUP_STYLE_CASCADE){
r=i.y
}else{
var n=(d.style.borderTopWidth=="")?0:parseInt(d.style.borderTopWidth);
n+=(d.style.borderBottomWidth=="")?0:parseInt(d.style.borderBottomWidth);
r=i.y+s.height+n
}}
o.popup(0,h,r,u);
o.setSelectedItem(0)
};
DwtButton.prototype.getKeyMapName=function(){
return DwtKeyMap.MAP_BUTTON
};
DwtButton.prototype.handleKeyAction=function(e,t){
switch(e){
case DwtKeyMap.SELECT:this._emulateSingleClick();
break;
case DwtKeyMap.SUBMENU:var a=this.getMenu();
if(!a){
return false
}
this._emulateDropDownClick();
a.setSelectedItem(0);
break
}
return true
};
DwtButton.prototype.removePullDownMenuOptions=function(){
if(this._menu){
this._setDropDownCellMouseHandlers(false);
if(this._dropDownEl&&this._dropDownImg){
AjxImg.setImage(this._dropDownEl,"");
this.setDropDownImages("","","","")
}}};
DwtButton.prototype._emulateSingleClick=function(){
this.trigger();
var e=this.getHtmlElement();
var t=Dwt.toWindow(e);
var a=new DwtMouseEvent();
this._setMouseEvent(a,{
type:this._actionTiming==DwtButton.ACTION_MOUSEDOWN?DwtEvent.ONMOUSEDOWN:DwtEvent.ONMOUSEUP,dwtObj:this,target:e,button:DwtMouseEvent.LEFT,docX:t.x,docY:t.y,kbNavEvent:true}
);
this.notifyListeners(a.type,a)
};
DwtButton.prototype._emulateDropDownClick=function(){
var e=this._dropDownEl;
if(!e){
return
}
var t=Dwt.toWindow(e);
var a=new DwtMouseEvent();
this._setMouseEvent(a,{
dwtObj:this,target:e,button:DwtMouseEvent.LEFT,docX:t.x,docY:t.y,kbNavEvent:true}
);
DwtButton._dropDownCellMouseUpHdlr(a)
};
DwtButton.prototype._focusByMouseUpEvent=function(){};
DwtButton.prototype._focus=function(){
this.setDisplayState(DwtControl.FOCUSED)
};
DwtButton.prototype._blur=function(){
this.setDisplayState(DwtControl.NORMAL)
};
DwtButton.prototype._toggleMenu=function(e){
if(this._shouldToggleMenu){
var t=this.getMenu();
if(!t.isPoppedUp()){
this.popup(null,e);
this._menuUp=true
}else{
t.popdown(0,e);
this._menuUp=false;
this.deactivate()
}}else{
this.popup(null,e)
}};
DwtButton.prototype._isDropDownEvent=function(t){
if(this._dropDownEventsEnabled&&this._dropDownEl){
var e=t.docX;
var a=Dwt.toWindow(this._dropDownEl,0,0,window).x;
if(e>=a){
return true
}}
return false
};
DwtButton.prototype.trigger=function(){
if(this._depressedImageInfo){
this.setImage(this._depressedImageInfo)
}
this.setDisplayState(DwtControl.ACTIVE,true);
this.isActive=true
};
DwtButton.prototype.deactivate=function(){
this._showHoverImage(true);
if(this._style&DwtButton.TOGGLE_STYLE){
this._selected=!this._selected
}
this.setDisplayState(DwtControl.HOVER)
};
DwtButton.prototype.dontStealFocus=function(e){
if(e==null){
e=true
}
if(this._menu&&this._menu.isDwtMenu){
this._menu.dontStealFocus(e)
}
this.__preventMenuFocus=e
};
DwtButton.prototype._toggleHoverClass=function(t,i){
var e=this._getIconEl(i);
if(e){
var a=t?this._hoverImageInfo[i]:this.__imageInfo[i];
e.firstChild.className=AjxImg.getClassForImage(a)
}};
DwtButton.prototype._showHoverImage=function(e){
if(!this._hoverImageInfo){
return
}
if(this._hoverImageInfo.left){
this._toggleHoverClass(e,DwtLabel.LEFT)
}
if(this._hoverImageInfo.right){
this._toggleHoverClass(e,DwtLabel.RIGHT)
}};
DwtButton.prototype._handleClick=function(t){
if(this.isListenerRegistered(DwtEvent.SELECTION)){
var e=(new Date()).getTime();
if(!this._lastNotify||(e-this._lastNotify>DwtButton.NOTIFY_WINDOW)){
var a=DwtShell.selectionEvent;
DwtUiEvent.copy(a,t);
a.item=this;
a.detail=(typeof this.__detail=="undefined")?0:this.__detail;
this.notifyListeners(DwtEvent.SELECTION,a);
this._lastNotify=e;
this.shell.notifyGlobalSelection(a)
}}else{
if(this._menu){
if(this._menu.isDwtMenu&&!this.isListenerRegistered(DwtEvent.SELECTION)){
this._menu.setAssociatedObj(this)
}
this._toggleMenu(t)
}}};
DwtButton.prototype._setMouseOutClassName=function(){
this.setDisplayState(DwtControl.NORMAL)
};
DwtButton.prototype._createHtmlFromTemplate=function(e,t){
DwtLabel.prototype._createHtmlFromTemplate.call(this,e,t);
this._dropDownEl=document.getElementById(t.id+"_dropdown")
};
DwtButton.prototype._menuAdded=function(e){
this.setAttribute("aria-haspopup",true);
this.setAttribute("aria-controls",e._htmlElId)
};
DwtButton.prototype._menuItemSelected=function(e){};
DwtButton._dropDownCellMouseDownHdlr=function(t){
var a=DwtControl.getTargetControl(t);
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t,a);
if(e.button==DwtMouseEvent.LEFT){
if(this._depImg){
AjxImg.setImage(this,this._depImg)
}}
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
};
DwtButton._dropDownCellMouseUpHdlr=function(t){
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t);
if(e.button==DwtMouseEvent.LEFT){
if(this._dropDownHovImg&&!this.noMenuBar){
AjxImg.setImage(this,this._dropDownHovImg)
}
DwtEventManager.notifyListeners(DwtEvent.ONMOUSEDOWN,e);
var i=DwtControl.getTargetControl(t);
if(i){
if(i.getMenu()&&i.getMenu().isPoppedUp()){
i.getMenu().popdown()
}else{
if(i._menu&&i._menu.isAjxCallback){
i.popup()
}
if(i._dropDownEvtMgr.isListenerRegistered(DwtEvent.SELECTION)){
var a=DwtShell.selectionEvent;
DwtUiEvent.copy(a,e);
a.item=i;
i._dropDownEvtMgr.notifyListeners(DwtEvent.SELECTION,a)
}else{
i._toggleMenu(t)
}}}}
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
};
DwtButton._mouseOverListener=function(i){
var t=i.dwtObj;
if(!t){
return false
}
t._showHoverImage(true);
t.setDisplayState(DwtControl.HOVER);
var o=t._dropDownEl;
if(t._menu&&o&&t._dropDownHovImg&&!t.noMenuBar&&t.isListenerRegistered(DwtEvent.SELECTION)){
if(t._dropDownHovImg){
AjxImg.setImage(o,t._dropDownHovImg)
}}
if(AjxEnv.isIE){
if(i&&i.target&&i.target.firstChild){
var a=i.target.firstChild;
var e=a.className;
a.className="";
a.className=e
}}
i._stopPropagation=true
};
DwtButton._mouseOutListener=function(t){
var e=t.dwtObj;
if(!e){
return false
}
e._showHoverImage(false);
e._setMouseOutClassName();
e.isActive=false;
var a=e._dropDownEl;
if(e._menu&&a&&e._dropDownImg){
AjxImg.setImage(a,e._dropDownImg)
}};
DwtButton._mouseDownListener=function(t){
var e=t.dwtObj;
if(!e){
return false
}
if(e._isDropDownEvent(t)){
return DwtButton._dropDownCellMouseDownHdlr(t)
}
if(t.button!=DwtMouseEvent.LEFT){
return
}
var a=e._dropDownEl;
if(e._menu&&a&&e._dropDownDepImg){
AjxImg.setImage(a,e._dropDownDepImg)
}
switch(e._actionTiming){
case DwtButton.ACTION_MOUSEDOWN:e.trigger();
e._handleClick(t);
break;
case DwtButton.ACTION_MOUSEUP:e.trigger();
break
}};
DwtButton._mouseUpListener=function(a){
var e=a.dwtObj;
if(!e){
return false
}
if(e._isDropDownEvent(a)){
return DwtButton._dropDownCellMouseUpHdlr(a)
}
if(a.button!=DwtMouseEvent.LEFT){
return
}
var i=e._dropDownEl;
if(e._menu&&i&&e._dropDownHovImg&&!e.noMenuBar){
AjxImg.setImage(i,e._dropDownHovImg)
}
switch(e._actionTiming){
case DwtButton.ACTION_MOUSEDOWN:e.deactivate();
break;
case DwtButton.ACTION_MOUSEUP:var t=e.getHtmlElement();
if(e.isActive){
e.deactivate();
e._handleClick(a)
}
break
}};
DwtButton._listeners={};
DwtButton._listeners[DwtEvent.ONMOUSEOVER]=new AjxListener(null,DwtButton._mouseOverListener);
DwtButton._listeners[DwtEvent.ONMOUSEOUT]=new AjxListener(null,DwtButton._mouseOutListener);
DwtButton._listeners[DwtEvent.ONMOUSEDOWN]=new AjxListener(null,DwtButton._mouseDownListener);
DwtButton._listeners[DwtEvent.ONMOUSEUP]=new AjxListener(null,DwtButton._mouseUpListener);
DwtButton._listeners[DwtEvent.ONMOUSEENTER]=new AjxListener(null,DwtButton._mouseOverListener);
DwtButton._listeners[DwtEvent.ONMOUSELEAVE]=new AjxListener(null,DwtButton._mouseOutListener)
}
if(AjxPackage.define("ajax.dwt.widgets.DwtLinkButton")){
DwtLinkButton=function(e){
e.className=e.className||"ZButtonLink";
this._noDropDown=e.noDropDown;
this._elementTag=e.elementTag;
DwtButton.call(this,e)
};
DwtLinkButton.prototype=new DwtButton;
DwtLinkButton.prototype.constructor=DwtLinkButton;
DwtLinkButton.prototype.TEMPLATE="dwt.Widgets#ZLinkButton";
DwtLinkButton.prototype._dropDownImg=null;
DwtLinkButton.prototype._dropDownDepImg=null;
DwtLinkButton.prototype._dropDownHovImg=null;
DwtLinkButton.prototype.toString=function(){
return"DwtLinkButton"
};
DwtLinkButton.prototype._createHtmlFromTemplate=function(e,t){
t=t||{};
t.noDropDown=this._noDropDown;
DwtButton.prototype._createHtmlFromTemplate.call(this,e,t)
};
DwtLinkButton.prototype._createElement=function(){
return document.createElement(this._elementTag||"SPAN")
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtBorderlessButton")){
DwtBorderlessButton=function(e){
if(arguments.length==0){
return
}
e=Dwt.getParams(arguments,DwtBorderlessButton.PARAMS);
DwtButton.call(this,e)
};
DwtBorderlessButton.PARAMS=["parent","style","className","posStyle","actionTiming","id","index"];
DwtBorderlessButton.prototype=new DwtButton;
DwtBorderlessButton.prototype.constructor=DwtBorderlessButton;
DwtBorderlessButton.prototype.toString=function(){
return"DwtBorderlessButton"
};
DwtBorderlessButton.prototype.TEMPLATE="dwt.Widgets#ZBorderlessButton"
}
if(AjxPackage.define("ajax.dwt.widgets.DwtMenuItem")){
DwtMenuItem=function(i){
if(arguments.length==0){
return
}
i=Dwt.getParams(arguments,DwtMenuItem.PARAMS);
var a=i.parent;
if(!(a&&a.isDwtMenu)){
throw new DwtException("Parent must be a DwtMenu object",DwtException.INVALIDPARENT,"DwtMenuItem")
}
var t=i.style=i.style||DwtMenuItem.NO_STYLE;
if(a._style==DwtMenu.BAR_STYLE&&t!=DwtMenuItem.PUSH_STYLE){
throw new DwtException("DwtMenuItemInit: invalid style",DwtException.INVALID_PARAM,"DwtMenuItem")
}
i.className=i.className||"ZMenuItem";
t&=~DwtLabel.IMAGE_RIGHT;
t|=DwtButton.ALWAYS_FLAT|DwtLabel.IMAGE_LEFT;
var e=(t&DwtMenuItem.SEPARATOR_STYLE);
if(e){
i.className="ZMenuItemSeparator";
this.isFocusable=false;
this.role=null
}
i.listeners=DwtMenuItem._listeners;
DwtButton.call(this,i);
this.setDropDownImages("Cascade","Cascade","Cascade","Cascade");
this._radioGroupId=i.radioGroupId;
if(a._addItem){
a._addItem(this,i.index)
}
if(!e){
this.addSelectionListener(this.__handleItemSelect.bind(this))
}};
DwtMenuItem.PARAMS=["parent","style","radioGroupId","index","className","posStyle","id"];
DwtMenuItem.prototype=new DwtButton;
DwtMenuItem.prototype.constructor=DwtMenuItem;
DwtMenuItem.prototype.isDwtMenuItem=true;
DwtMenuItem.prototype.toString=function(){
return"DwtMenuItem"
};
DwtMenuItem.prototype.role="menuitem";
DwtMenuItem.CHECKED=1;
DwtMenuItem.UNCHECKED=2;
DwtMenuItem.NO_STYLE=0;
DwtMenuItem.CHECK_STYLE=DwtButton._LAST_STYLE*2;
DwtMenuItem.RADIO_STYLE=DwtButton._LAST_STYLE*4;
DwtMenuItem.SEPARATOR_STYLE=DwtButton._LAST_STYLE*8;
DwtMenuItem.CASCADE_STYLE=DwtButton._LAST_STYLE*16;
DwtMenuItem.PUSH_STYLE=DwtButton._LAST_STYLE*32;
DwtMenuItem.SELECT_STYLE=DwtButton._LAST_STYLE*64;
DwtMenuItem._LAST_STYLE=DwtMenuItem.SELECT_STYLE;
DwtMenuItem._MENU_POPUP_DELAY=250;
DwtMenuItem._MENU_POPDOWN_DELAY=250;
DwtMenuItem.prototype.TEMPLATE="dwt.Widgets#ZMenuItem";
DwtMenuItem.prototype.SEPARATOR_TEMPLATE="dwt.Widgets#ZMenuItemSeparator";
DwtMenuItem.prototype.BLANK_CHECK_TEMPLATE="dwt.Widgets#ZMenuItemBlankCheck";
DwtMenuItem.prototype.BLANK_ICON_TEMPLATE="dwt.Widgets#ZMenuItemBlankIcon";
DwtMenuItem.prototype.BLANK_CASCADE_TEMPLATE="dwt.Widgets#ZMenuItemBlankCascade";
DwtMenuItem.prototype.dispose=function(){
delete this._checkEl;
DwtButton.prototype.dispose.call(this)
};
DwtMenuItem.create=function(t){
var e=new DwtMenuItem(t);
if(t.imageInfo){
e.setImage(t.imageInfo)
}
if(t.text){
e.setText(t.text)
}
e.setEnabled(t.enabled!==false);
return e
};
DwtMenuItem.prototype.getChecked=function(){
return this._itemChecked
};
DwtMenuItem.prototype.setChecked=function(t,e){
this._setChecked(t,null,e);
this.parent._checkItemAdded(this)
};
DwtMenuItem.prototype.setImage=function(e){
DwtButton.prototype.setImage.call(this,e);
this.parent._iconItemAdded(this)
};
DwtMenuItem.prototype.setText=function(e){
DwtButton.prototype.setText.call(this,e);
if(this.parent.isPoppedUp()){
this.parent.render()
}};
DwtMenuItem.prototype.setMenu=function(e){
var e=Dwt.getParams(arguments,DwtButton.setMenuParams);
DwtButton.prototype.setMenu.call(this,e);
this.parent._submenuItemAdded(this)
};
DwtMenuItem.prototype.setHoverDelay=function(e){
this._hoverDelay=e
};
DwtMenuItem.prototype.setShortcut=function(e){
if(e&&this._dropDownEl){
this._dropDownEl.innerHTML=e
}};
DwtMenuItem.prototype.setSelectableWithSubmenu=function(e){
this._selectableWithSubmenu=e
};
DwtMenuItem.prototype.isSeparator=function(){
return Boolean(this._style&DwtMenuItem.SEPARATOR_STYLE)
};
DwtMenuItem.prototype.handleKeyAction=function(e,t){
if(this.parent){
return this.parent.handleKeyAction(e,t)
}else{
return DwtButton.prototype.handleKeyAction.call(this,e,t)
}};
DwtMenuItem.prototype.getKeyMapName=function(){
return DwtKeyMap.MAP_MENU
};
DwtMenuItem.prototype._createHtml=function(e){
var t=this.isSeparator()?this.SEPARATOR_TEMPLATE:this.TEMPLATE;
DwtButton.prototype._createHtml.call(this,e||t)
};
DwtMenuItem.prototype._createHtmlFromTemplate=function(e,t){
DwtButton.prototype._createHtmlFromTemplate.call(this,e,t);
this._checkEl=document.getElementById(t.id+"_check")
};
DwtMenuItem.prototype._setChecked=function(n,o,t){
var e=this._style&DwtMenuItem.CHECK_STYLE;
var i=this._style&DwtMenuItem.RADIO_STYLE;
if((e||i)&&this._itemChecked!=n){
this._itemChecked=n;
if(this._checkEl){
this._checkEl.innerHTML="";
var a=n?(e?"MenuCheck":"MenuRadio"):"Blank_9";
AjxImg.setImage(this._checkEl,a);
if(n){
if(i){
this.parent._radioItemSelected(this,t)
}}}}};
DwtMenuItem.prototype._checkItemAdded=function(e){};
DwtMenuItem.prototype._checkedItemsRemoved=function(){};
DwtMenuItem.prototype._submenuItemAdded=function(){
if(this.isSeparator()){
return
}
if(this._cascCell==null){
this._cascCell=this._row.insertCell(-1);
this._cascCell.noWrap=true
}};
DwtMenuItem.prototype._submenuItemRemoved=function(){
if(this._dropDownEl){
this._dropDownEl.innerHTML=""
}};
DwtMenuItem.prototype._popupMenu=function(o,d){
var e=this.getMenu();
var t=this.parent.parent;
var l=this.getBounds();
var n=e.shell.getSize();
var u=e.getSize();
var c;
var r;
var i;
var h;
var a=t.getHtmlElement();
if(t._style==DwtMenu.BAR_STYLE){
i=(a.style.borderLeftWidth=="")?0:parseInt(a.style.borderLeftWidth);
c=l.x+i;
h=(a.style.borderTopWidth=="")?0:parseInt(a.style.borderTopWidth);
h+=(a.style.borderBottomWidth=="")?0:parseInt(a.style.borderBottonWidth);
r=l.y+l.height+h;
c=((c+u.x)>=n.x)?c-(c+u.x-n.x):c
}else{
i=(a.style.borderLeftWidth=="")?0:parseInt(a.style.borderLeftWidth);
i+=(a.style.borderRightWidth=="")?0:parseInt(a.style.borderRightWidth);
c=l.x+l.width+i;
h=(a.style.borderTopWidth=="")?0:parseInt(a.style.borderTopWidth);
r=l.y+h;
if(e.centerOnParentVertically()){
r+=l.height/2
}}
e.popup(o,c,r,d)
};
DwtMenuItem.prototype._popdownMenu=function(){
var e=this.getMenu();
if(e){
e.popdown()
}};
DwtMenuItem.prototype._isMenuPoppedUp=function(){
var e=this.getMenu();
return(e&&e.isPoppedUp())
};
DwtMenuItem.prototype._blur=function(){
var e=this.parent;
var t=new DwtMouseEvent();
this._setMouseEvent(t,{
dwtObj:this,ersatz:true,type:DwtEvent.ONMOUSEOUT}
);
this.notifyListeners(DwtEvent.ONMOUSEOUT,t);
e.__currentItem=null;
DwtButton.prototype._blur.call(this)
};
DwtMenuItem.prototype._focus=function(){
var t=this.parent;
var e=t.__currentItem;
var a=new DwtMouseEvent();
if(e&&e!=this){
e.blur()
}
this._setMouseEvent(a,{
dwtObj:this,ersatz:true}
);
this.notifyListeners(AjxEnv.isIE?DwtEvent.ONMOUSEENTER:DwtEvent.ONMOUSEOVER,a);
t.__currentItem=this;
DwtButton.prototype._focus.call(this)
};
DwtMenuItem.prototype.__handleItemSelect=function(e){
this.setDisplayState(DwtControl.NORMAL);
if(this.isStyle(DwtMenuItem.CHECK_STYLE)){
this._setChecked(!this._itemChecked,null,true);
e.detail=this.getChecked()?DwtMenuItem.CHECKED:DwtMenuItem.UNCHECKED
}else{
if(this.isStyle(DwtMenuItem.RADIO_STYLE)){
this._setChecked(true,true);
this.parent._radioItemSelected(this,true);
e.detail=this.getChecked()?DwtMenuItem.CHECKED:DwtMenuItem.UNCHECKED
}else{
if(this.isStyle(DwtMenuItem.PUSH_STYLE)){
if(this._menu){
if(this._isMenuPoppedUp()){
DwtMenu.closeActiveMenu(e)
}else{
this._popupMenu(DwtKeyEvent.isKeyEvent(ev))
}}
return
}}}
if(!this.isStyle(DwtMenuItem.CASCADE_STYLE)){
if(this._selectableWithSubmenu||!this._menu||!this._menu.isPoppedUp||!this._menu.isPoppedUp()){
DwtMenu.closeActiveMenu(e)
}}};
DwtMenuItem._mouseOverListener=function(t){
var e=t.dwtObj;
if(!e){
return false
}
var a=e.parent;
if(e.isSeparator()){
return false
}
DwtButton._mouseOverListener(t,e);
if(!t.ersatz){
a._popdownSubmenus()
}
if(!e.hasFocus()&&e.getEnabled()){
e.focus()
}
if(e._menu&&!t.ersatz){
e._popupMenu(e._hoverDelay)
}};
DwtMenuItem._mouseOutListener=function(a){
var t=a.dwtObj;
var e=t&&t.getMenu();
if(e&&e.isPoppedUp()){
return
}
DwtButton._mouseOutListener(a)
};
DwtMenuItem.prototype.getRowElement=function(){
var e=this._textEl||this._dropDownEl||(this._iconEl&&this._iconEl.left)||(this._iconEl&&this._iconEl.right);
if(e){
return e.parentNode
}};
DwtMenuItem._listeners={};
DwtMenuItem._listeners[DwtEvent.ONMOUSEOVER]=DwtMenuItem._mouseOverListener.bind();
DwtMenuItem._listeners[DwtEvent.ONMOUSEOUT]=DwtMenuItem._mouseOutListener.bind();
DwtMenuItem._listeners[DwtEvent.ONMOUSEDOWN]=DwtButton._mouseDownListener.bind();
DwtMenuItem._listeners[DwtEvent.ONMOUSEUP]=DwtButton._mouseUpListener.bind();
DwtMenuItem._listeners[DwtEvent.ONMOUSEENTER]=DwtMenuItem._mouseOverListener.bind();
DwtMenuItem._listeners[DwtEvent.ONMOUSELEAVE]=DwtButton._mouseOutListener.bind()
}
if(AjxPackage.define("ajax.dwt.widgets.DwtMenu")){
DwtMenu=function(i){
this._created=false;
if(arguments.length==0){
return
}
i=Dwt.getParams(arguments,DwtMenu.PARAMS);
this._origStyle=i.style;
var t=i.parent;
if(t){
if(t instanceof DwtMenuItem||t instanceof DwtButton){
if((i.style==DwtMenu.GENERIC_WIDGET_STYLE)||(i.style==DwtMenu.DROPDOWN_CENTERV_STYLE)){
this._style=i.style
}else{
this._style=DwtMenu.DROPDOWN_STYLE
}}else{
this._style=i.style||DwtMenu.POPUP_STYLE
}
if(!i.posStyle){
i.posStyle=(this._style==DwtMenu.BAR_STYLE)?DwtControl.STATIC_STYLE:DwtControl.ABSOLUTE_STYLE
}}
i.className=i.className||"DwtMenu";
this._layoutStyle=i.layout==null||i.layout;
if(this._layoutStyle===true){
this._layoutStyle=DwtMenu.LAYOUT_CASCADE
}else{
if(this._layoutStyle===false){
this._layoutStyle=DwtMenu.LAYOUT_STACK
}}
this._maxRows=this._layoutStyle&&i.maxRows||0;
this._congruent=i.congruent;
i.parent=(t instanceof DwtShell)?t:t.shell;
DwtComposite.call(this,i);
this.parent=t;
if(this._isPopupStyle()&&(this._layoutStyle==DwtMenu.LAYOUT_STACK)){
this.setScrollStyle(DwtControl.SCROLL)
}
if(!t){
return
}
var e=AjxEnv.isIE?[DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEUP]:[DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEUP,DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEOUT];
this._setEventHdlrs(e);
this._hasSetMouseEvents=true;
var a=this.getHtmlElement();
if(i.posStyle!=DwtControl.STATIC_STYLE){
Dwt.setLocation(a,Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE)
}
if(this._style!=DwtMenu.COLOR_PICKER_STYLE&&this._style!=DwtMenu.CALENDAR_PICKER_STYLE&&this._style!=DwtMenu.GENERIC_WIDGET_STYLE){
this._table=document.createElement("table");
this._table.border=this._table.cellPadding=this._table.cellSpacing=0;
this._table.className="DwtMenuTable";
this._table.id=Dwt.getNextId();
if(this._layoutStyle==DwtMenu.LAYOUT_SCROLL){
this._setupScroll()
}else{
a.appendChild(this._table)
}
this._table.backgroundColor=DwtCssStyle.getProperty(a,"background-color")
}
if(i.style!=DwtMenu.BAR_STYLE){
this.setVisible(false);
this._isPoppedUp=false
}else{
DwtMenu._activeMenuIds.add(a.id,null,true);
this._isPoppedUp=true
}
this._popdownAction=new AjxTimedAction(this,this._doPopdown);
this._popdownActionId=-1;
this._popupAction=new AjxTimedAction(this,this._doPopup);
this._popupActionId=-1;
this._outsideListener=new AjxListener(null,DwtMenu._outsideMouseDownListener);
this._menuItemsHaveChecks=false;
this._menuItemsHaveIcons=false;
this._menuItemsWithSubmenus=0;
this.__currentItem=null;
this.__preventMenuFocus=false;
this._created=true;
this._itemSelectionListener=new AjxListener(this,this._propagateItemSelection);
if(t._menuAdded){
t._menuAdded(this)
}};
DwtMenu.PARAMS=["parent","style","className","posStyle","cascade","id"];
DwtMenu.prototype=new DwtComposite;
DwtMenu.prototype.constructor=DwtMenu;
DwtMenu.prototype.isDwtMenu=true;
DwtMenu.prototype.toString=function(){
return"DwtMenu"
};
DwtMenu.prototype.role="menu";
DwtMenu.BAR_STYLE="BAR";
DwtMenu.POPUP_STYLE="POPUP";
DwtMenu.DROPDOWN_STYLE="DROPDOWN";
DwtMenu.DROPDOWN_CENTERV_STYLE="DROPDOWN_CENTERV";
DwtMenu.COLOR_PICKER_STYLE="COLOR";
DwtMenu.CALENDAR_PICKER_STYLE="CALENDAR";
DwtMenu.GENERIC_WIDGET_STYLE="GENERIC";
DwtMenu.HAS_ICON="ZHasIcon";
DwtMenu.HAS_CHECK="ZHasCheck";
DwtMenu.HAS_SUBMENU="ZHasSubMenu";
DwtMenu.LAYOUT_STACK=0;
DwtMenu.LAYOUT_CASCADE=1;
DwtMenu.LAYOUT_SCROLL=2;
DwtMenu._activeMenuUp=false;
DwtMenu._activeMenuIds=new AjxVector();
DwtMenu._activeMenus=new AjxVector();
DwtMenu.prototype.dispose=function(){
this._table=null;
DwtComposite.prototype.dispose.call(this);
if(!(this.parent instanceof DwtShell)){
this.shell.removeChild(this)
}};
DwtMenu.prototype.addSelectionListener=function(e){
this.addListener(DwtEvent.SELECTION,e)
};
DwtMenu.prototype.removeSelectionListener=function(e){
this.removeListener(DwtEvent.SELECTION,e)
};
DwtMenu.prototype.addPopupListener=function(e){
this.addListener(DwtEvent.POPUP,e)
};
DwtMenu.prototype.removePopupListener=function(e){
this.removeListener(DwtEvent.POPUP,e)
};
DwtMenu.prototype.addPopdownListener=function(e){
this.addListener(DwtEvent.POPDOWN,e)
};
DwtMenu.prototype.removePopdownListener=function(e){
this.removeListener(DwtEvent.POPDOWN,e)
};
DwtMenu.prototype.setWidth=function(e){
this._width=e;
if(this._table){
Dwt.setSize(this._table,e,Dwt.CLEAR)
}};
DwtMenu.prototype.centerOnParentVertically=function(){
return(this._style===DwtMenu.DROPDOWN_CENTERV_STYLE)
};
DwtMenu.prototype._isPopupStyle=function(){
return(this._style===DwtMenu.POPUP_STYLE||this._style===DwtMenu.DROPDOWN_STYLE||this._style===DwtMenu.DROPDOWN_CENTERV_STYLE)
};
DwtMenu.prototype.getItem=function(e){
return this._children.get(e)
};
DwtMenu.prototype.getItemIndex=function(e){
return this._children.indexOf(e)
};
DwtMenu.prototype.getItemById=function(a,n){
var e=this.getItems();
for(var t=0;
t<e.length;
t++){
var o=e[t].getData(a);
if(o==n){
e[t].index=t;
return e[t]
}}
return null
};
DwtMenu.prototype.getItemCount=function(){
return this._children.size()
};
DwtMenu.prototype.getItems=function(){
return this._children.getArray()
};
DwtMenu.prototype.getSelectedItem=function(n){
var e=this._children.getArray();
for(var o=0;
o<e.length;
o++){
var t=e[o];
if((n==null||(t._style&&n!=0))&&t.getChecked()){
return t
}}
return null
};
DwtMenu.prototype.isPoppedUp=function(){
return this._isPoppedUp
};
DwtMenu.prototype.popup=function(a,e,i,t){
if(this._style==DwtMenu.BAR_STYLE){
return
}
if(this._popdownActionId!=-1){
AjxTimedAction.cancelAction(this._popdownActionId);
this._popdownActionId=-1
}else{
if(this._isPoppedUp||(this._popupActionId!=-1&&a&&a>0)){
return
}else{
if(this._popupActionId!=-1){
AjxTimedAction.cancelAction(this._popupActionId);
this._popupActionId=-1
}}
if(!a){
this._doPopup(e,i,t)
}else{
this._popupAction.args=[e,i,t];
this._popupActionId=AjxTimedAction.scheduleAction(this._popupAction,a)
}}};
DwtMenu.prototype.popdown=function(t,e){
if(this._style==DwtMenu.BAR_STYLE){
return
}
if(this._popupActionId!=-1){
AjxTimedAction.cancelAction(this._popupActionId);
this._popupActionId=-1
}else{
if(!this._isPoppedUp||this._popdownActionId!=-1){
return
}
if(t==null||t==0){
this._doPopdown(e)
}else{
this._popdownActionId=AjxTimedAction.scheduleAction(this._popdownAction,t)
}}};
DwtMenu.prototype._setupScroll=function(){
var r=this.getHtmlElement();
this._table.style.position="relative";
this._topScroller=document.createElement("div");
this._topScroller.className="DwtMenuScrollTop";
this._topScroller.id=Dwt.getNextId();
this._imgDivTop=document.createElement("div");
this._imgDivTop.className="ImgUpArrowSmall";
this._topScroller.appendChild(this._imgDivTop);
Dwt.setHandler(this._imgDivTop,DwtEvent.ONMOUSEOUT,DwtMenu._stopEvent);
Dwt.setHandler(this._imgDivTop,DwtEvent.ONMOUSEOVER,DwtMenu._stopEvent);
r.appendChild(this._topScroller);
this._tableContainer=document.createElement("div");
this._tableContainer.appendChild(this._table);
r.appendChild(this._tableContainer);
this._bottomScroller=document.createElement("div");
this._bottomScroller.className="DwtMenuScrollBottom";
this._bottomScroller.id=Dwt.getNextId();
this._imgDivBottom=document.createElement("div");
this._imgDivBottom.className="ImgDownArrowSmall";
Dwt.setHandler(this._imgDivBottom,DwtEvent.ONMOUSEOUT,DwtMenu._stopEvent);
Dwt.setHandler(this._imgDivBottom,DwtEvent.ONMOUSEOVER,DwtMenu._stopEvent);
this._bottomScroller.appendChild(this._imgDivBottom);
r.appendChild(this._bottomScroller);
var a=AjxCallback.simpleClosure(this._scroll,this,this._table.id,true,false);
var e=AjxCallback.simpleClosure(this._scroll,this,this._table.id,false,false);
var t=AjxCallback.simpleClosure(this._handleMouseOut,this,this._topScroller.id,this._table.id);
var n=AjxCallback.simpleClosure(this._handleMouseOut,this,this._bottomScroller.id,this._table.id);
Dwt.setHandler(this._topScroller,DwtEvent.ONMOUSEDOWN,a);
Dwt.setHandler(this._topScroller,DwtEvent.ONMOUSEUP,e);
if(!AjxEnv.isIE){
Dwt.setHandler(this._topScroller,DwtEvent.ONMOUSEOUT,t)
}else{
Dwt.setHandler(this._topScroller,DwtEvent.ONMOUSELEAVE,e)
}
var o=AjxCallback.simpleClosure(this._scroll,this,this._table.id,true,true);
var i=AjxCallback.simpleClosure(this._scroll,this,this._table.id,false,true);
Dwt.setHandler(this._bottomScroller,DwtEvent.ONMOUSEDOWN,o);
Dwt.setHandler(this._bottomScroller,DwtEvent.ONMOUSEUP,i);
Dwt.setHandler(this._bottomScroller,DwtEvent.ONMOUSEUP,i);
if(!AjxEnv.isIE){
Dwt.setHandler(this._bottomScroller,DwtEvent.ONMOUSEOUT,n)
}else{
Dwt.setHandler(this._bottomScroller,DwtEvent.ONMOUSELEAVE,i)
}
var s=AjxCallback.simpleClosure(this._handleScroll,this,this._table.id);
Dwt.setHandler(r,DwtEvent.ONMOUSEWHEEL,s)
};
DwtMenu.prototype.render=function(k,w){
var T=this.shell.getSize();
var S=this.getSize();
var q=this.getHtmlElement();
T.y-=10+(AjxEnv.isIE?20:0);
T.x-=28;
var z=this._layoutStyle==DwtMenu.LAYOUT_SCROLL;
var s=this._isPopupStyle();
var W=this._layoutStyle==DwtMenu.LAYOUT_CASCADE;
if(this._table){
if(s&&W){
var F=T.y;
var M=null;
var v=this._table.rows;
var r=v.length;
var t=this._maxRows;
var O=S.y;
var g=F-25;
for(var C=r-1;
C>=0;
C--){
O-=Dwt.getSize(v[C]).y;
if(O<g){
break
}}
var p=t?Math.min(C+1,t):(C+1);
for(var B=p;
B<r;
B++){
var f=v[(B-p)%p];
var o=f.insertCell(-1);
o.className="DwtMenuCascadeCell";
var m=v[B].cells[0].firstChild;
while(m!=null){
o.appendChild(m);
m=m.nextSibling
}}
for(B=v.length-1;
B>=p;
B--){
this._table.deleteRow(p)
}
var d=r%p;
if(d>0){
for(var B=d;
B<p;
B++){
var f=v[B];
var o=f.insertCell(-1);
o.className="DwtMenuCascadeCell";
o.empty=true;
o.innerHTML="&nbsp;"
}}
S=this.getSize();
if(M){
w=M-S.y
}}else{
if(s&&z){
var v=this._table.rows;
var r=v.length;
var t=this._maxRows;
var u=t?Math.min(t,r):r;
var c=T.y-25;
var O=20;
for(var C=0;
C<u;
C++){
var e=Dwt.getSize(v[C]).y;
if(O+e<=c){
O+=e
}else{
break
}}
S.y=O
}}}
var H="auto";
var l="auto";
if(s&&z){
l=S.y;
if(this._tableContainer){
this._tableContainer.style.height=(l-20)+"px"
}}else{
if((s&&W)||w+S.y<T.y-5){
l="auto"
}else{
l=T.y-w-5
}}
if(z){
if(this._table){
this._table.style.width=S.x
}
H=S.x
}
this.setSize(H,l);
if((AjxEnv.isGeckoBased||AjxEnv.isSafari||(this._origStyle==DwtMenu.CALENDAR_PICKER_STYLE))&&this._table&&!z){
q.style.width=(S.x+(s&&!W?10:0))+"px"
}
var R=k+S.x>=T.x?T.x-S.x:k;
if(this.parent instanceof DwtMenuItem){
Dwt.delClass(q,"DwtMenu-congruentLeft");
Dwt.delClass(q,"DwtMenu-congruentRight");
var D=this.parent.getBounds();
var I=DwtCssStyle.getComputedStyleObject(this.parent.parent.getHtmlElement());
var a=DwtCssStyle.getComputedStyleObject(q);
if(((R>D.x&&R<D.x+D.width)||(D.x>=R&&D.x<R+S.x))&&D.x>=S.x){
var n=parseInt(a.width);
if(!AjxEnv.isIE){
n+=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+parseInt(a.borderLeftWidth)+parseInt(a.borderRightWidth)
}
R=(parseInt(I.left)||D.x)-(n||S.x);
if(this._congruent){
var d;
if(AjxEnv.isIE){
d=parseInt(a.borderLeftWidth)
}else{
d=parseInt(a.borderLeftWidth)+parseInt(a.borderRightWidth)
}
if(!isNaN(d)){
R+=d;
Dwt.addClass(q,"DwtMenu-congruentLeft")
}}}else{
var h=parseInt(I.left)||(D.x-(parseInt(I.paddingLeft)||0));
var A=parseInt(I.width)||D.width;
R=h+A;
if(this._congruent){
var d=parseInt(I.paddingRight)+parseInt(a.paddingLeft)+parseInt(a.borderLeftWidth);
if(!isNaN(d)){
R+=d;
Dwt.addClass(q,"DwtMenu-congruentRight")
}}}}
if(this._style===DwtMenu.DROPDOWN_CENTERV_STYLE){
w-=S.y/2;
if(w<0){
w=0
}}
var M=s&&w+S.y>=T.y?T.y-S.y:w;
if(this.parent instanceof DwtMenuItem&&this._congruent){
var d=(parseInt(a.paddingTop)||0)-(parseInt(a.borderTopWidth)||0);
if(d>0){
M-=d
}}
this.setLocation(R,M)
};
DwtMenu.prototype.getKeyMapName=function(){
return DwtKeyMap.MAP_MENU
};
DwtMenu.prototype._handleScroll=function(e,i){
if(!i){
i=window.event
}
var n=Dwt.byId(e);
if(n&&i){
i=i?i:window.event;
var t=i.detail?i.detail*-1:i.wheelDelta/40;
var o=n.rows;
var a=Dwt.getSize(o[0]).y||10;
this._popdownSubmenus();
if(t>0){
this._doScroll(n,+a)
}else{
if(t<0){
this._doScroll(n,-a)
}}}};
DwtMenu.prototype._handleMouseOut=function(e,t,a){
if(e&&a.type&&a.type=="mouseout"&&!AjxEnv.isIE){
var i=e?Dwt.byId(e):null;
fromEl=a.target;
if(fromEl!=i){
return
}
toEl=a.relatedTarget;
while(toEl){
toEl=toEl.parentNode;
if(toEl==i){
return
}}
this._scroll(t,false,false,null)
}};
DwtMenu.prototype._scroll=function(e,n,o,a){
var s=e?document.getElementById(e):null;
if(s&&n){
var i=s.rows;
var t=Dwt.getSize(i[0]).y||10;
if(this._direction!=o||!this._scrollTimer){
this._popdownSubmenus();
this._direction=o;
if(this._scrollTimer){
clearInterval(this._scrollTimer);
this._scrollTimer=null
}
if(o){
this._scrollTimer=setInterval(AjxCallback.simpleClosure(this._doScroll,this,s,-t),100);
this._doScroll(s,-t)
}else{
this._scrollTimer=setInterval(AjxCallback.simpleClosure(this._doScroll,this,s,t),100);
this._doScroll(s,t)
}}}else{
if(this._scrollTimer){
clearInterval(this._scrollTimer);
this._scrollTimer=null
}}};
DwtMenu.prototype._doScroll=function(s,i){
if(s&&i){
var a=parseInt(s.style.top)||0;
var n;
if(i<0){
var o=this._table.rows||null;
var t=o&&o.length&&Dwt.getSize(o[0]).y;
var e=s.scrollHeight-(parseInt(s.parentNode.style.height)||((this._maxRows||(o&&o.length))*t)||0);
if(Math.abs(a+i)<=e){
n=a+i
}else{
n=-e
}}else{
if((a+i)<0){
n=a+i
}else{
n=0
}}
Dwt.setLocation(s,Dwt.DEFAULT,n)
}};
DwtMenu.prototype.scrollToItem=function(a,e){
var t=this.getItemIndex(a);
if(t!=-1){
this.scrollToIndex(t,e)
}};
DwtMenu.prototype.scrollToIndex=function(r,o){
if(this._created&&this._layoutStyle==DwtMenu.LAYOUT_SCROLL&&r!==null&&r>=0&&this._table){
var f=this._table.rows;
if(f){
var u=this._maxRows;
var e=0;
var c=[];
for(var a=0,s=f.length;
a<s;
a++){
var n=Dwt.getSize(f[a]).y;
if(a<u){
e+=n
}
c.push(n)
}
var t=c[r];
var l=parseInt(this._table.style.top)||0;
if(r>=f.length){
r=f.length-1
}
var d=0;
for(var a=0;
a<r&&a<c.length;
a++){
d+=c[a]
}
var m=0;
if(o){
if(d<-l){
m=-(d+l)
}else{
if(d+t>e-l){
m=-(d+l-e+t)
}}}else{
m=-(d+l)
}
if(m){
this._popdownSubmenus();
this._doScroll(this._table,m)
}}}};
DwtMenu.prototype.handleKeyAction=function(t,i){
switch(this._style){
case DwtMenu.BAR_STYLE:case DwtMenu.POPUP_STYLE:case DwtMenu.DROPDOWN_STYLE:case DwtMenu.DROPDOWN_CENTERV_STYLE:break;
default:return false
}
switch(t){
case DwtKeyMap.PAGE_UP:case DwtKeyMap.PAGE_DOWN:var a=this.__currentItem||this._children.get(0);
var e=this.getItemIndex(a);
if(this._maxRows&&e!=-1){
this.setSelectedItem(e+((t==DwtKeyMap.PAGE_UP)?-this._maxRows:this._maxRows))
}else{
this.setSelectedItem(t==DwtKeyMap.PAGE_DOWN)
}
break;
case DwtKeyMap.SELECT_NEXT:case DwtKeyMap.SELECT_PREV:this.setSelectedItem(t==DwtKeyMap.SELECT_NEXT);
break;
case DwtKeyMap.SELECT:if(this.__currentItem){
this.__currentItem._emulateSingleClick()
}
break;
case DwtKeyMap.SUBMENU:if(this.__currentItem&&this.__currentItem._menu){
this.__currentItem._popupMenu(0,true)
}
break;
case DwtKeyMap.PARENTMENU:if(this.parent instanceof DwtMenuItem){
this.popdown(0)
}
this.parent.focus();
break;
case DwtKeyMap.CANCEL:this.popdown(0);
break;
default:return false
}
return true
};
DwtMenu.prototype._focus=function(){
var e=this.__currentItem||this._children.get(0);
e.focus()
};
DwtMenu.prototype._blur=function(){};
DwtMenu.prototype.setAssociatedObj=function(e){
this._associatedObj=e
};
DwtMenu.prototype.setAssociatedElementId=function(e){
this._associatedElId=e
};
DwtMenu.prototype.checkItem=function(s,n,a){
var e=this._children.getArray();
for(var t=0;
t<e.length;
t++){
var o=e[t];
if(!(o.isStyle(DwtMenuItem.CHECK_STYLE)||o.isStyle(DwtMenuItem.RADIO_STYLE))){
continue
}
var r=o.getData(s);
if(r==n){
o.setChecked(true,a)
}}};
DwtMenu.prototype.setSelectedItem=function(a,t){
var e=this.__currentItem;
if(typeof(a)=="boolean"){
e=!e?this._children.get(0):a?this._children.getNext(e):this._children.getPrev(e)
}else{
if(a instanceof DwtMenuItem){
if(this._children.contains(a)){
e=a
}}else{
a=Math.max(0,Math.min(this._children.size()-1,a));
e=this._children.get(a)
}}
while(e){
if(!e.isStyle){
if(!t){
e.focus()
}
break
}else{
if(!e.isStyle(DwtMenuItem.SEPARATOR_STYLE)&&e.getEnabled()&&e.getVisible()){
break
}}
e=(a===false)?this._children.getPrev(e):this._children.getNext(e)
}
if(!e){
return
}
this.scrollToItem(e,true);
if(!t){
e.focus()
}
if(this.parent&&this.parent._menuItemSelected){
this.parent._menuItemSelected(e)
}};
DwtMenu.prototype.clearExternallySelectedItems=function(){
if(this._externallySelected!=null){
this._externallySelected._deselect();
this._externallySelected=null
}};
DwtMenu.prototype.removeChild=function(a){
if(this._table){
if(this._style==DwtMenu.BAR_STYLE){
var e=a.getHtmlElement().parentNode;
this._table.rows[0].deleteCell(Dwt.getCellIndex(e))
}else{
var t=a.getHtmlElement();
if(t&&t.parentNode&&t.parentNode.parentNode.rowIndex>-1){
this._table.deleteRow(t.parentNode.parentNode.rowIndex)
}}}
this._children.remove(a);
if(a.removeSelectionListener){
a.removeSelectionListener(this._itemSelectionListener)
}};
DwtMenu.prototype.addChild=function(e){
DwtComposite.prototype.addChild.apply(this,arguments);
if(Dwt.instanceOf(e,"DwtColorPicker")||Dwt.instanceOf(e,"DwtCalendar")||(this._style==DwtMenu.GENERIC_WIDGET_STYLE)){
this._addItem(e)
}
if(e.addSelectionListener){
e.addSelectionListener(this._itemSelectionListener)
}};
DwtMenu.prototype._addItem=function(i,t){
if(this._style==DwtMenu.COLOR_PICKER_STYLE||this._style==DwtMenu.CALENDAR_PICKER_STYLE||this._style==DwtMenu.GENERIC_WIDGET_STYLE){
return
}
var n;
var e;
if(this._style==DwtMenu.BAR_STYLE){
var o=this._table.rows;
n=(o.length!=0)?o[0]:this._table.insertRow(0);
if(t==null||t>n.cells.length){
t=o.cells.length
}
e=n.insertCell(t);
e.align="center";
e.vAlign="middle";
var a=n.insertCell(-1);
a.nowrap=true;
a.width="7px"
}else{
if(i.isStyle&&(i.isStyle(DwtMenuItem.CHECK_STYLE)||i.isStyle(DwtMenuItem.RADIO_STYLE))){
this._checkItemAdded()
}
if(t==null||t>this._table.rows.length){
t=-1
}
n=this._table.insertRow(t);
e=n.insertCell(0)
}
e.noWrap=true;
e.appendChild(i.getHtmlElement())
};
DwtMenu.prototype._radioItemSelected=function(r,n){
var t=r._radioGroupId;
var s=this._children.size();
var e=this._children.getArray();
for(var o=0;
o<s;
o++){
if(e[o]!=r&&e[o].isStyle(DwtMenuItem.RADIO_STYLE)&&e[o]._radioGroupId==t&&e[o]._itemChecked){
e[o].setChecked(false,n);
break
}}};
DwtMenu.prototype._propagateItemSelection=function(e){
if(this.isListenerRegistered(DwtEvent.SELECTION)){
this.notifyListeners(DwtEvent.SELECTION,e)
}};
DwtMenu.prototype._menuHasCheckedItems=function(){
return this._menuItemsHaveChecks
};
DwtMenu.prototype._menuHasItemsWithIcons=function(){
return this._menuItemsHaveIcons
};
DwtMenu.prototype._menuHasSubmenus=function(){
return(this._menuItemsWithSubmenus>0)
};
DwtMenu.prototype._iconItemAdded=function(e){
if(!this._menuItemsHaveIcons){
Dwt.addClass(this.getHtmlElement(),DwtMenu.HAS_ICON)
}
this._menuItemsHaveIcons=true
};
DwtMenu.prototype._checkItemAdded=function(e){
if(!this._menuItemsHaveChecks){
Dwt.addClass(this.getHtmlElement(),DwtMenu.HAS_CHECK)
}
this._menuItemsHaveChecks=true
};
DwtMenu.prototype._submenuItemAdded=function(){
Dwt.addClass(this.getHtmlElement(),DwtMenu.HAS_SUBMENU);
this._menuItemsWithSubmenus++
};
DwtMenu.prototype._submenuItemRemoved=function(){
if(this._menuItemsWithSubmenus==1){
var o=this._children.size();
var e=this._children.getArray();
for(var t=0;
t<o;
t++){
e[t]._submenuItemRemoved()
}}
this._menuItemsWithSubmenus--;
if(this._menuItemsWithSubmenus==0){
Dwt.delClass(this.getHtmlElement(),DwtMenu.HAS_SUBMENU)
}};
DwtMenu.prototype._popdownSubmenus=function(){
var o=this._children.size();
var e=this._children.getArray();
for(var t=0;
t<o;
t++){
if(e[t]._popdownMenu){
e[t]._popdownMenu()
}}};
DwtMenu.prototype.dontStealFocus=function(e){
if(e==null){
e=true
}
this.__preventMenuFocus=!!e
};
DwtMenu.prototype._doPopup=function(o,a,r){
var i=DwtBaseDialog.getActiveDialog()?Dwt.Z_DIALOG_MENU:Dwt.Z_MENU;
this.setZIndex(i);
this.setVisible(true);
this.render(o,a);
var t=this._layoutStyle==DwtMenu.LAYOUT_SCROLL;
var n=this._layoutStyle==DwtMenu.LAYOUT_CASCADE;
if(!t){
this.setScrollStyle(this._isPopupStyle()&&n?Dwt.CLIP:Dwt.SCROLL)
}else{
if(this._tableContainer){
Dwt.setScrollStyle(this._tableContainer,Dwt.CLIP)
}}
this.notifyListeners(DwtEvent.POPUP,this);
var h=this.shell.getToolTip();
if(h){
h.popdown()
}
this._popupActionId=-1;
this._isPoppedUp=true;
var s=DwtOutsideMouseEventMgr.INSTANCE;
var e={
id:"DwtMenu",obj:this,outsideListener:this._outsideListener};
s.startListening(e);
if(!DwtMenu._activeMenu){
DwtMenu._activeMenu=this;
DwtMenu._activeMenuUp=true
}
DwtMenu._activeMenuIds.add(this._htmlElId,null,true);
DwtMenu._activeMenuIds.sort();
DwtMenu._activeMenus.add(this,null,true);
DwtShell.getShell(window).getKeyboardMgr().pushTabGroup(this.getTabGroupMember(),this.__preventMenuFocus);
if(r||!this.parent.isDwtMenu){
this.setSelectedItem(0,this.__preventMenuFocus)
}};
DwtMenu.prototype.getSize=function(t){
var e;
if(this._table){
e=Dwt.getSize(this._table,t)
}else{
e=DwtComposite.prototype.getSize.call(this,t)
}
if(this._width&&this._width>e.x){
e.x=this._width
}
return e
};
DwtMenu.prototype._doPopdown=function(h){
var l=this._children.getArray();
var m=this._children.size();
for(var n=0;
n<m;
n++){
if((l[n] instanceof DwtMenuItem)&&!(l[n].isStyle(DwtMenuItem.SEPARATOR_STYLE))){
l[n]._popdownMenu()
}}
this.setVisible(false);
this._ev=h;
this.notifyListeners(DwtEvent.POPDOWN,this);
var d=DwtOutsideMouseEventMgr.INSTANCE;
d.stopListening({
id:"DwtMenu",obj:this}
);
if(DwtMenu._activeMenu==this){
DwtMenu._activeMenu=null;
DwtMenu._activeMenuUp=false
}
DwtMenu._activeMenuIds.remove(this._htmlElId);
DwtMenu._activeMenus.remove(this);
this._popdownActionId=-1;
this._isPoppedUp=false;
if(this._isPopupStyle()&&this._table&&this._table.rows&&this._table.rows.length&&this._table.rows[0].cells.length){
var t=this._table.rows[0].cells.length;
var r=this._table.rows.length;
for(var n=1;
n<t;
n++){
for(var o=0;
o<r;
o++){
var c=this._table.rows[o].cells[n];
if(!c.empty){
var e=c.firstChild;
var u=this._table.insertRow(this._table.rows.length);
var c=u.insertCell(0);
while(e!=null){
c.appendChild(e);
e=e.nextSibling
}}}}
for(var o=0;
o<r;
o++){
var u=this._table.rows[o];
for(var n=u.cells.length-1;
n>0;
n--){
u.deleteCell(n)
}}}
if(this.__currentItem){
this.__currentItem.blur()
}
DwtShell.getShell(window).getKeyboardMgr().popTabGroup(this.getTabGroupMember())
};
DwtMenu.prototype._getActiveItem=function(){
var e=this._children.getArray();
var o=this._children.size();
for(var t=0;
t<o;
t++){
if(e[t]._isMenuPoppedUp()){
return e[t]
}}
return null
};
DwtMenu._outsideMouseDownListener=function(t){
if(DwtMenu._activeMenuUp){
var i=DwtMenu._activeMenu;
var o=i._htmlElId;
var a=DwtUiEvent.getTarget(t);
while(a!=null){
if(a.id&&a.id!=""&&(a.id==o||a.id==i._associatedElId||DwtMenu._activeMenuIds.binarySearch(a.id)!=-1)){
return false
}
a=a.parentNode
}
i.popdown(0,t);
var e=null;
do{
e=DwtMenu._activeMenus.getLast();
if(e!=null&&e instanceof DwtMenu){
e.popdown()
}}
while(e!=null)
}};
DwtMenu._stopEvent=function(t){
if(!t){
t=window.event
}
t.cancelBubble=true;
if(t.stopPropagation){
t.stopPropagation()
}};
DwtMenu.menuShowing=function(){
return DwtMenu._activeMenuUp
};
DwtMenu.closeActiveMenu=function(e){
if(DwtMenu._activeMenuUp){
DwtMenu._activeMenu.popdown(0,e)
}}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtInputField")){
DwtInputField=function(h){
if(arguments.length==0){
return
}
h.className=h.className||"DwtInputField";
this._origClassName=h.className;
this._errorClassName=this._origClassName+"-Error";
this._hintClassName=this._origClassName+"-hint";
this._disabledClassName=this._origClassName+"-disabled";
this._errorHintClassName=this._origClassName+"-errorhint";
DwtComposite.call(this,h);
this._inputEventHandlers={};
this._type=h.type?h.type:DwtInputField.STRING;
this._rows=h.rows?h.rows:1;
this._size=h.size;
this._errorIconStyle=h.errorIconStyle?h.errorIconStyle:h.validator?DwtInputField.ERROR_ICON_RIGHT:DwtInputField.ERROR_ICON_NONE;
this._validationStyle=h.validationStyle?h.validationStyle:DwtInputField.ONEXIT_VALIDATION;
this._hasError=false;
this._hintIsVisible=false;
this._hint=h.hint;
var r=h.inputId||Dwt.getNextId();
var s=Dwt.getNextId();
var n=this.getHtmlElement();
if(this._errorIconStyle==DwtInputField.ERROR_ICON_NONE){
if(h.forceMultiRow||(h.rows&&h.rows>1)){
var e=["<textarea id='",r,"' rows=",h.rows];
var o=e.length;
if(h.forceMultiRow||h.size){
e[o++]=" cols=";
e[o++]=h.size||1
}
if(h.wrap){
e[o++]=" wrap=";
e[o++]=h.wrap
}
e[o++]="></textarea>";
n.innerHTML=e.join("")
}else{
n.innerHTML=["<input id='",r,"'>"].join("")
}}else{
var e=["<table cellspacing='0' cellpadding='0'><tr>"];
var o=1;
if(this._errorIconStyle==DwtInputField.ERROR_ICON_LEFT){
e[o++]=["<td style='padding-right:2px;'id='",s,"'></td>"].join("")
}
e[o++]=["<td>","<input id='",r,"'>","</td>"].join("");
if(this._errorIconStyle==DwtInputField.ERROR_ICON_RIGHT){
e[o++]=["<td style='padding-left:2px;' id='",s,"'></td>"].join("")
}
e[o++]="</tr></table>";
n.innerHTML=e.join("");
if(this._errorIconStyle!=DwtInputField.ERROR_ICON_NONE){
this._errorIconTd=document.getElementById(s);
this._errorIconTd.vAlign="middle";
this._errorIconTd.innerHTML=DwtInputField._NOERROR_ICON_HTML
}}
this._tabGroup=new DwtTabGroup(this._htmlElId);
if(h.forceMultiRow||this._rows>1){
this._inputField=document.getElementById(r);
this._inputField.onkeyup=DwtInputField._keyUpHdlr;
this._inputField.onblur=DwtInputField._blurHdlr;
this._inputField.onfocus=DwtInputField._focusHdlr;
this._inputField.onkeydown=DwtInputField._keyDownHdlr;
if(h.size){
this._inputField.size=h.size
}
if(h.maxLen){
this._inputField.maxLength=this._maxLen=h.maxLen
}
this._inputField.value=h.initialValue||"";
this._tabGroup.addMember(this._inputField)
}else{
var t=document.getElementById(r);
var a=this.__createInputEl(h);
if(AjxEnv.isCamino){
t.parentNode.style.overflow="hidden"
}
t.parentNode.replaceChild(a,t)
}
if(h.label){
this._inputField.setAttribute("aria-label",h.label)
}
this.setValidatorFunction(h.validatorCtxtObj,h.validator);
this._setMouseEventHdlrs(false);
this._setKeyPressEventHdlr(false);
if(h.required!=null){
this.setRequired(h.required)
}};
DwtInputField.prototype=new DwtComposite;
DwtInputField.prototype.constructor=DwtInputField;
DwtInputField.prototype.isDwtInputField=true;
DwtInputField.prototype.isInputControl=true;
DwtInputField.prototype.toString=function(){
return"DwtInputField"
};
DwtInputField.ERROR_ICON_LEFT=1;
DwtInputField.ERROR_ICON_RIGHT=2;
DwtInputField.ERROR_ICON_NONE=3;
DwtInputField.CONTINUAL_VALIDATION=1;
DwtInputField.ONEXIT_VALIDATION=2;
DwtInputField.MANUAL_VALIDATION=3;
DwtInputField.NUMBER=1;
DwtInputField.INTEGER=2;
DwtInputField.FLOAT=3;
DwtInputField.STRING=4;
DwtInputField.PASSWORD=5;
DwtInputField.DATE=6;
DwtInputField._ERROR_ICON_HTML=AjxImg.getImageHtml("ClearSearch");
DwtInputField._NOERROR_ICON_HTML=AjxImg.getImageHtml("Blank_9");
DwtInputField.prototype.dispose=function(){
this._errorIconTd=null;
this._inputField=null;
DwtComposite.prototype.dispose.call(this)
};
DwtInputField.prototype.getTabGroupMember=function(){
return this._tabGroup
};
DwtInputField.prototype.setHandler=function(t,e){
if(!this._checkState()){
return
}
this._inputEventHandlers[t]=e;
Dwt.setHandler(this.getInputElement(),t,e)
};
DwtInputField.prototype.setInputType=function(a){
if(a!=this._type&&this._rows==1){
this._type=a;
if(AjxEnv.isIE){
var e=this._inputField;
var t=this.__createInputEl();
e.parentNode.replaceChild(t,e)
}else{
this._inputField.type=this._type!=DwtInputField.PASSWORD?"text":"password"
}}};
DwtInputField.prototype.applySubstitution=function(a,t){
if(!this._inputField.setRangeText){
this.setValue(this.getValue().replace(a,t))
}else{
var e;
while((e=a.exec(this.getValue()))){
this._inputField.setRangeText(t,e.index,e.index+e[0].length);
if(!a.global){
return
}}}};
DwtInputField.prototype.setValidatorFunction=function(t,e){
if(e){
this._validator=e;
this._validatorObj=t
}else{
switch(this._type){
case DwtInputField.NUMBER:this._validator=DwtInputField.validateNumber;
break;
case DwtInputField.INTEGER:this._validator=DwtInputField.validateInteger;
break;
case DwtInputField.FLOAT:this._validator=DwtInputField.validateFloat;
break;
case DwtInputField.STRING:case DwtInputField.PASSWORD:this._validator=DwtInputField.validateString;
break;
case DwtInputField.DATE:this._validator=DwtInputField.validateDate;
break;
default:this._validator=DwtInputField.validateAny
}}};
DwtInputField.prototype.setValidatorRegExp=function(e,t){
this._validator=e;
this._validatorObj=null;
this._errorString=t||""
};
DwtInputField.prototype.setValidationCallback=function(e){
this._validationCallback=e
};
DwtInputField.prototype.getInputElement=function(){
return this._inputField
};
DwtInputField.prototype.getValue=function(){
return this._hintIsVisible?"":AjxStringUtil.trim(this._inputField.value)
};
DwtInputField.prototype.setValue=function(t,e){
t=t||"";
this._inputField.value=t;
if(!e){
t=this._validateInput(t);
if(t!=null){
this._inputField.value=t
}}
if(this._hintIsVisible&&t){
this._hideHint(t)
}else{
if(!t){
this._showHint()
}}};
DwtInputField.prototype.clear=function(){
this.setValue("")
};
DwtInputField.prototype.setHint=function(t){
this._hint=t;
var e=this.getInputElement();
if(AjxEnv.supportsPlaceholder){
e.placeholder=t||"";
return
}
if(this._hintIsVisible){
e.value=t;
if(!t){
this._hintIsVisible=false;
this._updateClassName()
}}else{
if(e.value===""){
this._showHint()
}}};
DwtInputField.prototype.setValidNumberRange=function(t,e){
this._minNumVal=t;
this._maxNumVal=e;
var a=this._validateInput(this.getValue());
if(a!=null){
this.setValue(a)
}};
DwtInputField.prototype.setValidStringLengths=function(t,e){
this._minLen=t||0;
if(e!=null){
this._inputField.maxLength=e;
this._maxLen=e
}};
DwtInputField.prototype.setNumberPrecision=function(e){
this._decimals=e
};
DwtInputField.prototype.setReadOnly=function(e){
this._inputField.setAttribute("readonly",(e==null?true:e))
};
DwtInputField.prototype.setRequired=function(t){
var e=t==null?true:t;
if(this._required!=e){
this._required=e;
this.validate()
}};
DwtInputField.prototype.getEnabled=function(){
return !this.getInputElement().disabled
};
DwtInputField.prototype.setEnabled=function(e){
DwtControl.prototype.setEnabled.call(this,e);
this.getInputElement().disabled=!e;
this._validateInput(this.getValue())
};
DwtInputField.prototype.focus=function(){
if(this.getEnabled()){
this._hasFocus=true;
this.getInputElement().focus();
DwtShell.getShell(window).getKeyboardMgr().grabFocus(this.getTabGroupMember())
}};
DwtInputField.prototype.blur=function(){
this.getInputElement().blur()
};
DwtInputField.prototype.setVisible=function(e){
DwtComposite.prototype.setVisible.apply(this,arguments);
Dwt.setVisible(this.getInputElement(),e)
};
DwtInputField.prototype.isValid=function(){
if(!this.getEnabled()){
return this.getValue()
}
try{
if(typeof this._validator=="function"){
return this._validatorObj?this._validator.call(this._validatorObj,this.getValue(),this):this._validator(this.getValue())
}else{
return this._validator.test(this._inputField.value)
}}
catch(e){
if(typeof e=="string"){
return null
}else{
throw e
}}};
DwtInputField.prototype.getValidationError=function(){
this.validate();
return this._validationError
};
DwtInputField.prototype.validate=function(){
var e=this._validateInput(this.getValue());
if(e!=null){
this.setValue(e);
return true
}else{
return false
}};
DwtInputField.validateNumber=function(e){
var t=new Number(e);
if(isNaN(t)||(Math.round(t)!=t)){
throw AjxMsg.notAnInteger
}
return DwtInputField.validateFloat.call(this,e)
};
DwtInputField.validateInteger=function(e){
var t=new Number(e);
if(isNaN(t)||(Math.round(t)!=t)||(t.toString()!=e)){
throw AjxMsg.notAnInteger
}
if(this._minNumVal&&e<this._minNumVal){
throw AjxMessageFormat.format(AjxMsg.numberLessThanMin,this._minNumVal)
}
if(this._maxNumVal&&e>this._maxNumVal){
throw AjxMessageFormat.format(AjxMsg.numberMoreThanMax,this._maxNumVal)
}
return e
};
DwtInputField.validateFloat=function(e){
if(this._required&&e==""){
throw AjxMsg.valueIsRequired
}
var i=new Number(e);
if(isNaN(i)){
throw AjxMsg.notANumber
}
if(this._minNumVal&&e<this._minNumVal){
throw AjxMessageFormat.format(AjxMsg.numberLessThanMin,this._minNumVal)
}
if(this._maxNumVal&&e>this._maxNumVal){
throw AjxMessageFormat.format(AjxMsg.numberMoreThanMax,this._maxNumVal)
}
if(this._decimals!=null){
var t=i.toString();
var a=t.indexOf(".");
if(a==-1){
a=t.length
}
e=i.toPrecision(a+this._decimals)
}else{
e=i.toString()
}
return e
};
DwtInputField.validateString=function(e){
if(this._required&&e==""){
throw AjxMsg.valueIsRequired
}
if(this._minLen!=null&&e.length<this._minLen){
throw AjxMessageFormat.format(AjxMsg.stringTooShort,this._minLen)
}
if(this._maxLen!=null&&e.length>this._maxLen){
throw AjxMessageFormat.format(AjxMsg.stringTooLong,this._maxLen)
}
return e
};
DwtInputField.validateDate=function(e){
if(this._required&&e==""){
throw AjxMsg.valueIsRequired
}
if(AjxDateUtil.simpleParseDateStr(e)==null){
throw AjxMsg.invalidDatetimeString
}
return e
};
DwtInputField.validateEmail=function(e){
if(this._required&&e==""){
throw AjxMsg.valueIsRequired
}
if(!AjxEmailAddress.isValid(e)){
throw AjxMsg.invalidEmailAddr
}
return e
};
DwtInputField.validateAny=function(e){
if(this._required&&e==""){
throw AjxMsg.valueIsRequired
}
return e
};
DwtInputField.prototype._validateRegExp=function(e){
if(this._required&&e==""){
throw AjxMsg.valueIsRequired
}
if(this._regExp&&!this._regExp.test(e)){
throw this._errorString
}
return e
};
DwtInputField._keyUpHdlr=function(t){
var e=DwtShell.keyEvent;
e.setFromDhtmlEvent(t,true);
var i=e.dwtObj;
var a=e.keyCode;
if(i.notifyListeners(DwtEvent.ONKEYUP,e)){
return true
}
var o=null;
if((a==13||a==9)&&i._validationStyle==DwtInputField.ONEXIT_VALIDATION){
o=i._validateInput(i.getValue())
}else{
if(i._validationStyle==DwtInputField.CONTINUAL_VALIDATION){
o=i._validateInput(i.getValue())
}}
if(o!=null&&o!=i.getValue()){
i.setValue(o)
}
return true
};
DwtInputField._blurHdlr=function(e){
var t=DwtControl.getTargetControl(e);
if(t){
t._hasFocus=false;
if(t._validationStyle==DwtInputField.ONEXIT_VALIDATION){
var a=t._validateInput(t.getValue());
if(a!=null){
t.setValue(a)
}}
if(!t._hintIsVisible&&t._hint){
t._showHint()
}}
t.notifyListeners(DwtEvent.ONBLUR,e)
};
DwtInputField._focusHdlr=function(e){
var t=DwtControl.getTargetControl(e);
if(t){
var a=DwtShell.getShell(window).getKeyboardMgr().inputGotFocus(t);
if(t._hintIsVisible){
t._hideHint("")
}}
t.notifyListeners(DwtEvent.ONFOCUS,e)
};
DwtInputField._keyDownHdlr=function(e){
var t=DwtControl.getTargetControl(e);
if(t){
if(t._hintIsVisible){
t._hideHint("")
}}};
DwtInputField.prototype._hideHint=function(t){
if(!AjxEnv.supportsPlaceholder){
var e=this.getInputElement();
e.value=t;
e.title=this._hint||"";
this._hintIsVisible=false;
this._updateClassName()
}};
DwtInputField.prototype._showHint=function(){
if(!AjxEnv.supportsPlaceholder&&this._hint){
var e=this.getInputElement();
if(!e.value){
this._hintIsVisible=true;
this._updateClassName();
e.title="";
e.value=this._hint
}}};
DwtInputField.prototype._updateClassName=function(){
var e;
if(!this.getEnabled()){
e=this._disabledClassName
}else{
if(this._hasError){
if(this._hintIsVisible&&!this._hasFocus){
e=this._errorHintClassName
}else{
e=this._errorClassName
}}else{
if(this._hintIsVisible&&!this._hasFocus){
e=this._hintClassName
}else{
e=this._origClassName
}}}
this.getHtmlElement().className=e
};
DwtInputField.prototype._validateInput=function(t){
var i=true;
var a;
this._validationError=null;
if(!this.getEnabled()){
a=this.getValue()
}else{
try{
if(typeof this._validator=="function"){
a=t=this._validatorObj?this._validator.call(this._validatorObj,t,this):this._validator(t)
}else{
if(!this._validator.test(t)){
this._validationError=this._errorString
}}}
catch(e){
if(typeof e=="string"){
this._validationError=e
}else{
throw e
}}}
if(this._validationError){
this._hasError=true;
if(this._errorIconTd){
this._errorIconTd.innerHTML=DwtInputField._ERROR_ICON_HTML
}
this.setToolTipContent(this._validationError);
i=false;
a=null
}else{
this._hasError=false;
if(this._errorIconTd){
this._errorIconTd.innerHTML=DwtInputField._NOERROR_ICON_HTML
}
this.setToolTipContent(null);
i=true
}
this._updateClassName();
if(this._validationCallback){
this._validationCallback.run(this,i,t)
}
return a
};
DwtInputField.prototype._focusByMouseUpEvent=function(){
if(this.getEnabled()){
this._hasFocus=true
}};
DwtInputField.prototype._replaceElementHook=function(t,a,e,i){
a=this.getInputElement();
DwtControl.prototype._replaceElementHook.call(this,t,a,e,i);
if(t.id){
a.id=t.id
}
if(t.size){
a.size=t.size
}
if(t.title){
this.setHint(t.title)
}};
DwtInputField.prototype.__createInputEl=function(s){
var t=this._inputField;
if(t){
for(var o in this._inputEventHandlers){
t.removeAttribute(o)
}}
var i;
var n=this._type!=DwtInputField.PASSWORD?"text":"password";
i=document.createElement("INPUT");
i.type=n;
this._inputField=i;
var a=s?s.size:t.size;
var e=s?s.maxLen:t.maxLength;
i.autocomplete="off";
if(a){
i.size=a
}
if(e){
i.maxLength=e
}
i.value=(s?s.initialValue:t.value)||"";
i.readonly=t?t.readonly:false;
if(s&&s.inputId){
i.id=s.inputId
}
if(AjxEnv.supportsPlaceholder&&this._hint){
i.placeholder=this._hint
}
i.onkeyup=DwtInputField._keyUpHdlr;
i.onblur=DwtInputField._blurHdlr;
i.onfocus=DwtInputField._focusHdlr;
i.onkeydown=DwtInputField._keyDownHdlr;
for(var o in this._inputEventHandlers){
i[o]=this._inputEventHandlers[o]
}
this._tabGroup.removeAllMembers();
this._tabGroup.addMember(i);
return i
};
DwtInputField.prototype.disableFocusHdlr=function(){
this._inputField.onfocus=null
};
DwtInputField.prototype.enableFocusHdlr=function(){
this._inputField.onfocus=DwtInputField._focusHdlr
};
DwtInputField.prototype.enableKeyDownHdlr=function(){
this._inputField.onkeydown=DwtInputField._keyDownHdlr
};
DwtInputField.prototype.moveCursorToEnd=function(){
Dwt.moveCursorToEnd(this._inputField)
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtBaseDialog")){
DwtBaseDialog=function(t){
if(arguments.length==0){
return
}
t=Dwt.getParams(arguments,DwtBaseDialog.PARAMS);
var e=t.parent;
if(!(e instanceof DwtShell)){
throw new DwtException("DwtBaseDialog parent must be a DwtShell",DwtException.INVALIDPARENT,"DwtDialog")
}
t.className=t.className||"DwtBaseDialog";
t.posStyle=DwtControl.ABSOLUTE_STYLE;
t.isFocusable=false;
this._title=t.title||"";
DwtComposite.call(this,t);
this._disposeOnPopDown=t.disposeOnPopDown||false;
this._shell=e;
this._zIndex=t.zIndex||Dwt.Z_DIALOG;
this._mode=t.mode||DwtBaseDialog.MODAL;
this._loc=new DwtPoint();
if(t.loc){
this._loc.x=t.loc.x;
this._loc.y=t.loc.y
}else{
this._loc.x=this._loc.y=Dwt.LOC_NOWHERE
}
this._tabGroup=new DwtTabGroup(this.toString());
this._dragHandleId=t.dragHandleId||this._htmlElId+"_handle";
this._createHtml();
this._initializeDragging(this._dragHandleId);
if(t.view){
this.setView(t.view)
}
this.setZIndex(Dwt.Z_HIDDEN);
this._position(DwtBaseDialog.__nowhereLoc);
this._propagateEvent[DwtEvent.ONMOUSEUP]=true
};
DwtBaseDialog.PARAMS=["parent","className","title","zIndex","mode","loc","view","dragHandleId","id"];
DwtBaseDialog.prototype=new DwtComposite;
DwtBaseDialog.prototype.constructor=DwtBaseDialog;
DwtBaseDialog.prototype.role="dialog";
DwtBaseDialog.prototype.isFocusable=true;
DwtBaseDialog.prototype.toString=function(){
return"DwtBaseDialog"
};
DwtBaseDialog.MODELESS=1;
DwtBaseDialog.MODAL=2;
DwtBaseDialog.__nowhereLoc=new DwtPoint(Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE);
DwtBaseDialog.prototype.TEMPLATE="dwt.Widgets#DwtBaseDialog";
DwtBaseDialog.prototype.CONTROLS_TEMPLATE=null;
DwtBaseDialog.prototype.addPopupListener=function(e){
this.addListener(DwtEvent.POPUP,e)
};
DwtBaseDialog.prototype.removePopupListener=function(e){
this.removeListener(DwtEvent.POPUP,e)
};
DwtBaseDialog.prototype.addPopdownListener=function(e){
this.addListener(DwtEvent.POPDOWN,e)
};
DwtBaseDialog.prototype.removePopdownListener=function(e){
this.removeListener(DwtEvent.POPDOWN,e)
};
DwtBaseDialog.prototype.popup=function(t){
if(this._poppedUp){
return
}
this.cleanup(true);
var e=this._zIndex;
if(this._mode==DwtBaseDialog.MODAL){
e=this._setModalEffect(e)
}
this._shell._veilOverlay.activeDialogs.push(this);
if(t){
this._loc.x=t.x;
this._loc.y=t.y
}
this._position(t);
this._resetTabFocus();
this.setZIndex(e);
this._poppedUp=true;
var a=this._shell.getKeyboardMgr();
a.pushTabGroup(this._tabGroup);
a.pushDefaultHandler(this);
this.notifyListeners(DwtEvent.POPUP,this)
};
DwtBaseDialog.prototype._resetTabFocus=function(){
this._tabGroup.resetFocusMember(true)
};
DwtBaseDialog.prototype.focus=function(){
if(this.isListenerRegistered(DwtEvent.ONFOCUS)){
this.notifyListeners(DwtEvent.ONFOCUS)
}else{
if(this._focusElementId){
var e=document.getElementById(this._focusElementId);
if(e){
e.focus()
}}}};
DwtBaseDialog.prototype.isPoppedUp=function(){
return this._poppedUp
};
DwtBaseDialog.prototype.popdown=function(){
if(this._poppedUp){
this._poppedUp=false;
this.cleanup(false);
var e=this._zIndex;
this.setZIndex(Dwt.Z_HIDDEN);
this._position(DwtBaseDialog.__nowhereLoc);
if(this._mode==DwtBaseDialog.MODAL){
this._undoModality(e)
}else{
this._shell._veilOverlay.activeDialogs.pop()
}
if(this._disposeOnPopDown===true){
this.dispose()
}
var t=this._shell.getKeyboardMgr();
t.popTabGroup(this._tabGroup);
t.popDefaultHandler();
this.notifyListeners(DwtEvent.POPDOWN,this)
}};
DwtBaseDialog.prototype.setView=function(e){
this.reset();
if(e){
this._getContentDiv().appendChild(e.getHtmlElement())
}};
DwtBaseDialog.prototype.reset=function(){
this._loc.x=this._loc.y=Dwt.LOC_NOWHERE
};
DwtBaseDialog.prototype.cleanup=function(t){
var o=this._getInputFields();
if(o){
var e=o.length;
for(var a=0;
a<e;
a++){
o[a].disabled=!t;
if(t){
o[a].value=""
}}}};
DwtBaseDialog.prototype.setTitle=function(e){
if(this._titleEl){
this._titleEl.innerHTML=e||""
}
this._title=e
};
DwtBaseDialog.prototype.setContent=function(t){
var e=this._getContentDiv();
if(e){
e.innerHTML=t||""
}};
DwtBaseDialog.prototype._getContentDiv=function(){
return this._contentEl
};
DwtBaseDialog.prototype.addEnterListener=function(e){
this.addListener(DwtEvent.ENTER,e)
};
DwtBaseDialog.getActiveDialog=function(){
var t=null;
var a=DwtShell.getShell(window);
if(a){
var e=a._veilOverlay.activeDialogs.length;
if(e>0){
t=a._veilOverlay.activeDialogs[e-1]
}}
return t
};
DwtBaseDialog.prototype._initializeDragging=function(r){
var s=document.getElementById(r);
if(s){
var n=DwtControl.fromElementId(window._dwtShellId);
if(n){
var e=Dwt.getSize(n.getHtmlElement());
var a=document.getElementById(this._htmlElId);
var h=this.getSize();
var o=new AjxCallback(this,this._dragEnd);
var i=new AjxCallback(this,this._duringDrag);
var t=new AjxCallback(this,this._dragStart);
DwtDraggable.init(s,a,0,document.body.offsetWidth-10,0,document.body.offsetHeight-10,t,i,o)
}}};
DwtBaseDialog.prototype._getContentHtml=function(){
return""
};
DwtBaseDialog.prototype._createHtml=function(e){
var t={
id:this._htmlElId};
this._createHtmlFromTemplate(e||this.TEMPLATE,t)
};
DwtBaseDialog.prototype._createHtmlFromTemplate=function(e,t){
t.dragId=this._dragHandleId;
t.title=this._title;
t.icon="";
t.closeIcon1="";
t.closeIcon2="";
t.controlsTemplateId=this.CONTROLS_TEMPLATE;
DwtComposite.prototype._createHtmlFromTemplate.call(this,e,t);
this._titleBarEl=document.getElementById(t.id+"_titlebar");
this._titleEl=document.getElementById(t.id+"_title");
this._contentEl=document.getElementById(t.id+"_content");
if(this._titleEl){
this.setAttribute("aria-labelledby",this._titleEl.id);
this._titleEl.setAttribute("role","heading");
this._titleEl.setAttribute("aria-level","2")
}
this.setContent(this._getContentHtml())
};
DwtBaseDialog.prototype._setModalEffect=function(){
var a=this._shell._veilOverlay.dialogZ;
var i=null;
var t,e;
if(a.length){
i=a[a.length-1]
}
if(i){
t=i+2;
e=i+1
}else{
t=this._zIndex;
e=Dwt.Z_VEIL
}
this._shell._veilOverlay.veilZ.push(e);
this._shell._veilOverlay.dialogZ.push(t);
Dwt.setZIndex(this._shell._veilOverlay,e);
return t
};
DwtBaseDialog.prototype._undoModality=function(a){
var e=this._shell._veilOverlay.veilZ;
e.pop();
var t=e[e.length-1];
Dwt.setZIndex(this._shell._veilOverlay,t);
this._shell._veilOverlay.dialogZ.pop();
this._shell._veilOverlay.activeDialogs.pop();
if(this._shell._veilOverlay.activeDialogs.length>0){
this._shell._veilOverlay.activeDialogs[0].focus()
}};
DwtBaseDialog.prototype._getInputFields=function(){};
DwtBaseDialog.prototype._dragStart=function(e,t){
if(AjxEnv.isNav&&!this._ignoreSetDragBoundries){
this._currSize=this.getSize();
DwtDraggable.setDragBoundaries(DwtDraggable.dragEl,0,document.body.offsetWidth-this._currSize.x,0,document.body.offsetHeight-this._currSize.y)
}};
DwtBaseDialog.prototype._dragEnd=function(e,t){
this._loc.x=e;
this._loc.y=t
};
DwtBaseDialog.prototype._duringDrag=function(e,t){};
DwtBaseDialog.prototype._doesContainElement=function(e){
return Dwt.contains(this.getHtmlElement(),e)
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtDialog")){
DwtDialog=function(t){
if(arguments.length==0){
return
}
t=Dwt.getParams(arguments,DwtDialog.PARAMS);
t.className=t.className||"DwtDialog";
this._title=t.title=t.title||"";
var a=t.standardButtons;
var l=t.extraButtons;
if(!a){
a=[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]
}else{
if(a==DwtDialog.NO_BUTTONS){
a=null
}else{
if(a&&!a.length){
a=[a]
}}}
this._buttonList=[];
var d={};
d[DwtDialog.ALIGN_LEFT]=[];
d[DwtDialog.ALIGN_CENTER]=[];
d[DwtDialog.ALIGN_RIGHT]=[];
if(a||l){
this._buttonDesc={};
if(a&&a.length){
this._initialEnterButtonId=this._enterButtonId=a[0];
for(var o=0;
o<a.length;
o++){
var h=a[o];
this._buttonList.push(h);
var r=DwtDialog.ALIGN[h];
if(r){
d[r].push(h)
}
this._buttonDesc[h]=new DwtDialog_ButtonDescriptor(h,AjxMsg[DwtDialog.MSG_KEY[h]],r)
}
this._resetCallbacks()
}
if(l&&l.length){
if(!this._enterButtonId){
this._initialEnterButtonId=this._enterButtonId=l[0]
}
for(var o=0;
o<l.length;
o++){
var h=l[o].id;
this._buttonList.push(h);
var r=l[o].align;
if(r){
d[r].push(h)
}
this._buttonDesc[h]=l[o]
}}}
this._buttonElementId={};
for(var o=0;
o<this._buttonList.length;
o++){
var h=this._buttonList[o];
this._buttonElementId[h]=this._buttonDesc[h].label?this._buttonDesc[h].label+"_"+Dwt.getNextId():Dwt.getNextId()
}
DwtBaseDialog.call(this,t);
this._button={};
for(var o=0;
o<this._buttonList.length;
o++){
var h=this._buttonList[o];
var c=this._button[h]=new DwtButton({
parent:this,id:this._htmlElId+"_button"+h}
);
c.setText(this._buttonDesc[h].label);
c.buttonId=h;
c.addSelectionListener(new AjxListener(this,this._buttonListener));
var e=document.getElementById(this._buttonElementId[h]);
if(e){
e.appendChild(c.getHtmlElement())
}}
var s=d[DwtDialog.ALIGN_LEFT].concat(d[DwtDialog.ALIGN_CENTER],d[DwtDialog.ALIGN_RIGHT]);
for(var o=0;
o<s.length;
o++){
var n=this._button[s[o]];
this._tabGroup.addMember(n)
}};
DwtDialog.PARAMS=["parent","className","title","standardButtons","extraButtons","zIndex","mode","loc","id"];
DwtDialog.prototype=new DwtBaseDialog;
DwtDialog.prototype.constructor=DwtDialog;
DwtDialog.prototype.isDwtDialog=true;
DwtDialog.prototype.toString=function(){
return"DwtDialog"
};
DwtDialog.ALIGN_LEFT=1;
DwtDialog.ALIGN_RIGHT=2;
DwtDialog.ALIGN_CENTER=3;
DwtDialog.CANCEL_BUTTON=1;
DwtDialog.OK_BUTTON=2;
DwtDialog.DISMISS_BUTTON=3;
DwtDialog.NO_BUTTON=4;
DwtDialog.YES_BUTTON=5;
DwtDialog.LAST_BUTTON=5;
DwtDialog.NO_BUTTONS=256;
DwtDialog.ALL_BUTTONS=[DwtDialog.CANCEL_BUTTON,DwtDialog.OK_BUTTON,DwtDialog.DISMISS_BUTTON,DwtDialog.NO_BUTTON,DwtDialog.YES_BUTTON];
DwtDialog.MSG_KEY={};
DwtDialog.MSG_KEY[DwtDialog.CANCEL_BUTTON]="cancel";
DwtDialog.MSG_KEY[DwtDialog.OK_BUTTON]="ok";
DwtDialog.MSG_KEY[DwtDialog.DISMISS_BUTTON]="dismiss";
DwtDialog.MSG_KEY[DwtDialog.NO_BUTTON]="no";
DwtDialog.MSG_KEY[DwtDialog.YES_BUTTON]="yes";
DwtDialog.ALIGN={};
DwtDialog.ALIGN[DwtDialog.CANCEL_BUTTON]=DwtDialog.ALIGN_RIGHT;
DwtDialog.ALIGN[DwtDialog.OK_BUTTON]=DwtDialog.ALIGN_RIGHT;
DwtDialog.ALIGN[DwtDialog.DISMISS_BUTTON]=DwtDialog.ALIGN_RIGHT;
DwtDialog.ALIGN[DwtDialog.NO_BUTTON]=DwtDialog.ALIGN_RIGHT;
DwtDialog.ALIGN[DwtDialog.YES_BUTTON]=DwtDialog.ALIGN_RIGHT;
DwtDialog.MODELESS=DwtBaseDialog.MODELESS;
DwtDialog.MODAL=DwtBaseDialog.MODAL;
DwtDialog.prototype.CONTROLS_TEMPLATE="dwt.Widgets#DwtDialogControls";
DwtDialog.prototype.popdown=function(){
DwtBaseDialog.prototype.popdown.call(this);
if(!this._disposeOnPopDown){
this.resetButtonStates()
}};
DwtDialog.prototype.popup=function(e,t){
this._focusButtonId=t;
DwtBaseDialog.prototype.popup.call(this,e)
};
DwtDialog.prototype._resetTabFocus=function(){
if(this._focusButtonId){
var e=this.getButton(this._focusButtonId);
this._tabGroup.setFocusMember(e,true)
}else{
DwtBaseDialog.prototype._resetTabFocus.call(this)
}};
DwtDialog.prototype.reset=function(){
this._resetCallbacks();
this.resetButtonStates();
DwtBaseDialog.prototype.reset.call(this)
};
DwtDialog.prototype.resetButtonStates=function(){
for(b in this._button){
this._button[b].setEnabled(true);
this._button[b].setHovered(false)
}
this.associateEnterWithButton(this._initialEnterButtonId)
};
DwtDialog.prototype.getButton=function(e){
return this._button[e]
};
DwtDialog.prototype.setButtonEnabled=function(t,e){
if(!this._button[t]){
return
}
this._button[t].setEnabled(e)
};
DwtDialog.prototype.setButtonVisible=function(e,t){
if(!this._button[e]){
return
}
this._button[e].setVisible(t)
};
DwtDialog.prototype.getButtonEnabled=function(e){
return this._button[e].getEnabled()
};
DwtDialog.prototype.registerCallback=function(t,a,i,e){
this._buttonDesc[t].callback=(a&&(a.isAjxCallback||(!i&&!e)))?a:(new AjxCallback(i,a,e))
};
DwtDialog.prototype.unregisterCallback=function(e){
this._buttonDesc[e].callback=null
};
DwtDialog.prototype.setButtonListener=function(e,t){
this._button[e].removeSelectionListeners();
this._button[e].addSelectionListener(t)
};
DwtDialog.prototype.setEnterListener=function(e){
this.removeAllListeners(DwtEvent.ENTER);
this.addEnterListener(e)
};
DwtDialog.prototype.associateEnterWithButton=function(e){
this._enterButtonId=e
};
DwtDialog.prototype.getKeyMapName=function(){
return DwtKeyMap.MAP_DIALOG
};
DwtDialog.prototype.handleKeyAction=function(e,t){
switch(e){
case DwtKeyMap.ENTER:this.notifyListeners(DwtEvent.ENTER,t);
break;
case DwtKeyMap.CANCEL:var a=false;
a=a||this._runCallbackForButtonId(DwtDialog.CANCEL_BUTTON);
a=a||this._runCallbackForButtonId(DwtDialog.NO_BUTTON);
a=a||this._runCallbackForButtonId(DwtDialog.DISMISS_BUTTON);
if(!a&&this._buttonDesc[DwtDialog.OK_BUTTON]&&this._buttonList.length==1){
a=a||this._runCallbackForButtonId(DwtDialog.OK_BUTTON)
}
this.popdown();
return true;
case DwtKeyMap.YES:if(this._buttonDesc[DwtDialog.YES_BUTTON]){
this._runCallbackForButtonId(DwtDialog.YES_BUTTON)
}
break;
case DwtKeyMap.NO:if(this._buttonDesc[DwtDialog.NO_BUTTON]){
this._runCallbackForButtonId(DwtDialog.NO_BUTTON)
}
break;
default:return false
}
return true
};
DwtDialog.prototype._createHtmlFromTemplate=function(a,o){
DwtBaseDialog.prototype._createHtmlFromTemplate.call(this,a,o);
var i=o.id+"_focus";
if(document.getElementById(i)){
this._focusElementId=i
}
this._buttonsEl=document.getElementById(o.id+"_buttons");
if(this._buttonsEl){
var t=[];
var e=0;
this._addButtonsHtml(t,e);
this._buttonsEl.innerHTML=t.join("")
}};
DwtDialog.prototype._getButtonsContainerStartTemplate=function(){
return"<table role='presentation' width='100%'><tr>"
};
DwtDialog.prototype._getButtonsAlignStartTemplate=function(){
return"<td align=\"{0}\"><table role='presentation'><tr>"
};
DwtDialog.prototype._getButtonsAlignEndTemplate=function(){
return"</tr></table></td>"
};
DwtDialog.prototype._getButtonsCellTemplate=function(){
return'<td id="{0}"></td>'
};
DwtDialog.prototype._getButtonsContainerEndTemplate=function(){
return"</tr></table>"
};
DwtDialog.prototype._addButtonsHtml=function(s,t){
if(this._buttonList&&this._buttonList.length){
var a=new Array();
var e=new Array();
var n=new Array();
for(var o=0;
o<this._buttonList.length;
o++){
var r=this._buttonList[o];
switch(this._buttonDesc[r].align){
case DwtDialog.ALIGN_RIGHT:e.push(r);
break;
case DwtDialog.ALIGN_LEFT:a.push(r);
break;
case DwtDialog.ALIGN_CENTER:n.push(r);
break
}}
s[t++]=this._getButtonsContainerStartTemplate();
if(a.length){
s[t++]=AjxMessageFormat.format(this._getButtonsAlignStartTemplate(),["left"]);
for(var o=0;
o<a.length;
o++){
var r=a[o];
var h=this._buttonDesc[r].cellTemplate?this._buttonDesc[r].cellTemplate:this._getButtonsCellTemplate();
s[t++]=AjxMessageFormat.format(h,[this._buttonElementId[r]])
}
s[t++]=this._getButtonsAlignEndTemplate()
}
if(n.length){
s[t++]=AjxMessageFormat.format(this._getButtonsAlignStartTemplate(),["center"]);
for(var o=0;
o<n.length;
o++){
var r=n[o];
var h=this._buttonDesc[r].cellTemplate?this._buttonDesc[r].cellTemplate:this._getButtonsCellTemplate();
s[t++]=AjxMessageFormat.format(h,[this._buttonElementId[r]])
}
s[t++]=this._getButtonsAlignEndTemplate()
}
if(e.length){
s[t++]=AjxMessageFormat.format(this._getButtonsAlignStartTemplate(),["right"]);
for(var o=0;
o<e.length;
o++){
var r=e[o];
var h=this._buttonDesc[r].cellTemplate?this._buttonDesc[r].cellTemplate:this._getButtonsCellTemplate();
s[t++]=AjxMessageFormat.format(h,[this._buttonElementId[r]])
}
s[t++]=this._getButtonsAlignEndTemplate()
}
s[t++]=this._getButtonsContainerEndTemplate()
}
return t
};
DwtDialog.prototype._buttonListener=function(a,e){
var i=DwtControl.getTargetControl(a);
var t=(i&&i.buttonId)||this._enterButtonId;
if(t){
this._runCallbackForButtonId(t,e)
}};
DwtDialog.prototype._runCallbackForButtonId=function(i,e){
var t=this._buttonDesc[i];
var a=t&&t.callback;
if(!a){
return false
}
e=(e instanceof Array)?e:[e];
a.run.apply(a,e);
return true
};
DwtDialog.prototype._runEnterCallback=function(e){
if(this._enterButtonId&&this.getButtonEnabled(this._enterButtonId)){
this._runCallbackForButtonId(this._enterButtonId,e)
}};
DwtDialog.prototype._resetCallbacks=function(){
if(this._buttonDesc){
for(var e=0;
e<DwtDialog.ALL_BUTTONS.length;
e++){
var t=DwtDialog.ALL_BUTTONS[e];
if(this._buttonDesc[t]){
this._buttonDesc[t].callback=new AjxCallback(this,this.popdown)
}}}};
DwtDialog_ButtonDescriptor=function(o,e,i,a,t){
this.id=o;
this.label=e;
this.align=i;
this.callback=a;
this.cellTemplate=t
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtSash")){
DwtSash=function(a){
a=Dwt.getParams(arguments,DwtSash.PARAMS);
a.className=a.className||"DwtSash";
a.posStyle=a.posStyle||DwtControl.ABSOLUTE_STYLE;
DwtControl.call(this,a);
var t=this.getHtmlElement();
var e="dwt.Widgets#";
if(!a.style||a.style!=DwtSash.HORIZONTAL_STYLE){
this._style=DwtSash.VERTICAL_STYLE;
t.style.cursor=AjxEnv.isIE?"row-resize":"s-resize";
t.innerHTML=AjxTemplate.expand(e+"DwtVerticalSash")
}else{
this._style=DwtSash.HORIZONTAL_STYLE;
t.style.cursor=AjxEnv.isIE?"col-resize":"w-resize";
t.innerHTML=AjxTemplate.expand(e+"DwtHorizontalSash")
}
this._threshold=(a.threshold>0)?a.threshold:1;
this._captureObj=new DwtMouseEventCapture({
targetObj:this,id:"DwtSash",mouseOverHdlr:DwtSash._mouseOverHdlr,mouseDownHdlr:DwtSash._mouseDownHdlr,mouseMoveHdlr:DwtSash._mouseMoveHdlr,mouseUpHdlr:DwtSash._mouseUpHdlr,mouseOutHdlr:DwtSash._mouseOutHdlr}
);
this.setHandler(DwtEvent.ONMOUSEDOWN,DwtSash._mouseDownHdlr);
this.setHandler(DwtEvent.ONMOUSEOVER,DwtSash._mouseOverHdlr);
this.setHandler(DwtEvent.ONMOUSEOUT,DwtSash._mouseOutHdlr);
this.setZIndex(Dwt.Z_VIEW)
};
DwtSash.PARAMS=["parent","style","className","threshold","posStyle"];
DwtSash.prototype=new DwtControl;
DwtSash.prototype.constructor=DwtSash;
DwtSash.prototype.toString=function(){
return"DwtSash"
};
DwtSash.HORIZONTAL_STYLE=1;
DwtSash.VERTICAL_STYLE=2;
DwtSash.prototype.registerCallback=function(e,t){
this._callbackFunc=e;
this._callbackObj=t
};
DwtSash._mouseOverHdlr=function(t){
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t);
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
};
DwtSash._mouseDownHdlr=function(t){
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t,true);
if(e.button!=DwtMouseEvent.LEFT){
DwtUiEvent.setBehaviour(t,true,false);
return false
}
DwtEventManager.notifyListeners(DwtEvent.ONMOUSEDOWN,e);
var a=e.dwtObj;
if(a._callbackFunc!=null){
a._captureObj.capture();
a._startCoord=(a._style==DwtSash.HORIZONTAL_STYLE)?e.docX:e.docY
}
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
};
DwtSash._mouseMoveHdlr=function(t){
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t);
var i=0;
var a=DwtMouseEventCapture.getTargetObj();
if(a._style==DwtSash.HORIZONTAL_STYLE){
if(e.docX>0&&e.docX!=a._startCoord){
i=e.docX-a._startCoord
}}else{
if(e.docY>0&&e.docY!=a._startCoord){
i=e.docY-a._startCoord
}}
if(Math.abs(i)>=a._threshold){
if(a._callbackObj!=null){
i=a._callbackFunc.call(a._callbackObj,i)
}else{
i=a._callbackFunc(i)
}
a._startCoord+=i;
if(i!=0&&a.getHtmlElement().style.position==Dwt.ABSOLUTE_STYLE){
if(a._style==DwtSash.HORIZONTAL_STYLE){
a.setLocation(a.getLocation().x+i,Dwt.DEFAULT)
}else{
a.setLocation(Dwt.DEFAULT,a.getLocation().y+i)
}}}
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
};
DwtSash._mouseUpHdlr=function(t){
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t);
if(e.button!=DwtMouseEvent.LEFT){
DwtUiEvent.setBehaviour(t,true,false);
return false
}
var a=DwtMouseEventCapture.getTargetObj();
if(a._callbackFunc!=null){
DwtMouseEventCapture.getCaptureObj().release()
}
a.notifyListeners(DwtEvent.ONMOUSEUP,e);
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
};
DwtSash._mouseOutHdlr=function(t){
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t);
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtToolBar")){
DwtToolBar=function(t){
if(arguments.length==0){
return
}
t=Dwt.getParams(arguments,DwtToolBar.PARAMS);
t.className=t.className||"ZToolbar";
DwtComposite.call(this,t);
if(t.parent instanceof DwtToolBar){
this._hasSetMouseEvents=t.parent._hasSetMouseEvents
}
if(t.handleMouse!==false&&!this._hasSetMouseEvents){
var e=[DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEUP,DwtEvent.ONCLICK];
if(!AjxEnv.isIE){
e.push(DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEOUT)
}
this._setEventHdlrs(e);
this._hasSetMouseEvents=true
}
this._style=t.style||DwtToolBar.HORIZ_STYLE;
this._items=[];
this._createHtml();
this._numFillers=0;
this._curFocusIndex=0;
this._keyMapName=(this._style==DwtToolBar.HORIZ_STYLE)?DwtKeyMap.MAP_TOOLBAR_HORIZ:DwtKeyMap.MAP_TOOLBAR_VERT
};
DwtToolBar.PARAMS=["parent","className","posStyle","style","index","id"];
DwtToolBar.prototype=new DwtComposite;
DwtToolBar.prototype.constructor=DwtToolBar;
DwtToolBar.prototype.role="toolbar";
DwtToolBar.prototype.isDwtToolBar=true;
DwtToolBar.prototype.toString=function(){
return"DwtToolBar"
};
DwtToolBar.HORIZ_STYLE=1;
DwtToolBar.VERT_STYLE=2;
DwtToolBar.ELEMENT=1;
DwtToolBar.SPACER=2;
DwtToolBar.SEPARATOR=3;
DwtToolBar.FILLER=4;
DwtToolBar.FIRST_ITEM="ZFirstItem";
DwtToolBar.LAST_ITEM="ZLastItem";
DwtToolBar.SELECTED_NEXT=DwtControl.SELECTED+"Next";
DwtToolBar.SELECTED_PREV=DwtControl.SELECTED+"Prev";
DwtToolBar._NEXT_PREV_RE=new RegExp("\\b"+[DwtToolBar.SELECTED_NEXT,DwtToolBar.SELECTED_PREV].join("|")+"\\b","g");
DwtToolBar.prototype.TEMPLATE="dwt.Widgets#ZToolbar";
DwtToolBar.prototype.ITEM_TEMPLATE="dwt.Widgets#ZToolbarItem";
DwtToolBar.prototype.SEPARATOR_TEMPLATE="dwt.Widgets#ZToolbarSeparator";
DwtToolBar.prototype.SPACER_TEMPLATE="dwt.Widgets#ZToolbarSpacer";
DwtToolBar.prototype.FILLER_TEMPLATE="dwt.Widgets#ZToolbarFiller";
DwtToolBar.__itemCount=0;
DwtToolBar.prototype.dispose=function(){
this._itemsEl=null;
this._prefixEl=null;
this._suffixEl=null;
DwtComposite.prototype.dispose.call(this)
};
DwtToolBar.prototype.getItem=function(e){
return this._children.get(e)
};
DwtToolBar.prototype.getItemCount=function(){
return this._children.size()
};
DwtToolBar.prototype.getItems=function(){
return this._children.getArray()
};
DwtToolBar.prototype.addSpacer=function(t,e){
var a=this._createSpacerElement();
this._addItem(DwtToolBar.SPACER,a,e);
new DwtToolBarSpacer({
parent:this,parentElement:a,index:e,id:this._htmlElId+"_spacer"+DwtToolBar.__itemCount}
);
return a
};
DwtToolBar.prototype.addSeparator=function(a,e){
var t=this._createSeparatorElement();
this._addItem(DwtToolBar.SEPARATOR,t,e);
new DwtToolBarSeparator({
parent:this,parentElement:t,index:e,id:this._htmlElId+"_separator"+DwtToolBar.__itemCount}
);
return t
};
DwtToolBar.prototype.removeSeparator=function(e){
this.removeChild(DwtControl.fromElement(e.firstChild));
this._removeItem(e)
};
DwtToolBar.prototype.addFiller=function(a,e){
var t=this._createFillerElement();
this._addItem(DwtToolBar.FILLER,t,e);
new DwtToolBarSpacer({
parent:this,parentElement:t,index:e,id:this._htmlElId+"_filler"+DwtToolBar.__itemCount}
);
return t
};
DwtToolBar.prototype.addChild=function(a,e){
var t=this._createItemElement();
this._addItem(DwtToolBar.ELEMENT,t,e);
DwtComposite.prototype.addChild.apply(this,arguments);
a.reparentHtmlElement(t)
};
DwtToolBar.prototype.getKeyMapName=function(){
return this._keyMapName
};
DwtToolBar.prototype.handleKeyAction=function(t,i){
var a=this.getItem(this._curFocusIndex);
var e=this.getItemCount();
if(e<2){
return true
}
switch(t){
case DwtKeyMap.PREV:if(this._curFocusIndex>0){
this._moveFocus(true)
}
break;
case DwtKeyMap.NEXT:if(this._curFocusIndex<(e-1)){
this._moveFocus()
}
break;
default:if(a){
return a.handleKeyAction(t,i)
}}
return true
};
DwtToolBar.prototype._createItemId=function(t){
t=t||this._htmlElId;
var e=[t,"item",++DwtToolBar.__itemCount].join("_");
return e
};
DwtToolBar.prototype._createHtml=function(){
var e={
id:this._htmlElId};
this._createHtmlFromTemplate(this.TEMPLATE,e);
this._itemsEl=document.getElementById(e.id+"_items");
this._prefixEl=document.getElementById(e.id+"_prefix");
this._suffixEl=document.getElementById(e.id+"_suffix")
};
DwtToolBar.prototype._createItemElement=function(a){
a=a||this.ITEM_TEMPLATE;
var i={
id:this._htmlElId,itemId:this._createItemId()};
var t=AjxTemplate.expand(a,i);
var e=AjxStringUtil.calcDIV();
e.innerHTML=t;
return e.firstChild.rows[0].cells[0]
};
DwtToolBar.prototype._createSpacerElement=function(e){
return this._createItemElement(e||this.SPACER_TEMPLATE)
};
DwtToolBar.prototype._createSeparatorElement=function(e){
return this._createItemElement(e||this.SEPARATOR_TEMPLATE)
};
DwtToolBar.prototype._createFillerElement=function(e){
return this._createItemElement(e||this.FILLER_TEMPLATE)
};
DwtToolBar.prototype._addItem=function(i,a,t){
var o=this._items[t]||this._suffixEl;
var e=t||(typeof t=="number")?t:this._items.length;
this._items.splice(e,0,a);
this._itemsEl.insertBefore(a,o)
};
DwtToolBar.prototype._removeItem=function(t){
for(var e=0;
e<this._items.length;
e++){
if(this._items[e]==t){
this._items.splice(e,1);
this._itemsEl.removeChild(t);
break
}}};
DwtToolBar.prototype._focus=function(e){
if(!this._submenuKeySet){
var a=this.shell.getKeyboardMgr();
if(a.isEnabled()){
var t=a.__keyMapMgr;
if(t){
if(this._style==DwtToolBar.HORIZ_STYLE){
t.removeMapping(DwtKeyMap.MAP_BUTTON,"ArrowRight");
t.setMapping(DwtKeyMap.MAP_BUTTON,"ArrowDown",DwtKeyMap.SUBMENU)
}else{
t.removeMapping(DwtKeyMap.MAP_BUTTON,"ArrowDown");
t.setMapping(DwtKeyMap.MAP_BUTTON,"ArrowRight",DwtKeyMap.SUBMENU)
}
t.reloadMap(DwtKeyMap.MAP_BUTTON)
}}
this._submenuKeySet=true
}
e=e?e:this._getFocusItem(this._curFocusIndex);
if(e){
e.focus()
}else{
this._moveFocus()
}};
DwtToolBar.prototype._blur=function(e){
e=e?e:this._getFocusItem(this._curFocusIndex);
if(e){
e.blur()
}};
DwtToolBar.prototype._getFocusItem=function(e){
var t=this.getItem(e);
if(!t||(t instanceof DwtToolBar)){
return null
}
if(t._noFocus){
return null
}
if(t.getEnabled&&!t.getEnabled()){
return null
}
if(t.getVisible&&!t.getVisible()){
return null
}
if(t instanceof DwtText&&!t.getText()){
return null
}
return t
};
DwtToolBar.prototype._moveFocus=function(e){
var t=this._curFocusIndex;
var a=this.getItemCount()-1;
var i=null;
while(!i&&t>=0&&t<=a){
t=e?t-1:t+1;
i=this._getFocusItem(t)
}
if(i){
this._blur();
this._curFocusIndex=t;
this._focus(i)
}};
DwtToolBar.prototype.__markPrevNext=function(s,n){
var e=this.__getButtonIndex(s);
var i=this.__getButtonAt(e-1);
var t=this.__getButtonAt(e+1);
if(n){
if(i){
Dwt.delClass(i.getHtmlElement(),DwtToolBar._NEXT_PREV_RE,DwtToolBar.SELECTED_PREV)
}
if(t){
Dwt.delClass(t.getHtmlElement(),DwtToolBar._NEXT_PREV_RE,DwtToolBar.SELECTED_NEXT)
}}else{
if(i){
Dwt.delClass(i.getHtmlElement(),DwtToolBar._NEXT_PREV_RE)
}
if(t){
Dwt.delClass(t.getHtmlElement(),DwtToolBar._NEXT_PREV_RE)
}}
var o=this.__getButtonAt(0);
if(o){
Dwt.addClass(o.getHtmlElement(),DwtToolBar.FIRST_ITEM)
}
var a=this.__getButtonAt(this.getItemCount()-1);
if(a){
Dwt.addClass(a.getHtmlElement(),DwtToolBar.LAST_ITEM)
}};
DwtToolBar.prototype.__getButtonIndex=function(a){
var t=this.getChildren();
var e=this._buttons[a];
if(t&&t.length&&e){
return AjxUtil.indexOf(t,e)
}
return -1
};
DwtToolBar.prototype.__getButtonAt=function(t){
var a=0;
for(var e in this._buttons){
if(this._buttons.hasOwnProperty(e)){
if(a==t){
return this._buttons[e]
}
a++
}}
return null
};
DwtToolBarButton=function(e){
if(arguments.length==0){
return
}
var e=Dwt.getParams(arguments,DwtToolBarButton.PARAMS);
e.className=e.className||"ZToolbarButton";
DwtButton.call(this,e)
};
DwtToolBarButton.PARAMS=["parent","style","className","posStyle","actionTiming","id","index"];
DwtToolBarButton.prototype=new DwtButton;
DwtToolBarButton.prototype.constructor=DwtToolBarButton;
DwtToolBarButton.prototype.isDwtToolBarButton=true;
DwtToolBarButton.prototype.toString=function(){
return"DwtToolBarButton"
};
DwtToolBarButton.prototype.TEMPLATE="dwt.Widgets#ZToolbarButton";
DwtToolBarSpacer=function(){
DwtControl.apply(this,arguments);
this._noFocus=true
};
DwtToolBarSpacer.prototype=new DwtControl;
DwtToolBarSpacer.prototype.constructor=DwtToolBarSpacer;
DwtToolBarSpacer.prototype.isDwtToolBarSpacer=true;
DwtToolBarSpacer.prototype.toString=function(){
return"DwtToolBarSpacer"
};
DwtToolBarSeparator=function(){};
DwtToolBarSeparator.prototype=new DwtToolBarSpacer;
DwtToolBarSeparator.prototype.constructor=DwtToolBarSeparator;
DwtToolBarSeparator.prototype.isDwtToolBarSeparator=true;
DwtToolBarSeparator.prototype.toString=function(){
return"DwtToolBarSeparator"
};
DwtToolBarSeparator.prototype.isFocusable=true;
DwtToolBarSeparator.prototype.role="separator"
}
if(AjxPackage.define("ajax.dwt.widgets.DwtToolTip")){
DwtToolTip=function(n,s,o){
if(arguments.length==0){
return
}
this.shell=n;
this._dialog=o;
this._poppedUp=false;
this._div=document.createElement("div");
this._div.className=s||"DwtToolTip";
this._div.style.position=DwtControl.ABSOLUTE_STYLE;
this.shell.getHtmlElement().appendChild(this._div);
Dwt.setZIndex(this._div,Dwt.Z_HIDDEN);
Dwt.setLocation(this._div,Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE);
this._eventMgr=new AjxEventMgr();
var a="dwt.Widgets#DwtToolTip";
this._div.innerHTML=AjxTemplate.expand(a);
var h=AjxTemplate.getParams(a);
this._offsetX=(h.width!=null)?Number(h.width):DwtToolTip.POPUP_OFFSET_X;
this._offsetY=(h.height!=null)?Number(h.height):DwtToolTip.POPUP_OFFSET_Y;
this._contentDiv=document.getElementById("tooltipContents");
Dwt.setHandler(this._div,DwtEvent.ONMOUSEOVER,AjxCallback.simpleClosure(this._mouseOverListener,this));
Dwt.setHandler(this._div,DwtEvent.ONMOUSEOUT,AjxCallback.simpleClosure(this._mouseOutListener,this));
var t=[DwtEvent.ONCLICK,DwtEvent.ONDBLCLICK,DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEENTER,DwtEvent.ONMOUSELEAVE,DwtEvent.ONMOUSEMOVE,DwtEvent.ONMOUSEUP,DwtEvent.ONMOUSEWHEEL,DwtEvent.ONSCROLL];
for(var e=0;
e<t.length;
e++){
var r=t[e];
Dwt.setHandler(this._div,r,AjxCallback.simpleClosure(this.notifyListeners,this,[r]))
}};
DwtToolTip.prototype.isDwtToolTip=true;
DwtToolTip.prototype.toString=function(){
return"DwtToolTip"
};
DwtToolTip.TOOLTIP_DELAY=750;
DwtToolTip.WINDOW_GUTTER=5;
DwtToolTip.POPUP_OFFSET_X=5;
DwtToolTip.POPUP_OFFSET_Y=5;
DwtToolTip.prototype.getContent=function(){
return this._div.innerHTML
};
DwtToolTip.prototype.setContent=function(t,e){
this._content=t;
if(e){
this._contentDiv.innerHTML=this._content
}};
DwtToolTip.prototype.popup=function(e,s,t,a,i,n,o){
this._hovered=false;
if(this._popupAction){
AjxTimedAction.cancelAction(this._popupAction);
this._popupAction=null
}
this._popdownOnMouseOver=a;
this._popdownListener=o;
if(this._content!=null){
if(!t){
this._contentDiv.innerHTML=this._content
}
this._popupAction=new AjxTimedAction(this,this._positionElement,[e,s,i,n]);
AjxTimedAction.scheduleAction(this._popupAction,5)
}};
DwtToolTip.prototype.setSticky=function(e){
this._poppedUp=!e
};
DwtToolTip.prototype.popdown=function(){
this._popdownOnMouseOver=false;
this._hovered=false;
if(this._popupAction){
AjxTimedAction.cancelAction(this._popupAction);
this._popupAction=null
}
if(this._content!=null&&this._poppedUp){
Dwt.setLocation(this._div,Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE);
this._poppedUp=false;
if(this._popdownListener instanceof AjxCallback){
this._popdownListener.run()
}
this._popdownListener=null
}};
DwtToolTip.prototype._positionElement=function(s,n,o,r){
this._popupAction=null;
var a=DwtShell.getShell(window).getSize();
var t=a.x,m=a.y;
var f,u,e;
var p=o&&o.getTooltipBase(r);
if(p){
e=Dwt.toWindow(p);
var i=Dwt.getSize(p);
f=e.x+this._offsetX;
u=e.y+i.y+this._offsetY
}else{
f=s+this._offsetX;
u=n+this._offsetY
}
var c=Dwt.getSize(this._div);
var d=c.x,h=c.y;
if(f+d>t-DwtToolTip.WINDOW_GUTTER){
f=t-DwtToolTip.WINDOW_GUTTER-d
}
if(u+h>m-DwtToolTip.WINDOW_GUTTER){
u=(e?e.y:u)-this._offsetY-h
}
Dwt.setLocation(this._div,f,u);
var l=this._dialog?this._dialog.getZIndex()+Dwt._Z_INC:Dwt.Z_TOOLTIP;
Dwt.setZIndex(this._div,l);
this._poppedUp=true
};
DwtToolTip.prototype._mouseOverListener=function(e){
this._hovered=true;
if(this._popdownOnMouseOver&&this._poppedUp){
var t=(this._popdownOnMouseOver.isAjxCallback||AjxUtil.isFunction(this._popdownOnMouseOver))?this._popdownOnMouseOver:null;
this.popdown();
if(t){
t.run()
}}
this.notifyListeners(DwtEvent.ONMOUSEOVER)
};
DwtToolTip.prototype._mouseOutListener=function(a){
a=DwtUiEvent.getEvent(a,this._div);
var e=Dwt.toWindow(this._div);
var t=Dwt.getSize(this._div);
if(a.clientX<=e.x||a.clientX>=(e.x+t.x)||a.clientY<=e.y||a.clientY>=(e.y+t.y)){
this.popdown();
this.notifyListeners(DwtEvent.ONMOUSEOUT)
}};
DwtToolTip.prototype.getHovered=function(){
return this._hovered
};
DwtToolTip.prototype.addListener=function(t,a,e){
return this._eventMgr.addListener(t,a,e)
};
DwtToolTip.prototype.setListener=function(t,a,e){
this.removeAllListeners(t);
return this._eventMgr.addListener(t,a,e)
};
DwtToolTip.prototype.removeListener=function(e,t){
return this._eventMgr.removeListener(e,t)
};
DwtToolTip.prototype.removeAllListeners=function(e){
return this._eventMgr.removeAll(e)
};
DwtToolTip.prototype.isListenerRegistered=function(e){
return this._eventMgr.isListenerRegistered(e)
};
DwtToolTip.prototype.notifyListeners=function(e,t){
return this._eventMgr.notifyListeners(e,t)
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtTreeItem")){
DwtTreeItem=function(t){
if(arguments.length==0){
return
}
t=Dwt.getParams(arguments,DwtTreeItem.PARAMS);
var e=t.parent;
if(e instanceof DwtTree){
this._tree=e
}else{
if(e instanceof DwtTreeItem){
this._tree=e._tree
}else{
throw new DwtException("DwtTreeItem parent must be a DwtTree or DwtTreeItem",DwtException.INVALIDPARENT,"DwtTreeItem")
}}
this._origClassName=t.className||"DwtTreeItem";
this._textClassName=[this._origClassName,"Text"].join("-");
this._selectedClassName=this._origClassName+" "+[this._origClassName,DwtCssStyle.SELECTED].join("-");
this._selectedFocusedClassName=this._selectedClassName+" "+[this._origClassName,DwtCssStyle.SELECTED,DwtCssStyle.FOCUSED].join("-");
this._actionedClassName=this._origClassName+" "+[this._origClassName,DwtCssStyle.ACTIONED].join("-");
this._dragOverClassName=this._origClassName+" "+[this._origClassName,DwtCssStyle.DRAG_OVER].join("-");
this._treeItemTextClass="DwtTreeItem-Text";
this._treeItemExtraImgClass="DwtTreeItem-ExtraImg";
this._dynamicWidth=t.dynamicWidth;
t.deferred=(t.deferred!==false);
t.className=null;
DwtComposite.call(this,t);
this._imageInfoParam=t.imageInfo;
this._extraInfo=t.extraInfo;
this._textParam=t.text;
this._deferred=t.deferred;
this._expandNodeImage=t.expandNodeImage||"NodeExpanded";
this._collapseNodeImage=t.collapseNodeImage||"NodeCollapsed";
this._itemChecked=false;
this._initialized=false;
this._selectionEnabled=Boolean(t.selectable!==false);
this._forceNotifySelection=Boolean(t.forceNotifySelection);
this._actionEnabled=true;
this._forceNotifyAction=Boolean(t.forceNotifyAction);
this._dndScrollCallback=t.dndScrollCallback;
this._dndScrollId=t.dndScrollId;
this._arrowDisabled=t.arrowDisabled;
if(t.singleClickAction){
this._singleClickAction=true;
this._selectedFocusedClassName=this._selectedClassName=this._textClassName;
this._hoverClassName=[this._origClassName,DwtCssStyle.HOVER].join("-")
}else{
this._hoverClassName=this._textClassName
}
if(e instanceof DwtTree||(e._initialized&&(!e._deferred||e._expanded))||!t.deferred){
this._initialize(t.index)
}else{
e._addDeferredChild(this,t.index);
this._index=t.index
}};
DwtTreeItem.PARAMS=["parent","index","text","imageInfo","deferred","className","posStyle","forceNotifySelection","forceNotifyAction"];
DwtTreeItem.prototype=new DwtComposite;
DwtTreeItem.prototype.constructor=DwtTreeItem;
DwtTreeItem.prototype.isDwtTreeItem=true;
DwtTreeItem.prototype.toString=function(){
return"DwtTreeItem"
};
DwtTreeItem.prototype.TEMPLATE="dwt.Widgets#ZTreeItem";
DwtTreeItem.prototype.role="treeitem";
DwtTreeItem.prototype.isFocusable=true;
DwtTreeItem.prototype._checkBoxVisible=true;
DwtTreeItem._NODECELL_DIM="16px";
DwtTreeItem._processedMouseDown=false;
DwtTreeItem.prototype.dispose=function(){
DwtComposite.prototype.dispose.call(this);
this._itemDiv=null;
this._nodeCell=null;
this._checkBoxCell=null;
this._checkedImg=null;
this._checkBox=null;
this._imageCell=null;
this._textCell=null;
this._childDiv=null;
this._initialized=false
};
DwtTreeItem.prototype.getData=function(e){
var t=this._data[e];
if(e!==Dwt.KEY_OBJECT||!t||!t.isZmOrganizer){
return t
}
var a=t&&appCtxt.cacheGet(t.id);
return a||t
};
DwtTreeItem.prototype.getChecked=function(){
return this._itemChecked
};
DwtTreeItem.prototype.setChecked=function(e,t){
if((this._itemChecked!=e)||t){
this._itemChecked=e;
if(this._checkBox!=null&&(this._checkBoxCell&&Dwt.getVisible(this._checkBoxCell))){
Dwt.setVisible(this._checkedImg,e)
}}};
DwtTreeItem.prototype._handleCheckboxOnclick=function(e){
this.setChecked(!Dwt.getVisible(this._checkedImg));
e=e||window.event;
e.item=this;
this._tree._itemChecked(this,e)
};
DwtTreeItem.prototype.getExpanded=function(){
return this._expanded
};
DwtTreeItem.prototype.setExpanded=function(t,s,n){
if(t){
var r=this.parent;
while(r instanceof DwtTreeItem&&!r._expanded){
r.setExpanded(true);
r=r.parent
}
this._realizeDeferredChildren()
}
if(this.getNumChildren()){
if(t&&s){
if(!this._expanded){
this._expand(t,null,n)
}
var e=this.getChildren();
for(var o=0;
o<e.length;
o++){
if(e[o] instanceof DwtTreeItem){
e[o].setExpanded(t,s,n)
}}}else{
if(this._expanded!=t){
this._expand(t,null,n)
}}}};
DwtTreeItem.prototype.getItemCount=function(){
return this._children.size()
};
DwtTreeItem.prototype.getItems=function(){
return this._children.getArray()
};
DwtTreeItem.prototype.getChildIndex=function(e){
return this._children.indexOf(e)
};
DwtTreeItem.prototype.getNestingLevel=function(){
return this.parent.getNestingLevel()+1
};
DwtTreeItem.prototype.getImage=function(){
return this._imageInfo
};
DwtTreeItem.prototype.setImage=function(e){
if(this._initialized){
if(this._imageCell){
AjxImg.setImage(this._imageCell,e)
}
this._imageInfo=e
}else{
this._imageInfoParam=e
}};
DwtTreeItem.prototype.setDndImage=function(e){
this._dndImageInfo=e
};
DwtTreeItem.prototype.getSelected=function(){
return this._selected
};
DwtTreeItem.prototype.getActioned=function(){
return this._actioned
};
DwtTreeItem.prototype.getText=function(){
return this._text
};
DwtTreeItem.prototype.setText=function(e){
if(this._initialized&&this._textCell){
if(!e){
e=""
}
this._text=this._textCell.innerHTML=e
}else{
this._textParam=e
}};
DwtTreeItem.prototype.setDndText=function(e){
this._dndText=e
};
DwtTreeItem.prototype.showCheckBox=function(e){
this._checkBoxVisible=e;
if(this._checkBoxCell){
Dwt.setVisible(this._checkBoxCell,e)
}};
DwtTreeItem.prototype.showExpansionIcon=function(e){
if(this._nodeCell){
Dwt.setVisible(this._nodeCell,e)
}};
DwtTreeItem.prototype.enableSelection=function(e){
this._selectionEnabled=e;
this._selectedClassName=e?this._origClassName+"-"+DwtCssStyle.SELECTED:this._origClassName
};
DwtTreeItem.prototype.isSelectionEnabled=function(){
return this._selectionEnabled
};
DwtTreeItem.prototype.enableAction=function(e){
this._actionEnabled=e
};
DwtTreeItem.prototype.addSeparator=function(e){
this._children.add((new DwtTreeItemSeparator(this)),e)
};
DwtTreeItem.prototype.setVisible=function(a,t,e){
if(t&&!e){
Dwt.setVisible(this._itemDiv,a)
}else{
if(e&&!t){
Dwt.setVisible(this._childDiv,a)
}else{
DwtComposite.prototype.setVisible.call(this,a)
}}};
DwtTreeItem.prototype.removeChild=function(t){
if(t._initialized){
this._tree._deselect(t);
if(this._childDiv){
this._childDiv.removeChild(t.getHtmlElement())
}}
this._children.remove(t);
if(this._children.size()==0){
if(this._expanded){
this._expanded=false
}
this._expandable=false;
if(this._initialized&&this._nodeCell){
AjxImg.setImage(this._nodeCell,"Blank_16");
var e=AjxImg.getImageElement(this._nodeCell);
if(e){
Dwt.clearHandler(e,DwtEvent.ONMOUSEDOWN)
}}}};
DwtTreeItem.prototype.getKeyMapName=function(){
return DwtKeyMap.MAP_TREE
};
DwtTreeItem.prototype.handleKeyAction=function(o,r){
switch(o){
case DwtKeyMap.ENTER:this._tree.setEnterSelection(this,true);
break;
case DwtKeyMap.NEXT:var e=this._tree._getNextTreeItem(true);
if(e){
e._tree.setSelection(e,false,true)
}
break;
case DwtKeyMap.PREV:var e=this._tree._getNextTreeItem(false);
if(e){
e._tree.setSelection(e,false,true)
}
break;
case DwtKeyMap.SELECT_FIRST:case DwtKeyMap.SELECT_LAST:var e=(o===DwtKeyMap.SELECT_FIRST)?this._tree._getFirstTreeItem():this._tree._getLastTreeItem();
if(e){
e._tree.setSelection(e,false,true)
}
break;
case DwtKeyMap.EXPAND:if(!this._expanded){
this.setExpanded(true,false,true)
}else{
if(this._children.size()>0){
var i=this._children.get(0);
this._tree.setSelection(i,false,true)
}}
break;
case DwtKeyMap.COLLAPSE:if(this._expanded){
this.setExpanded(false,false,true)
}else{
if(this.parent.isDwtTreeItem){
this._tree.setSelection(this.parent,false,true)
}}
break;
case DwtKeyMap.SUBMENU:var a=this.getHtmlElement();
var t=Dwt.toWindow(a,0,0);
var l=this.getSize();
var h=t.x+l.x/4;
var n=t.y+l.y/2;
this._gotMouseDownRight=true;
this._emulateSingleClick({
dwtObj:this,target:a,button:DwtMouseEvent.RIGHT,docX:h,docY:n,kbNavEvent:true}
);
break;
default:return false
}
return true
};
DwtTreeItem.prototype.addNodeIconListeners=function(){
var e=AjxImg.getImageElement(this._nodeCell);
if(e){
Dwt.setHandler(e,DwtEvent.ONMOUSEDOWN,DwtTreeItem._nodeIconMouseDownHdlr);
Dwt.setHandler(e,DwtEvent.ONMOUSEUP,DwtTreeItem._nodeIconMouseUpHdlr)
}};
DwtTreeItem.prototype._initialize=function(e,o,i){
this._checkState();
if(AjxEnv.isIE){
this._setEventHdlrs([DwtEvent.ONMOUSEENTER,DwtEvent.ONMOUSELEAVE])
}
if(AjxEnv.isSafari){
this._setEventHdlrs([DwtEvent.ONCONTEXTMENU])
}
var a={
id:this._htmlElId,divClassName:this._origClassName,isCheckedStyle:this._tree.isCheckedStyle,textClassName:this._textClassName};
this._createHtmlFromTemplate(this.TEMPLATE,a);
this.parent._addItem(this,e,o);
this._itemDiv=document.getElementById(a.id+"_div");
this._nodeCell=document.getElementById(a.id+"_nodeCell");
this._checkBoxCell=document.getElementById(a.id+"_checkboxCell");
this._checkBox=document.getElementById(a.id+"_checkbox");
this._checkedImg=document.getElementById(a.id+"_checkboxImg");
this._imageCell=document.getElementById(a.id+"_imageCell");
this._textCell=document.getElementById(a.id+"_textCell");
this._extraCell=document.getElementById(a.id+"_extraCell");
this.setAttribute("aria-level",this.getNestingLevel());
if(this._textCell){
this.setAttribute("aria-labelledby",this._textCell.id)
}
this.setAttribute("aria-expanded",false);
if(this._dynamicWidth){
var t=document.getElementById(a.id+"_table");
if(t){
t.style.tableLayout="auto"
}}
this._expandable=false;
if(this._nodeCell){
this._nodeCell.style.minWidth=this._nodeCell.style.width=this._nodeCell.style.height=DwtTreeItem._NODECELL_DIM;
if(this._children.size()>0||i){
this._expandable=true;
AjxImg.setImage(this._nodeCell,this._collapseNodeImage);
this.addNodeIconListeners()
}}
if(this._extraCell){
AjxImg.setImage(this._extraCell,(this._extraInfo||"Blank_16"));
this._extraCell.className=this._treeItemExtraImgClass
}
if(this._tree.isCheckedStyle&&this._checkBox){
this._checkBox.onclick=AjxCallback.simpleClosure(this._handleCheckboxOnclick,this);
this.showCheckBox(this._checkBoxVisible);
this.setChecked(this._tree.isCheckedByDefault,true)
}
if(this._imageCell&&this._imageInfoParam){
AjxImg.setImage(this._imageCell,this._imageInfoParam);
this._imageInfo=this._imageInfoParam
}
if(this._textCell&&this._textParam){
this._textCell.innerHTML=this._text=this._textParam
}
this._expanded=this._selected=this._actioned=false;
this._gotMouseDownLeft=this._gotMouseDownRight=false;
this._addMouseListeners();
this._initialized=true
};
DwtTreeItem.prototype.setTreeItemColor=function(i){
var n=this._htmlElId+"_table";
var a=document.getElementById(n);
var o=document.getElementById(this._htmlElId+"_div");
var t=this.getHtmlElement();
var e=this._origClassName+" "+i;
if(o){
o.className=e
}else{
if(t){
t.className=i
}}};
DwtTreeItem.prototype._addMouseListeners=function(){
var t=[DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEUP,DwtEvent.ONDBLCLICK];
if(AjxEnv.isIE){
t.push(DwtEvent.ONMOUSEENTER,DwtEvent.ONMOUSELEAVE)
}else{
t.push(DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEOUT)
}
if(AjxEnv.isSafari){
t.push(DwtEvent.ONCONTEXTMENU)
}
for(var e=0;
e<t.length;
e++){
this.addListener(t[e],DwtTreeItem._listeners[t[e]])
}};
DwtTreeItem.prototype._addDeferredChild=function(a,e){
if(this._initialized&&this._children.size()==0){
if(this._nodeCell){
AjxImg.setImage(this._nodeCell,this._collapseNodeImage);
var t=AjxImg.getImageElement(this._nodeCell);
if(t){
this._expandable=true;
Dwt.setHandler(t,DwtEvent.ONMOUSEDOWN,DwtTreeItem._nodeIconMouseDownHdlr);
Dwt.setHandler(t,DwtEvent.ONMOUSEUP,DwtTreeItem._nodeIconMouseUpHdlr)
}}}
this._children.add(a,e)
};
DwtTreeItem.prototype.addChild=function(e){};
DwtTreeItem.prototype._addItem=function(a,t,n){
if(!this._children.contains(a)){
this._children.add(a,t)
}
this._expandable=true;
if(this._childDiv==null){
this._childDiv=document.createElement("div");
this._childDiv.className=(this.parent!=this._tree)?"DwtTreeItemChildDiv":"DwtTreeItemLevel1ChildDiv";
this._childDiv.setAttribute("role","group");
this._childDiv.setAttribute("aria-labelledby",this._itemDiv.id);
this._childDiv.setAttribute("aria-expanded",false);
this.getHtmlElement().appendChild(this._childDiv);
if(!this._expanded){
this._childDiv.style.display="none"
}}
if(n&&this._nodeCell){
if(AjxImg.getImageClass(this._nodeCell)==AjxImg.getClassForImage("Blank_16")){
AjxImg.setImage(this._nodeCell,this._expanded?this._expandNodeImage:this._collapseNodeImage);
var o=AjxImg.getImageElement(this._nodeCell);
if(o){
Dwt.setHandler(o,DwtEvent.ONMOUSEDOWN,DwtTreeItem._nodeIconMouseDownHdlr)
}}}
var e=this._childDiv;
var i=e.childNodes.length;
if(t==null||t>=i||i==0){
e.appendChild(a.getHtmlElement())
}else{
e.insertBefore(a.getHtmlElement(),e.childNodes[t])
}};
DwtTreeItem.prototype.sort=function(e){
this._children.sort(e);
if(this._childDiv){
this._setChildElOrder()
}else{
this._needsSort=true
}};
DwtTreeItem.prototype._setChildElOrder=function(e){
var t=document.createDocumentFragment();
this._children.foreach(function(o,a){
t.appendChild(o.getHtmlElement());
o._index=a
}
);
this._childDiv.appendChild(t)
};
DwtTreeItem.prototype._getDragProxy=function(){
var t=document.createElement("div");
Dwt.setPosition(t,Dwt.ABSOLUTE_STYLE);
var a=document.createElement("table");
t.appendChild(a);
a.cellSpacing=a.cellPadding=0;
var o=a.insertRow(0);
var e=0;
var n=o.insertCell(e++);
n.noWrap=true;
if(this._dndImageInfo){
AjxImg.setImage(n,this._dndImageInfo)
}else{
if(this._imageInfo){
AjxImg.setImage(n,this._imageInfo)
}}
n=o.insertCell(e);
n.noWrap=true;
n.className=this._origClassName;
if(this._dndText){
n.innerHTML=this._dndText
}else{
if(this._text){
n.innerHTML=this._text
}}
this.shell.getHtmlElement().appendChild(t);
Dwt.setZIndex(t,Dwt.Z_DND);
return t
};
DwtTreeItem.prototype._dragEnter=function(){
this._preDragClassName=this._textCell.className;
this._textCell.className=this._dragOverClassName;
this._draghovering=true
};
DwtTreeItem.prototype._dragHover=function(){
if(this.getNumChildren()>0&&!this.getExpanded()){
this.setExpanded(true)
}};
DwtTreeItem.prototype._dragLeave=function(e){
if(this._preDragClassName){
this._textCell.className=this._preDragClassName
}
this._draghovering=false
};
DwtTreeItem.prototype._drop=function(){
if(this._preDragClassName){
this._textCell.className=this._preDragClassName
}
this._draghovering=false
};
DwtTreeItem.prototype._focusByMouseDownEvent=function(e){};
DwtTreeItem._nodeIconMouseDownHdlr=function(t){
var a=DwtControl.getTargetControl(t);
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t,a);
if(e.button==DwtMouseEvent.LEFT){
a._expand(!a._expanded,e)
}else{
if(e.button==DwtMouseEvent.RIGHT){
e.dwtObj._tree._itemActioned(e.dwtObj,e)
}}
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
};
DwtTreeItem._nodeIconMouseUpHdlr=function(t){
var a=DwtControl.getTargetControl(t);
var e=DwtShell.mouseEvent;
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
};
DwtTreeItem.prototype._expand=function(t,a,e){
if(t!==this._expanded){
if(!t){
this._expanded=false;
this._childDiv.style.display="none";
if(this._nodeCell){
AjxImg.setImage(this._nodeCell,this._collapseNodeImage)
}
this._tree._itemCollapsed(this,a,e)
}else{
this._realizeDeferredChildren();
this._expanded=true;
if(this._childDiv&&this._childDiv.style){
this._childDiv.style.display="block"
}
if(this._nodeCell){
AjxImg.setImage(this._nodeCell,this._expandNodeImage)
}
this._tree._itemExpanded(this,a,e)
}
this.setAttribute("aria-expanded",t);
this._childDiv.setAttribute("aria-expanded",t);
this._childDiv.setAttribute("aria-hidden",!t)
}};
DwtTreeItem.prototype._realizeDeferredChildren=function(){
var e=this._children.getArray();
for(var t=0;
t<e.length;
t++){
var o=e[t];
if(!o._initialized){
o._initialize(o._index,true)
}else{
if(o._isSeparator&&!o.div&&this._childDiv){
var n=o.div=document.createElement("div");
n.className="vSpace";
this._childDiv.appendChild(n);
o._initialized=true
}}}
if(this._needsSort){
if(e.length){
this._setChildElOrder()
}
delete this.__needsSort
}};
DwtTreeItem.prototype._isChildOf=function(e){
var t=this.parent;
while(t&&t!=this._tree){
if(t==e){
return true
}
t=t.parent
}
return false
};
DwtTreeItem.prototype._setTreeElementStyles=function(e,a){
if(this._arrowDisabled||this._draghovering){
return
}
var t=a?"-focused":"";
if(this._extraCell){
AjxImg.setImage(this._extraCell,e);
this._extraCell.className=this._treeItemExtraImgClass+t
}
if(this._textCell){
this._textCell.className=this._treeItemTextClass+t
}};
DwtTreeItem.prototype._setSelected=function(t,a){
if(this._selected!=t&&!this._disposed){
this._selected=t;
if(!this._initialized){
this._initialize()
}
if(!this._itemDiv){
return
}
if(t&&(this._selectionEnabled||this._forceNotifySelection)){
this._itemDiv.className=this._selectedClassName;
this._setTreeElementStyles("DownArrowSmall",true);
if(!a){
this.focus()
}
return true
}else{
this.blur();
this._setTreeElementStyles("Blank_16",false);
this._itemDiv.className=this._origClassName;
return false
}
this.getHtmlElement().setAttribute("aria-selected",t);
var e=this._tree.getHtmlElement();
if(t){
e.setAttribute("aria-activedescendant",this.getHTMLElId())
}else{
e.removeAttribute("aria-activedescendant")
}}};
DwtTreeItem.prototype._setActioned=function(e){
if(this._actioned!=e){
this._actioned=e;
if(!this._initialized){
this._initialize()
}
if(!this._itemDiv){
return
}
if(e&&(this._actionEnabled||this._forceNotifyAction)&&!this._selected){
this._itemDiv.className=this._actionedClassName;
return true
}
if(!e){
if(!this._selected){
this._itemDiv.className=this._origClassName
}
return false
}}};
DwtTreeItem.prototype._focus=function(){
if(!this._itemDiv){
return
}
this._itemDiv.className=this._selectedFocusedClassName;
this._setTreeElementStyles("DownArrowSmall",true)
};
DwtTreeItem.prototype._blur=function(){
if(!this._itemDiv){
return
}
this._itemDiv.className=this._selected?this._selectedClassName:this._origClassName;
this._setTreeElementStyles(this._selected?"DownArrowSmall":"Blank_16",this._selected)
};
DwtTreeItem._mouseDownListener=function(e){
var t=e.dwtObj;
if(!t){
return false
}
if(e.target==t._childDiv){
return
}
if(e.button==DwtMouseEvent.LEFT&&(t._selectionEnabled||t._forceNotifySelection)){
t._gotMouseDownLeft=true
}else{
if(e.button==DwtMouseEvent.RIGHT&&(t._actionEnabled||t._forceNotifyAction)){
t._gotMouseDownRight=true
}}};
DwtTreeItem._mouseOutListener=function(e){
var t=e.dwtObj;
if(!t){
return false
}
if(e.target==t._childDiv){
return
}
t._gotMouseDownLeft=false;
t._gotMouseDownRight=false;
if(t._singleClickAction&&t._textCell){
t._textCell.className=t._textClassName
}
if(!t._selected){
t._setTreeElementStyles("Blank_16",false)
}};
DwtTreeItem._mouseOverListener=function(e){
var t=e.dwtObj;
if(!t){
return false
}
if(e.target==t._childDiv){
return
}
if(t._singleClickAction&&t._textCell){
t._textCell.className=t._hoverClassName
}
if(!t._selected){
t._setTreeElementStyles("ColumnDownArrow",true)
}};
DwtTreeItem._mouseUpListener=function(e){
var t=e.dwtObj;
if(!t){
return false
}
if(e.target==t._childDiv){
return
}
if(t._expandable&&e.target===AjxImg.getImageElement(t._nodeCell)){
return
}
if(e.button==DwtMouseEvent.LEFT&&t._gotMouseDownLeft){
t._tree._itemClicked(t,e)
}else{
if(e.button==DwtMouseEvent.RIGHT&&t._gotMouseDownRight){
t._tree._itemActioned(t,e)
}}};
DwtTreeItem._doubleClickListener=function(t){
var a=t.dwtObj;
if(!a){
return false
}
if(t.target==a._childDiv){
return
}
var i=DwtControl.getTargetControl(t);
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t,i);
if(e.button==DwtMouseEvent.LEFT||e.button==DwtMouseEvent.NONE){
e.dwtObj._tree._itemDblClicked(e.dwtObj,e)
}};
DwtTreeItem._contextListener=function(t){
if(AjxEnv.isSafari){
var a=DwtControl.getTargetControl(t);
var e=a?a.preventContextMenu():true;
if(e){
a.notifyListeners(DwtEvent.ONMOUSEDOWN,t);
return a.notifyListeners(DwtEvent.ONMOUSEUP,t)
}}};
DwtTreeItem.prototype._emulateSingleClick=function(e){
var t=new DwtMouseEvent();
this._setMouseEvent(t,e);
t.kbNavEvent=e.kbNavEvent;
this.notifyListeners(DwtEvent.ONMOUSEUP,t)
};
DwtTreeItem.prototype.getTooltipBase=function(e){
return this._itemDiv
};
DwtTreeItem._listeners={};
DwtTreeItem._listeners[DwtEvent.ONMOUSEDOWN]=new AjxListener(null,DwtTreeItem._mouseDownListener);
DwtTreeItem._listeners[DwtEvent.ONMOUSEOUT]=new AjxListener(null,DwtTreeItem._mouseOutListener);
DwtTreeItem._listeners[DwtEvent.ONMOUSELEAVE]=new AjxListener(null,DwtTreeItem._mouseOutListener);
DwtTreeItem._listeners[DwtEvent.ONMOUSEENTER]=new AjxListener(null,DwtTreeItem._mouseOverListener);
DwtTreeItem._listeners[DwtEvent.ONMOUSEOVER]=new AjxListener(null,DwtTreeItem._mouseOverListener);
DwtTreeItem._listeners[DwtEvent.ONMOUSEUP]=new AjxListener(null,DwtTreeItem._mouseUpListener);
DwtTreeItem._listeners[DwtEvent.ONDBLCLICK]=new AjxListener(null,DwtTreeItem._doubleClickListener);
DwtTreeItem._listeners[DwtEvent.ONCONTEXTMENU]=new AjxListener(null,DwtTreeItem._contextListener);
DwtTreeItemSeparator=function(e){
this.parent=e;
this._isSeparator=true;
this._initialized=true
};
DwtTreeItemSeparator.prototype.dispose=function(){
DwtComposite.prototype.removeChild.call(this.parent,this)
};
DwtTreeItemSeparator.prototype.isInitialized=function(){
return this._initialized
};
DwtTreeItemSeparator.prototype.getHtmlElement=function(){
return this.div
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtHeaderTreeItem")){
DwtHeaderTreeItem=function(e){
this.overview=e.overview;
this._optButton=e.optButton;
this._noNodeCell=e.noNodeCell;
DwtTreeItem.call(this,e);
this._arrowDisabled=true
};
DwtHeaderTreeItem.prototype=new DwtTreeItem;
DwtHeaderTreeItem.prototype.constructor=DwtHeaderTreeItem;
DwtHeaderTreeItem.prototype.TEMPLATE="dwt.Widgets#ZHeaderTreeItem";
DwtHeaderTreeItem.prototype.toString=function(){
return"DwtHeaderTreeItem"
};
DwtHeaderTreeItem.prototype._createHtmlFromTemplate=function(e,t){
t.noNodeCell=this._noNodeCell;
DwtTreeItem.prototype._createHtmlFromTemplate.apply(this,arguments)
};
DwtHeaderTreeItem.prototype._initialize=function(){
DwtTreeItem.prototype._initialize.apply(this,arguments);
var e=this._tree.getHtmlElement();
e.setAttribute("aria-labelledby",this._textCell.id);
if(this._optButton){
this._optButtonId=this._htmlElId+"_optButton";
var t=document.getElementById(this._optButtonId);
if(t){
this._optButtonItem=new DwtBorderlessButton({
parent:this,style:DwtLabel.IMAGE_LEFT}
);
this._optButtonItem.setToolTipContent(this._optButton.tooltip);
this._optButtonItem.callback=this._optButton.callback;
this._optButtonItem.addSelectionListener(new AjxListener(this,this._onclickHandler));
this._optButtonItem.replaceElement(this._optButtonId);
this._optButtonItem.setImage("ContextMenu");
this._optButtonItem.setIconEl(this._optButtonItem.getHtmlElement())
}}};
DwtHeaderTreeItem.prototype._onclickHandler=function(e){
this._tree._itemActioned(this,e)
};
DwtHeaderTreeItem.prototype._focusByMouseUpEvent=function(t){
var e=t.target&&t.target.id;
if(e&&(e==this._headerButtonId)){
return
}
DwtTreeItem.prototype._focusByMouseUpEvent.apply(this,arguments)
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtTree")){
DwtTree=function(a){
if(arguments.length==0){
return
}
a=Dwt.getParams(arguments,DwtTree.PARAMS);
a.className=a.className||"DwtTree";
DwtComposite.call(this,a);
var e=[DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEUP,DwtEvent.ONDBLCLICK];
if(!AjxEnv.isIE){
e=e.concat([DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEOUT])
}
this._setEventHdlrs(e);
var t=a.style;
if(!t){
this._style=DwtTree.SINGLE_STYLE
}else{
if(t==DwtTree.CHECKEDITEM_STYLE){
t|=DwtTree.SINGLE_STYLE
}
this._style=t
}
this.isCheckedStyle=((this._style&DwtTree.CHECKEDITEM_STYLE)!=0);
this.isCheckedByDefault=a.isCheckedByDefault;
this._selectedItems=new AjxVector();
this._selEv=new DwtSelectionEvent(true);
this._selByClickEv=new DwtSelectionEvent(true);
this._selByClickEv.clicked=true;
this._selByEnterEv=new DwtSelectionEvent(true);
this._selByEnterEv.enter=true
};
DwtTree.PARAMS=["parent","style","className","posStyle"];
DwtTree.prototype=new DwtComposite;
DwtTree.prototype.constructor=DwtTree;
DwtTree.prototype.role="tree";
DwtTree.prototype.toString=function(){
return"DwtTree"
};
DwtTree.SINGLE_STYLE=1;
DwtTree.MULTI_STYLE=2;
DwtTree.CHECKEDITEM_STYLE=4;
DwtTree.ITEM_SELECTED=0;
DwtTree.ITEM_DESELECTED=1;
DwtTree.ITEM_CHECKED=2;
DwtTree.ITEM_ACTIONED=3;
DwtTree.ITEM_DBL_CLICKED=4;
DwtTree.ITEM_EXPANDED=1;
DwtTree.ITEM_COLLAPSED=2;
DwtTree.prototype.getStyle=function(){
return this._style
};
DwtTree.prototype.getNestingLevel=function(){
return 0
};
DwtTree.prototype.addSelectionListener=function(e){
this.addListener(DwtEvent.SELECTION,e)
};
DwtTree.prototype.removeSelectionListener=function(e){
this.removeListener(DwtEvent.SELECTION,e)
};
DwtTree.prototype.addTreeListener=function(e){
this.addListener(DwtEvent.TREE,e)
};
DwtTree.prototype.removeTreeListener=function(e){
this.removeListener(DwtEvent.TREE,e)
};
DwtTree.prototype.getItemCount=function(){
return this.getItems().length
};
DwtTree.prototype.getItems=function(){
return this._children.getArray()
};
DwtTree.prototype.clearItems=function(){
var e=this.getItems();
for(var t=0;
t<e.length;
t++){
this.removeChild(e[t])
}
this._getContainerElement().innerHTML=""
};
DwtTree.prototype.deselectAll=function(){
var e=this._selectedItems.getArray();
var o=this._selectedItems.size();
for(var t=0;
t<o;
t++){
if(e[t]){
e[t]._setSelected(false)
}}
if(o>0){
this._notifyListeners(DwtEvent.SELECTION,this._selectedItems.getArray(),DwtTree.ITEM_DESELECTED,null,this._selEv)
}
this._selectedItems.removeAll()
};
DwtTree.prototype.getSelection=function(){
return this._selectedItems.getArray()
};
DwtTree.prototype.setEnterSelection=function(t,e){
if(!t){
return
}
this._notifyListeners(DwtEvent.SELECTION,[t],DwtTree.ITEM_SELECTED,null,this._selByEnterEv,e)
};
DwtTree.prototype.setSelection=function(n,r,c,e){
if(!n){
return
}
var l=this._selectedItems.getArray();
var h=this._selectedItems.size();
var d;
var t=0;
var s=false;
for(var o=0;
o<h;
o++){
if(l[o]==n){
s=true
}else{
l[o]._setSelected(false);
this._selectedItems.remove(l[o]);
if(d==null){
d=new Array()
}
d[t++]=l[o]
}}
if(d&&!r){
this._notifyListeners(DwtEvent.SELECTION,d,DwtTree.ITEM_DESELECTED,null,this._selEv,c)
}
if(s){
return
}
this._selectedItems.add(n);
this._expandUp(n);
if(n._setSelected(true,e)&&!r){
this._notifyListeners(DwtEvent.SELECTION,[n],DwtTree.ITEM_SELECTED,null,this._selEv,c)
}};
DwtTree.prototype.getSelectionCount=function(){
return this._selectedItems.size()
};
DwtTree.prototype.addChild=function(e){
if(e instanceof DwtTreeItem){
return
}
DwtComposite.prototype.addChild.apply(this,arguments)
};
DwtTree.prototype.addSeparator=function(){
var e=document.createElement("div");
e.className="vSpace";
this._getContainerElement().appendChild(e)
};
DwtTree.prototype._expandUp=function(t){
var e=t.parent;
while(e instanceof DwtTreeItem){
e.setExpanded(true);
e.setVisible(true);
e=e.parent
}};
DwtTree.prototype._addItem=function(t,e){
this._children.add(t,e);
var i=this._getContainerElement();
var a=i.childNodes.length;
if(e==null||e>a){
i.appendChild(t.getHtmlElement())
}else{
i.insertBefore(t.getHtmlElement(),i.childNodes[e])
}};
DwtTree.prototype._getContainerElement=DwtTree.prototype.getHtmlElement;
DwtTree.prototype.sort=function(a){
var t=this.getItems();
t.sort(a);
var e=document.createDocumentFragment();
AjxUtil.foreach(t,function(n,o){
e.appendChild(n.getHtmlElement());
n._index=o
}
);
this._getContainerElement().appendChild(e)
};
DwtTree.prototype.removeChild=function(t){
this._children.remove(t);
this._selectedItems.remove(t);
var e=t.getHtmlElement();
if(e.parentNode){
e.parentNode.removeChild(e)
}};
DwtTree.prototype._getNextTreeItem=function(n){
var a=this.getSelection();
var l=(a&&a.length)?a[0]:null;
var e=null,h=-1;
var r=this.getTreeItemList(true);
if(l){
for(var o=0,s=r.length;
o<s;
o++){
var t=r[o];
if(t==l){
h=n?o+1:o-1;
break
}}
e=r[h]
}else{
if(r&&r.length){
e=n?r[0]:r[r.length-1]
}}
return e
};
DwtTree.prototype._getFirstTreeItem=function(){
var e=this.getTreeItemList(true);
if(e&&e.length>0){
return e[0]
}
return null
};
DwtTree.prototype._getLastTreeItem=function(){
var e=this.getTreeItemList(true);
if(e&&e.length>0){
return e[e.length-1]
}
return null
};
DwtTree.prototype.getTreeItemList=function(e){
return this._addToList([],e)
};
DwtTree.prototype._addToList=function(n,s,o){
if(o&&!o._isSeparator&&(!s||(o.getVisible()&&o._selectionEnabled))){
n.push(o)
}
if(!o||!s||o._expanded){
var a=o||this;
var t=a.getChildren?a.getChildren():[];
for(var e=0;
e<t.length;
e++){
this._addToList(n,s,t[e])
}}
return n
};
DwtTree.prototype._deselect=function(e){
if(this._selectedItems.contains(e)){
this._selectedItems.remove(e);
e._setSelected(false);
this._notifyListeners(DwtEvent.SELECTION,[e],DwtTree.ITEM_DESELECTED,null,this._selEv)
}};
DwtTree.prototype._itemActioned=function(t,e){
if(this._actionedItem&&!this._actionedItem.isDisposed()){
this._actionedItem._setActioned(false);
this._notifyListeners(DwtEvent.SELECTION,[this._actionedItem],DwtTree.ITEM_DESELECTED,e,this._selEv)
}
this._actionedItem=t;
t._setActioned(true);
this._notifyListeners(DwtEvent.SELECTION,[t],DwtTree.ITEM_ACTIONED,e,this._selEv)
};
DwtTree.prototype._itemChecked=function(t,e){
this._notifyListeners(DwtEvent.SELECTION,[t],DwtTree.ITEM_CHECKED,e,this._selEv)
};
DwtTree.prototype._itemClicked=function(n,o){
var t;
var e=this._selectedItems.getArray();
var s=this._selectedItems.size();
if(this._style&DwtTree.SINGLE_STYLE||(!o.shiftKey&&!o.ctrlKey)){
if(s>0){
for(t=0;
t<s;
t++){
e[t]._setSelected(false)
}
this._notifyListeners(DwtEvent.SELECTION,this._selectedItems.getArray(),DwtTree.ITEM_DESELECTED,o,this._selByClickEv);
this._selectedItems.removeAll()
}
this._selectedItems.add(n);
if(n._setSelected(true)){
this._notifyListeners(DwtEvent.SELECTION,[n],DwtTree.ITEM_SELECTED,o,this._selByClickEv)
}}else{
if(o.ctrlKey){
if(this._selectedItems.contains(n)){
this._selectedItems.remove(n);
n._setSelected(false);
this._notifyListeners(DwtEvent.SELECTION,[n],DwtTree.ITEM_DESELECTED,o,this._selByClickEv)
}else{
this._selectedItems.add(n);
if(n._setSelected(true)){
this._notifyListeners(DwtEvent.SELECTION,[n],DwtTree.ITEM_SELECTED,o,this._selByClickEv)
}}}else{}}};
DwtTree.prototype._itemDblClicked=function(t,e){
this._notifyListeners(DwtEvent.SELECTION,[t],DwtTree.ITEM_DBL_CLICKED,e,this._selEv)
};
DwtTree.prototype._itemExpanded=function(a,t,e){
if(!e){
this._notifyListeners(DwtEvent.TREE,[a],DwtTree.ITEM_EXPANDED,t,DwtShell.treeEvent)
}};
DwtTree.prototype._itemCollapsed=function(l,s,n){
var o;
if(!n){
this._notifyListeners(DwtEvent.TREE,[l],DwtTree.ITEM_COLLAPSED,s,DwtShell.treeEvent)
}
var h=false;
var r=this._selectedItems.getArray();
var e=this._selectedItems.size();
var c;
var t=0;
for(o=0;
o<e;
o++){
if(r[o]._isChildOf(l)){
h=true;
if(c==null){
c=new Array()
}
c[t++]=r[o];
r[o]._setSelected(false);
this._selectedItems.remove(r[o])
}}
if(c){
this._notifyListeners(DwtEvent.SELECTION,c,DwtTree.ITEM_DESELECTED,s,this._selEv)
}
if(h&&!this._selectedItems.contains(l)){
if(l._setSelected(true)){
this._selectedItems.add(l);
this._notifyListeners(DwtEvent.SELECTION,[l],DwtTree.ITEM_SELECTED,s,this._selEv)
}}};
DwtTree.prototype._notifyListeners=function(n,e,i,a,t,o){
if(this.isListenerRegistered(n)){
if(a){
DwtUiEvent.copy(t,a)
}
t.items=e;
if(e.length==1){
t.item=e[0]
}
t.detail=i;
t.kbNavEvent=o;
this.notifyListeners(n,t);
if(n==DwtEvent.SELECTION){
this.shell.notifyGlobalSelection(t)
}}}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtText")){
DwtText=function(e){
if(arguments.length==0){
return
}
e=Dwt.getParams(arguments,DwtText.PARAMS);
e.className=e.className||"DwtText";
DwtControl.call(this,e);
this.noTab=true
};
DwtText.PARAMS=["parent","className","posStyle"];
DwtText.prototype=new DwtControl;
DwtText.prototype.constructor=DwtText;
DwtText.prototype.isFocusable=true;
DwtText.prototype.toString=function(){
return"DwtText"
};
DwtText.prototype.getTabGroupMember=function(){
return null
};
DwtText.prototype.setText=function(a){
this.noTab=!a;
if(!this._textNode){
this._textNode=document.createTextNode(a);
this.getHtmlElement().appendChild(this._textNode)
}else{
try{
this._textNode.data=a
}
catch(t){}}};
DwtText.prototype.getText=function(){
return this._textNode?this._textNode.data:""
};
DwtText.prototype.getTextNode=function(){
return this._textNode
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtIframe")){
DwtIframe=function(i){
i.posStyle=i.posStyle||DwtControl.STATIC_STYLE;
i.className=i.className||"DwtIframe";
DwtControl.call(this,i);
this._styles=i.styles;
this._noscroll=i.noscroll;
this._iframeID=i.id?DwtId.getIframeId(i.id):Dwt.getNextId();
this._onLoadHandler=i.onload;
this._processHtmlCallback=i.processHtmlCallback;
this._hidden=i.hidden;
this._title=i.title;
if(!this._createFrame(i.html)){
this.initFailed=true;
return
}
if(i.useKbMgmt){
var t=this.getIframe();
var e=Dwt.getIframeDoc(t);
var a=AjxEnv.isIE?e:t.contentWindow;
Dwt.setHandler(a,DwtEvent.ONKEYDOWN,DwtKeyboardMgr.__keyDownHdlr);
Dwt.setHandler(a,DwtEvent.ONKEYUP,DwtKeyboardMgr.__keyUpHdlr);
Dwt.setHandler(a,DwtEvent.ONKEYPRESS,DwtKeyboardMgr.__keyPressHdlr)
}};
DwtIframe.prototype=new DwtControl;
DwtIframe.prototype.constructor=DwtIframe;
DwtIframe.prototype.isDwtIframe=true;
DwtIframe.prototype.toString=function(){
return"DwtIframe"
};
DwtIframe.prototype.getIframe=function(){
return document.getElementById(this._iframeID)
};
DwtIframe.prototype.getInputElement=function(){
return this.getIframe()
};
DwtIframe.prototype.getDocument=function(){
return this.getIframe().contentWindow.document
};
DwtIframe.prototype._rawEventHandler=function(s){
var a=this.getIframe();
var i=a.contentWindow;
if(AjxEnv.isIE){
s=i.event
}
var e;
if(/mouse|context|click|select/i.test(s.type)){
e=new DwtMouseEvent(true)
}else{
e=new DwtUiEvent(true)
}
e.setFromDhtmlEvent(s);
if(s.type=="mousedown"||s.type=="mousewheel"){
DwtOutsideMouseEventMgr.forwardEvent(s)
}
var o=e.type.toLowerCase();
if(!/^on/.test(o)){
o="on"+o
}
var n=this.getLocation();
if(!AjxEnv.isIE){
var r=i.document;
var t=r.documentElement.scrollLeft||(r.body?r.body.scrollLeft:0);
var c=r.documentElement.scrollTop||(r.body?r.body.scrollTop:0);
n.x-=t;
n.y-=c
}
e.docX+=n.x;
e.docY+=n.y;
e.elementX+=n.x;
e.elementY+=n.y;
var l=DwtMouseEventCapture.getCaptureObj();
l=l&&e.button!=DwtMouseEvent.RIGHT;
if(AjxEnv.isIE||!l){
DwtEventManager.notifyListeners(o,e);
this.parent.notifyListeners(o,e)
}else{
var h=document.createEvent("MouseEvents");
h.initMouseEvent(s.type,true,true,document.defaultView,0,s.screenX,s.screenY,e.docX,e.docY,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.button,s.relatedTarget);
document.body.dispatchEvent(h)
}
e.setToDhtmlEvent(s);
return e._returnValue
};
DwtIframe._forwardEvents=[DwtEvent.ONCHANGE,DwtEvent.ONCLICK,DwtEvent.ONCONTEXTMENU,DwtEvent.ONDBLCLICK,DwtEvent.ONFOCUS,DwtEvent.ONKEYDOWN,DwtEvent.ONKEYPRESS,DwtEvent.ONKEYUP,DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEENTER,DwtEvent.ONMOUSELEAVE,DwtEvent.ONMOUSEMOVE,DwtEvent.ONMOUSEOUT,DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEUP,DwtEvent.ONSELECTSTART];
DwtIframe.prototype._createFrame=function(t){
var e=this.getHTMLElId();
function a(n){
var o=document.getElementById(e);
var i=DwtControl.findControl(o);
return i._rawEventHandler(n)
}
return(function(){
var c,l=[],h=0,o;
var s=document.getElementById(e);
var n=DwtControl.findControl(s);
if(!n){
return false
}
l[h++]="<iframe";
if(n._noscroll){
l[h++]=" scrolling='no'"
}
if(n._hidden){
l[h++]=" style='visibility:hidden'"
}
if(n._title){
l[h++]=" title='"+AjxStringUtil.encodeQuotes(AjxStringUtil.htmlEncode(n._title))+"'"
}
l[h++]=" frameborder='0' width='100%' id='";
l[h++]=n._iframeID;
l[h++]="' name='"+n._iframeID+"'";
if(n._onLoadHandler){
l[h++]=" onload='"+n._onLoadHandler+"'"
}
l[h++]=" src='javascript:\"\";' ></iframe>";
n.setContent(l.join(""));
t=t.replace(/(<style[^>]*>)[\s\t\u00A0]*((.|\n)*?)[\s\t\u00A0]*<\x2fstyle>/mgi,function(i,m,u){
return m+u.replace(/@import.*?(;|[\s\t\u00A0]*$)/gi,"")+"</style>"
}
);
t=AjxStringUtil.checkForCleanHtml(t,ZmMailMsgView.TRUSTED_TAGS,ZmMailMsgView.UNTRUSTED_ATTRS).html;
c=n.getIframe();
o=Dwt.getIframeDoc(c);
o.open();
if(n._styles){
o.write(["<style type='text/css'>",n._styles,"</style>"].join(""))
}
o.write(t);
o.close();
if(n._processHtmlCallback){
n._processHtmlCallback.run(o)
}
l=o.documentElement.style;
l.margin=l.padding="0";
if(o.body){
o.body.style.margin="0"
}
var d=o.firstChild&&o.firstChild.tagName&&o.firstChild.tagName.toLowerCase()==="html"?o.firstChild:null,r=d&&d.getAttribute("lang");
if(d&&!r){
d.setAttribute("lang",window.appLang)
}
l=DwtIframe._forwardEvents;
if(!AjxEnv.isIE){
o=c.contentWindow
}
for(h=l.length;
--h>=0;
){
o[l[h]]=a
}
return true
}
)()
};
DwtIframe.prototype._resetEventHandlers=function(){
var e=this;
function t(a){
return e._rawEventHandler(a)
}
(function(){
var s,n=[],o=0,a;
s=e.getIframe();
a=Dwt.getIframeDoc(s);
n=DwtIframe._forwardEvents;
if(!AjxEnv.isIE){
a=s.contentWindow
}
for(o=n.length;
--o>=0;
){
a[n[o]]=t
}}
)()
};
DwtIframe.prototype.setSrc=function(t){
t=t||'javascript:"";';
var e=this.getIframe();
e.src=t
};
DwtIframe.prototype.setIframeContent=function(e){
var t=this.getDocument();
if(t.body){
t.body.innerHTML=e
}}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtForm")){
DwtForm=function(e){
if(arguments.length==0){
return
}
e=Dwt.getParams(arguments,DwtForm.PARAMS);
e.className=e.className||"DwtForm";
DwtComposite.apply(this,arguments);
this.setScrollStyle(DwtControl.SCROLL);
this._tabGroup=new DwtTabGroup(this._htmlElId);
this._context={
set:AjxCallback.simpleClosure(this.set,this),get:AjxCallback.simpleClosure(this.get,this)};
this._dirty={};
this._ignore={};
this._invalid={};
this._errorMessages={};
this.setModel(e.model);
this.setForm(e.form);
this.reset()
};
DwtForm.prototype=new DwtComposite;
DwtForm.prototype.constructor=DwtForm;
DwtForm.prototype.toString=function(){
return"DwtForm"
};
DwtForm.PARAMS=DwtControl.PARAMS.concat("form","model");
DwtForm.prototype.setValue=function(n,a,t){
if(typeof n!="string"){
n=String(n)
}
if(n.match(/\./)||n.match(/\[/)){
var o=n.replace(/\[(\d+)\](\.)?/,".$1$2").split(".");
var i=this.getControl(o[0]);
if(Dwt.instanceOf(i,"DwtForm")){
i.setValue(o.slice(1).join("."),a,t)
}
return
}
var e=this._items[n];
if(!e){
return
}
if(!t&&a==e.value){
return
}
this._setModelValue(n,a);
this._setControlValue(n,a)
};
DwtForm.prototype.getValue=function(n,e){
if(typeof n!=="string"){
n=String(n)
}
if(n.match(/\./)||n.match(/\[/)){
var o=n.replace(/\[(\d+)\](\.)?/,".$1$2").split(".");
var i=this.getControl(o[0]);
if(Dwt.instanceOf(i,"DwtForm")){
return i.getValue(o.slice(1).join("."))
}
return null
}
var t=this._items[n];
if(!t){
return
}
if(t.getter){
return this._call(t.getter)||e
}
var a=this._getControlValue(n);
if(a==null){
a=t.value
}
return a||e||""
};
DwtForm.prototype.getControl=function(t){
if(typeof t!="string"){
t=String(t)
}
var e=this._items[t];
return e&&e.control
};
DwtForm.prototype.isRelevant=function(e){
return this.isVisible(e)&&this.isEnabled(e)
};
DwtForm.prototype.getTabGroupMember=function(){
return this._tabGroup
};
DwtForm.prototype.setLabel=function(i,e){
var t=this._items[i];
if(!t){
return
}
if(e==this.getLabel(i)){
return
}
var a=t.control;
if(!a){
return
}
if(a.setLabel){
a.setLabel(e);
return
}
if(a.setText){
a.setText(e);
return
}};
DwtForm.prototype.setImage=function(i,a){
var e=this._items[i];
if(!e){
return
}
var t=e.control;
if(!t){
return
}
t.setImage(a)
};
DwtForm.prototype.getLabel=function(a){
var e=this._items[a];
var t=e&&e.control;
if(t){
if(t.getLabel){
return t.getLabel()
}
if(t.getText){
return t.getText()
}}
return""
};
DwtForm.prototype.setVisible=function(o,i){
if(arguments.length==1){
DwtComposite.prototype.setVisible.call(this,arguments[0]);
return
}
var t=this._items[o];
var a=t&&t.control;
if(!a){
return
}
if(a.setVisible){
a.setVisible(i)
}else{
Dwt.setVisible(a,i)
}
var e=document.getElementById([this._htmlElId,o,"row"].join("_"));
if(e){
Dwt.setVisible(e,i)
}};
DwtForm.prototype.isVisible=function(a){
if(arguments.length==0){
return DwtComposite.prototype.isVisible.call(this)
}
var e=this._items[a];
var t=e&&e.control;
if(!t){
return false
}
if(t.getVisible){
return t.getVisible()
}
if(t.isVisible){
return t.isVisible()
}
return Dwt.getVisible(t)
};
DwtForm.prototype.setEnabled=function(i,e){
if(arguments.length==1){
DwtComposite.prototype.setEnabled.call(this,arguments[0]);
return
}
var t=this._items[i];
var a=t&&t.control;
if(!a){
return
}
if(a.setEnabled){
a.setEnabled(e)
}else{
a.disabled=!e
}};
DwtForm.prototype.isEnabled=function(a){
if(arguments.length==0){
return DwtComposite.prototype.isEnabled.call(this)
}
var e=this._items[a];
var t=e&&e.control;
if(!t){
return false
}
if(t.isEnabled){
return t.isEnabled()
}
if(t.getEnabled){
return t.getEnabled()
}
return !t.disabled
};
DwtForm.prototype.setValid=function(t,e){
if(typeof(t)=="boolean"){
e=arguments[0];
for(t in this._items){
this.setValid(t,e)
}
return
}
if(e){
delete this._invalid[t]
}else{
this._invalid[t]=true
}};
DwtForm.prototype.isValid=function(e){
if(arguments.length==0||AjxUtil.isUndefined(e)){
for(var e in this._invalid){
return false
}
return true
}
return !(e in this._invalid)
};
DwtForm.prototype.setErrorMessage=function(t,e){
if(!t||t==""){
this._errorMessages={};
return
}
if(!e){
delete this._errorMessages[t]
}else{
this._errorMessages[t]=e
}};
DwtForm.prototype.getErrorMessage=function(t){
if(arguments.length==0){
var e={};
for(var t in this._invalid){
e[t]=this._errorMessages[t]
}
return e
}
return this._errorMessages[t]
};
DwtForm.prototype.getInvalidItems=function(){
return AjxUtil.keys(this._invalid)
};
DwtForm.prototype.setDirty=function(i,t,e){
if(typeof i=="boolean"){
t=arguments[0];
for(i in this._items){
this.setDirty(i,t,true)
}
if(!e&&this._ondirty){
this._call(this._ondirty,["*"])
}
return
}
if(t){
this._dirty[i]=true
}else{
delete this._dirty[i]
}
if(!e&&this._ondirty){
var a=this._items[i];
if(!a.ignore||!this._call(a.ignore)){
this._call(this._ondirty,[i])
}}};
DwtForm.prototype.isDirty=function(t){
if(arguments.length==0){
for(var t in this._dirty){
var e=this._items[t];
if(e.ignore&&this._call(e.ignore)){
continue
}
return true
}
return false
}
var e=this._items[t];
return e.ignore&&this._call(e.ignore)?false:t in this._dirty
};
DwtForm.prototype.getDirtyItems=function(){
DwtForm.__acceptDirtyItem.form=this;
return AjxUtil.keys(this._dirty,DwtForm.__acceptDirtyItem)
};
DwtForm.__acceptDirtyItem=function(a){
var t=arguments.callee.form;
var e=t._items[a];
return !e.ignore||!t._call(e.ignore)
};
DwtForm.prototype.setIgnore=function(t,e){
if(typeof t=="boolean"){
this._ignore={};
return
}
if(e){
this._ignore[t]=true;
return
}
delete this._ignore[t]
};
DwtForm.prototype.isIgnore=function(e){
return e in this._ignore
};
DwtForm.prototype.set=function(t,e){
this.setValue(t,e,true);
this.update()
};
DwtForm.prototype.get=DwtForm.prototype.getValue;
DwtForm.prototype.setModel=function(e,t){
this._context.model=this.model=e
};
DwtForm.prototype.setForm=function(e){
this._context.form=this.form=e;
this._createHtml(e.template)
};
DwtForm.prototype.validate=function(e){
if(arguments.length==0){
this.setValid(true);
for(var e in this._items){
this._validateItem(e)
}
return this.isValid()
}
return this._validateItem(e)
};
DwtForm.prototype._validateItem=function(s){
if(!s){
return true
}
var i=this._items[s];
if(!i){
return true
}
try{
var o=this.getValue(s);
var a=i.validator?i.validator(o):((i.control&&i.control.validator)?i.control.validator(o):true);
this.setValid(s,Boolean(a)||a==="");
if(AjxUtil.isString(a)||AjxUtil.isObject(a)){
this._setControlValue(s,a);
i.value=i.setter?this._call(i.setter,[a]):a;
var t=!Boolean(this._call(i.equals,[i.value,i.ovalue]));
this.setDirty(s,t)
}}
catch(n){
this.setErrorMessage(s,AjxUtil.isString(n)?n:n.message);
this.setValid(s,false)
}
return !(s in this._invalid)
};
DwtForm.prototype.reset=function(i){
this._dirty={};
this._ignore={};
this._invalid={};
for(var a in this._items){
var t=this._items[a];
if(t.control instanceof DwtForm){
t.control.reset(i)
}
var e=this._items[a].def;
if(!e){
continue
}
this._initControl(e,i)
}
this.update();
for(var a in this._items){
var t=this._items[a];
t.ovalue=t.value
}
this.validate();
this.setDirty(false);
if(this._onreset){
this._call(this._onreset)
}};
DwtForm.prototype.update=function(){
for(var t in this._items){
var e=this._items[t];
if(e.control instanceof DwtForm){
e.control.update()
}
if(e.getter){
this.setValue(t,this._call(e.getter))
}}
for(var t in this._items){
var e=this._items[t];
if(e.visible){
this.setVisible(t,Boolean(this._call(e.visible)))
}
if(e.enabled){
this.setEnabled(t,Boolean(this._call(e.enabled)))
}
if(e.ignore){
this.setIgnore(t,Boolean(this._call(e.ignore)))
}}
if(this._onupdate){
this._call(this._onupdate)
}};
DwtForm.prototype._setModelValue=function(i,a){
var t=this._items[i];
t.value=t.setter?this._call(t.setter,[a]):a;
var e=!Boolean(this._call(t.equals,[t.value,t.ovalue]));
this.setDirty(i,e);
this.validate(i);
return e
};
DwtForm.prototype._setControlValue=function(a,e){
var t=this._items[a].control;
if(t){
if(t instanceof DwtCheckbox||t instanceof DwtRadioButton){
t.setSelected(e);
return
}
if(t instanceof DwtMenuItem&&t.isStyle(DwtMenuItem.CHECK_STYLE)){
t.setChecked(e,true);
return
}
if(t.setSelectedValue){
t.setSelectedValue(e);
return
}
if(t.setValue){
t.setValue(e);
return
}
if(t.setText&&!(t instanceof DwtButton)){
t.setText(e);
return
}
if(!(t instanceof DwtControl)){
if(t.type=="checkbox"||t=="radio"){
t.checked=e
}else{
t.value=e
}
return
}}};
DwtForm.prototype._getControlValue=function(t){
var e=this._items[t].control;
if(e){
if(e instanceof DwtCheckbox||e instanceof DwtRadioButton){
return e.isSelected()
}
if(e.getSelectedValue){
return e.getSelectedValue()
}
if(e.getValue){
return e.getValue()
}
if(e.getText&&!(e instanceof DwtButton)){
return e.getText()
}
if(!(e instanceof DwtControl)){
if(e.type=="checkbox"||e=="radio"){
return e.checked
}
return e.value
}}};
DwtForm.prototype._deleteItem=function(e){
delete this._items[e];
delete this._dirty[e];
delete this._invalid[e];
delete this._ignore[e]
};
DwtForm.prototype._call=function(t,e){
if(t){
if(e){
return t.apply(this,e)
}
return t.call(this)
}};
DwtForm.prototype._createHtml=function(e){
this._createHtmlFromTemplate(e||this.TEMPLATE,{
id:this._htmlElId}
)
};
DwtForm.prototype._createHtmlFromTemplate=function(t,s){
DwtComposite.prototype._createHtmlFromTemplate.apply(this,arguments);
var a=[];
this._items={};
this._tabGroup.removeAllMembers();
this._onupdate=null;
this._onreset=null;
this._ondirty=null;
var e=this.form;
if(e&&e.items){
this._registerControls(e.items,null,a);
this._onupdate=DwtForm.__makeFunc(e.onupdate);
this._onreset=DwtForm.__makeFunc(e.onreset);
this._ondirty=DwtForm.__makeFunc(e.ondirty)
}
var l=this.getHtmlElement().getElementsByTagName("A");
for(var r=0;
r<l.length;
r++){
var h=l[r];
if(!h.href||h.getAttribute("notab")=="true"){
continue
}
var c=h.id&&h.id.substr(this.getHTMLElId().length+1);
if(this._items[c]){
continue
}
a.push({
tabindex:h.getAttribute("tabindex")||Number.MAX_VALUE,control:h}
)
}
a.sort(DwtForm.__byTabIndex);
for(var r=0;
r<a.length;
r++){
var n=a[r].control;
var o=(n.getTabGroupMember&&n.getTabGroupMember())||n;
this._tabGroup.addMember(o)
}};
DwtForm.prototype._registerControls=function(a,n,e,s,o,r){
for(var t=0;
t<a.length;
t++){
this._registerControl(a[t],n,e,s,o,r)
}};
DwtForm.prototype._registerControl=function(l,s,w,y,c,n){
var f=l.id||[this._htmlElId,Dwt.getNextId()].join("_");
var g=this._items[f]={
id:f,def:l,parentDef:s,equals:DwtForm.__makeFunc(l.equals)||DwtForm.__equals,getter:DwtForm.__makeGetter(l),setter:DwtForm.__makeSetter(l),value:l.value,visible:DwtForm.__makeFunc(l.visible),enabled:DwtForm.__makeFunc(l.enabled),validator:DwtForm.__makeFunc(l.validator),ignore:DwtForm.__makeFunc(l.ignore),control:l.control};
if(l.aka){
this._items[f].aka=l.aka;
this._items[l.aka]=g
}
var d=g.control;
if(d){
return d
}
c=c||this;
var o=l.type=l.type||n;
var t=(s&&s.menu==l);
var a=document.getElementById([c._htmlElId,f].join("_"));
if(Dwt.instanceOf(o,"DwtRadioButtonGroup")){
d=new window[o]({}
);
g.control=d;
var r={
name:[c._htmlElId,f].join("_"),value:l.value};
if(l.items){
for(var p=0;
p<l.items.length;
p++){
var m=l.items[p];
var h=m.checked||m.value==l.value;
var u=this._registerControl(m,l,w,r,c,"DwtRadioButton");
this._items[m.id].value=h;
if(u){
d.addRadio(u.getInputElement().id,u,h);
var e=DwtForm.__makeFunc(m.onclick||l.onclick);
u.addSelectionListener(new AjxListener(this,this._radio2group2model,[m.id,f,e]));
DwtForm.__hack_fixRadioButtonHandler(u)
}}}}else{
if(o){
if(Dwt.instanceOf(o,"DwtInputField")){
g.value=g.value||""
}
if(Dwt.instanceOf(o,"DwtFormRows")){
g.equals=DwtFormRows.__equals
}
if(a||t){
d=g.control=this._createControl(l,s,w,y,c,n)
}}else{
if(a){
this._attachElementHandlers(l,s,w,c,a);
d=g.control=a;
if(l.items){
this._registerControls(l.items,l,w,null,c,null)
}}}}
if(a&&d instanceof DwtControl){
d.replaceElement(a)
}
if(a&&d instanceof DwtInputField){
d.getInputElement().id+="_input";
d.setHandler(DwtEvent.ONPASTE,this._onPaste.bind(this,f))
}
if(l.notab==null){
l.notab=a&&a.getAttribute("notab")=="true"
}
if(w&&d&&!l.notab&&!(d instanceof DwtRadioButtonGroup)){
w.push({
tabindex:(a&&a.getAttribute("tabindex"))||Number.MAX_VALUE,control:d}
)
}
if(d instanceof DwtListView){
g.getter=g.getter||AjxCallback.simpleClosure(this.__list_getValue,this,f);
g.setter=g.setter||AjxCallback.simpleClosure(this.__list_setValue,this,f)
}
return d
};
DwtForm.prototype._onPaste=function(t,e){
AjxTimedAction.scheduleAction(new AjxTimedAction(this,this._applyPasteInput,[t]),100)
};
DwtForm.prototype._applyPasteInput=function(t,e){
this._setModelValue(t,this._getControlValue(t))
};
DwtForm.prototype._attachElementHandlers=function(s,a,i,l,n){
var t=s.id;
var e=n.nodeName.toLowerCase();
var h=n.type;
if(h=="checkbox"||h=="radio"){
var r;
if(h=="radio"){
r=n.name;
if(!this._items[r]){
this._items[r]={
id:r}
}
if(n.checked){
this._items[r].value=n.value
}}
var d=n.onclick;
var c=DwtForm.__makeFunc(s.onclick);
n.onclick=AjxCallback.simpleClosure(this._htmlInput_checked,this,t,r,c,d)
}else{
if(e=="select"){
var o=n.onchange;
var c=DwtForm.__makeFunc(s.onchange);
n.onchange=AjxCallback.simpleClosure(this._htmlSelect_selectedIndex,this,t,c,o)
}else{
if(e=="button"||e=="a"||h=="button"||h=="reset"||h=="submit"){
var d=n.onclick;
var c=DwtForm.__makeFunc(s.onclick);
n.onclick=AjxCallback.simpleClosure(this._htmlElement,this,t,c,d)
}else{
if(e=="textarea"||e=="input"){
var o=n.onchange;
var c=DwtForm.__makeFunc(s.onchange);
n.onchange=AjxCallback.simpleClosure(this._htmlInput_value,this,t,c,o)
}}}}
return n
};
DwtForm.prototype._createControl=function(m,c,M,F,g,l){
var j=m.id||[this._htmlElId,Dwt.getNextId()].join("_");
var n=m.type=m.type||l;
F=F?AjxUtil.createProxy(F):{};
F.id=F.id||[this._htmlElId,j].join("_");
F.parent=g||this;
F.template=m.template||F.template;
F.className=m.className||F.className;
var S=Dwt.instanceOf(n,"DwtRadioButton");
var q=Dwt.instanceOf(n,"DwtCheckbox");
if(S||q){
F.name=m.name||F.name;
F.value=m.value||F.value;
F.checked=m.checked!=null?m.checked:F.checked
}
var f=Dwt.instanceOf(n,"DwtInputField");
if(f){
F.type=m.password?DwtInputField.PASSWORD:null;
F.size=m.cols;
F.rows=m.rows
}
var r=Dwt.instanceOf(n,"DwtTabViewPage");
if(r){
F.contentTemplate=m.template;
delete m.template
}
var x=Dwt.instanceOf(n,"DwtTree");
if(x){
F.style=m.style
}
F.formItemDef=m;
if(m.params){
for(var z in m.params){
F[z]=m.params[z]
}}
var y=new window[n](F);
if(y instanceof DwtSelect){
var o=m.items;
if(o){
for(var B=0;
B<o.length;
B++){
var k=o[B];
k.displayValue=k.label||k.value;
y.addOption(k)
}}
var t=DwtForm.__makeFunc(m.onchange);
y.addChangeListener(new AjxListener(this,this._control2model,[j,t]))
}else{
if(y instanceof DwtButton||y instanceof DwtMenuItem){
if(m.label){
y.setText(m.label)
}
if(m.image){
y.setImage(m.image)
}
if(m.menu){
var a=Dwt.instanceOf(m.menu.type||"DwtMenu","DwtMenu");
var e;
if(a){
e=this._registerControl(m.menu,m,null,null,y,"DwtMenu")
}else{
e=new DwtMenu({
parent:y}
);
var C=Dwt.instanceOf(m.menu.type,"DwtCalendar")?DwtMenu.CALENDAR_PICKER_STYLE:DwtMenu.GENERIC_WIDGET_STYLE;
this._registerControl(m.menu,m,null,{
style:C}
,e)
}
y.setMenu(e)
}
var W;
if(g instanceof DwtToolBar||g instanceof DwtMenu){
W=c.id
}
var t=DwtForm.__makeFunc(m.onclick||(c&&c.onclick));
y.addSelectionListener(new AjxListener(this,this._item2parent,[j,W,t]))
}else{
if(y instanceof DwtCheckbox&&!(y instanceof DwtRadioButton)){
var t=DwtForm.__makeFunc(m.onclick);
y.addSelectionListener(new AjxListener(this,this._control2model,[j,t]))
}else{
if(y instanceof DwtInputField){
var T=DwtForm.__makeFunc(m.onchange);
var A=AjxCallback.simpleClosure(this._input2model2handler,this,j,T);
y.setHandler(DwtEvent.ONKEYUP,A);
if(AjxEnv.isFirefox){
var u=this._onkeydownhandler.bind(this,j,T);
y.setHandler(DwtEvent.ONKEYDOWN,u)
}
var D=DwtForm.__makeFunc(m.onblur);
if(D){
var s=AjxCallback.simpleClosure(this._input2model2handler,this,j,D);
y.setHandler(DwtEvent.ONBLUR,s)
}
y.setHint(m.hint)
}else{
if(y instanceof DwtListView){
y.addSelectionListener(new AjxListener(this,this._handleListSelection,[j]))
}else{
if(y instanceof DwtMenu){
if(m.items){
var O=m.items;
for(var B=0;
B<O.length;
B++){
var v=O[B];
if(v.type==DwtMenuItem.SEPARATOR_STYLE){
new DwtMenuItem({
parent:y,style:DwtMenuItem.SEPARATOR_STYLE}
);
continue
}
this._registerControl(v,m,null,null,y,"DwtMenuItem")
}}}else{
if(y instanceof DwtTabView){
var d=m.items;
if(d){
this._registerControls(d,m,null,null,y,"DwtTabViewPage")
}}else{
if(y instanceof DwtTabViewPage&&g instanceof DwtTabView){
var R=g.addTab(m.label,y);
if(m.image){
g.getTabButton(R).setImage(m.image)
}
if(m.items){
this._registerControls(m.items,m,M,null,y)
}}else{
if(y instanceof DwtToolBar){
var w=m.items;
if(w){
for(var B=0;
B<w.length;
B++){
var h=w[B];
if(h.type==DwtToolBar.SPACER){
y.addSpacer(h.size);
continue
}
if(h.type==DwtToolBar.SEPARATOR){
y.addSeparator(h.className);
continue
}
if(h.type==DwtToolBar.FILLER){
y.addFiller(h.className);
continue
}
this._registerControl(h,m,null,null,y,"DwtToolBarButton")
}}}else{
if(y instanceof DwtCalendar){
if(m.onselect instanceof AjxListener){
y.addSelectionListener(m.onselect)
}}else{
if(y instanceof DwtComposite){
if(m.items){
this._registerControls(m.items,m,M,null,y)
}}}}}}}}}}}}
if(m.width||m.height){
if(y instanceof DwtInputField){
Dwt.setSize(y.getInputElement(),m.width,m.height)
}else{
y.setSize(m.width,m.height)
}}
return y
};
DwtForm.prototype._onkeydownhandler=function(t,e){
setTimeout(this._input2model2handler.bind(this,t,e),500)
};
DwtForm.prototype._initControl=function(e,i){
var a=e.id;
if(e.label){
this.setLabel(a,e.label)
}
var t=this._items[a];
if(i){
t.ovalue=t.value
}else{
if(e.value){
if(Dwt.instanceOf(e.type,"DwtRadioButton")){
t.ovalue=t.value=t.control&&t.control.isSelected()
}else{
this.setValue(a,e.value,true);
t.ovalue=t.value
}}else{
t.ovalue=null
}}
if(typeof e.enabled=="boolean"){
this.setEnabled(a,e.enabled)
}
if(typeof e.visible=="boolean"){
this.setVisible(a,e.visible)
}};
DwtForm.prototype._htmlElement=function(i,a,t,e){
if(a){
this._call(a,[i])
}
if(t){
t(e)
}};
DwtForm.prototype._htmlInput_checked=function(s,n,a,t,e){
var o=this.getControl(s);
var i=o.checked;
this._setModelValue(s,i);
if(n&&i){
this._setModelValue(n,o.value)
}
this.update();
this._htmlElement(s,a,t,e)
};
DwtForm.prototype._htmlInput_value=function(i,a,t,e){
this._setModelValue(i,this.getControl(i).value);
this.update();
this._htmlElement(i,a,t,e)
};
DwtForm.prototype._htmlSelect_selectedIndex=function(o,i,a,t){
var e=this.getControl(o);
this._setModelValue(o,e.options[e.selectedIndex].value);
this.update();
this._htmlElement(o,i,a,t)
};
DwtForm.prototype._control2model=function(t,e){
this._setModelValue(t,this._getControlValue(t));
this.update();
if(e){
this._call(e,[t])
}};
DwtForm.prototype._radio2group2model=function(e,t,a){
this._setModelValue(t,this.getControl(e).getValue());
this._setModelValue(e,this._getControlValue(e));
this.update();
if(a){
this._call(a,[e])
}};
DwtForm.prototype._input2model2handler=function(t,e){
this._setModelValue(t,this._getControlValue(t));
this.update();
if(e){
this._call(e,[t])
}};
DwtForm.prototype._item2parent=function(i,o,t){
var a=this.getControl(i);
var e=this._items[i].def;
if(a instanceof DwtButtonColorPicker||(e.menu&&!e.onclick)){
a._toggleMenu()
}else{
if(o){
this._setModelValue(o,this._getControlValue(i)||i);
this.update()
}}
if(t){
this._call(t,[i])
}};
DwtForm.prototype._handleListSelection=function(t,e){
this.update()
};
DwtForm.prototype.__list_getValue=function(e){
return this.getControl(e).getSelection()
};
DwtForm.prototype.__list_setValue=function(t,e){
this.getControl(t).setSelection(e)
};
DwtForm.__makeGetter=function(s){
var t=s.getter;
if(t){
return DwtForm.__makeFunc(t)
}
var n=s.ref;
if(!n){
return null
}
var r=n.split(".");
var e=["var context = this.model;"];
for(var o=0;
o<r.length;
o++){
var a=r[o];
var h=DwtForm.__makeFuncName(a);
if(o==r.length-1){
break
}
e.push("context = context && (context.",h," ? context.",h,"() : context.",a,");")
}
e.push("var value = context ? (context.",h," ? context.",h,"() : context.",a,") : this._items.",a,".value;","return value !== undefined ? value : defaultValue;");
return new Function("defaultValue",e.join(""))
};
DwtForm.__makeSetter=function(l){
var o=l.setter;
if(o){
return DwtForm.__makeFunc(o)
}
var a=l.ref;
if(!a){
return null
}
var n=a.split(".");
var h=["var context = this.model;"];
for(var r=0;
r<n.length;
r++){
var s=r==n.length-1;
var e=n[r];
var t=DwtForm.__makeFuncName(e,s?"set":"get");
if(s){
break
}
h.push("context = context && (context.",t," ? context.",t,"() : context.",e,");")
}
h.push("if (context) {","if (context.",t,") {","context.",t,"(value);","}","else {","context.",e," = value;","}","}");
return new Function("value",h.join("\n"))
};
DwtForm.__makeFuncName=function(e,t){
return[t||"get",e.substr(0,1).toUpperCase(),e.substr(1)].join("")
};
DwtForm.__makeFunc=function(t){
if(t==null){
return null
}
if(typeof t=="function"&&!(t instanceof RegExp)){
return t
}
var e=["with (this._context) {","return (",t,");","}"].join("");
return new Function(e)
};
DwtForm.__equals=function(t,e){
return t==e
};
DwtForm.__byTabIndex=function(t,e){
return t.tabindex-e.tabindex
};
DwtForm.__hack_fixRadioButtonHandler=function(t){
var e=[t.getInputElement().onclick,DwtCheckbox.__handleClick];
var a=function(o){
for(var n=0;
n<e.length;
n++){
var s=e[n];
if(s){
s(o)
}}};
Dwt.setHandler(t.getInputElement(),DwtEvent.ONCLICK,a)
};
DwtFormRows=function(a){
if(arguments.length==0){
return
}
this._itemDef=a.formItemDef||{};
a.className=a.className||"DwtFormRows";
DwtForm.call(this,{
id:a.id,parent:a.parent,form:{}
,template:this._itemDef.template}
);
this._rowsTabGroup=new DwtTabGroup(this._htmlElId);
this._rowDef=this._itemDef.rowitem||{};
this._equals=DwtForm.__makeFunc(this._rowDef.equals)||DwtForm.__equals;
this._rowCount=0;
this._minRows=this._itemDef.minrows||1;
this._maxRows=this._itemDef.maxrows||Number.MAX_VALUE;
if(this._itemDef.rowtemplate){
this.ROW_TEMPLATE=this._itemDef.rowtemplate
}
var t=this._itemDef.items||[];
for(var e=0;
e<t.length;
e++){
this.addRow(t[e])
}
for(;
e<this._minRows;
e++){
this.addRow()
}
this._onaddrow=DwtForm.__makeFunc(this._itemDef.onaddrow);
this._onremoverow=DwtForm.__makeFunc(this._itemDef.onremoverow)
};
DwtFormRows.prototype=new DwtForm;
DwtFormRows.prototype.constructor=DwtFormRows;
DwtFormRows.prototype.toString=function(){
return"DwtFormRows"
};
DwtFormRows.prototype.TEMPLATE="dwt.Widgets#DwtFormRows";
DwtFormRows.prototype.ROW_TEMPLATE="dwt.Widgets#DwtFormRow";
DwtFormRows.prototype.getTabGroupMember=function(){
return this._rowsTabGroup
};
DwtFormRows.prototype.setValue=function(o){
if(arguments.length>1){
DwtForm.prototype.setValue.apply(this,arguments);
return
}
var a=Math.max(o.length,this._minRows);
for(var t=this._rowCount;
t>a;
t--){
this.removeRow(t-1)
}
var e=Math.min(o.length,this._maxRows);
for(var t=this._rowCount;
t<e;
t++){
this.addRow()
}
for(var t=0;
t<e;
t++){
this.setValue(String(t),o[t],true)
}
for(var t=o.length;
t<this._rowCount;
t++){
this.setValue(String(t),null,true)
}};
DwtFormRows.prototype.getValue=function(){
if(arguments.length>0){
return DwtForm.prototype.getValue.apply(this,arguments)
}
var t=new Array(this._rowCount);
for(var e=0;
e<this._rowCount;
e++){
t[e]=this.getValue(String(e))
}
return t
};
DwtFormRows.prototype.getRowCount=function(){
return this._rowCount
};
DwtFormRows.prototype.addRow=function(n,o){
if(this._rowCount>=this._maxRows){
return
}
n=n||(this._rowDef&&AjxUtil.createProxy(this._rowDef));
if(!n){
return
}
if(o==null){
o=this._rowCount
}
for(var d=this._rowCount-1;
d>=o;
d--){
var w=d,u=d+1;
var m=this._items[w];
m.aka=String(u);
delete this._items[w];
this._items[m.aka]=m;
this._setControlIds(m.id,m.aka)
}
n.id=n.id||Dwt.getNextId();
n.aka=String(o);
this._rowCount++;
var v={
id:[this.getHTMLElId(),n.id].join("_")};
var p=AjxTemplate.expand(this.ROW_TEMPLATE,v);
var e=this._rowsEl;
e.appendChild(Dwt.toDocumentFragment(p,v.id+"_row"));
var g=e.lastChild;
if(o!=this._rowCount-1){
e.insertBefore(g,e.childNodes[o])
}
var y=[];
var s=this._registerControl(n,null,y);
var t=this._itemDef.additem?AjxUtil.createProxy(this._itemDef.additem):{
image:"Add"};
t.id=t.id||n.id+"_add";
t.visible="this.getRowCount() < this.getMaxRows()";
t.ignore=true;
var c=this._registerControl(t,null,y,null,null,"DwtButton");
if(!t.onclick){
c.addSelectionListener(new AjxListener(this,this._handleAddRow,[n.id]))
}
var h=this._itemDef.removeitem?AjxUtil.createProxy(this._itemDef.removeitem):{
image:"Remove"};
h.id=h.id||n.id+"_remove";
h.visible="this.getRowCount() > this.getMinRows()";
h.ignore=true;
var f=this._registerControl(h,null,y,null,null,"DwtButton");
if(!h.onclick){
f.addSelectionListener(new AjxListener(this,this._handleRemoveRow,[n.id]))
}
var m=this._items[n.id];
m._rowEl=g;
m._addId=t.id;
m._removeId=h.id;
this._setControlIds(m.id,o);
var a=new DwtTabGroup(n.id);
y.sort(DwtForm.__byTabIndex);
for(var d=0;
d<y.length;
d++){
var s=y[d].control;
a.addMember(s.getTabGroupMember()||s)
}
if(o==this._rowCount-1){
this._rowsTabGroup.addMember(a)
}else{
var r=this._items[String(o+1)];
var l=this._rowsTabGroup.getTabGroupMemberByName(r.id);
this._rowsTabGroup.addMemberBefore(a,l)
}
this.update();
if(this._onaddrow){
this._call(this._onaddrow,[o])
}
return s
};
DwtFormRows.prototype.removeRow=function(r){
if(this._rowCount<=this._minRows){
return
}
var c=this._items[r];
if(c.control instanceof DwtControl){
this.removeChild(c.control)
}
delete this._items[c.aka];
this._deleteItem(c.id);
var h=this._items[c._addId];
if(h){
this.removeChild(h.control);
this._deleteItem(h.id)
}
var l=this._items[c._removeId];
if(l){
this.removeChild(l.control);
this._deleteItem(l.id)
}
var s=Number(c.aka);
for(var a=s+1;
a<this._rowCount;
a++){
var n=a,t=a-1;
this._items[t]=this._items[n];
this._items[t].aka=String(t);
this._setControlIds(this._items[t].id,this._items[t].aka)
}
this._deleteItem(String(--this._rowCount));
var e=c._rowEl;
e.parentNode.removeChild(e);
delete c._rowEl;
var o=this._rowsTabGroup.getTabGroupMemberByName(c.id);
this._rowsTabGroup.removeMember(o);
this.update();
if(this._onremoverow){
this._call(this._onremoverow,[Number(c.aka)])
}};
DwtFormRows.prototype.getMinRows=function(){
return this._minRows
};
DwtFormRows.prototype.getMaxRows=function(){
return this._maxRows
};
DwtFormRows.prototype.getRowCount=function(){
return this._rowCount
};
DwtFormRows.prototype.getIndexForRowId=function(a){
var t=this._rowsEl.childNodes;
for(var e=0;
e<t.length;
e++){
if(t[e].id==[this._htmlElId,a,"row"].join("_")){
return e
}}
return -1
};
DwtFormRows.__equals=function(t,e){
if(t===e){
return true
}
if(!t||!e||t.length!=e.length){
return false
}
for(var o=0;
o<t.length;
o++){
if(!this._call(this._equals,[t[o],e[o]])){
return false
}}
return true
};
DwtFormRows.prototype._setControlIds=function(o,e){
var n=[this.getHTMLElId(),e].join("_");
var i=this._items[o];
this._setControlId(i&&i.control,n);
var t=this._items[i._addId];
this._setControlId(t&&t.control,n+"_add");
var a=this._items[i._removeId];
this._setControlId(a&&a.control,n+"_remove")
};
DwtFormRows.prototype._setControlId=function(e,t){
if(!e){
return
}
if(e instanceof DwtControl){
e.setHtmlElementId(t)
}else{
e.id=t
}};
DwtFormRows.prototype._handleAddRow=function(t){
if(this.getRowCount()<this.getMaxRows()){
var e=this.getIndexForRowId(t)+1;
this.addRow(null,e)
}};
DwtFormRows.prototype._handleRemoveRow=function(e){
this.removeRow(e)
};
DwtFormRows.prototype._setModelValue=function(t,e){
if(DwtForm.prototype._setModelValue.apply(this,arguments)){
this.parent.setDirty(this._itemDef.id,true)
}};
DwtFormRows.prototype._createHtmlFromTemplate=function(e,t){
DwtForm.prototype._createHtmlFromTemplate.apply(this,arguments);
this._rowsEl=document.getElementById(this._htmlElId+"_rows")
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtMessageDialog")){
DwtMessageDialog=function(t){
if(arguments.length==0){
return
}
t=Dwt.getParams(arguments,DwtMessageDialog.PARAMS);
this._msgCellId=Dwt.getNextId("MessageDialog_");
t.standardButtons=t.buttons||[DwtDialog.OK_BUTTON];
if(t.helpText){
var e=new DwtDialog_ButtonDescriptor(DwtMessageDialog.HELP_BUTTON,t.helpText,DwtDialog.ALIGN_LEFT);
t.extraButtons=t.extraButtons||[];
t.extraButtons.push(e);
DwtDialog.call(this,t);
this.registerCallback(DwtMessageDialog.HELP_BUTTON,function(){
ZmZimbraMail.helpLinkCallback(this._helpURL)
}
,this)
}else{
DwtDialog.call(this,t)
}
this.setContent(this._contentHtml());
this._msgCell=document.getElementById(this._msgCellId);
this.addEnterListener(new AjxListener(this,this._enterListener));
this._setAllowSelection()
};
DwtMessageDialog.PARAMS=["parent","className","buttons","extraButtons","id"];
DwtMessageDialog.prototype=new DwtDialog;
DwtMessageDialog.prototype.constructor=DwtMessageDialog;
DwtMessageDialog.prototype.role="alertdialog";
DwtMessageDialog.CRITICAL_STYLE=1;
DwtMessageDialog.INFO_STYLE=2;
DwtMessageDialog.WARNING_STYLE=3;
DwtMessageDialog.TITLE={};
DwtMessageDialog.TITLE[DwtMessageDialog.CRITICAL_STYLE]=AjxMsg.criticalMsg;
DwtMessageDialog.TITLE[DwtMessageDialog.INFO_STYLE]=AjxMsg.infoMsg;
DwtMessageDialog.TITLE[DwtMessageDialog.WARNING_STYLE]=AjxMsg.warningMsg;
DwtMessageDialog.ICON={};
DwtMessageDialog.ICON[DwtMessageDialog.CRITICAL_STYLE]="Critical_32";
DwtMessageDialog.ICON[DwtMessageDialog.INFO_STYLE]="Information_32";
DwtMessageDialog.ICON[DwtMessageDialog.WARNING_STYLE]="Warning_32";
DwtMessageDialog.HELP_BUTTON="Help";
DwtMessageDialog.prototype.toString=function(){
return"DwtMessageDialog"
};
DwtMessageDialog.prototype.setMessage=function(a,o,n){
this._message=a||"";
this._style=o||DwtMessageDialog.INFO_STYLE;
this.setTitle(n||DwtMessageDialog.TITLE[this._style]);
if(a){
var t=[];
var e=0;
t[e++]="<table role='presentation' cellspacing=0 cellpadding=0 border=0 width=100% height=100%><tr><td valign='top'>";
t[e++]=AjxImg.getImageHtml({
imageName:DwtMessageDialog.ICON[this._style],attrStr:"id='"+this._msgCellId+"_Image''",altText:DwtMessageDialog.TITLE[this._style]}
);
t[e++]="</td><td role='document' class='DwtMsgArea' id='"+this._msgCellId+"_Msg'>";
t[e++]=a;
t[e++]="</td></tr></table>";
this._msgCell.innerHTML=t.join("")
}else{
this._msgCell.innerHTML=""
}};
DwtMessageDialog.prototype.setHelpURL=function(e){
this._helpURL=e
};
DwtMessageDialog.prototype.setSize=function(t,e){
var a=document.getElementById(this._msgCellId);
if(a&&(t||e)){
Dwt.setSize(a,t,e)
}};
DwtMessageDialog.prototype.focus=function(){
DwtDialog.prototype.focus.apply(this,arguments);
var e=this._tabGroup.getFirstMember();
if(e&&e.isDwtButton&&!e.hasAttribute("aria-describedby")){
e.setAttribute("aria-describedby",this._msgCellId+"_Msg")
}};
DwtMessageDialog.prototype.reset=function(){
this._msgCell.innerHTML="";
this._helpURL="";
DwtDialog.prototype.reset.call(this)
};
DwtMessageDialog.prototype.handleKeyAction=function(e,t){
return DwtDialog.prototype.handleKeyAction.call(this,e,t)
};
DwtMessageDialog.prototype._contentHtml=function(){
return"<div id='"+this._msgCellId+"' class='DwtMsgDialog'></div>"
};
DwtMessageDialog.prototype._enterListener=function(e){
this._runEnterCallback()
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtChooser")){
DwtChooser=function(a){
if(arguments.length==0){
return
}
DwtComposite.call(this,a.parent,a.className);
this._slvClassName=a.slvClassName;
this._tlvClassName=a.tlvClassName;
this._layoutStyle=a.layoutStyle?a.layoutStyle:DwtChooser.HORIZ_STYLE;
this._selectStyle=a.selectStyle?a.selectStyle:DwtChooser.MULTI_SELECT;
this._mode=a.listStyle?a.listStyle:DwtChooser.MODE_MOVE;
this._noDuplicates=(a.noDuplicates!==false);
this._singleHeight=a.singleHeight?a.singleHeight:45;
this._listSize=a.listSize;
this._sourceEmptyOk=a.sourceEmptyOk;
this._allButtons=a.allButtons;
this._hasTextField=a.hasTextField;
this._handleButtonInfo(a.buttonInfo);
this._mode=a.mode?a.mode:this._hasMultiButtons?DwtChooser.MODE_COPY:DwtChooser.MODE_MOVE;
this._createHtml();
this._initialize();
var t=a.parent.getSize();
var i=a.listWidth||t.x;
var e=a.listHeight||t.y;
if(i&&e){
this.resize(i,e)
}};
DwtChooser.prototype=new DwtComposite;
DwtChooser.prototype.constructor=DwtChooser;
DwtChooser.prototype.isFocusable=true;
DwtChooser.prototype.role="listbox";
DwtChooser.HORIZ_STYLE=1;
DwtChooser.VERT_STYLE=2;
DwtChooser.SINGLE_SELECT=1;
DwtChooser.MULTI_SELECT=2;
DwtChooser.MODE_COPY=1;
DwtChooser.MODE_MOVE=2;
DwtChooser.REMOVE_BTN_ID="__remove__";
DwtChooser.ADD_ALL_BTN_ID="__addAll__";
DwtChooser.REMOVE_ALL_BTN_ID="__removeAll__";
DwtChooser.prototype.toString=function(){
return"DwtChooser"
};
DwtChooser.prototype.setItems=function(t,e,a){
e=e?e:DwtChooserListView.SOURCE;
this._reset(e);
this.addItems(t,e,true);
this._selectFirst(e);
if(a){
this._reset((e==DwtChooserListView.SOURCE)?DwtChooserListView.TARGET:DwtChooserListView.SOURCE)
}};
DwtChooser.prototype.getItems=function(e){
e=e?e:DwtChooserListView.TARGET;
if(e==DwtChooserListView.SOURCE){
return this.sourceListView.getList().clone()
}else{
if(this._hasMultiButtons){
var a={};
for(var t in this._data){
a[t]=this._data[t].clone()
}
return a
}else{
return this._data[this._buttonInfo[0].id].clone()
}}};
DwtChooser.prototype.addItems=function(t,e,o,r){
e=e?e:DwtChooserListView.SOURCE;
var s=(t instanceof AjxVector)?t.getArray():(t instanceof Array)?t:[t];
if(e==DwtChooserListView.SOURCE){
for(var a=0;
a<s.length;
a++){
this._addToSource(s[a],null,o)
}}else{
var n;
if(this._selectStyle==DwtChooser.SINGLE_SELECT){
this.targetListView._resetList();
s=(s.length>0)?[s[0]]:s
}
for(var a=0;
a<s.length;
a++){
this._addToTarget(s[a],r,o)
}}
if(e==DwtChooserListView.SOURCE){
var s=this.sourceListView.getList();
this._sourceSize=s?s.size():0
}};
DwtChooser.prototype.removeItems=function(o,e,a){
o=(o instanceof AjxVector)?o.getArray():(o instanceof Array)?o:[o];
for(var t=0;
t<o.length;
t++){
(e==DwtChooserListView.SOURCE)?this._removeFromSource(o[t],a):this._removeFromTarget(o[t],a)
}};
DwtChooser.prototype.transfer=function(t,i,e){
i=i?i:this._activeButtonId;
this._setActiveButton(i);
if(this._mode==DwtChooser.MODE_MOVE){
if(this._selectStyle==DwtChooser.SINGLE_SELECT){
var a=this.targetListView.getList();
if(a&&a.size()){
this.remove(a,true)
}}
this.removeItems(t,DwtChooserListView.SOURCE,true)
}
this.addItems(t,DwtChooserListView.TARGET,e);
this.sourceListView.deselectAll()
};
DwtChooser.prototype.remove=function(o,a){
o=(o instanceof AjxVector)?o.getArray():(o instanceof Array)?o:[o];
if(this._mode==DwtChooser.MODE_MOVE){
for(var t=0;
t<o.length;
t++){
var e=this._getInsertionIndex(this.sourceListView,o[t]);
this.sourceListView.addItem(o[t],e,true)
}
this._sourceSize=o?o.length:0
}
this.removeItems(o,DwtChooserListView.TARGET)
};
DwtChooser.prototype.setSelectStyle=function(i,s){
if(i==this._selectStyle){
return
}
this._selectStyle=i;
if(this._defLabel){
var t=this._button[this._buttonInfo[0].id];
t.setText((i==DwtChooser.SINGLE_SELECT)?AjxMsg.select:AjxMsg.add)
}
if(!s){
var o=this.getSize();
this.resize(o.x,o.y)
}
if(this._allButtons){
this._addAllButton.setVisible(i==DwtChooser.MULTI_SELECT);
this._removeAllButton.setVisible(i==DwtChooser.MULTI_SELECT);
this._enableButtons()
}
if(i==DwtChooser.SINGLE_SELECT){
var n=this.targetListView.getList();
var e=n?n.clone().getArray():null;
if(e&&e.length){
this._reset(DwtChooserListView.TARGET);
this.addItems(e[0],DwtChooserListView.TARGET,true);
this.targetListView.deselectAll();
if(e.length>1&&this._mode==DwtChooser.MODE_MOVE){
this.addItems(e.slice(1),DwtChooserListView.SOURCE,true)
}
this._enableButtons()
}}
this.sourceListView.setMultiSelect(i==DwtChooser.MULTI_SELECT);
this.targetListView.setMultiSelect(i==DwtChooser.MULTI_SELECT)
};
DwtChooser.prototype.reset=function(e){
this._reset(e);
this._setActiveButton(this._buttonInfo[0].id);
this._enableButtons();
if(this._hasTextField){
this._textField.setValue("")
}};
DwtChooser.prototype._reset=function(e){
if(!e||e==DwtChooserListView.SOURCE){
this.sourceListView._resetList()
}
if(!e||e==DwtChooserListView.TARGET){
this.targetListView._resetList();
for(var t in this._data){
this._data[t].removeAll()
}}};
DwtChooser.prototype.addStateChangeListener=function(e){
this.targetListView.addStateChangeListener(e)
};
DwtChooser.prototype.removeStateChangeListener=function(e){
this.targetListView.removeStateChangeListener(e)
};
DwtChooser.prototype.getSourceListView=function(){
return document.getElementById(this._sourceListViewDivId)
};
DwtChooser.prototype.getButtons=function(){
return document.getElementById(this._buttonsDivId)
};
DwtChooser.prototype.getTargetListView=function(){
return document.getElementById(this._targetListViewDivId)
};
DwtChooser.prototype.getTextField=function(){
return this._textField
};
DwtChooser.prototype._createHtml=function(){
this._sourceListViewDivId=Dwt.getNextId();
this._targetListViewDivId=Dwt.getNextId();
this._buttonsDivId=Dwt.getNextId();
this._removeButtonDivId=Dwt.getNextId();
if(this._allButtons){
this._addAllButtonDivId=Dwt.getNextId();
this._removeAllButtonDivId=Dwt.getNextId()
}
if(this._hasTextField){
this._textFieldTdId=Dwt.getNextId()
}
var a=[];
var e=0;
if(this._layoutStyle==DwtChooser.HORIZ_STYLE){
a[e++]="<table>";
a[e++]="<tr>";
a[e++]="<td id='";
a[e++]=this._sourceListViewDivId;
a[e++]="'></td>";
a[e++]="<td valign='middle' id='";
a[e++]=this._buttonsDivId;
a[e++]="'>";
if(this._allButtons){
a[e++]="<div id='";
a[e++]=this._addAllButtonDivId;
a[e++]="'></div><br>"
}
for(var t=0;
t<this._buttonInfo.length;
t++){
var o=this._buttonInfo[t].id;
a[e++]="<div id='";
a[e++]=this._buttonDivId[o];
a[e++]="'></div><br>"
}
a[e++]="<br><div id='";
a[e++]=this._removeButtonDivId;
a[e++]="'></div>";
if(this._allButtons){
a[e++]="<br><div id='";
a[e++]=this._removeAllButtonDivId;
a[e++]="'></div><br>"
}
a[e++]="</td>";
a[e++]="<td id='";
a[e++]=this._targetListViewDivId;
a[e++]="'></td>";
a[e++]="</tr>";
if(this._hasTextField){
a[e++]="<tr><td>";
a[e++]="<table width=100%><tr><td style='white-space:nowrap; width:1%'>";
a[e++]=AjxMsg.add;
a[e++]=":</td><td id='";
a[e++]=this._textFieldTdId;
a[e++]="'></td></tr></table>";
a[e++]="</td><td>&nbsp;</td><td>&nbsp;</td></tr>"
}
a[e++]="</table>"
}else{
a[e++]="<div id='";
a[e++]=this._sourceListViewDivId;
a[e++]="'></div>";
a[e++]="<div align='center' id='";
a[e++]=this._buttonsDivId;
a[e++]="'>";
a[e++]="<table class='ZPropertySheet' cellspacing='6'><tr>";
if(this._allButtons){
a[e++]="<td id='";
a[e++]=this._addAllButtonDivId;
a[e++]="'></td>"
}
for(var t=0;
t<this._buttonInfo.length;
t++){
var o=this._buttonInfo[t].id;
a[e++]="<td id='";
a[e++]=this._buttonDivId[o];
a[e++]="'></td>"
}
a[e++]="<td id='";
a[e++]=this._removeButtonDivId;
a[e++]="'></td>";
if(this._allButtons){
a[e++]="<td id='";
a[e++]=this._removeAllButtonDivId;
a[e++]="'></td>"
}
a[e++]="</tr></table></div>";
a[e++]="<div id='";
a[e++]=this._targetListViewDivId;
a[e++]="'></div>"
}
this.getHtmlElement().innerHTML=a.join("")
};
DwtChooser.prototype._handleButtonInfo=function(t){
if(!t){
this._defLabel=(this._selectStyle==DwtChooser.SINGLE_SELECT)?AjxMsg.select:AjxMsg.add;
t=[{
label:this._defLabel}
]
}
this._buttonInfo=t;
this._buttonDivId={};
this._buttonId={};
if(this._buttonInfo.length==1){
if(!this._buttonInfo[0].id){
this._buttonInfo[0].id=Dwt.getNextId("DwtChooserButtonInfo_")
}
this._activeButtonId=this._buttonInfo[0].id
}
for(var e=0;
e<this._buttonInfo.length;
e++){
var a=this._buttonInfo[e].id;
this._buttonDivId[a]=Dwt.getNextId("DwtChooserButtonDiv_");
this._buttonId[a]=Dwt.getNextId("DwtChooserButton_")
}
this._hasMultiButtons=(this._buttonInfo.length>1)
};
DwtChooser.prototype._initialize=function(){
var e=new AjxListener(this,this._transferButtonListener);
this._button={};
this._buttonIndex={};
this._data={};
for(var t=0;
t<this._buttonInfo.length;
t++){
var o=this._buttonInfo[t].id;
this._button[o]=this._setupButton(o,this._buttonId[o],this._buttonDivId[o],this._buttonInfo[t].label);
this._button[o].addSelectionListener(e);
this._buttonIndex[o]=t;
this._data[o]=new AjxVector()
}
this.sourceListView=this._createSourceListView();
this._addListView(this.sourceListView,this._sourceListViewDivId);
this.sourceListView.addSelectionListener(new AjxListener(this,this._sourceListener));
this.targetListView=this._createTargetListView();
this._addListView(this.targetListView,this._targetListViewDivId);
this.targetListView.addSelectionListener(new AjxListener(this,this._targetListener));
this._removeButtonId=Dwt.getNextId("DwtChooserRemoveButton_");
this._removeButton=this._setupButton(DwtChooser.REMOVE_BTN_ID,this._removeButtonId,this._removeButtonDivId,AjxMsg.remove);
this._removeButton.addSelectionListener(new AjxListener(this,this._removeButtonListener));
if(this._allButtons){
this._addAllButtonId=Dwt.getNextId();
this._addAllButton=this._setupButton(DwtChooser.ADD_ALL_BTN_ID,this._addAllButtonId,this._addAllButtonDivId,AjxMsg.addAll);
this._addAllButton.addSelectionListener(new AjxListener(this,this._addAllButtonListener));
this._removeAllButtonId=Dwt.getNextId();
this._removeAllButton=this._setupButton(DwtChooser.REMOVE_ALL_BTN_ID,this._removeAllButtonId,this._removeAllButtonDivId,AjxMsg.removeAll);
this._removeAllButton.addSelectionListener(new AjxListener(this,this._removeAllButtonListener));
if(this._selectStyle==DwtChooser.SINGLE_SELECT){
this._addAllButton.setVisible(false);
this._removeAllButton.setVisible(false)
}}
if(this._hasTextField){
var a={
parent:this,type:DwtInputField.STRING};
this._textField=new DwtInputField(a);
this._textField.reparentHtmlElement(this._textFieldTdId);
this._textField._chooser=this;
this._textField.setHandler(DwtEvent.ONKEYUP,DwtChooser._onKeyUp);
Dwt.setSize(this._textField.getInputElement(),"100%",Dwt.DEFAULT)
}
if(this._selectStyle==DwtChooser.SINGLE_SELECT){
this.sourceListView.setMultiSelect(false);
this.targetListView.setMultiSelect(false)
}};
DwtChooser.prototype.getTabGroupMember=function(){
var t=new DwtTabGroup(this.toString());
t.addMember(this.sourceListView);
for(var e=0;
e<this._buttonInfo.length;
e++){
t.addMember(this._button[this._buttonInfo[e].id])
}
t.addMember(this._removeButton);
if(this._addAllButton){
t.addMember(this._addAllButton);
t.addMember(this._removeAllButton)
}
if(this._hasTextField){
t.addMember(this._textField)
}
t.addMember(this.targetListView);
return t
};
DwtChooser.prototype._createSourceListView=function(){
return new DwtChooserListView(this,DwtChooserListView.SOURCE,this._slvClassName)
};
DwtChooser.prototype._createTargetListView=function(){
return new DwtChooserListView(this,DwtChooserListView.TARGET,this._tlvClassName)
};
DwtChooser.prototype._addListView=function(t,a){
var e=document.getElementById(a);
e.appendChild(t.getHtmlElement());
t.setUI(null,true);
t._initialized=true
};
DwtChooser.prototype.resize=function(o,e){
if(!o||!e){
return
}
if(o==Dwt.DEFAULT&&e==Dwt.DEFAULT){
return
}
var a=document.getElementById(this._buttonsDivId);
var s=Dwt.getSize(a);
var t,i,n;
if(this._layoutStyle==DwtChooser.HORIZ_STYLE){
t=this._listSize?this._listSize:(o==Dwt.DEFAULT)?o:Math.floor(((o-s.x)/2)-12);
i=n=e
}else{
t=o;
if(this._selectStyle==DwtChooser.SINGLE_SELECT){
i=this._listSize?this._listSize:(e==Dwt.DEFAULT)?e:e-s.y-this._singleHeight-30;
n=(e==Dwt.DEFAULT)?e:e-s.y-i-30
}else{
i=n=this._listSize?this._listSize:(e==Dwt.DEFAULT)?e:Math.floor(((e-s.y)/2)-12)
}}
this.sourceListView.setSize((t==Dwt.DEFAULT)?t:t+2,i);
this.targetListView.setSize((t==Dwt.DEFAULT)?t:t+2,n)
};
DwtChooser.prototype._setupButton=function(n,a,o,e){
var t=new DwtButton({
parent:this,id:a}
);
t.setText(e);
t.id=a;
t._buttonId=n;
var i=document.getElementById(o);
i.appendChild(t.getHtmlElement());
return t
};
DwtChooser.prototype._sourceListener=function(e){
if(e.detail==DwtListView.ITEM_DBL_CLICKED){
this.transfer(this.sourceListView.getSelection(),this._activeButtonId);
this.sourceListView.deselectAll()
}else{
if(this._activeButtonId==DwtChooser.REMOVE_BTN_ID){
var t=this._lastActiveTransferButtonId?this._lastActiveTransferButtonId:this._buttonInfo[0].id;
this._setActiveButton(t)
}}
this.targetListView.deselectAll();
this._enableButtons()
};
DwtChooser.prototype._targetListener=function(e){
if(e.detail==DwtListView.ITEM_DBL_CLICKED){
this.remove(this.targetListView.getSelection())
}else{
this._setActiveButton(DwtChooser.REMOVE_BTN_ID);
this.sourceListView.deselectAll();
this._enableButtons()
}};
DwtChooser.prototype._transferButtonListener=function(a){
var t=DwtControl.getTargetControl(a);
var o=t._buttonId;
var i=this.sourceListView.getSelection();
if(i&&i.length){
this.transfer(i,o);
this._enableButtons()
}else{
var e=this._getEmailFromText();
if(e){
this.transfer([e],o)
}else{
this._setActiveButton(o)
}}};
DwtChooser.prototype._removeButtonListener=function(e){
this.remove(this.targetListView.getSelection());
var t=this.targetListView.getList();
if(t&&t.size()){
this._selectFirst(DwtChooserListView.TARGET)
}else{
this._enableButtons()
}};
DwtChooser.prototype._addAllButtonListener=function(e){
this.transfer(this.sourceListView.getList().clone());
this._selectFirst(DwtChooserListView.TARGET)
};
DwtChooser.prototype._removeAllButtonListener=function(e){
this.remove(this.targetListView.getList().clone());
this._selectFirst(DwtChooserListView.SOURCE)
};
DwtChooser.prototype._enableButtons=function(a,r){
var h=this.sourceListView.getList();
var c=this.targetListView.getList();
var o=(a||(this.sourceListView.getSelectionCount()>0));
for(var s=0;
s<this._buttonInfo.length;
s++){
var t=this._buttonInfo[s].id;
this._button[t].setEnabled(o)
}
var l=(r||(this.targetListView.getSelectionCount()>0));
this._removeButton.setEnabled(l);
if(this._allButtons&&(this._selectStyle==DwtChooser.MULTI_SELECT)){
var e=h?h.size():0;
var n=c?c.size():0;
this._addAllButton.setEnabled(e>0);
this._removeAllButton.setEnabled(n>0)
}};
DwtChooser.prototype._selectFirst=function(t,a){
var e=(t==DwtChooserListView.SOURCE)?this.sourceListView:this.targetListView;
var i=e.getList();
if(i&&i.size()>0){
e.setSelection(i.get(0))
}};
DwtChooser.prototype._setActiveButton=function(i){
if(!this._hasMultiButtons){
return
}
if(i!=this._activeButtonId){
var a=(this._activeButtonId==DwtChooser.REMOVE_BTN_ID)?this._removeButtonId:this._buttonId[this._activeButtonId];
if(a){
var e=DwtControl.findControl(document.getElementById(a));
if(e){
e.setDisplayState(DwtControl.NORMAL)
}}
a=(i==DwtChooser.REMOVE_BTN_ID)?this._removeButtonId:this._buttonId[i];
var t=DwtControl.findControl(document.getElementById(a));
if(t){
t.setDisplayState(DwtControl.DEFAULT)
}
this._activeButtonId=i;
if(i!=DwtChooser.REMOVE_BTN_ID){
this._lastActiveTransferButtonId=i
}}};
DwtChooser.prototype._isDuplicate=function(e,t){
return t.contains(e)
};
DwtChooser.prototype._addToSource=function(a,e,t){
if(!a){
return
}
if(!a._chooserIndex){
var i=this.sourceListView.getList();
a._chooserIndex=i?i.size()+1:1
}
this.sourceListView.addItem(a,e,t)
};
DwtChooser.prototype._addToTarget=function(l,e,s){
if(!l){
return
}
e=e?e:this._activeButtonId;
if(this._noDuplicates&&this._data[e]&&this._isDuplicate(l,this._data[e])){
return
}
var n=this.targetListView.getList();
if(n&&n.contains(l)&&l.clone){
var a=l.clone();
a.id=Dwt.getNextId();
l=a
}
var r=null;
if(this._hasMultiButtons){
n=[];
for(var t=0;
t<this._buttonInfo.length;
t++){
n=n.concat(this._data[this._buttonInfo[t].id].getArray())
}
var o=this._buttonIndex[e];
for(r=0;
r<n.length;
r++){
var h=this._buttonIndex[n[r]._buttonId];
if(h>o){
break
}}}
l._buttonId=e;
l.id=l.id||Dwt.getNextId();
this._data[e].add(l);
this.targetListView.addItem(l,r,s)
};
DwtChooser.prototype._removeFromSource=function(t,e){
if(!t){
return
}
var a=this.sourceListView.getList();
if(!a){
return
}
if(!a.contains(t)){
return
}
this.sourceListView.removeItem(t,e)
};
DwtChooser.prototype._removeFromTarget=function(t,e){
if(!t){
return
}
var a=this.targetListView.getList();
if(!a){
return
}
if(!a.contains(t)){
return
}
this._data[t._buttonId].remove(t);
this.targetListView.removeItem(t,e)
};
DwtChooser.prototype._getInsertionIndex=function(t,n){
var s=t.getList();
if(!s){
return null
}
var e=s.getArray();
for(var o=0;
o<e.length;
o++){
if(n._chooserIndex&&e[o]._chooserIndex&&(e[o]._chooserIndex>=n._chooserIndex)){
return o
}}
return null
};
DwtChooser.prototype._getEmailFromText=function(){
if(this._hasTextField){
var t=this._textField.getValue();
var e=AjxEmailAddress.parse(t);
if(e){
e.id=Dwt.getNextId();
return e
}}};
DwtChooser._onKeyUp=function(o){
var a=DwtUiEvent.getTarget(o);
var n=DwtControl.findControl(a);
var i=n._chooser;
var t=DwtKeyEvent.getCharCode(o);
if(t==3||t==13){
var e=i._getEmailFromText();
if(e){
i.transfer([e],i._activeButtonId);
a.value=""
}}
i._enableButtons(a.value.length)
};
DwtChooserListView=function(e){
if(arguments.length==0){
return
}
e=Dwt.getParams(arguments,DwtChooserListView.PARAMS);
e.className=e.className||"DwtChooserListView";
e.headerList=this._getHeaderList(parent);
DwtListView.call(this,e);
this.type=e.type;
this._chooserParent=e.parent.parent
};
DwtChooserListView.PARAMS=["parent","type","className","view"];
DwtChooserListView.SOURCE=1;
DwtChooserListView.TARGET=2;
DwtChooserListView.prototype=new DwtListView;
DwtChooserListView.prototype.constructor=DwtChooserListView;
DwtChooserListView.prototype._getHeaderList=function(){};
DwtChooserListView.prototype.toString=function(){
return"DwtChooserListView"
};
DwtChooserListView.prototype.setUI=function(t,e){
e=e?e:((this.type==DwtChooserListView.TARGET)||this.parent._sourceEmptyOk);
DwtListView.prototype.setUI.call(this,t,e)
};
DwtChooserListView.prototype._itemClicked=function(e,t){
if(!t.shiftKey&&!t.ctrlKey&&t.button==DwtMouseEvent.RIGHT){
return
}else{
DwtListView.prototype._itemClicked.call(this,e,t)
}};
DwtChooserListView.prototype._sortColumn=function(t,e){
this._chooserParent.search(t,e)
};
DwtChooserListView.prototype._getHeaderSashLocation=function(){
var t=this.getHtmlElement();
if(Dwt.getPosition(t)==Dwt.ABSOLUTE_STYLE){
return DwtListView.prototype._getHeaderSashLocation.call(this)
}
var a=Dwt.toWindow(t,0,0);
var e=Dwt.toWindow(this._chooserParent.getHtmlElement(),0,0);
if(!this._tmpPoint){
this._tmpPoint=new DwtPoint()
}
this._tmpPoint.x=a.x-e.x;
this._tmpPoint.y=a.y-e.y;
return this._tmpPoint
}
}
if(AjxPackage.define("ajax.dwt.widgets.DwtTimeSelect")){
DwtTimeSelect=function(e,t){
DwtComposite.call(this,{
parent:e,className:"DwtTimeSelect"}
);
this.id=t;
this._isLocale24Hour=true;
this._createSelects()
};
DwtTimeSelect.START=1;
DwtTimeSelect.END=2;
DwtTimeSelect.HOUR=1;
DwtTimeSelect.MINUTE=2;
DwtTimeSelect.AMPM=3;
DwtTimeSelect.getDateFromFields=function(e,i,a,t){
e=Number(e);
if(a){
if(a=="AM"||a===0){
e=(e==12)?0:e
}else{
if(a=="PM"||a==1){
e=(e<12)?e+12:e
}}}
t=t?t:new Date();
t.setHours(e,Number(i),0,0);
return t
};
DwtTimeSelect.parse=function(a){
var t;
var i=a.toLowerCase();
if(i===AjxMsg.midnight.toLowerCase()||i===AjxMsg.noon.toLowerCase()){
t=new Date();
t.setMinutes(0);
t.setSeconds(0);
t.setHours(i===AjxMsg.noon.toLowerCase()?12:0)
}else{
var e=AjxDateFormat.getTimeInstance(AjxDateFormat.SHORT);
t=e.parse(a)||AjxDateFormat.parseTime(a)
}
return t
};
DwtTimeSelect.format=function(e){
if(e.getHours()==0&&e.getMinutes()==0){
return AjxMsg.midnight
}else{
if(e.getHours()==12&&e.getMinutes()==0){
return AjxMsg.noon
}else{
return AjxDateFormat.getTimeInstance(AjxDateFormat.SHORT).format(e)
}}};
DwtTimeSelect.adjustStartEnd=function(y,e,h,l,u){
var s=y._args.selectObj;
var t=AjxDateUtil.simpleParseDateStr(l.value);
var p=AjxDateUtil.simpleParseDateStr(u.value);
var n=l.value;
var a=u.value;
if(s.id==DwtTimeSelect.START){
var m=(s.compId==DwtTimeSelect.HOUR)?y._args.oldValue:e.getHours();
var c=(s.compId==DwtTimeSelect.MINUTE)?y._args.oldValue:e.getMinutes();
var i=(s.compId==DwtTimeSelect.AMPM)?y._args.oldValue:e.getAmPm();
var d=DwtTimeSelect.getDateFromFields(m,c,i,t).getTime();
var r=DwtTimeSelect.getDateFromFields(e.getHours(),e.getMinutes(),e.getAmPm(),t).getTime();
var f=DwtTimeSelect.getDateFromFields(h.getHours(),h.getMinutes(),h.getAmPm(),p).getTime();
var w=f-d;
if(!w){
return null
}
var o=r+w;
var g=new Date(o);
h.set(g);
u.value=AjxDateUtil.simpleComputeDateStr(g);
if(u.value!=a){
return u
}}else{
return null
}};
DwtTimeSelect.validStartEnd=function(r,t,i,s){
var e=AjxDateUtil.simpleParseDateStr(r.value);
var n=AjxDateUtil.simpleParseDateStr(t.value);
if(e&&n){
if((e.valueOf()>n.valueOf())){
return false
}
if(e.getFullYear()>9999||n.getFullYear()>9999){
return false
}
if(i&&s){
var a=DwtTimeSelect.getDateFromFields(i.getHours(),i.getMinutes(),i.getAmPm(),e).getTime();
var o=DwtTimeSelect.getDateFromFields(s.getHours(),s.getMinutes(),s.getAmPm(),n).getTime();
if(a>o){
return false
}}}else{
return false
}
return true
};
DwtTimeSelect.prototype=new DwtComposite;
DwtTimeSelect.prototype.constructor=DwtTimeSelect;
DwtTimeSelect.prototype.isDwtTimeSelect=true;
DwtTimeSelect.prototype.toString=function(){
return"DwtTimeSelect"
};
DwtTimeSelect.prototype.set=function(i){
var a=0,n=0,o=0;
var t=this.isLocale24Hour();
var e=i.getHours();
if(!t&&e>12){
a=e-13
}else{
if(!t&&e==0){
a=this.getHourSelectSize()-1
}else{
a=t?e:e-1
}}
n=Math.floor(i.getMinutes()/5);
if(!t){
o=(i.getHours()>=12)?1:0
}
this.setSelected(a,n,o)
};
DwtTimeSelect.prototype.getValue=function(e){
return(DwtTimeSelect.getDateFromFields(this.getHours(),this.getMinutes(),this.getAmPm(),e))
};
DwtTimeSelect.prototype.getHours=function(){
return this._hourSelect.getValue()
};
DwtTimeSelect.prototype.getMinutes=function(){
return this._minuteSelect.getValue()
};
DwtTimeSelect.prototype.getAmPm=function(){
return this._amPmSelect?this._amPmSelect.getValue():null
};
DwtTimeSelect.prototype.setSelected=function(e,a,t){
this._hourSelect.setSelected(e);
this._minuteSelect.setSelected(a);
if(!this._isLocale24Hour){
this._amPmSelect.setSelected(t)
}};
DwtTimeSelect.prototype.addChangeListener=function(e){
this._hourSelect.addChangeListener(e);
this._minuteSelect.addChangeListener(e);
if(this._amPmSelect){
this._amPmSelect.addChangeListener(e)
}};
DwtTimeSelect.prototype.isLocale24Hour=function(){
return this._isLocale24Hour
};
DwtTimeSelect.prototype.getHourSelectSize=function(){
return this._hourSelect.size()
};
DwtTimeSelect.prototype.getMinuteSelectSize=function(){
return this._minuteSelect.size()
};
DwtTimeSelect.prototype.getSelectedHourIdx=function(){
return this._hourSelect.getSelectedIndex()
};
DwtTimeSelect.prototype.getSelectedMinuteIdx=function(){
return this._minuteSelect.getSelectedIndex()
};
DwtTimeSelect.prototype.getSelectedAmPmIdx=function(){
return this._amPmSelect?this._amPmSelect.getSelectedIndex():0
};
DwtTimeSelect.prototype.setEnabled=function(e){
DwtComposite.prototype.setEnabled.call(this,e);
this._hourSelect.setEnabled(e);
this._minuteSelect.setEnabled(e);
if(this._amPmSelect){
this._amPmSelect.setEnabled(e)
}};
DwtTimeSelect.prototype._createSelects=function(){
this._hourSelectId=Dwt.getNextId();
this._minuteSelectId=Dwt.getNextId();
this._amPmSelectId=Dwt.getNextId();
var o=AjxDateFormat.getTimeInstance(AjxDateFormat.SHORT);
var s=0;
var d=0;
var c=[];
var h=0;
c[h++]="<table border=0 cellpadding=0 cellspacing=0><tr>";
for(var r=0;
r<o._segments.length;
r++){
var l=o._segments[r]._s;
if(o._segments[r] instanceof AjxFormat.TextSegment){
var e=AjxStringUtil.trim(l);
if(e.length){
c[h++]="<td class='TextPadding ZmFieldLabel'>";
c[h++]=l;
c[h++]="</td>"
}}else{
if(l.charAt(0)=="h"||l.charAt(0)=="H"){
s=r;
c[h++]="<td width=42 id='";
c[h++]=this._hourSelectId;
c[h++]="'></td>"
}else{
if(l.charAt(0)=="m"){
d=r;
c[h++]="<td width=42 id='";
c[h++]=this._minuteSelectId;
c[h++]="'></td>"
}else{
if(l=="a"){
this._isLocale24Hour=false;
c[h++]="<td width=42 id='";
c[h++]=this._amPmSelectId;
c[h++]="'></td>"
}}}}}
c[h++]="</tr></table>";
this.getHtmlElement().innerHTML=c.join("");
var a=new Date();
var t=this._isLocale24Hour?0:1;
var n=this._isLocale24Hour?24:13;
this._hourSelect=new DwtSelect({
parent:this}
);
this._hourSelect.id=this.id;
this._hourSelect.compId=DwtTimeSelect.HOUR;
for(var h=t;
h<n;
h++){
a.setHours(h);
var u=o._segments[s].format(a);
this._hourSelect.addOption(u,false,h)
}
this._hourSelect.reparentHtmlElement(this._hourSelectId);
delete this._hourSelectId;
this._minuteSelect=new DwtSelect({
parent:this}
);
this._minuteSelect.id=this.id;
this._minuteSelect.compId=DwtTimeSelect.MINUTE;
for(var h=0;
h<60;
h=h+5){
a.setMinutes(h);
var u=o._segments[d].format(a);
this._minuteSelect.addOption(u,false,h)
}
this._minuteSelect.reparentHtmlElement(this._minuteSelectId);
delete this._minuteSelectId;
if(!this._isLocale24Hour){
this._amPmSelect=new DwtSelect({
parent:this}
);
this._amPmSelect.id=this.id;
this._amPmSelect.compId=DwtTimeSelect.AMPM;
this._amPmSelect.addOption(I18nMsg.periodAm,false,"AM");
this._amPmSelect.addOption(I18nMsg.periodPm,false,"PM");
this._amPmSelect.reparentHtmlElement(this._amPmSelectId);
delete this._amPmSelectId
}};
DwtTimeInput=function(a,o,e,t){
var i={
parent:a,id:"DwtTimeInput",className:"DwtTimeInput"};
if(e){
i.parentElement=e
}
DwtComposite.call(this,i);
this._interval=t||DwtTimeInput.FIFTEEN_MIN_INTERVAL;
this.id=o;
this._isLocale24Hour=true;
this._createSelects();
this._useTextInput=true
};
DwtTimeInput.THIRTY_MIN_INTERVAL=30;
DwtTimeInput.FIFTEEN_MIN_INTERVAL=15;
DwtTimeInput.START=1;
DwtTimeInput.END=2;
DwtTimeInput.HOUR=1;
DwtTimeInput.MINUTE=2;
DwtTimeInput.AMPM=3;
DwtTimeInput.ROWS=8;
DwtTimeInput.DEFAULT_TOP_ROW=8;
DwtTimeInput.getDateFromFields=function(t,e){
var a=DwtTimeSelect.parse(t);
e=e||new Date();
e.setHours(a.getHours(),a.getMinutes(),0,0);
return e
};
DwtTimeInput.adjustStartEnd=function(y,e,r,l,d,p,n){
var t=AjxDateUtil.simpleParseDateStr(l.value);
var f=AjxDateUtil.simpleParseDateStr(d.value);
var i=l.value;
var a=d.value;
if(n==DwtTimeInput.START){
var h=p?p.startTimeStr:e.getTimeString();
var c=DwtTimeInput.getDateFromFields(h,t).getTime();
var s=DwtTimeInput.getDateFromFields(e.getTimeString(),t).getTime();
var m=DwtTimeInput.getDateFromFields(r.getTimeString(),f).getTime();
var w=m-c;
if(!w){
return null
}
var o=s+w;
var g=new Date(o);
e.set(new Date(s));
r.set(g);
d.value=AjxDateUtil.simpleComputeDateStr(g);
if(d.value!=a){
return d
}}else{
if(n==DwtTimeInput.END){
var h=p?p.endTimeStr:r.getTimeString();
var m=DwtTimeInput.getDateFromFields(h,f).getTime();
var o=DwtTimeInput.getDateFromFields(r.getTimeString(),f).getTime();
var c=DwtTimeInput.getDateFromFields(e.getTimeString(),t).getTime();
var w=m-c;
if(!w){
return null
}
if(o<c){
var s=o-w;
var u=new Date(s);
e.set(u);
r.set(new Date(o));
l.value=AjxDateUtil.simpleComputeDateStr(u);
d.value=AjxDateUtil.simpleComputeDateStr(new Date(o))
}
if(l.value!=i){
return l
}}else{
return null
}}};
DwtTimeInput.validStartEnd=function(o,e,l,h){
var i=AjxDateUtil.simpleParseDateStr(o.value);
var s=AjxDateUtil.simpleParseDateStr(e.value);
if(i&&s){
if((i.valueOf()>s.valueOf())){
return false
}
if(i.getFullYear()>9999||s.getFullYear()>9999){
return false
}
if(l&&h){
var a=l.getTimeString();
var r=h.getTimeString();
if(a&&r){
var t=DwtTimeInput.getDateFromFields(a,i).getTime();
var n=DwtTimeInput.getDateFromFields(r,s).getTime();
if(t>n){
return false
}}}}else{
return false
}
return true
};
DwtTimeInput.prototype=new DwtComposite;
DwtTimeInput.prototype.constructor=DwtTimeInput;
DwtTimeInput.prototype.isDwtTimeInput=true;
DwtTimeInput.prototype.toString=function(){
return"DwtTimeInput"
};
DwtTimeInput.prototype.set=function(e){
var t=DwtTimeSelect.format(e);
this._originalTimeStr=t;
this._timeSelectInput.setValue(t);
this._scrollToValue(t)
};
DwtTimeInput.prototype.setValue=function(t){
var e=DwtTimeSelect.parse(t);
if(!e){
t=""
}
this._originalTimeStr=t;
this._timeSelectInput.setValue(t);
this._scrollToValue(t)
};
DwtTimeInput.prototype._scrollToValue=function(t){
var e=this.getTimeIndex(t);
if(e!==null){
this._hoursSelectMenu.setSelectedItem(e)
}};
DwtTimeInput.prototype.getValue=function(e){
var t=DwtTimeSelect.parse(this._timeSelectInput.getValue());
if(!t){
t=new Date()
}
e=e||new Date();
if(AjxDateUtil.isDayShifted(e)){
AjxDateUtil.rollToNextDay(e)
}
e.setHours(t.getHours(),t.getMinutes(),0,0);
return e
};
DwtTimeInput.prototype.getHours=function(){
var e=this.getValue();
return e?e.getHours():null
};
DwtTimeInput.prototype.getMinutes=function(){
var e=this.getValue();
return e?e.getMinutes():null
};
DwtTimeInput.prototype.addChangeListener=function(e){
this._changeListener=e;
var t=AjxCallback.simpleClosure(this.handleTimeChange,this,e);
this._timeSelectInput.setHandler(DwtEvent.ONBLUR,t)
};
DwtTimeInput.prototype.handleTimeChange=function(t,e){
var i=this._timeSelectInput.getValue();
var a=DwtTimeSelect.parse(i);
if(!a){
this.setValue(this._originalTimeStr)
}else{
this._scrollToValue(i)
}
t.run(e,this.id)
};
DwtTimeInput.prototype.correctTimeString=function(o,t){
var e=o.split(":");
if(!e){
return t
}
var a=(e.length&&e[0]!=null)?parseInt(e[0].replace(/\D/g,"")):null;
var i=(e.length>1&&e[1]!=null)?parseInt(e[1].replace(/\D/g,"")):0;
if(!a){
a=(a==0)?0:t.getHours()
}
if(!i){
i=0
}
t.setHours(a,i,0,0);
return t
};
DwtTimeInput.prototype.isLocale24Hour=function(){
return this._isLocale24Hour
};
DwtTimeInput.prototype.setEnabled=function(e){
DwtComposite.prototype.setEnabled.call(this,e);
this._timeSelectInput.setEnabled(e);
this._timeSelectBtn.setEnabled(e)
};
DwtTimeInput.prototype._timeButtonListener=function(d){
var t=AjxDateFormat.getTimeInstance(AjxDateFormat.SHORT);
var o;
if(!this._menuItemsAdded){
var i,a,r,s,u,n,c,e=new Date(),l=this._timeSelectBtn,h=new AjxListener(this,this._timeSelectionListener);
for(i=0;
i<24;
i++){
e.setHours(i);
e.setMinutes(0);
r=new DwtMenuItem({
parent:this._hoursSelectMenu,style:DwtMenuItem.NO_STYLE}
);
u=t.format(e);
this.putTimeIndex(u,i);
if(i==0||i==12){
u=DwtTimeSelect.format(e);
this.putTimeIndex(u,i)
}
r.setText(u);
r.setData("value",i*60);
if(h){
r.addSelectionListener(h)
}
if(i==DwtTimeInput.DEFAULT_TOP_ROW){
o=r
}
n=60/this._interval;
c=new DwtMenu({
parent:r,style:DwtMenu.DROPDOWN_CENTERV_STYLE,layout:DwtMenu.LAYOUT_CASCADE,maxRows:n,congruent:true}
);
r.setMenu(c,true);
r.setSelectableWithSubmenu(true);
c.dontStealFocus(true);
for(a=1;
a<n;
a++){
e.setMinutes(a*this._interval);
s=new DwtMenuItem({
parent:c,style:DwtMenuItem.NO_STYLE}
);
s.setText(t.format(e));
s.setData("value",i*60+a*this._interval);
if(h){
s.addSelectionListener(h)
}}}
this._hoursSelectMenu.setWidth(l.getW()+this._timeSelectInput.getW());
this._menuItemsAdded=true
}
d.item.popup();
if(o){
this._hoursSelectMenu.scrollToItem(o)
}
this._scrollToValue(t.format(this.getValue()))
};
DwtTimeInput.prototype._timeSelectionListener=function(e){
if(e.item&&e.item instanceof DwtMenuItem){
this._timeSelectInput.setValue(e.item.getText());
this._timeSelectValue=e.item.getData("value");
if(this._changeListener){
this._changeListener.run(e,this.id)
}
return
}};
DwtTimeInput.prototype.getTimeString=function(){
var e=DwtTimeSelect.parse(this._timeSelectInput.getValue());
return e?this._timeSelectInput.getValue():""
};
DwtTimeInput.prototype.getInputField=function(){
return this._timeSelectInput
};
DwtTimeInput.prototype.putTimeIndex=function(t,e){
this._timeIndex[t.replace(/\:\d\d/,":00").replace(/\s/,"").toLowerCase()]=e
};
DwtTimeInput.prototype.getTimeIndex=function(t){
if(!t){
return null
}
var e=this._timeIndex[t.replace(/\:\d\d/,":00").replace(/\s/,"").toLowerCase()];
return(e||e===0)?e:null
};
DwtTimeInput.prototype._createSelects=function(){
this.getHtmlElement().innerHTML=AjxTemplate.expand("calendar.Appointment#ApptTimeInput",{
id:this._htmlElId}
);
var a=Dwt.getNextId("DwtTimeInputSelect_");
if(this.id&&this.id==DwtTimeSelect.START){
a+="_startTimeInput"
}else{
if(this.id&&this.id==DwtTimeSelect.END){
a+="_endTimeInput"
}}
var n={
parent:this,parentElement:(this._htmlElId+"_timeSelectInput"),type:DwtInputField.STRING,errorIconStyle:DwtInputField.ERROR_ICON_NONE,validationStyle:DwtInputField.CONTINUAL_VALIDATION,inputId:a,id:Dwt.getNextId("DwtTimeInputField_")};
this._timeSelectInput=new DwtInputField(n);
var i=this._timeSelectInput.getInputElement();
Dwt.setSize(i,"80px","2rem");
i.typeId=this.id;
var e=new AjxListener(this,this._timeButtonListener);
var o=this._htmlElId+"_timeSelectBtn";
var t=this._timeSelectBtn=new DwtButton({
parent:this}
);
t.addDropDownSelectionListener(e);
t.setData(Dwt.KEY_ID,o);
t.setSize("20");
this._timeIndex={};
this._hoursSelectMenu=new DwtMenu({
parent:t,style:DwtMenu.DROPDOWN_STYLE,layout:DwtMenu.LAYOUT_SCROLL,maxRows:DwtTimeInput.ROWS}
);
t.setMenu(this._hoursSelectMenu,true,false,false,true);
this._menuItemsAdded=false;
t.reparentHtmlElement(o)
}
}
if(AjxPackage.define("ajax.3rdparty.jquery.jquery")){
/* jQuery v@1.8.1 jquery.com | jquery.org/license */
(function(a,b){
function G(a){
var b=F[a]={};
return p.each(a.split(s),function(a,c){
b[c]=!0
}
),b
}
function J(a,c,d){
if(d===b&&a.nodeType===1){
var e="data-"+c.replace(I,"-$1").toLowerCase();
d=a.getAttribute(e);
if(typeof d=="string"){
try{
d=d==="true"?!0:d==="false"?!1:d==="null"?null:+d+""===d?+d:H.test(d)?p.parseJSON(d):d
}
catch(f){}
p.data(a,c,d)
}else{
d=b
}}
return d
}
function K(a){
var b;
for(b in a){
if(b==="data"&&p.isEmptyObject(a[b])){
continue
}
if(b!=="toJSON"){
return !1
}}
return !0
}
function ba(){
return !1
}
function bb(){
return !0
}
function bh(a){
return !a||!a.parentNode||a.parentNode.nodeType===11
}
function bi(a,b){
do{
a=a[b]
}
while(a&&a.nodeType!==1);
return a
}
function bj(a,b,c){
b=b||0;
if(p.isFunction(b)){
return p.grep(a,function(a,d){
var e=!!b.call(a,d,a);
return e===c
}
)
}
if(b.nodeType){
return p.grep(a,function(a,d){
return a===b===c
}
)
}
if(typeof b=="string"){
var d=p.grep(a,function(a){
return a.nodeType===1
}
);
if(be.test(b)){
return p.filter(b,d,!c)
}
b=p.filter(b,d)
}
return p.grep(a,function(a,d){
return p.inArray(a,b)>=0===c
}
)
}
function bk(a){
var b=bl.split("|"),c=a.createDocumentFragment();
if(c.createElement){
while(b.length){
c.createElement(b.pop())
}}
return c
}
function bC(a,b){
return a.getElementsByTagName(b)[0]||a.appendChild(a.ownerDocument.createElement(b))
}
function bD(a,b){
if(b.nodeType!==1||!p.hasData(a)){
return
}
var c,d,e,f=p._data(a),g=p._data(b,f),h=f.events;
if(h){
delete g.handle,g.events={};
for(c in h){
for(d=0,e=h[c].length;
d<e;
d++){
p.event.add(b,c,h[c][d])
}}}
g.data&&(g.data=p.extend({}
,g.data))
}
function bE(a,b){
var c;
if(b.nodeType!==1){
return
}
b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?(b.parentNode&&(b.outerHTML=a.outerHTML),p.support.html5Clone&&a.innerHTML&&!p.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):c==="input"&&bv.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text),b.removeAttribute(p.expando)
}
function bF(a){
return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]
}
function bG(a){
bv.test(a.type)&&(a.defaultChecked=a.checked)
}
function bY(a,b){
if(b in a){
return b
}
var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=bW.length;
while(e--){
b=bW[e]+c;
if(b in a){
return b
}}
return d
}
function bZ(a,b){
return a=b||a,p.css(a,"display")==="none"||!p.contains(a.ownerDocument,a)
}
function b$(a,b){
var c,d,e=[],f=0,g=a.length;
for(;
f<g;
f++){
c=a[f];
if(!c.style){
continue
}
e[f]=p._data(c,"olddisplay"),b?(!e[f]&&c.style.display==="none"&&(c.style.display=""),c.style.display===""&&bZ(c)&&(e[f]=p._data(c,"olddisplay",cc(c.nodeName)))):(d=bH(c,"display"),!e[f]&&d!=="none"&&p._data(c,"olddisplay",d))
}
for(f=0;
f<g;
f++){
c=a[f];
if(!c.style){
continue
}
if(!b||c.style.display==="none"||c.style.display===""){
c.style.display=b?e[f]||"":"none"
}}
return a
}
function b_(a,b,c){
var d=bP.exec(b);
return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b
}
function ca(a,b,c,d){
var e=c===(d?"border":"content")?4:b==="width"?1:0,f=0;
for(;
e<4;
e+=2){
c==="margin"&&(f+=p.css(a,c+bV[e],!0)),d?(c==="content"&&(f-=parseFloat(bH(a,"padding"+bV[e]))||0),c!=="margin"&&(f-=parseFloat(bH(a,"border"+bV[e]+"Width"))||0)):(f+=parseFloat(bH(a,"padding"+bV[e]))||0,c!=="padding"&&(f+=parseFloat(bH(a,"border"+bV[e]+"Width"))||0))
}
return f
}
function cb(a,b,c){
var d=b==="width"?a.offsetWidth:a.offsetHeight,e=!0,f=p.support.boxSizing&&p.css(a,"boxSizing")==="border-box";
if(d<=0||d==null){
d=bH(a,b);
if(d<0||d==null){
d=a.style[b]
}
if(bQ.test(d)){
return d
}
e=f&&(p.support.boxSizingReliable||d===a.style[b]),d=parseFloat(d)||0
}
return d+ca(a,b,c||(f?"border":"content"),e)+"px"
}
function cc(a){
if(bS[a]){
return bS[a]
}
var b=p("<"+a+">").appendTo(e.body),c=b.css("display");
b.remove();
if(c==="none"||c===""){
bI=e.body.appendChild(bI||p.extend(e.createElement("iframe"),{
frameBorder:0,width:0,height:0}
));
if(!bJ||!bI.createElement){
bJ=(bI.contentWindow||bI.contentDocument).document,bJ.write("<!doctype html><html><body>"),bJ.close()
}
b=bJ.body.appendChild(bJ.createElement(a)),c=bH(b,"display"),e.body.removeChild(bI)
}
return bS[a]=c,c
}
function ci(a,b,c,d){
var e;
if(p.isArray(b)){
p.each(b,function(b,e){
c||ce.test(a)?d(a,e):ci(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)
}
)
}else{
if(!c&&p.type(b)==="object"){
for(e in b){
ci(a+"["+e+"]",b[e],c,d)
}}else{
d(a,b)
}}}
function cz(a){
return function(b,c){
typeof b!="string"&&(c=b,b="*");
var d,e,f,g=b.toLowerCase().split(s),h=0,i=g.length;
if(p.isFunction(c)){
for(;
h<i;
h++){
d=g[h],f=/^\+/.test(d),f&&(d=d.substr(1)||"*"),e=a[d]=a[d]||[],e[f?"unshift":"push"](c)
}}}
}
function cA(a,c,d,e,f,g){
f=f||c.dataTypes[0],g=g||{}
,g[f]=!0;
var h,i=a[f],j=0,k=i?i.length:0,l=a===cv;
for(;
j<k&&(l||!h);
j++){
h=i[j](c,d,e),typeof h=="string"&&(!l||g[h]?h=b:(c.dataTypes.unshift(h),h=cA(a,c,d,e,h,g)))
}
return(l||!h)&&!g["*"]&&(h=cA(a,c,d,e,"*",g)),h
}
function cB(a,c){
var d,e,f=p.ajaxSettings.flatOptions||{};
for(d in c){
c[d]!==b&&((f[d]?a:e||(e={}
))[d]=c[d])
}
e&&p.extend(!0,a,e)
}
function cC(a,c,d){
var e,f,g,h,i=a.contents,j=a.dataTypes,k=a.responseFields;
for(f in k){
f in d&&(c[k[f]]=d[f])
}
while(j[0]==="*"){
j.shift(),e===b&&(e=a.mimeType||c.getResponseHeader("content-type"))
}
if(e){
for(f in i){
if(i[f]&&i[f].test(e)){
j.unshift(f);
break
}}}
if(j[0] in d){
g=j[0]
}else{
for(f in d){
if(!j[0]||a.converters[f+" "+j[0]]){
g=f;
break
}
h||(h=f)
}
g=g||h
}
if(g){
return g!==j[0]&&j.unshift(g),d[g]
}}
function cD(a,b){
var c,d,e,f,g=a.dataTypes.slice(),h=g[0],i={}
,j=0;
a.dataFilter&&(b=a.dataFilter(b,a.dataType));
if(g[1]){
for(c in a.converters){
i[c.toLowerCase()]=a.converters[c]
}}
for(;
e=g[++j];
){
if(e!=="*"){
if(h!=="*"&&h!==e){
c=i[h+" "+e]||i["* "+e];
if(!c){
for(d in i){
f=d.split(" ");
if(f[1]===e){
c=i[h+" "+f[0]]||i["* "+f[0]];
if(c){
c===!0?c=i[d]:i[d]!==!0&&(e=f[0],g.splice(j--,0,e));
break
}}}}
if(c!==!0){
if(c&&a["throws"]){
b=c(b)
}else{
try{
b=c(b)
}
catch(k){
return{
state:"parsererror",error:c?k:"No conversion from "+h+" to "+e}
}}}}
h=e
}}
return{
state:"success",data:b}
}
function cL(){
try{
return new a.XMLHttpRequest
}
catch(b){}}
function cM(){
try{
return new a.ActiveXObject("Microsoft.XMLHTTP")
}
catch(b){}}
function cU(){
return setTimeout(function(){
cN=b
}
,0),cN=p.now()
}
function cV(a,b){
p.each(b,function(b,c){
var d=(cT[b]||[]).concat(cT["*"]),e=0,f=d.length;
for(;
e<f;
e++){
if(d[e].call(a,b,c)){
return
}}}
)
}
function cW(a,b,c){
var d,e=0,f=0,g=cS.length,h=p.Deferred().always(function(){
delete i.elem
}
),i=function(){
var b=cN||cU(),c=Math.max(0,j.startTime+j.duration-b),d=1-(c/j.duration||0),e=0,f=j.tweens.length;
for(;
e<f;
e++){
j.tweens[e].run(d)
}
return h.notifyWith(a,[j,d,c]),d<1&&f?c:(h.resolveWith(a,[j]),!1)
}
,j=h.promise({
elem:a,props:p.extend({}
,b),opts:p.extend(!0,{
specialEasing:{}}
,c),originalProperties:b,originalOptions:c,startTime:cN||cU(),duration:c.duration,tweens:[],createTween:function(b,c,d){
var e=p.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);
return j.tweens.push(e),e
}
,stop:function(b){
var c=0,d=b?j.tweens.length:0;
for(;
c<d;
c++){
j.tweens[c].run(1)
}
return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this
}}
),k=j.props;
cX(k,j.opts.specialEasing);
for(;
e<g;
e++){
d=cS[e].call(j,a,k,j.opts);
if(d){
return d
}}
return cV(j,k),p.isFunction(j.opts.start)&&j.opts.start.call(a,j),p.fx.timer(p.extend(i,{
anim:j,queue:j.opts.queue,elem:a}
)),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)
}
function cX(a,b){
var c,d,e,f,g;
for(c in a){
d=p.camelCase(c),e=b[d],f=a[c],p.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=p.cssHooks[d];
if(g&&"expand" in g){
f=g.expand(f),delete a[d];
for(c in f){
c in a||(a[c]=f[c],b[c]=e)
}}else{
b[d]=e
}}}
function cY(a,b,c){
var d,e,f,g,h,i,j,k,l=this,m=a.style,n={}
,o=[],q=a.nodeType&&bZ(a);
c.queue||(j=p._queueHooks(a,"fx"),j.unqueued==null&&(j.unqueued=0,k=j.empty.fire,j.empty.fire=function(){
j.unqueued||k()
}
),j.unqueued++,l.always(function(){
l.always(function(){
j.unqueued--,p.queue(a,"fx").length||j.empty.fire()
}
)
}
)),a.nodeType===1&&("height" in b||"width" in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],p.css(a,"display")==="inline"&&p.css(a,"float")==="none"&&(!p.support.inlineBlockNeedsLayout||cc(a.nodeName)==="inline"?m.display="inline-block":m.zoom=1)),c.overflow&&(m.overflow="hidden",p.support.shrinkWrapBlocks||l.done(function(){
m.overflow=c.overflow[0],m.overflowX=c.overflow[1],m.overflowY=c.overflow[2]
}
));
for(d in b){
f=b[d];
if(cP.exec(f)){
delete b[d];
if(f===(q?"hide":"show")){
continue
}
o.push(d)
}}
g=o.length;
if(g){
h=p._data(a,"fxshow")||p._data(a,"fxshow",{}
),q?p(a).show():l.done(function(){
p(a).hide()
}
),l.done(function(){
var b;
p.removeData(a,"fxshow",!0);
for(b in n){
p.style(a,b,n[b])
}}
);
for(d=0;
d<g;
d++){
e=o[d],i=l.createTween(e,q?h[e]:0),n[e]=h[e]||p.style(a,e),e in h||(h[e]=i.start,q&&(i.end=i.start,i.start=e==="width"||e==="height"?1:0))
}}}
function cZ(a,b,c,d,e){
return new cZ.prototype.init(a,b,c,d,e)
}
function c$(a,b){
var c,d={
height:a}
,e=0;
b=b?1:0;
for(;
e<4;
e+=2-b){
c=bV[e],d["margin"+c]=d["padding"+c]=a
}
return b&&(d.opacity=d.width=a),d
}
function da(a){
return p.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1
}
var c,d,e=a.document,f=a.location,g=a.navigator,h=a.jQuery,i=a.$,j=Array.prototype.push,k=Array.prototype.slice,l=Array.prototype.indexOf,m=Object.prototype.toString,n=Object.prototype.hasOwnProperty,o=String.prototype.trim,p=function(a,b){
return new p.fn.init(a,b,c)
}
,q=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,r=/\S/,s=/\s+/,t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,u=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,y=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,z=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,A=/^-ms-/,B=/-([\da-z])/gi,C=function(a,b){
return(b+"").toUpperCase()
}
,D=function(){
e.addEventListener?(e.removeEventListener("DOMContentLoaded",D,!1),p.ready()):e.readyState==="complete"&&(e.detachEvent("onreadystatechange",D),p.ready())
}
,E={};
p.fn=p.prototype={
constructor:p,init:function(a,c,d){
var f,g,h,i;
if(!a){
return this
}
if(a.nodeType){
return this.context=this[0]=a,this.length=1,this
}
if(typeof a=="string"){
a.charAt(0)==="<"&&a.charAt(a.length-1)===">"&&a.length>=3?f=[null,a,null]:f=u.exec(a);
if(f&&(f[1]||!c)){
if(f[1]){
return c=c instanceof p?c[0]:c,i=c&&c.nodeType?c.ownerDocument||c:e,a=p.parseHTML(f[1],i,!0),v.test(f[1])&&p.isPlainObject(c)&&this.attr.call(a,c,!0),p.merge(this,a)
}
g=e.getElementById(f[2]);
if(g&&g.parentNode){
if(g.id!==f[2]){
return d.find(a)
}
this.length=1,this[0]=g
}
return this.context=e,this.selector=a,this
}
return !c||c.jquery?(c||d).find(a):this.constructor(c).find(a)
}
return p.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),p.makeArray(a,this))
}
,selector:"",jquery:"1.8.1",length:0,size:function(){
return this.length
}
,toArray:function(){
return k.call(this)
}
,get:function(a){
return a==null?this.toArray():a<0?this[this.length+a]:this[a]
}
,pushStack:function(a,b,c){
var d=p.merge(this.constructor(),a);
return d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")"),d
}
,each:function(a,b){
return p.each(this,a,b)
}
,ready:function(a){
return p.ready.promise().done(a),this
}
,eq:function(a){
return a=+a,a===-1?this.slice(a):this.slice(a,a+1)
}
,first:function(){
return this.eq(0)
}
,last:function(){
return this.eq(-1)
}
,slice:function(){
return this.pushStack(k.apply(this,arguments),"slice",k.call(arguments).join(","))
}
,map:function(a){
return this.pushStack(p.map(this,function(b,c){
return a.call(b,c,b)
}
))
}
,end:function(){
return this.prevObject||this.constructor(null)
}
,push:j,sort:[].sort,splice:[].splice}
,p.fn.init.prototype=p.fn,p.extend=p.fn.extend=function(){
var a,c,d,e,f,g,h=arguments[0]||{}
,i=1,j=arguments.length,k=!1;
typeof h=="boolean"&&(k=h,h=arguments[1]||{}
,i=2),typeof h!="object"&&!p.isFunction(h)&&(h={}
),j===i&&(h=this,--i);
for(;
i<j;
i++){
if((a=arguments[i])!=null){
for(c in a){
d=h[c],e=a[c];
if(h===e){
continue
}
k&&e&&(p.isPlainObject(e)||(f=p.isArray(e)))?(f?(f=!1,g=d&&p.isArray(d)?d:[]):g=d&&p.isPlainObject(d)?d:{}
,h[c]=p.extend(k,g,e)):e!==b&&(h[c]=e)
}}}
return h
}
,p.extend({
noConflict:function(b){
return a.$===p&&(a.$=i),b&&a.jQuery===p&&(a.jQuery=h),p
}
,isReady:!1,readyWait:1,holdReady:function(a){
a?p.readyWait++:p.ready(!0)
}
,ready:function(a){
if(a===!0?--p.readyWait:p.isReady){
return
}
if(!e.body){
return setTimeout(p.ready,1)
}
p.isReady=!0;
if(a!==!0&&--p.readyWait>0){
return
}
d.resolveWith(e,[p]),p.fn.trigger&&p(e).trigger("ready").off("ready")
}
,isFunction:function(a){
return p.type(a)==="function"
}
,isArray:Array.isArray||function(a){
return p.type(a)==="array"
}
,isWindow:function(a){
return a!=null&&a==a.window
}
,isNumeric:function(a){
return !isNaN(parseFloat(a))&&isFinite(a)
}
,type:function(a){
return a==null?String(a):E[m.call(a)]||"object"
}
,isPlainObject:function(a){
if(!a||p.type(a)!=="object"||a.nodeType||p.isWindow(a)){
return !1
}
try{
if(a.constructor&&!n.call(a,"constructor")&&!n.call(a.constructor.prototype,"isPrototypeOf")){
return !1
}}
catch(c){
return !1
}
var d;
for(d in a){}
return d===b||n.call(a,d)
}
,isEmptyObject:function(a){
var b;
for(b in a){
return !1
}
return !0
}
,error:function(a){
throw new Error(a)
}
,parseHTML:function(a,b,c){
var d;
return !a||typeof a!="string"?null:(typeof b=="boolean"&&(c=b,b=0),b=b||e,(d=v.exec(a))?[b.createElement(d[1])]:(d=p.buildFragment([a],b,c?null:[]),p.merge([],(d.cacheable?p.clone(d.fragment):d.fragment).childNodes)))
}
,parseJSON:function(b){
if(!b||typeof b!="string"){
return null
}
b=p.trim(b);
if(a.JSON&&a.JSON.parse){
return a.JSON.parse(b)
}
if(w.test(b.replace(y,"@").replace(z,"]").replace(x,""))){
return(new Function("return "+b))()
}
p.error("Invalid JSON: "+b)
}
,parseXML:function(c){
var d,e;
if(!c||typeof c!="string"){
return null
}
try{
a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))
}
catch(f){
d=b
}
return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&p.error("Invalid XML: "+c),d
}
,noop:function(){}
,globalEval:function(b){
b&&r.test(b)&&(a.execScript||function(b){
a.eval.call(a,b)
}
)(b)
}
,camelCase:function(a){
return a.replace(A,"ms-").replace(B,C)
}
,nodeName:function(a,b){
return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()
}
,each:function(a,c,d){
var e,f=0,g=a.length,h=g===b||p.isFunction(a);
if(d){
if(h){
for(e in a){
if(c.apply(a[e],d)===!1){
break
}}}else{
for(;
f<g;
){
if(c.apply(a[f++],d)===!1){
break
}}}}else{
if(h){
for(e in a){
if(c.call(a[e],e,a[e])===!1){
break
}}}else{
for(;
f<g;
){
if(c.call(a[f],f,a[f++])===!1){
break
}}}}
return a
}
,trim:o&&!o.call(" ")?function(a){
return a==null?"":o.call(a)
}
:function(a){
return a==null?"":a.toString().replace(t,"")
}
,makeArray:function(a,b){
var c,d=b||[];
return a!=null&&(c=p.type(a),a.length==null||c==="string"||c==="function"||c==="regexp"||p.isWindow(a)?j.call(d,a):p.merge(d,a)),d
}
,inArray:function(a,b,c){
var d;
if(b){
if(l){
return l.call(b,a,c)
}
d=b.length,c=c?c<0?Math.max(0,d+c):c:0;
for(;
c<d;
c++){
if(c in b&&b[c]===a){
return c
}}}
return -1
}
,merge:function(a,c){
var d=c.length,e=a.length,f=0;
if(typeof d=="number"){
for(;
f<d;
f++){
a[e++]=c[f]
}}else{
while(c[f]!==b){
a[e++]=c[f++]
}}
return a.length=e,a
}
,grep:function(a,b,c){
var d,e=[],f=0,g=a.length;
c=!!c;
for(;
f<g;
f++){
d=!!b(a[f],f),c!==d&&e.push(a[f])
}
return e
}
,map:function(a,c,d){
var e,f,g=[],h=0,i=a.length,j=a instanceof p||i!==b&&typeof i=="number"&&(i>0&&a[0]&&a[i-1]||i===0||p.isArray(a));
if(j){
for(;
h<i;
h++){
e=c(a[h],h,d),e!=null&&(g[g.length]=e)
}}else{
for(f in a){
e=c(a[f],f,d),e!=null&&(g[g.length]=e)
}}
return g.concat.apply([],g)
}
,guid:1,proxy:function(a,c){
var d,e,f;
return typeof c=="string"&&(d=a[c],c=a,a=d),p.isFunction(a)?(e=k.call(arguments,2),f=function(){
return a.apply(c,e.concat(k.call(arguments)))
}
,f.guid=a.guid=a.guid||f.guid||p.guid++,f):b
}
,access:function(a,c,d,e,f,g,h){
var i,j=d==null,k=0,l=a.length;
if(d&&typeof d=="object"){
for(k in d){
p.access(a,c,k,d[k],1,g,e)
}
f=1
}else{
if(e!==b){
i=h===b&&p.isFunction(e),j&&(i?(i=c,c=function(a,b,c){
return i.call(p(a),c)
}
):(c.call(a,e),c=null));
if(c){
for(;
k<l;
k++){
c(a[k],d,i?e.call(a[k],k,c(a[k],d)):e,h)
}}
f=1
}}
return f?a:j?c.call(a):l?c(a[0],d):g
}
,now:function(){
return(new Date).getTime()
}}
),p.ready.promise=function(b){
if(!d){
d=p.Deferred();
if(e.readyState==="complete"){
setTimeout(p.ready,1)
}else{
if(e.addEventListener){
e.addEventListener("DOMContentLoaded",D,!1),a.addEventListener("load",p.ready,!1)
}else{
e.attachEvent("onreadystatechange",D),a.attachEvent("onload",p.ready);
var c=!1;
try{
c=a.frameElement==null&&e.documentElement
}
catch(f){}
c&&c.doScroll&&function g(){
if(!p.isReady){
try{
c.doScroll("left")
}
catch(a){
return setTimeout(g,50)
}
p.ready()
}}
()
}}}
return d.promise(b)
}
,p.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){
E["[object "+b+"]"]=b.toLowerCase()
}
),c=p(e);
var F={};
p.Callbacks=function(a){
a=typeof a=="string"?F[a]||G(a):p.extend({}
,a);
var c,d,e,f,g,h,i=[],j=!a.once&&[],k=function(b){
c=a.memory&&b,d=!0,h=f||0,f=0,g=i.length,e=!0;
for(;
i&&h<g;
h++){
if(i[h].apply(b[0],b[1])===!1&&a.stopOnFalse){
c=!1;
break
}}
e=!1,i&&(j?j.length&&k(j.shift()):c?i=[]:l.disable())
}
,l={
add:function(){
if(i){
var b=i.length;
(function d(b){
p.each(b,function(b,c){
var e=p.type(c);
e==="function"&&(!a.unique||!l.has(c))?i.push(c):c&&c.length&&e!=="string"&&d(c)
}
)
}
)(arguments),e?g=i.length:c&&(f=b,k(c))
}
return this
}
,remove:function(){
return i&&p.each(arguments,function(a,b){
var c;
while((c=p.inArray(b,i,c))>-1){
i.splice(c,1),e&&(c<=g&&g--,c<=h&&h--)
}}
),this
}
,has:function(a){
return p.inArray(a,i)>-1
}
,empty:function(){
return i=[],this
}
,disable:function(){
return i=j=c=b,this
}
,disabled:function(){
return !i
}
,lock:function(){
return j=b,c||l.disable(),this
}
,locked:function(){
return !j
}
,fireWith:function(a,b){
return b=b||[],b=[a,b.slice?b.slice():b],i&&(!d||j)&&(e?j.push(b):k(b)),this
}
,fire:function(){
return l.fireWith(this,arguments),this
}
,fired:function(){
return !!d
}};
return l
}
,p.extend({
Deferred:function(a){
var b=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],c="pending",d={
state:function(){
return c
}
,always:function(){
return e.done(arguments).fail(arguments),this
}
,then:function(){
var a=arguments;
return p.Deferred(function(c){
p.each(b,function(b,d){
var f=d[0],g=a[b];
e[d[1]](p.isFunction(g)?function(){
var a=g.apply(this,arguments);
a&&p.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])
}
:c[f])
}
),a=null
}
).promise()
}
,promise:function(a){
return typeof a=="object"?p.extend(a,d):d
}}
,e={};
return d.pipe=d.then,p.each(b,function(a,f){
var g=f[2],h=f[3];
d[f[1]]=g.add,h&&g.add(function(){
c=h
}
,b[a^1][2].disable,b[2][2].lock),e[f[0]]=g.fire,e[f[0]+"With"]=g.fireWith
}
),d.promise(e),a&&a.call(e,e),e
}
,when:function(a){
var b=0,c=k.call(arguments),d=c.length,e=d!==1||a&&p.isFunction(a.promise)?d:0,f=e===1?a:p.Deferred(),g=function(a,b,c){
return function(d){
b[a]=this,c[a]=arguments.length>1?k.call(arguments):d,c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)
}
}
,h,i,j;
if(d>1){
h=new Array(d),i=new Array(d),j=new Array(d);
for(;
b<d;
b++){
c[b]&&p.isFunction(c[b].promise)?c[b].promise().done(g(b,j,c)).fail(f.reject).progress(g(b,i,h)):--e
}}
return e||f.resolveWith(j,c),f.promise()
}}
),p.support=function(){
var b,c,d,f,g,h,i,j,k,l,m,n=e.createElement("div");
n.setAttribute("className","t"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=n.getElementsByTagName("*"),d=n.getElementsByTagName("a")[0],d.style.cssText="top:1px;float:left;opacity:.5";
if(!c||!c.length||!d){
return{}
}
f=e.createElement("select"),g=f.appendChild(e.createElement("option")),h=n.getElementsByTagName("input")[0],b={
leadingWhitespace:n.firstChild.nodeType===3,tbody:!n.getElementsByTagName("tbody").length,htmlSerialize:!!n.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:d.getAttribute("href")==="/a",opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:h.value==="on",optSelected:g.selected,getSetAttribute:n.className!=="t",enctype:!!e.createElement("form").enctype,html5Clone:e.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:e.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1}
,h.checked=!0,b.noCloneChecked=h.cloneNode(!0).checked,f.disabled=!0,b.optDisabled=!g.disabled;
try{
delete n.test
}
catch(o){
b.deleteExpando=!1
}
!n.addEventListener&&n.attachEvent&&n.fireEvent&&(n.attachEvent("onclick",m=function(){
b.noCloneEvent=!1
}
),n.cloneNode(!0).fireEvent("onclick"),n.detachEvent("onclick",m)),h=e.createElement("input"),h.value="t",h.setAttribute("type","radio"),b.radioValue=h.value==="t",h.setAttribute("checked","checked"),h.setAttribute("name","t"),n.appendChild(h),i=e.createDocumentFragment(),i.appendChild(n.lastChild),b.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=h.checked,i.removeChild(h),i.appendChild(n);
if(n.attachEvent){
for(k in {
submit:!0,change:!0,focusin:!0}
){
j="on"+k,l=j in n,l||(n.setAttribute(j,"return;"),l=typeof n[j]=="function"),b[k+"Bubbles"]=l
}}
return p(function(){
var c,d,f,g,h="padding:0;margin:0;border:0;display:block;overflow:hidden;",i=e.getElementsByTagName("body")[0];
if(!i){
return
}
c=e.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",i.insertBefore(c,i.firstChild),d=e.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",f=d.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",l=f[0].offsetHeight===0,f[0].style.display="",f[1].style.display="none",b.reliableHiddenOffsets=l&&f[0].offsetHeight===0,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",b.boxSizing=d.offsetWidth===4,b.doesNotIncludeMarginInBodyOffset=i.offsetTop!==1,a.getComputedStyle&&(b.pixelPosition=(a.getComputedStyle(d,null)||{}
).top!=="1%",b.boxSizingReliable=(a.getComputedStyle(d,null)||{
width:"4px"}
).width==="4px",g=e.createElement("div"),g.style.cssText=d.style.cssText=h,g.style.marginRight=g.style.width="0",d.style.width="1px",d.appendChild(g),b.reliableMarginRight=!parseFloat((a.getComputedStyle(g,null)||{}
).marginRight)),typeof d.style.zoom!="undefined"&&(d.innerHTML="",d.style.cssText=h+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=d.offsetWidth===3,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=d.offsetWidth!==3,c.style.zoom=1),i.removeChild(c),c=d=f=g=null
}
),i.removeChild(n),c=d=f=g=h=i=n=null,b
}
();
var H=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,I=/([A-Z])/g;
p.extend({
cache:{}
,deletedIds:[],uuid:0,expando:"jQuery"+(p.fn.jquery+Math.random()).replace(/\D/g,""),noData:{
embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0}
,hasData:function(a){
return a=a.nodeType?p.cache[a[p.expando]]:a[p.expando],!!a&&!K(a)
}
,data:function(a,c,d,e){
if(!p.acceptData(a)){
return
}
var f,g,h=p.expando,i=typeof c=="string",j=a.nodeType,k=j?p.cache:a,l=j?a[h]:a[h]&&h;
if((!l||!k[l]||!e&&!k[l].data)&&i&&d===b){
return
}
l||(j?a[h]=l=p.deletedIds.pop()||++p.uuid:l=h),k[l]||(k[l]={}
,j||(k[l].toJSON=p.noop));
if(typeof c=="object"||typeof c=="function"){
e?k[l]=p.extend(k[l],c):k[l].data=p.extend(k[l].data,c)
}
return f=k[l],e||(f.data||(f.data={}
),f=f.data),d!==b&&(f[p.camelCase(c)]=d),i?(g=f[c],g==null&&(g=f[p.camelCase(c)])):g=f,g
}
,removeData:function(a,b,c){
if(!p.acceptData(a)){
return
}
var d,e,f,g=a.nodeType,h=g?p.cache:a,i=g?a[p.expando]:p.expando;
if(!h[i]){
return
}
if(b){
d=c?h[i]:h[i].data;
if(d){
p.isArray(b)||(b in d?b=[b]:(b=p.camelCase(b),b in d?b=[b]:b=b.split(" ")));
for(e=0,f=b.length;
e<f;
e++){
delete d[b[e]]
}
if(!(c?K:p.isEmptyObject)(d)){
return
}}}
if(!c){
delete h[i].data;
if(!K(h[i])){
return
}}
g?p.cleanData([a],!0):p.support.deleteExpando||h!=h.window?delete h[i]:h[i]=null
}
,_data:function(a,b,c){
return p.data(a,b,c,!0)
}
,acceptData:function(a){
var b=a.nodeName&&p.noData[a.nodeName.toLowerCase()];
return !b||b!==!0&&a.getAttribute("classid")===b
}}
),p.fn.extend({
data:function(a,c){
var d,e,f,g,h,i=this[0],j=0,k=null;
if(a===b){
if(this.length){
k=p.data(i);
if(i.nodeType===1&&!p._data(i,"parsedAttrs")){
f=i.attributes;
for(h=f.length;
j<h;
j++){
g=f[j].name,g.indexOf("data-")===0&&(g=p.camelCase(g.substring(5)),J(i,g,k[g]))
}
p._data(i,"parsedAttrs",!0)
}}
return k
}
return typeof a=="object"?this.each(function(){
p.data(this,a)
}
):(d=a.split(".",2),d[1]=d[1]?"."+d[1]:"",e=d[1]+"!",p.access(this,function(c){
if(c===b){
return k=this.triggerHandler("getData"+e,[d[0]]),k===b&&i&&(k=p.data(i,a),k=J(i,a,k)),k===b&&d[1]?this.data(d[0]):k
}
d[1]=c,this.each(function(){
var b=p(this);
b.triggerHandler("setData"+e,d),p.data(this,a,c),b.triggerHandler("changeData"+e,d)
}
)
}
,null,c,arguments.length>1,null,!1))
}
,removeData:function(a){
return this.each(function(){
p.removeData(this,a)
}
)
}}
),p.extend({
queue:function(a,b,c){
var d;
if(a){
return b=(b||"fx")+"queue",d=p._data(a,b),c&&(!d||p.isArray(c)?d=p._data(a,b,p.makeArray(c)):d.push(c)),d||[]
}}
,dequeue:function(a,b){
b=b||"fx";
var c=p.queue(a,b),d=c.length,e=c.shift(),f=p._queueHooks(a,b),g=function(){
p.dequeue(a,b)
};
e==="inprogress"&&(e=c.shift(),d--),e&&(b==="fx"&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()
}
,_queueHooks:function(a,b){
var c=b+"queueHooks";
return p._data(a,c)||p._data(a,c,{
empty:p.Callbacks("once memory").add(function(){
p.removeData(a,b+"queue",!0),p.removeData(a,c,!0)
}
)}
)
}}
),p.fn.extend({
queue:function(a,c){
var d=2;
return typeof a!="string"&&(c=a,a="fx",d--),arguments.length<d?p.queue(this[0],a):c===b?this:this.each(function(){
var b=p.queue(this,a,c);
p._queueHooks(this,a),a==="fx"&&b[0]!=="inprogress"&&p.dequeue(this,a)
}
)
}
,dequeue:function(a){
return this.each(function(){
p.dequeue(this,a)
}
)
}
,delay:function(a,b){
return a=p.fx?p.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){
var d=setTimeout(b,a);
c.stop=function(){
clearTimeout(d)
}
}
)
}
,clearQueue:function(a){
return this.queue(a||"fx",[])
}
,promise:function(a,c){
var d,e=1,f=p.Deferred(),g=this,h=this.length,i=function(){
--e||f.resolveWith(g,[g])
};
typeof a!="string"&&(c=a,a=b),a=a||"fx";
while(h--){
d=p._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i))
}
return i(),f.promise(c)
}}
);
var L,M,N,O=/[\t\r\n]/g,P=/\r/g,Q=/^(?:button|input)$/i,R=/^(?:button|input|object|select|textarea)$/i,S=/^a(?:rea|)$/i,T=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,U=p.support.getSetAttribute;
p.fn.extend({
attr:function(a,b){
return p.access(this,p.attr,a,b,arguments.length>1)
}
,removeAttr:function(a){
return this.each(function(){
p.removeAttr(this,a)
}
)
}
,prop:function(a,b){
return p.access(this,p.prop,a,b,arguments.length>1)
}
,removeProp:function(a){
return a=p.propFix[a]||a,this.each(function(){
try{
this[a]=b,delete this[a]
}
catch(c){}}
)
}
,addClass:function(a){
var b,c,d,e,f,g,h;
if(p.isFunction(a)){
return this.each(function(b){
p(this).addClass(a.call(this,b,this.className))
}
)
}
if(a&&typeof a=="string"){
b=a.split(s);
for(c=0,d=this.length;
c<d;
c++){
e=this[c];
if(e.nodeType===1){
if(!e.className&&b.length===1){
e.className=a
}else{
f=" "+e.className+" ";
for(g=0,h=b.length;
g<h;
g++){
~f.indexOf(" "+b[g]+" ")||(f+=b[g]+" ")
}
e.className=p.trim(f)
}}}}
return this
}
,removeClass:function(a){
var c,d,e,f,g,h,i;
if(p.isFunction(a)){
return this.each(function(b){
p(this).removeClass(a.call(this,b,this.className))
}
)
}
if(a&&typeof a=="string"||a===b){
c=(a||"").split(s);
for(h=0,i=this.length;
h<i;
h++){
e=this[h];
if(e.nodeType===1&&e.className){
d=(" "+e.className+" ").replace(O," ");
for(f=0,g=c.length;
f<g;
f++){
while(d.indexOf(" "+c[f]+" ")>-1){
d=d.replace(" "+c[f]+" "," ")
}}
e.className=a?p.trim(d):""
}}}
return this
}
,toggleClass:function(a,b){
var c=typeof a,d=typeof b=="boolean";
return p.isFunction(a)?this.each(function(c){
p(this).toggleClass(a.call(this,c,this.className,b),b)
}
):this.each(function(){
if(c==="string"){
var e,f=0,g=p(this),h=b,i=a.split(s);
while(e=i[f++]){
h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e)
}}else{
if(c==="undefined"||c==="boolean"){
this.className&&p._data(this,"__className__",this.className),this.className=this.className||a===!1?"":p._data(this,"__className__")||""
}}}
)
}
,hasClass:function(a){
var b=" "+a+" ",c=0,d=this.length;
for(;
c<d;
c++){
if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(O," ").indexOf(b)>-1){
return !0
}}
return !1
}
,val:function(a){
var c,d,e,f=this[0];
if(!arguments.length){
if(f){
return c=p.valHooks[f.type]||p.valHooks[f.nodeName.toLowerCase()],c&&"get" in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,typeof d=="string"?d.replace(P,""):d==null?"":d)
}
return
}
return e=p.isFunction(a),this.each(function(d){
var f,g=p(this);
if(this.nodeType!==1){
return
}
e?f=a.call(this,d,g.val()):f=a,f==null?f="":typeof f=="number"?f+="":p.isArray(f)&&(f=p.map(f,function(a){
return a==null?"":a+""
}
)),c=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()];
if(!c||!("set" in c)||c.set(this,f,"value")===b){
this.value=f
}}
)
}}
),p.extend({
valHooks:{
option:{
get:function(a){
var b=a.attributes.value;
return !b||b.specified?a.value:a.text
}}
,select:{
get:function(a){
var b,c,d,e,f=a.selectedIndex,g=[],h=a.options,i=a.type==="select-one";
if(f<0){
return null
}
c=i?f:0,d=i?f+1:h.length;
for(;
c<d;
c++){
e=h[c];
if(e.selected&&(p.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!p.nodeName(e.parentNode,"optgroup"))){
b=p(e).val();
if(i){
return b
}
g.push(b)
}}
return i&&!g.length&&h.length?p(h[f]).val():g
}
,set:function(a,b){
var c=p.makeArray(b);
return p(a).find("option").each(function(){
this.selected=p.inArray(p(this).val(),c)>=0
}
),c.length||(a.selectedIndex=-1),c
}}}
,attrFn:{}
,attr:function(a,c,d,e){
var f,g,h,i=a.nodeType;
if(!a||i===3||i===8||i===2){
return
}
if(e&&p.isFunction(p.fn[c])){
return p(a)[c](d)
}
if(typeof a.getAttribute=="undefined"){
return p.prop(a,c,d)
}
h=i!==1||!p.isXMLDoc(a),h&&(c=c.toLowerCase(),g=p.attrHooks[c]||(T.test(c)?M:L));
if(d!==b){
if(d===null){
p.removeAttr(a,c);
return
}
return g&&"set" in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,""+d),d)
}
return g&&"get" in g&&h&&(f=g.get(a,c))!==null?f:(f=a.getAttribute(c),f===null?b:f)
}
,removeAttr:function(a,b){
var c,d,e,f,g=0;
if(b&&a.nodeType===1){
d=b.split(s);
for(;
g<d.length;
g++){
e=d[g],e&&(c=p.propFix[e]||e,f=T.test(e),f||p.attr(a,e,""),a.removeAttribute(U?e:c),f&&c in a&&(a[c]=!1))
}}}
,attrHooks:{
type:{
set:function(a,b){
if(Q.test(a.nodeName)&&a.parentNode){
p.error("type property can't be changed")
}else{
if(!p.support.radioValue&&b==="radio"&&p.nodeName(a,"input")){
var c=a.value;
return a.setAttribute("type",b),c&&(a.value=c),b
}}}}
,value:{
get:function(a,b){
return L&&p.nodeName(a,"button")?L.get(a,b):b in a?a.value:null
}
,set:function(a,b,c){
if(L&&p.nodeName(a,"button")){
return L.set(a,b,c)
}
a.value=b
}}}
,propFix:{
tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"}
,prop:function(a,c,d){
var e,f,g,h=a.nodeType;
if(!a||h===3||h===8||h===2){
return
}
return g=h!==1||!p.isXMLDoc(a),g&&(c=p.propFix[c]||c,f=p.propHooks[c]),d!==b?f&&"set" in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get" in f&&(e=f.get(a,c))!==null?e:a[c]
}
,propHooks:{
tabIndex:{
get:function(a){
var c=a.getAttributeNode("tabindex");
return c&&c.specified?parseInt(c.value,10):R.test(a.nodeName)||S.test(a.nodeName)&&a.href?0:b
}}}}
),M={
get:function(a,c){
var d,e=p.prop(a,c);
return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b
}
,set:function(a,b,c){
var d;
return b===!1?p.removeAttr(a,c):(d=p.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c
}}
,U||(N={
name:!0,id:!0,coords:!0}
,L=p.valHooks.button={
get:function(a,c){
var d;
return d=a.getAttributeNode(c),d&&(N[c]?d.value!=="":d.specified)?d.value:b
}
,set:function(a,b,c){
var d=a.getAttributeNode(c);
return d||(d=e.createAttribute(c),a.setAttributeNode(d)),d.value=b+""
}}
,p.each(["width","height"],function(a,b){
p.attrHooks[b]=p.extend(p.attrHooks[b],{
set:function(a,c){
if(c===""){
return a.setAttribute(b,"auto"),c
}}}
)
}
),p.attrHooks.contenteditable={
get:L.get,set:function(a,b,c){
b===""&&(b="false"),L.set(a,b,c)
}}
),p.support.hrefNormalized||p.each(["href","src","width","height"],function(a,c){
p.attrHooks[c]=p.extend(p.attrHooks[c],{
get:function(a){
var d=a.getAttribute(c,2);
return d===null?b:d
}}
)
}
),p.support.style||(p.attrHooks.style={
get:function(a){
return a.style.cssText.toLowerCase()||b
}
,set:function(a,b){
return a.style.cssText=""+b
}}
),p.support.optSelected||(p.propHooks.selected=p.extend(p.propHooks.selected,{
get:function(a){
var b=a.parentNode;
return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null
}}
)),p.support.enctype||(p.propFix.enctype="encoding"),p.support.checkOn||p.each(["radio","checkbox"],function(){
p.valHooks[this]={
get:function(a){
return a.getAttribute("value")===null?"on":a.value
}}
}
),p.each(["radio","checkbox"],function(){
p.valHooks[this]=p.extend(p.valHooks[this],{
set:function(a,b){
if(p.isArray(b)){
return a.checked=p.inArray(p(a).val(),b)>=0
}}}
)
}
);
var V=/^(?:textarea|input|select)$/i,W=/^([^\.]*|)(?:\.(.+)|)$/,X=/(?:^|\s)hover(\.\S+|)\b/,Y=/^key/,Z=/^(?:mouse|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=function(a){
return p.event.special.hover?a:a.replace(X,"mouseenter$1 mouseleave$1")
};
p.event={
add:function(a,c,d,e,f){
var g,h,i,j,k,l,m,n,o,q,r;
if(a.nodeType===3||a.nodeType===8||!c||!d||!(g=p._data(a))){
return
}
d.handler&&(o=d,d=o.handler,f=o.selector),d.guid||(d.guid=p.guid++),i=g.events,i||(g.events=i={}
),h=g.handle,h||(g.handle=h=function(a){
return typeof p!="undefined"&&(!a||p.event.triggered!==a.type)?p.event.dispatch.apply(h.elem,arguments):b
}
,h.elem=a),c=p.trim(_(c)).split(" ");
for(j=0;
j<c.length;
j++){
k=W.exec(c[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),r=p.event.special[l]||{}
,l=(f?r.delegateType:r.bindType)||l,r=p.event.special[l]||{}
,n=p.extend({
type:l,origType:k[1],data:e,handler:d,guid:d.guid,selector:f,namespace:m.join(".")}
,o),q=i[l];
if(!q){
q=i[l]=[],q.delegateCount=0;
if(!r.setup||r.setup.call(a,e,m,h)===!1){
a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h)
}}
r.add&&(r.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?q.splice(q.delegateCount++,0,n):q.push(n),p.event.global[l]=!0
}
a=null
}
,global:{}
,remove:function(a,b,c,d,e){
var f,g,h,i,j,k,l,m,n,o,q,r=p.hasData(a)&&p._data(a);
if(!r||!(m=r.events)){
return
}
b=p.trim(_(b||"")).split(" ");
for(f=0;
f<b.length;
f++){
g=W.exec(b[f])||[],h=i=g[1],j=g[2];
if(!h){
for(h in m){
p.event.remove(a,h+b[f],c,d,!0)
}
continue
}
n=p.event.special[h]||{}
,h=(d?n.delegateType:n.bindType)||h,o=m[h]||[],k=o.length,j=j?new RegExp("(^|\\.)"+j.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;
for(l=0;
l<o.length;
l++){
q=o[l],(e||i===q.origType)&&(!c||c.guid===q.guid)&&(!j||j.test(q.namespace))&&(!d||d===q.selector||d==="**"&&q.selector)&&(o.splice(l--,1),q.selector&&o.delegateCount--,n.remove&&n.remove.call(a,q))
}
o.length===0&&k!==o.length&&((!n.teardown||n.teardown.call(a,j,r.handle)===!1)&&p.removeEvent(a,h,r.handle),delete m[h])
}
p.isEmptyObject(m)&&(delete r.handle,p.removeData(a,"events",!0))
}
,customEvent:{
getData:!0,setData:!0,changeData:!0}
,trigger:function(c,d,f,g){
if(!f||f.nodeType!==3&&f.nodeType!==8){
var h,i,j,k,l,m,n,o,q,r,s=c.type||c,t=[];
if($.test(s+p.event.triggered)){
return
}
s.indexOf("!")>=0&&(s=s.slice(0,-1),i=!0),s.indexOf(".")>=0&&(t=s.split("."),s=t.shift(),t.sort());
if((!f||p.event.customEvent[s])&&!p.event.global[s]){
return
}
c=typeof c=="object"?c[p.expando]?c:new p.Event(s,c):new p.Event(s),c.type=s,c.isTrigger=!0,c.exclusive=i,c.namespace=t.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+t.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,m=s.indexOf(":")<0?"on"+s:"";
if(!f){
h=p.cache;
for(j in h){
h[j].events&&h[j].events[s]&&p.event.trigger(c,d,h[j].handle.elem,!0)
}
return
}
c.result=b,c.target||(c.target=f),d=d!=null?p.makeArray(d):[],d.unshift(c),n=p.event.special[s]||{};
if(n.trigger&&n.trigger.apply(f,d)===!1){
return
}
q=[[f,n.bindType||s]];
if(!g&&!n.noBubble&&!p.isWindow(f)){
r=n.delegateType||s,k=$.test(r+s)?f:f.parentNode;
for(l=f;
k;
k=k.parentNode){
q.push([k,r]),l=k
}
l===(f.ownerDocument||e)&&q.push([l.defaultView||l.parentWindow||a,r])
}
for(j=0;
j<q.length&&!c.isPropagationStopped();
j++){
k=q[j][0],c.type=q[j][1],o=(p._data(k,"events")||{}
)[c.type]&&p._data(k,"handle"),o&&o.apply(k,d),o=m&&k[m],o&&p.acceptData(k)&&o.apply(k,d)===!1&&c.preventDefault()
}
return c.type=s,!g&&!c.isDefaultPrevented()&&(!n._default||n._default.apply(f.ownerDocument,d)===!1)&&(s!=="click"||!p.nodeName(f,"a"))&&p.acceptData(f)&&m&&f[s]&&(s!=="focus"&&s!=="blur"||c.target.offsetWidth!==0)&&!p.isWindow(f)&&(l=f[m],l&&(f[m]=null),p.event.triggered=s,f[s](),p.event.triggered=b,l&&(f[m]=l)),c.result
}
return
}
,dispatch:function(c){
c=p.event.fix(c||a.event);
var d,e,f,g,h,i,j,k,l,m,n=(p._data(this,"events")||{}
)[c.type]||[],o=n.delegateCount,q=[].slice.call(arguments),r=!c.exclusive&&!c.namespace,s=p.event.special[c.type]||{}
,t=[];
q[0]=c,c.delegateTarget=this;
if(s.preDispatch&&s.preDispatch.call(this,c)===!1){
return
}
if(o&&(!c.button||c.type!=="click")){
for(f=c.target;
f!=this;
f=f.parentNode||this){
if(f.disabled!==!0||c.type!=="click"){
h={}
,j=[];
for(d=0;
d<o;
d++){
k=n[d],l=k.selector,h[l]===b&&(h[l]=p(l,this).index(f)>=0),h[l]&&j.push(k)
}
j.length&&t.push({
elem:f,matches:j}
)
}}}
n.length>o&&t.push({
elem:this,matches:n.slice(o)}
);
for(d=0;
d<t.length&&!c.isPropagationStopped();
d++){
i=t[d],c.currentTarget=i.elem;
for(e=0;
e<i.matches.length&&!c.isImmediatePropagationStopped();
e++){
k=i.matches[e];
if(r||!c.namespace&&!k.namespace||c.namespace_re&&c.namespace_re.test(k.namespace)){
c.data=k.data,c.handleObj=k,g=((p.event.special[k.origType]||{}
).handle||k.handler).apply(i.elem,q),g!==b&&(c.result=g,g===!1&&(c.preventDefault(),c.stopPropagation()))
}}}
return s.postDispatch&&s.postDispatch.call(this,c),c.result
}
,props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{}
,keyHooks:{
props:"char charCode key keyCode".split(" "),filter:function(a,b){
return a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode),a
}}
,mouseHooks:{
props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){
var d,f,g,h=c.button,i=c.fromElement;
return a.pageX==null&&c.clientX!=null&&(d=a.target.ownerDocument||e,f=d.documentElement,g=d.body,a.pageX=c.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=c.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?c.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0),a
}}
,fix:function(a){
if(a[p.expando]){
return a
}
var b,c,d=a,f=p.event.fixHooks[a.type]||{}
,g=f.props?this.props.concat(f.props):this.props;
a=p.Event(d);
for(b=g.length;
b;
){
c=g[--b],a[c]=d[c]
}
return a.target||(a.target=d.srcElement||e),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,f.filter?f.filter(a,d):a
}
,special:{
load:{
noBubble:!0}
,focus:{
delegateType:"focusin"}
,blur:{
delegateType:"focusout"}
,beforeunload:{
setup:function(a,b,c){
p.isWindow(this)&&(this.onbeforeunload=c)
}
,teardown:function(a,b){
this.onbeforeunload===b&&(this.onbeforeunload=null)
}}}
,simulate:function(a,b,c,d){
var e=p.extend(new p.Event,c,{
type:a,isSimulated:!0,originalEvent:{}}
);
d?p.event.trigger(e,null,b):p.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()
}}
,p.event.handle=p.event.dispatch,p.removeEvent=e.removeEventListener?function(a,b,c){
a.removeEventListener&&a.removeEventListener(b,c,!1)
}
:function(a,b,c){
var d="on"+b;
a.detachEvent&&(typeof a[d]=="undefined"&&(a[d]=null),a.detachEvent(d,c))
}
,p.Event=function(a,b){
if(this instanceof p.Event){
a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?bb:ba):this.type=a,b&&p.extend(this,b),this.timeStamp=a&&a.timeStamp||p.now(),this[p.expando]=!0
}else{
return new p.Event(a,b)
}}
,p.Event.prototype={
preventDefault:function(){
this.isDefaultPrevented=bb;
var a=this.originalEvent;
if(!a){
return
}
a.preventDefault?a.preventDefault():a.returnValue=!1
}
,stopPropagation:function(){
this.isPropagationStopped=bb;
var a=this.originalEvent;
if(!a){
return
}
a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0
}
,stopImmediatePropagation:function(){
this.isImmediatePropagationStopped=bb,this.stopPropagation()
}
,isDefaultPrevented:ba,isPropagationStopped:ba,isImmediatePropagationStopped:ba}
,p.each({
mouseenter:"mouseover",mouseleave:"mouseout"}
,function(a,b){
p.event.special[a]={
delegateType:b,bindType:b,handle:function(a){
var c,d=this,e=a.relatedTarget,f=a.handleObj,g=f.selector;
if(!e||e!==d&&!p.contains(d,e)){
a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b
}
return c
}}
}
),p.support.submitBubbles||(p.event.special.submit={
setup:function(){
if(p.nodeName(this,"form")){
return !1
}
p.event.add(this,"click._submit keypress._submit",function(a){
var c=a.target,d=p.nodeName(c,"input")||p.nodeName(c,"button")?c.form:b;
d&&!p._data(d,"_submit_attached")&&(p.event.add(d,"submit._submit",function(a){
a._submit_bubble=!0
}
),p._data(d,"_submit_attached",!0))
}
)
}
,postDispatch:function(a){
a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&p.event.simulate("submit",this.parentNode,a,!0))
}
,teardown:function(){
if(p.nodeName(this,"form")){
return !1
}
p.event.remove(this,"._submit")
}}
),p.support.changeBubbles||(p.event.special.change={
setup:function(){
if(V.test(this.nodeName)){
if(this.type==="checkbox"||this.type==="radio"){
p.event.add(this,"propertychange._change",function(a){
a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)
}
),p.event.add(this,"click._change",function(a){
this._just_changed&&!a.isTrigger&&(this._just_changed=!1),p.event.simulate("change",this,a,!0)
}
)
}
return !1
}
p.event.add(this,"beforeactivate._change",function(a){
var b=a.target;
V.test(b.nodeName)&&!p._data(b,"_change_attached")&&(p.event.add(b,"change._change",function(a){
this.parentNode&&!a.isSimulated&&!a.isTrigger&&p.event.simulate("change",this.parentNode,a,!0)
}
),p._data(b,"_change_attached",!0))
}
)
}
,handle:function(a){
var b=a.target;
if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox"){
return a.handleObj.handler.apply(this,arguments)
}}
,teardown:function(){
return p.event.remove(this,"._change"),!V.test(this.nodeName)
}}
),p.support.focusinBubbles||p.each({
focus:"focusin",blur:"focusout"}
,function(a,b){
var c=0,d=function(a){
p.event.simulate(b,a.target,p.event.fix(a),!0)
};
p.event.special[b]={
setup:function(){
c++===0&&e.addEventListener(a,d,!0)
}
,teardown:function(){
--c===0&&e.removeEventListener(a,d,!0)
}}
}
),p.fn.extend({
on:function(a,c,d,e,f){
var g,h;
if(typeof a=="object"){
typeof c!="string"&&(d=d||c,c=b);
for(h in a){
this.on(h,c,d,a[h],f)
}
return this
}
d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));
if(e===!1){
e=ba
}else{
if(!e){
return this
}}
return f===1&&(g=e,e=function(a){
return p().off(a),g.apply(this,arguments)
}
,e.guid=g.guid||(g.guid=p.guid++)),this.each(function(){
p.event.add(this,a,e,d,c)
}
)
}
,one:function(a,b,c,d){
return this.on(a,b,c,d,1)
}
,off:function(a,c,d){
var e,f;
if(a&&a.preventDefault&&a.handleObj){
return e=a.handleObj,p(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this
}
if(typeof a=="object"){
for(f in a){
this.off(f,c,a[f])
}
return this
}
if(c===!1||typeof c=="function"){
d=c,c=b
}
return d===!1&&(d=ba),this.each(function(){
p.event.remove(this,a,d,c)
}
)
}
,bind:function(a,b,c){
return this.on(a,null,b,c)
}
,unbind:function(a,b){
return this.off(a,null,b)
}
,live:function(a,b,c){
return p(this.context).on(a,this.selector,b,c),this
}
,die:function(a,b){
return p(this.context).off(a,this.selector||"**",b),this
}
,delegate:function(a,b,c,d){
return this.on(b,a,c,d)
}
,undelegate:function(a,b,c){
return arguments.length==1?this.off(a,"**"):this.off(b,a||"**",c)
}
,trigger:function(a,b){
return this.each(function(){
p.event.trigger(a,b,this)
}
)
}
,triggerHandler:function(a,b){
if(this[0]){
return p.event.trigger(a,b,this[0],!0)
}}
,toggle:function(a){
var b=arguments,c=a.guid||p.guid++,d=0,e=function(c){
var e=(p._data(this,"lastToggle"+a.guid)||0)%d;
return p._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1
};
e.guid=c;
while(d<b.length){
b[d++].guid=c
}
return this.click(e)
}
,hover:function(a,b){
return this.mouseenter(a).mouseleave(b||a)
}}
),p.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){
p.fn[b]=function(a,c){
return c==null&&(c=a,a=null),arguments.length>0?this.on(b,null,a,c):this.trigger(b)
}
,Y.test(b)&&(p.event.fixHooks[b]=p.event.keyHooks),Z.test(b)&&(p.event.fixHooks[b]=p.event.mouseHooks)
}
),function(a,b){
function $(a,b,c,d){
c=c||[],b=b||q;
var e,f,g,j,k=b.nodeType;
if(k!==1&&k!==9){
return[]
}
if(!a||typeof a!="string"){
return c
}
g=h(b);
if(!g&&!d){
if(e=L.exec(a)){
if(j=e[1]){
if(k===9){
f=b.getElementById(j);
if(!f||!f.parentNode){
return c
}
if(f.id===j){
return c.push(f),c
}}else{
if(b.ownerDocument&&(f=b.ownerDocument.getElementById(j))&&i(b,f)&&f.id===j){
return c.push(f),c
}}}else{
if(e[2]){
return u.apply(c,t.call(b.getElementsByTagName(a),0)),c
}
if((j=e[3])&&X&&b.getElementsByClassName){
return u.apply(c,t.call(b.getElementsByClassName(j),0)),c
}}}}
return bk(a,b,c,d,g)
}
function _(a){
return function(b){
var c=b.nodeName.toLowerCase();
return c==="input"&&b.type===a
}
}
function ba(a){
return function(b){
var c=b.nodeName.toLowerCase();
return(c==="input"||c==="button")&&b.type===a
}
}
function bb(a,b,c){
if(a===b){
return c
}
var d=a.nextSibling;
while(d){
if(d===b){
return -1
}
d=d.nextSibling
}
return 1
}
function bc(a,b,c,d){
var e,g,h,i,j,k,l,m,n,p,r=!c&&b!==q,s=(r?"<s>":"")+a.replace(H,"$1<s>"),u=y[o][s];
if(u){
return d?0:t.call(u,0)
}
j=a,k=[],m=0,n=f.preFilter,p=f.filter;
while(j){
if(!e||(g=I.exec(j))){
g&&(j=j.slice(g[0].length),h.selector=l),k.push(h=[]),l="",r&&(j=" "+j)
}
e=!1;
if(g=J.exec(j)){
l+=g[0],j=j.slice(g[0].length),e=h.push({
part:g.pop().replace(H," "),string:g[0],captures:g}
)
}
for(i in p){
(g=S[i].exec(j))&&(!n[i]||(g=n[i](g,b,c)))&&(l+=g[0],j=j.slice(g[0].length),e=h.push({
part:i,string:g.shift(),captures:g}
))
}
if(!e){
break
}}
return l&&(h.selector=l),d?j.length:j?$.error(a):t.call(y(s,k),0)
}
function bd(a,b,e,f){
var g=b.dir,h=s++;
return a||(a=function(a){
return a===e
}
),b.first?function(b){
while(b=b[g]){
if(b.nodeType===1){
return a(b)&&b
}}}
:f?function(b){
while(b=b[g]){
if(b.nodeType===1&&a(b)){
return b
}}}
:function(b){
var e,f=h+"."+c,i=f+"."+d;
while(b=b[g]){
if(b.nodeType===1){
if((e=b[o])===i){
return b.sizset
}
if(typeof e=="string"&&e.indexOf(f)===0){
if(b.sizset){
return b
}}else{
b[o]=i;
if(a(b)){
return b.sizset=!0,b
}
b.sizset=!1
}}}}
}
function be(a,b){
return a?function(c){
var d=b(c);
return d&&a(d===!0?c:d)
}
:b
}
function bf(a,b,c){
var d,e,g=0;
for(;
d=a[g];
g++){
f.relative[d.part]?e=bd(e,f.relative[d.part],b,c):e=be(e,f.filter[d.part].apply(null,d.captures.concat(b,c)))
}
return e
}
function bg(a){
return function(b){
var c,d=0;
for(;
c=a[d];
d++){
if(c(b)){
return !0
}}
return !1
}
}
function bh(a,b,c,d){
var e=0,f=b.length;
for(;
e<f;
e++){
$(a,b[e],c,d)
}}
function bi(a,b,c,d,e,g){
var h,i=f.setFilters[b.toLowerCase()];
return i||$.error(b),(a||!(h=e))&&bh(a||"*",d,h=[],e),h.length>0?i(h,c,g):[]
}
function bj(a,c,d,e){
var f,g,h,i,j,k,l,m,n,o,p,q,r,s=0,t=a.length,v=S.POS,w=new RegExp("^"+v.source+"(?!"+A+")","i"),x=function(){
var a=1,c=arguments.length-2;
for(;
a<c;
a++){
arguments[a]===b&&(n[a]=b)
}};
for(;
s<t;
s++){
f=a[s],g="",m=e;
for(h=0,i=f.length;
h<i;
h++){
j=f[h],k=j.string;
if(j.part==="PSEUDO"){
v.exec(""),l=0;
while(n=v.exec(k)){
o=!0,p=v.lastIndex=n.index+n[0].length;
if(p>l){
g+=k.slice(l,n.index),l=p,q=[c],J.test(g)&&(m&&(q=m),m=e);
if(r=O.test(g)){
g=g.slice(0,-5).replace(J,"$&*"),l++
}
n.length>1&&n[0].replace(w,x),m=bi(g,n[1],n[2],q,m,r)
}
g=""
}}
o||(g+=k),o=!1
}
g?J.test(g)?bh(g,m||[c],d,e):$(g,c,d,e?e.concat(m):m):u.apply(d,m)
}
return t===1?d:$.uniqueSort(d)
}
function bk(a,b,e,g,h){
a=a.replace(H,"$1");
var i,k,l,m,n,o,p,q,r,s,v=bc(a,b,h),w=b.nodeType;
if(S.POS.test(a)){
return bj(v,b,e,g)
}
if(g){
i=t.call(g,0)
}else{
if(v.length===1){
if((o=t.call(v[0],0)).length>2&&(p=o[0]).part==="ID"&&w===9&&!h&&f.relative[o[1].part]){
b=f.find.ID(p.captures[0].replace(R,""),b,h)[0];
if(!b){
return e
}
a=a.slice(o.shift().string.length)
}
r=(v=N.exec(o[0].string))&&!v.index&&b.parentNode||b,q="";
for(n=o.length-1;
n>=0;
n--){
p=o[n],s=p.part,q=p.string+q;
if(f.relative[s]){
break
}
if(f.order.test(s)){
i=f.find[s](p.captures[0].replace(R,""),r,h);
if(i==null){
continue
}
a=a.slice(0,a.length-q.length)+q.replace(S[s],""),a||u.apply(e,t.call(i,0));
break
}}}}
if(a){
k=j(a,b,h),c=k.dirruns++,i==null&&(i=f.find.TAG("*",N.test(a)&&b.parentNode||b));
for(n=0;
m=i[n];
n++){
d=k.runs++,k(m)&&e.push(m)
}}
return e
}
var c,d,e,f,g,h,i,j,k,l,m=!0,n="undefined",o=("sizcache"+Math.random()).replace(".",""),q=a.document,r=q.documentElement,s=0,t=[].slice,u=[].push,v=function(a,b){
return a[o]=b||!0,a
}
,w=function(){
var a={}
,b=[];
return v(function(c,d){
return b.push(c)>f.cacheLength&&delete a[b.shift()],a[c]=d
}
,a)
}
,x=w(),y=w(),z=w(),A="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",C=B.replace("w","w#"),D="([*^$|!~]?=)",E="\\["+A+"*("+B+")"+A+"*(?:"+D+A+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+C+")|)|)"+A+"*\\]",F=":("+B+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+E+")|[^:]|\\\\.)*|.*))\\)|)",G=":(nth|eq|gt|lt|first|last|even|odd)(?:\\(((?:-\\d)?\\d*)\\)|)(?=[^-]|$)",H=new RegExp("^"+A+"+|((?:^|[^\\\\])(?:\\\\.)*)"+A+"+$","g"),I=new RegExp("^"+A+"*,"+A+"*"),J=new RegExp("^"+A+"*([\\x20\\t\\r\\n\\f>+~])"+A+"*"),K=new RegExp(F),L=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,M=/^:not/,N=/[\x20\t\r\n\f]*[+~]/,O=/:not\($/,P=/h\d/i,Q=/input|select|textarea|button/i,R=/\\(?!\\)/g,S={
ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),NAME:new RegExp("^\\[name=['\"]?("+B+")['\"]?\\]"),TAG:new RegExp("^("+B.replace("w","w*")+")"),ATTR:new RegExp("^"+E),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+A+"*(even|odd|(([+-]|)(\\d*)n|)"+A+"*(?:([+-]|)"+A+"*(\\d+)|))"+A+"*\\)|)","i"),POS:new RegExp(G,"ig"),needsContext:new RegExp("^"+A+"*[>+~]|"+G,"i")}
,T=function(a){
var b=q.createElement("div");
try{
return a(b)
}
catch(c){
return !1
}
finally{
b=null
}}
,U=T(function(a){
return a.appendChild(q.createComment("")),!a.getElementsByTagName("*").length
}
),V=T(function(a){
return a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==n&&a.firstChild.getAttribute("href")==="#"
}
),W=T(function(a){
a.innerHTML="<select></select>";
var b=typeof a.lastChild.getAttribute("multiple");
return b!=="boolean"&&b!=="string"
}
),X=T(function(a){
return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!a.getElementsByClassName||!a.getElementsByClassName("e").length?!1:(a.lastChild.className="e",a.getElementsByClassName("e").length===2)
}
),Y=T(function(a){
a.id=o+0,a.innerHTML="<a name='"+o+"'></a><div name='"+o+"'></div>",r.insertBefore(a,r.firstChild);
var b=q.getElementsByName&&q.getElementsByName(o).length===2+q.getElementsByName(o+0).length;
return e=!q.getElementById(o),r.removeChild(a),b
}
);
try{
t.call(r.childNodes,0)[0].nodeType
}
catch(Z){
t=function(a){
var b,c=[];
for(;
b=this[a];
a++){
c.push(b)
}
return c
}
}
$.matches=function(a,b){
return $(a,null,null,b)
}
,$.matchesSelector=function(a,b){
return $(b,null,null,[a]).length>0
}
,g=$.getText=function(a){
var b,c="",d=0,e=a.nodeType;
if(e){
if(e===1||e===9||e===11){
if(typeof a.textContent=="string"){
return a.textContent
}
for(a=a.firstChild;
a;
a=a.nextSibling){
c+=g(a)
}}else{
if(e===3||e===4){
return a.nodeValue
}}}else{
for(;
b=a[d];
d++){
c+=g(b)
}}
return c
}
,h=$.isXML=function(a){
var b=a&&(a.ownerDocument||a).documentElement;
return b?b.nodeName!=="HTML":!1
}
,i=$.contains=r.contains?function(a,b){
var c=a.nodeType===9?a.documentElement:a,d=b&&b.parentNode;
return a===d||!!(d&&d.nodeType===1&&c.contains&&c.contains(d))
}
:r.compareDocumentPosition?function(a,b){
return b&&!!(a.compareDocumentPosition(b)&16)
}
:function(a,b){
while(b=b.parentNode){
if(b===a){
return !0
}}
return !1
}
,$.attr=function(a,b){
var c,d=h(a);
return d||(b=b.toLowerCase()),f.attrHandle[b]?f.attrHandle[b](a):W||d?a.getAttribute(b):(c=a.getAttributeNode(b),c?typeof a[b]=="boolean"?a[b]?b:null:c.specified?c.value:null:null)
}
,f=$.selectors={
cacheLength:50,createPseudo:v,match:S,order:new RegExp("ID|TAG"+(Y?"|NAME":"")+(X?"|CLASS":"")),attrHandle:V?{}
:{
href:function(a){
return a.getAttribute("href",2)
}
,type:function(a){
return a.getAttribute("type")
}}
,find:{
ID:e?function(a,b,c){
if(typeof b.getElementById!==n&&!c){
var d=b.getElementById(a);
return d&&d.parentNode?[d]:[]
}}
:function(a,c,d){
if(typeof c.getElementById!==n&&!d){
var e=c.getElementById(a);
return e?e.id===a||typeof e.getAttributeNode!==n&&e.getAttributeNode("id").value===a?[e]:b:[]
}}
,TAG:U?function(a,b){
if(typeof b.getElementsByTagName!==n){
return b.getElementsByTagName(a)
}}
:function(a,b){
var c=b.getElementsByTagName(a);
if(a==="*"){
var d,e=[],f=0;
for(;
d=c[f];
f++){
d.nodeType===1&&e.push(d)
}
return e
}
return c
}
,NAME:function(a,b){
if(typeof b.getElementsByName!==n){
return b.getElementsByName(name)
}}
,CLASS:function(a,b,c){
if(typeof b.getElementsByClassName!==n&&!c){
return b.getElementsByClassName(a)
}}}
,relative:{
">":{
dir:"parentNode",first:!0}
," ":{
dir:"parentNode"}
,"+":{
dir:"previousSibling",first:!0}
,"~":{
dir:"previousSibling"}}
,preFilter:{
ATTR:function(a){
return a[1]=a[1].replace(R,""),a[3]=(a[4]||a[5]||"").replace(R,""),a[2]==="~="&&(a[3]=" "+a[3]+" "),a.slice(0,4)
}
,CHILD:function(a){
return a[1]=a[1].toLowerCase(),a[1]==="nth"?(a[2]||$.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*(a[2]==="even"||a[2]==="odd")),a[4]=+(a[6]+a[7]||a[2]==="odd")):a[2]&&$.error(a[0]),a
}
,PSEUDO:function(a,b,c){
var d,e;
if(S.CHILD.test(a[0])){
return null
}
if(a[3]){
a[2]=a[3]
}else{
if(d=a[4]){
K.test(d)&&(e=bc(d,b,c,!0))&&(e=d.indexOf(")",d.length-e)-d.length)&&(d=d.slice(0,e),a[0]=a[0].slice(0,e)),a[2]=d
}}
return a.slice(0,3)
}}
,filter:{
ID:e?function(a){
return a=a.replace(R,""),function(b){
return b.getAttribute("id")===a
}
}
:function(a){
return a=a.replace(R,""),function(b){
var c=typeof b.getAttributeNode!==n&&b.getAttributeNode("id");
return c&&c.value===a
}
}
,TAG:function(a){
return a==="*"?function(){
return !0
}
:(a=a.replace(R,"").toLowerCase(),function(b){
return b.nodeName&&b.nodeName.toLowerCase()===a
}
)
}
,CLASS:function(a){
var b=x[o][a];
return b||(b=x(a,new RegExp("(^|"+A+")"+a+"("+A+"|$)"))),function(a){
return b.test(a.className||typeof a.getAttribute!==n&&a.getAttribute("class")||"")
}
}
,ATTR:function(a,b,c){
return b?function(d){
var e=$.attr(d,a),f=e+"";
if(e==null){
return b==="!="
}
switch(b){
case"=":return f===c;
case"!=":return f!==c;
case"^=":return c&&f.indexOf(c)===0;
case"*=":return c&&f.indexOf(c)>-1;
case"$=":return c&&f.substr(f.length-c.length)===c;
case"~=":return(" "+f+" ").indexOf(c)>-1;
case"|=":return f===c||f.substr(0,c.length+1)===c+"-"
}}
:function(b){
return $.attr(b,a)!=null
}
}
,CHILD:function(a,b,c,d){
if(a==="nth"){
var e=s++;
return function(a){
var b,f,g=0,h=a;
if(c===1&&d===0){
return !0
}
b=a.parentNode;
if(b&&(b[o]!==e||!a.sizset)){
for(h=b.firstChild;
h;
h=h.nextSibling){
if(h.nodeType===1){
h.sizset=++g;
if(h===a){
break
}}}
b[o]=e
}
return f=a.sizset-d,c===0?f===0:f%c===0&&f/c>=0
}
}
return function(b){
var c=b;
switch(a){
case"only":case"first":while(c=c.previousSibling){
if(c.nodeType===1){
return !1
}}
if(a==="first"){
return !0
}
c=b;
case"last":while(c=c.nextSibling){
if(c.nodeType===1){
return !1
}}
return !0
}}
}
,PSEUDO:function(a,b,c,d){
var e,g=f.pseudos[a]||f.pseudos[a.toLowerCase()];
return g||$.error("unsupported pseudo: "+a),g[o]?g(b,c,d):g.length>1?(e=[a,a,"",b],function(a){
return g(a,0,e)
}
):g
}}
,pseudos:{
not:v(function(a,b,c){
var d=j(a.replace(H,"$1"),b,c);
return function(a){
return !d(a)
}
}
),enabled:function(a){
return a.disabled===!1
}
,disabled:function(a){
return a.disabled===!0
}
,checked:function(a){
var b=a.nodeName.toLowerCase();
return b==="input"&&!!a.checked||b==="option"&&!!a.selected
}
,selected:function(a){
return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0
}
,parent:function(a){
return !f.pseudos.empty(a)
}
,empty:function(a){
var b;
a=a.firstChild;
while(a){
if(a.nodeName>"@"||(b=a.nodeType)===3||b===4){
return !1
}
a=a.nextSibling
}
return !0
}
,contains:v(function(a){
return function(b){
return(b.textContent||b.innerText||g(b)).indexOf(a)>-1
}
}
),has:v(function(a){
return function(b){
return $(a,b).length>0
}
}
),header:function(a){
return P.test(a.nodeName)
}
,text:function(a){
var b,c;
return a.nodeName.toLowerCase()==="input"&&(b=a.type)==="text"&&((c=a.getAttribute("type"))==null||c.toLowerCase()===b)
}
,radio:_("radio"),checkbox:_("checkbox"),file:_("file"),password:_("password"),image:_("image"),submit:ba("submit"),reset:ba("reset"),button:function(a){
var b=a.nodeName.toLowerCase();
return b==="input"&&a.type==="button"||b==="button"
}
,input:function(a){
return Q.test(a.nodeName)
}
,focus:function(a){
var b=a.ownerDocument;
return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&(!!a.type||!!a.href)
}
,active:function(a){
return a===a.ownerDocument.activeElement
}}
,setFilters:{
first:function(a,b,c){
return c?a.slice(1):[a[0]]
}
,last:function(a,b,c){
var d=a.pop();
return c?a:[d]
}
,even:function(a,b,c){
var d=[],e=c?1:0,f=a.length;
for(;
e<f;
e=e+2){
d.push(a[e])
}
return d
}
,odd:function(a,b,c){
var d=[],e=c?0:1,f=a.length;
for(;
e<f;
e=e+2){
d.push(a[e])
}
return d
}
,lt:function(a,b,c){
return c?a.slice(+b):a.slice(0,+b)
}
,gt:function(a,b,c){
return c?a.slice(0,+b+1):a.slice(+b+1)
}
,eq:function(a,b,c){
var d=a.splice(+b,1);
return c?a:d
}}}
,k=r.compareDocumentPosition?function(a,b){
return a===b?(l=!0,0):(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1
}
:function(a,b){
if(a===b){
return l=!0,0
}
if(a.sourceIndex&&b.sourceIndex){
return a.sourceIndex-b.sourceIndex
}
var c,d,e=[],f=[],g=a.parentNode,h=b.parentNode,i=g;
if(g===h){
return bb(a,b)
}
if(!g){
return -1
}
if(!h){
return 1
}
while(i){
e.unshift(i),i=i.parentNode
}
i=h;
while(i){
f.unshift(i),i=i.parentNode
}
c=e.length,d=f.length;
for(var j=0;
j<c&&j<d;
j++){
if(e[j]!==f[j]){
return bb(e[j],f[j])
}}
return j===c?bb(a,f[j],-1):bb(e[j],b,1)
}
,[0,0].sort(k),m=!l,$.uniqueSort=function(a){
var b,c=1;
l=m,a.sort(k);
if(l){
for(;
b=a[c];
c++){
b===a[c-1]&&a.splice(c--,1)
}}
return a
}
,$.error=function(a){
throw new Error("Syntax error, unrecognized expression: "+a)
}
,j=$.compile=function(a,b,c){
var d,e,f,g=z[o][a];
if(g&&g.context===b){
return g
}
d=bc(a,b,c);
for(e=0,f=d.length;
e<f;
e++){
d[e]=bf(d[e],b,c)
}
return g=z(a,bg(d)),g.context=b,g.runs=g.dirruns=0,g
}
,q.querySelectorAll&&function(){
var a,b=bk,c=/'|\\/g,d=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,e=[],f=[":active"],g=r.matchesSelector||r.mozMatchesSelector||r.webkitMatchesSelector||r.oMatchesSelector||r.msMatchesSelector;
T(function(a){
a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||e.push("\\["+A+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),a.querySelectorAll(":checked").length||e.push(":checked")
}
),T(function(a){
a.innerHTML="<p test=''></p>",a.querySelectorAll("[test^='']").length&&e.push("[*^$]="+A+"*(?:\"\"|'')"),a.innerHTML="<input type='hidden'/>",a.querySelectorAll(":enabled").length||e.push(":enabled",":disabled")
}
),e=e.length&&new RegExp(e.join("|")),bk=function(a,d,f,g,h){
if(!g&&!h&&(!e||!e.test(a))){
if(d.nodeType===9){
try{
return u.apply(f,t.call(d.querySelectorAll(a),0)),f
}
catch(i){}}else{
if(d.nodeType===1&&d.nodeName.toLowerCase()!=="object"){
var j,k,l,m=d.getAttribute("id"),n=m||o,p=N.test(a)&&d.parentNode||d;
m?n=n.replace(c,"\\$&"):d.setAttribute("id",n),j=bc(a,d,h),n="[id='"+n+"']";
for(k=0,l=j.length;
k<l;
k++){
j[k]=n+j[k].selector
}
try{
return u.apply(f,t.call(p.querySelectorAll(j.join(",")),0)),f
}
catch(i){}
finally{
m||d.removeAttribute("id")
}}}}
return b(a,d,f,g,h)
}
,g&&(T(function(b){
a=g.call(b,"div");
try{
g.call(b,"[test!='']:sizzle"),f.push(S.PSEUDO.source,S.POS.source,"!=")
}
catch(c){}}
),f=new RegExp(f.join("|")),$.matchesSelector=function(b,c){
c=c.replace(d,"='$1']");
if(!h(b)&&!f.test(c)&&(!e||!e.test(c))){
try{
var i=g.call(b,c);
if(i||a||b.document&&b.document.nodeType!==11){
return i
}}
catch(j){}}
return $(c,null,null,[b]).length>0
}
)
}
(),f.setFilters.nth=f.setFilters.eq,f.filters=f.pseudos,$.attr=p.attr,p.find=$,p.expr=$.selectors,p.expr[":"]=p.expr.pseudos,p.unique=$.uniqueSort,p.text=$.getText,p.isXMLDoc=$.isXML,p.contains=$.contains
}
(a);
var bc=/Until$/,bd=/^(?:parents|prev(?:Until|All))/,be=/^.[^:#\[\.,]*$/,bf=p.expr.match.needsContext,bg={
children:!0,contents:!0,next:!0,prev:!0};
p.fn.extend({
find:function(a){
var b,c,d,e,f,g,h=this;
if(typeof a!="string"){
return p(a).filter(function(){
for(b=0,c=h.length;
b<c;
b++){
if(p.contains(h[b],this)){
return !0
}}}
)
}
g=this.pushStack("","find",a);
for(b=0,c=this.length;
b<c;
b++){
d=g.length,p.find(a,this[b],g);
if(b>0){
for(e=d;
e<g.length;
e++){
for(f=0;
f<d;
f++){
if(g[f]===g[e]){
g.splice(e--,1);
break
}}}}}
return g
}
,has:function(a){
var b,c=p(a,this),d=c.length;
return this.filter(function(){
for(b=0;
b<d;
b++){
if(p.contains(this,c[b])){
return !0
}}}
)
}
,not:function(a){
return this.pushStack(bj(this,a,!1),"not",a)
}
,filter:function(a){
return this.pushStack(bj(this,a,!0),"filter",a)
}
,is:function(a){
return !!a&&(typeof a=="string"?bf.test(a)?p(a,this.context).index(this[0])>=0:p.filter(a,this).length>0:this.filter(a).length>0)
}
,closest:function(a,b){
var c,d=0,e=this.length,f=[],g=bf.test(a)||typeof a!="string"?p(a,b||this.context):0;
for(;
d<e;
d++){
c=this[d];
while(c&&c.ownerDocument&&c!==b&&c.nodeType!==11){
if(g?g.index(c)>-1:p.find.matchesSelector(c,a)){
f.push(c);
break
}
c=c.parentNode
}}
return f=f.length>1?p.unique(f):f,this.pushStack(f,"closest",a)
}
,index:function(a){
return a?typeof a=="string"?p.inArray(this[0],p(a)):p.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1
}
,add:function(a,b){
var c=typeof a=="string"?p(a,b):p.makeArray(a&&a.nodeType?[a]:a),d=p.merge(this.get(),c);
return this.pushStack(bh(c[0])||bh(d[0])?d:p.unique(d))
}
,addBack:function(a){
return this.add(a==null?this.prevObject:this.prevObject.filter(a))
}}
),p.fn.andSelf=p.fn.addBack,p.each({
parent:function(a){
var b=a.parentNode;
return b&&b.nodeType!==11?b:null
}
,parents:function(a){
return p.dir(a,"parentNode")
}
,parentsUntil:function(a,b,c){
return p.dir(a,"parentNode",c)
}
,next:function(a){
return bi(a,"nextSibling")
}
,prev:function(a){
return bi(a,"previousSibling")
}
,nextAll:function(a){
return p.dir(a,"nextSibling")
}
,prevAll:function(a){
return p.dir(a,"previousSibling")
}
,nextUntil:function(a,b,c){
return p.dir(a,"nextSibling",c)
}
,prevUntil:function(a,b,c){
return p.dir(a,"previousSibling",c)
}
,siblings:function(a){
return p.sibling((a.parentNode||{}
).firstChild,a)
}
,children:function(a){
return p.sibling(a.firstChild)
}
,contents:function(a){
return p.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:p.merge([],a.childNodes)
}}
,function(a,b){
p.fn[a]=function(c,d){
var e=p.map(this,b,c);
return bc.test(a)||(d=c),d&&typeof d=="string"&&(e=p.filter(d,e)),e=this.length>1&&!bg[a]?p.unique(e):e,this.length>1&&bd.test(a)&&(e=e.reverse()),this.pushStack(e,a,k.call(arguments).join(","))
}
}
),p.extend({
filter:function(a,b,c){
return c&&(a=":not("+a+")"),b.length===1?p.find.matchesSelector(b[0],a)?[b[0]]:[]:p.find.matches(a,b)
}
,dir:function(a,c,d){
var e=[],f=a[c];
while(f&&f.nodeType!==9&&(d===b||f.nodeType!==1||!p(f).is(d))){
f.nodeType===1&&e.push(f),f=f[c]
}
return e
}
,sibling:function(a,b){
var c=[];
for(;
a;
a=a.nextSibling){
a.nodeType===1&&a!==b&&c.push(a)
}
return c
}}
);
var bl="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",bm=/ jQuery\d+="(?:null|\d+)"/g,bn=/^\s+/,bo=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bp=/<([\w:]+)/,bq=/<tbody/i,br=/<|&#?\w+;/,bs=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,bu=new RegExp("<(?:"+bl+")[\\s/>]","i"),bv=/^(?:checkbox|radio)$/,bw=/checked\s*(?:[^=]|=\s*.checked.)/i,bx=/\/(java|ecma)script/i,by=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,bz={
option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]}
,bA=bk(e),bB=bA.appendChild(e.createElement("div"));
bz.optgroup=bz.option,bz.tbody=bz.tfoot=bz.colgroup=bz.caption=bz.thead,bz.th=bz.td,p.support.htmlSerialize||(bz._default=[1,"X<div>","</div>"]),p.fn.extend({
text:function(a){
return p.access(this,function(a){
return a===b?p.text(this):this.empty().append((this[0]&&this[0].ownerDocument||e).createTextNode(a))
}
,null,a,arguments.length)
}
,wrapAll:function(a){
if(p.isFunction(a)){
return this.each(function(b){
p(this).wrapAll(a.call(this,b))
}
)
}
if(this[0]){
var b=p(a,this[0].ownerDocument).eq(0).clone(!0);
this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){
var a=this;
while(a.firstChild&&a.firstChild.nodeType===1){
a=a.firstChild
}
return a
}
).append(this)
}
return this
}
,wrapInner:function(a){
return p.isFunction(a)?this.each(function(b){
p(this).wrapInner(a.call(this,b))
}
):this.each(function(){
var b=p(this),c=b.contents();
c.length?c.wrapAll(a):b.append(a)
}
)
}
,wrap:function(a){
var b=p.isFunction(a);
return this.each(function(c){
p(this).wrapAll(b?a.call(this,c):a)
}
)
}
,unwrap:function(){
return this.parent().each(function(){
p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)
}
).end()
}
,append:function(){
return this.domManip(arguments,!0,function(a){
(this.nodeType===1||this.nodeType===11)&&this.appendChild(a)
}
)
}
,prepend:function(){
return this.domManip(arguments,!0,function(a){
(this.nodeType===1||this.nodeType===11)&&this.insertBefore(a,this.firstChild)
}
)
}
,before:function(){
if(!bh(this[0])){
return this.domManip(arguments,!1,function(a){
this.parentNode.insertBefore(a,this)
}
)
}
if(arguments.length){
var a=p.clean(arguments);
return this.pushStack(p.merge(a,this),"before",this.selector)
}}
,after:function(){
if(!bh(this[0])){
return this.domManip(arguments,!1,function(a){
this.parentNode.insertBefore(a,this.nextSibling)
}
)
}
if(arguments.length){
var a=p.clean(arguments);
return this.pushStack(p.merge(this,a),"after",this.selector)
}}
,remove:function(a,b){
var c,d=0;
for(;
(c=this[d])!=null;
d++){
if(!a||p.filter(a,[c]).length){
!b&&c.nodeType===1&&(p.cleanData(c.getElementsByTagName("*")),p.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c)
}}
return this
}
,empty:function(){
var a,b=0;
for(;
(a=this[b])!=null;
b++){
a.nodeType===1&&p.cleanData(a.getElementsByTagName("*"));
while(a.firstChild){
a.removeChild(a.firstChild)
}}
return this
}
,clone:function(a,b){
return a=a==null?!1:a,b=b==null?a:b,this.map(function(){
return p.clone(this,a,b)
}
)
}
,html:function(a){
return p.access(this,function(a){
var c=this[0]||{}
,d=0,e=this.length;
if(a===b){
return c.nodeType===1?c.innerHTML.replace(bm,""):b
}
if(typeof a=="string"&&!bs.test(a)&&(p.support.htmlSerialize||!bu.test(a))&&(p.support.leadingWhitespace||!bn.test(a))&&!bz[(bp.exec(a)||["",""])[1].toLowerCase()]){
a=a.replace(bo,"<$1></$2>");
try{
for(;
d<e;
d++){
c=this[d]||{}
,c.nodeType===1&&(p.cleanData(c.getElementsByTagName("*")),c.innerHTML=a)
}
c=0
}
catch(f){}}
c&&this.empty().append(a)
}
,null,a,arguments.length)
}
,replaceWith:function(a){
return bh(this[0])?this.length?this.pushStack(p(p.isFunction(a)?a():a),"replaceWith",a):this:p.isFunction(a)?this.each(function(b){
var c=p(this),d=c.html();
c.replaceWith(a.call(this,b,d))
}
):(typeof a!="string"&&(a=p(a).detach()),this.each(function(){
var b=this.nextSibling,c=this.parentNode;
p(this).remove(),b?p(b).before(a):p(c).append(a)
}
))
}
,detach:function(a){
return this.remove(a,!0)
}
,domManip:function(a,c,d){
a=[].concat.apply([],a);
var e,f,g,h,i=0,j=a[0],k=[],l=this.length;
if(!p.support.checkClone&&l>1&&typeof j=="string"&&bw.test(j)){
return this.each(function(){
p(this).domManip(a,c,d)
}
)
}
if(p.isFunction(j)){
return this.each(function(e){
var f=p(this);
a[0]=j.call(this,e,c?f.html():b),f.domManip(a,c,d)
}
)
}
if(this[0]){
e=p.buildFragment(a,this,k),g=e.fragment,f=g.firstChild,g.childNodes.length===1&&(g=f);
if(f){
c=c&&p.nodeName(f,"tr");
for(h=e.cacheable||l-1;
i<l;
i++){
d.call(c&&p.nodeName(this[i],"table")?bC(this[i],"tbody"):this[i],i===h?g:p.clone(g,!0,!0))
}}
g=f=null,k.length&&p.each(k,function(a,b){
b.src?p.ajax?p.ajax({
url:b.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}
):p.error("no ajax"):p.globalEval((b.text||b.textContent||b.innerHTML||"").replace(by,"")),b.parentNode&&b.parentNode.removeChild(b)
}
)
}
return this
}}
),p.buildFragment=function(a,c,d){
var f,g,h,i=a[0];
return c=c||e,c=!c.nodeType&&c[0]||c,c=c.ownerDocument||c,a.length===1&&typeof i=="string"&&i.length<512&&c===e&&i.charAt(0)==="<"&&!bt.test(i)&&(p.support.checkClone||!bw.test(i))&&(p.support.html5Clone||!bu.test(i))&&(g=!0,f=p.fragments[i],h=f!==b),f||(f=c.createDocumentFragment(),p.clean(a,c,f,d),g&&(p.fragments[i]=h&&f)),{
fragment:f,cacheable:g}
}
,p.fragments={}
,p.each({
appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"}
,function(a,b){
p.fn[a]=function(c){
var d,e=0,f=[],g=p(c),h=g.length,i=this.length===1&&this[0].parentNode;
if((i==null||i&&i.nodeType===11&&i.childNodes.length===1)&&h===1){
return g[b](this[0]),this
}
for(;
e<h;
e++){
d=(e>0?this.clone(!0):this).get(),p(g[e])[b](d),f=f.concat(d)
}
return this.pushStack(f,a,g.selector)
}
}
),p.extend({
clone:function(a,b,c){
var d,e,f,g;
p.support.html5Clone||p.isXMLDoc(a)||!bu.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(bB.innerHTML=a.outerHTML,bB.removeChild(g=bB.firstChild));
if((!p.support.noCloneEvent||!p.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!p.isXMLDoc(a)){
bE(a,g),d=bF(a),e=bF(g);
for(f=0;
d[f];
++f){
e[f]&&bE(d[f],e[f])
}}
if(b){
bD(a,g);
if(c){
d=bF(a),e=bF(g);
for(f=0;
d[f];
++f){
bD(d[f],e[f])
}}}
return d=e=null,g
}
,clean:function(a,b,c,d){
var f,g,h,i,j,k,l,m,n,o,q,r,s=b===e&&bA,t=[];
if(!b||typeof b.createDocumentFragment=="undefined"){
b=e
}
for(f=0;
(h=a[f])!=null;
f++){
typeof h=="number"&&(h+="");
if(!h){
continue
}
if(typeof h=="string"){
if(!br.test(h)){
h=b.createTextNode(h)
}else{
s=s||bk(b),l=b.createElement("div"),s.appendChild(l),h=h.replace(bo,"<$1></$2>"),i=(bp.exec(h)||["",""])[1].toLowerCase(),j=bz[i]||bz._default,k=j[0],l.innerHTML=j[1]+h+j[2];
while(k--){
l=l.lastChild
}
if(!p.support.tbody){
m=bq.test(h),n=i==="table"&&!m?l.firstChild&&l.firstChild.childNodes:j[1]==="<table>"&&!m?l.childNodes:[];
for(g=n.length-1;
g>=0;
--g){
p.nodeName(n[g],"tbody")&&!n[g].childNodes.length&&n[g].parentNode.removeChild(n[g])
}}
!p.support.leadingWhitespace&&bn.test(h)&&l.insertBefore(b.createTextNode(bn.exec(h)[0]),l.firstChild),h=l.childNodes,l.parentNode.removeChild(l)
}}
h.nodeType?t.push(h):p.merge(t,h)
}
l&&(h=l=s=null);
if(!p.support.appendChecked){
for(f=0;
(h=t[f])!=null;
f++){
p.nodeName(h,"input")?bG(h):typeof h.getElementsByTagName!="undefined"&&p.grep(h.getElementsByTagName("input"),bG)
}}
if(c){
q=function(a){
if(!a.type||bx.test(a.type)){
return d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a)
}};
for(f=0;
(h=t[f])!=null;
f++){
if(!p.nodeName(h,"script")||!q(h)){
c.appendChild(h),typeof h.getElementsByTagName!="undefined"&&(r=p.grep(p.merge([],h.getElementsByTagName("script")),q),t.splice.apply(t,[f+1,0].concat(r)),f+=r.length)
}}}
return t
}
,cleanData:function(a,b){
var c,d,e,f,g=0,h=p.expando,i=p.cache,j=p.support.deleteExpando,k=p.event.special;
for(;
(e=a[g])!=null;
g++){
if(b||p.acceptData(e)){
d=e[h],c=d&&i[d];
if(c){
if(c.events){
for(f in c.events){
k[f]?p.event.remove(e,f):p.removeEvent(e,f,c.handle)
}}
i[d]&&(delete i[d],j?delete e[h]:e.removeAttribute?e.removeAttribute(h):e[h]=null,p.deletedIds.push(d))
}}}}}
),function(){
var a,b;
p.uaMatch=function(a){
a=a.toLowerCase();
var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];
return{
browser:b[1]||"",version:b[2]||"0"}
}
,a=p.uaMatch(g.userAgent),b={}
,a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),p.browser=b,p.sub=function(){
function a(b,c){
return new a.fn.init(b,c)
}
p.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function c(c,d){
return d&&d instanceof p&&!(d instanceof a)&&(d=a(d)),p.fn.init.call(this,c,d,b)
}
,a.fn.init.prototype=a.fn;
var b=a(e);
return a
}
}
();
var bH,bI,bJ,bK=/alpha\([^)]*\)/i,bL=/opacity=([^)]*)/,bM=/^(top|right|bottom|left)$/,bN=/^(none|table(?!-c[ea]).+)/,bO=/^margin/,bP=new RegExp("^("+q+")(.*)$","i"),bQ=new RegExp("^("+q+")(?!px)[a-z%]+$","i"),bR=new RegExp("^([-+])=("+q+")","i"),bS={}
,bT={
position:"absolute",visibility:"hidden",display:"block"}
,bU={
letterSpacing:0,fontWeight:400}
,bV=["Top","Right","Bottom","Left"],bW=["Webkit","O","Moz","ms"],bX=p.fn.toggle;
p.fn.extend({
css:function(a,c){
return p.access(this,function(a,c,d){
return d!==b?p.style(a,c,d):p.css(a,c)
}
,a,c,arguments.length>1)
}
,show:function(){
return b$(this,!0)
}
,hide:function(){
return b$(this)
}
,toggle:function(a,b){
var c=typeof a=="boolean";
return p.isFunction(a)&&p.isFunction(b)?bX.apply(this,arguments):this.each(function(){
(c?a:bZ(this))?p(this).show():p(this).hide()
}
)
}}
),p.extend({
cssHooks:{
opacity:{
get:function(a,b){
if(b){
var c=bH(a,"opacity");
return c===""?"1":c
}}}}
,cssNumber:{
fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0}
,cssProps:{
"float":p.support.cssFloat?"cssFloat":"styleFloat"}
,style:function(a,c,d,e){
if(!a||a.nodeType===3||a.nodeType===8||!a.style){
return
}
var f,g,h,i=p.camelCase(c),j=a.style;
c=p.cssProps[i]||(p.cssProps[i]=bY(j,i)),h=p.cssHooks[c]||p.cssHooks[i];
if(d===b){
return h&&"get" in h&&(f=h.get(a,!1,e))!==b?f:j[c]
}
g=typeof d,g==="string"&&(f=bR.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(p.css(a,c)),g="number");
if(d==null||g==="number"&&isNaN(d)){
return
}
g==="number"&&!p.cssNumber[i]&&(d+="px");
if(!h||!("set" in h)||(d=h.set(a,d,e))!==b){
try{
j[c]=d
}
catch(k){}}}
,css:function(a,c,d,e){
var f,g,h,i=p.camelCase(c);
return c=p.cssProps[i]||(p.cssProps[i]=bY(a.style,i)),h=p.cssHooks[c]||p.cssHooks[i],h&&"get" in h&&(f=h.get(a,!0,e)),f===b&&(f=bH(a,c)),f==="normal"&&c in bU&&(f=bU[c]),d||e!==b?(g=parseFloat(f),d||p.isNumeric(g)?g||0:f):f
}
,swap:function(a,b,c){
var d,e,f={};
for(e in b){
f[e]=a.style[e],a.style[e]=b[e]
}
d=c.call(a);
for(e in b){
a.style[e]=f[e]
}
return d
}}
),a.getComputedStyle?bH=function(b,c){
var d,e,f,g,h=a.getComputedStyle(b,null),i=b.style;
return h&&(d=h[c],d===""&&!p.contains(b.ownerDocument,b)&&(d=p.style(b,c)),bQ.test(d)&&bO.test(c)&&(e=i.width,f=i.minWidth,g=i.maxWidth,i.minWidth=i.maxWidth=i.width=d,d=h.width,i.width=e,i.minWidth=f,i.maxWidth=g)),d
}
:e.documentElement.currentStyle&&(bH=function(a,b){
var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;
return e==null&&f&&f[b]&&(e=f[b]),bQ.test(e)&&!bM.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d)),e===""?"auto":e
}
),p.each(["height","width"],function(a,b){
p.cssHooks[b]={
get:function(a,c,d){
if(c){
return a.offsetWidth===0&&bN.test(bH(a,"display"))?p.swap(a,bT,function(){
return cb(a,b,d)
}
):cb(a,b,d)
}}
,set:function(a,c,d){
return b_(a,c,d?ca(a,b,d,p.support.boxSizing&&p.css(a,"boxSizing")==="border-box"):0)
}}
}
),p.support.opacity||(p.cssHooks.opacity={
get:function(a,b){
return bL.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":b?"1":""
}
,set:function(a,b){
var c=a.style,d=a.currentStyle,e=p.isNumeric(b)?"alpha(opacity="+b*100+")":"",f=d&&d.filter||c.filter||"";
c.zoom=1;
if(b>=1&&p.trim(f.replace(bK,""))===""&&c.removeAttribute){
c.removeAttribute("filter");
if(d&&!d.filter){
return
}}
c.filter=bK.test(f)?f.replace(bK,e):f+" "+e
}}
),p(function(){
p.support.reliableMarginRight||(p.cssHooks.marginRight={
get:function(a,b){
return p.swap(a,{
display:"inline-block"}
,function(){
if(b){
return bH(a,"marginRight")
}}
)
}}
),!p.support.pixelPosition&&p.fn.position&&p.each(["top","left"],function(a,b){
p.cssHooks[b]={
get:function(a,c){
if(c){
var d=bH(a,b);
return bQ.test(d)?p(a).position()[b]+"px":d
}}}
}
)
}
),p.expr&&p.expr.filters&&(p.expr.filters.hidden=function(a){
return a.offsetWidth===0&&a.offsetHeight===0||!p.support.reliableHiddenOffsets&&(a.style&&a.style.display||bH(a,"display"))==="none"
}
,p.expr.filters.visible=function(a){
return !p.expr.filters.hidden(a)
}
),p.each({
margin:"",padding:"",border:"Width"}
,function(a,b){
p.cssHooks[a+b]={
expand:function(c){
var d,e=typeof c=="string"?c.split(" "):[c],f={};
for(d=0;
d<4;
d++){
f[a+bV[d]+b]=e[d]||e[d-2]||e[0]
}
return f
}}
,bO.test(a)||(p.cssHooks[a+b].set=b_)
}
);
var cd=/%20/g,ce=/\[\]$/,cf=/\r?\n/g,cg=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,ch=/^(?:select|textarea)/i;
p.fn.extend({
serialize:function(){
return p.param(this.serializeArray())
}
,serializeArray:function(){
return this.map(function(){
return this.elements?p.makeArray(this.elements):this
}
).filter(function(){
return this.name&&!this.disabled&&(this.checked||ch.test(this.nodeName)||cg.test(this.type))
}
).map(function(a,b){
var c=p(this).val();
return c==null?null:p.isArray(c)?p.map(c,function(a,c){
return{
name:b.name,value:a.replace(cf,"\r\n")}
}
):{
name:b.name,value:c.replace(cf,"\r\n")}
}
).get()
}}
),p.param=function(a,c){
var d,e=[],f=function(a,b){
b=p.isFunction(b)?b():b==null?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)
};
c===b&&(c=p.ajaxSettings&&p.ajaxSettings.traditional);
if(p.isArray(a)||a.jquery&&!p.isPlainObject(a)){
p.each(a,function(){
f(this.name,this.value)
}
)
}else{
for(d in a){
ci(d,a[d],c,f)
}}
return e.join("&").replace(cd,"+")
};
var cj,ck,cl=/#.*$/,cm=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,cn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,co=/^(?:GET|HEAD)$/,cp=/^\/\//,cq=/\?/,cr=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,cs=/([?&])_=[^&]*/,ct=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,cu=p.fn.load,cv={}
,cw={}
,cx=["*/"]+["*"];
try{
cj=f.href
}
catch(cy){
cj=e.createElement("a"),cj.href="",cj=cj.href
}
ck=ct.exec(cj.toLowerCase())||[],p.fn.load=function(a,c,d){
if(typeof a!="string"&&cu){
return cu.apply(this,arguments)
}
if(!this.length){
return this
}
var e,f,g,h=this,i=a.indexOf(" ");
return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),p.isFunction(c)?(d=c,c=b):c&&typeof c=="object"&&(f="POST"),p.ajax({
url:a,type:f,dataType:"html",data:c,complete:function(a,b){
d&&h.each(d,g||[a.responseText,b,a])
}}
).done(function(a){
g=arguments,h.html(e?p("<div>").append(a.replace(cr,"")).find(e):a)
}
),this
}
,p.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){
p.fn[b]=function(a){
return this.on(b,a)
}
}
),p.each(["get","post"],function(a,c){
p[c]=function(a,d,e,f){
return p.isFunction(d)&&(f=f||e,e=d,d=b),p.ajax({
type:c,url:a,data:d,success:e,dataType:f}
)
}
}
),p.extend({
getScript:function(a,c){
return p.get(a,b,c,"script")
}
,getJSON:function(a,b,c){
return p.get(a,b,c,"json")
}
,ajaxSetup:function(a,b){
return b?cB(a,p.ajaxSettings):(b=a,a=p.ajaxSettings),cB(a,b),a
}
,ajaxSettings:{
url:cj,isLocal:cn.test(ck[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{
xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":cx}
,contents:{
xml:/xml/,html:/html/,json:/json/}
,responseFields:{
xml:"responseXML",text:"responseText"}
,converters:{
"* text":a.String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML}
,flatOptions:{
context:!0,url:!0}}
,ajaxPrefilter:cz(cv),ajaxTransport:cz(cw),ajax:function(a,c){
function y(a,c,f,i){
var k,s,t,u,w,y=c;
if(v===2){
return
}
v=2,h&&clearTimeout(h),g=b,e=i||"",x.readyState=a>0?4:0,f&&(u=cC(l,x,f));
if(a>=200&&a<300||a===304){
l.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(p.lastModified[d]=w),w=x.getResponseHeader("Etag"),w&&(p.etag[d]=w)),a===304?(y="notmodified",k=!0):(k=cD(l,u),y=k.state,s=k.data,t=k.error,k=!t)
}else{
t=y;
if(!y||a){
y="error",a<0&&(a=0)
}}
x.status=a,x.statusText=""+(c||y),k?o.resolveWith(m,[s,y,x]):o.rejectWith(m,[x,y,t]),x.statusCode(r),r=b,j&&n.trigger("ajax"+(k?"Success":"Error"),[x,l,k?s:t]),q.fireWith(m,[x,y]),j&&(n.trigger("ajaxComplete",[x,l]),--p.active||p.event.trigger("ajaxStop"))
}
typeof a=="object"&&(c=a,a=b),c=c||{};
var d,e,f,g,h,i,j,k,l=p.ajaxSetup({}
,c),m=l.context||l,n=m!==l&&(m.nodeType||m instanceof p)?p(m):p.event,o=p.Deferred(),q=p.Callbacks("once memory"),r=l.statusCode||{}
,t={}
,u={}
,v=0,w="canceled",x={
readyState:0,setRequestHeader:function(a,b){
if(!v){
var c=a.toLowerCase();
a=u[c]=u[c]||a,t[a]=b
}
return this
}
,getAllResponseHeaders:function(){
return v===2?e:null
}
,getResponseHeader:function(a){
var c;
if(v===2){
if(!f){
f={};
while(c=cm.exec(e)){
f[c[1].toLowerCase()]=c[2]
}}
c=f[a.toLowerCase()]
}
return c===b?null:c
}
,overrideMimeType:function(a){
return v||(l.mimeType=a),this
}
,abort:function(a){
return a=a||w,g&&g.abort(a),y(0,a),this
}};
o.promise(x),x.success=x.done,x.error=x.fail,x.complete=q.add,x.statusCode=function(a){
if(a){
var b;
if(v<2){
for(b in a){
r[b]=[r[b],a[b]]
}}else{
b=a[x.status],x.always(b)
}}
return this
}
,l.url=((a||l.url)+"").replace(cl,"").replace(cp,ck[1]+"//"),l.dataTypes=p.trim(l.dataType||"*").toLowerCase().split(s),l.crossDomain==null&&(i=ct.exec(l.url.toLowerCase()),l.crossDomain=!(!i||i[1]==ck[1]&&i[2]==ck[2]&&(i[3]||(i[1]==="http:"?80:443))==(ck[3]||(ck[1]==="http:"?80:443)))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=p.param(l.data,l.traditional)),cA(cv,l,c,x);
if(v===2){
return x
}
j=l.global,l.type=l.type.toUpperCase(),l.hasContent=!co.test(l.type),j&&p.active++===0&&p.event.trigger("ajaxStart");
if(!l.hasContent){
l.data&&(l.url+=(cq.test(l.url)?"&":"?")+l.data,delete l.data),d=l.url;
if(l.cache===!1){
var z=p.now(),A=l.url.replace(cs,"$1_="+z);
l.url=A+(A===l.url?(cq.test(l.url)?"&":"?")+"_="+z:"")
}}
(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&x.setRequestHeader("Content-Type",l.contentType),l.ifModified&&(d=d||l.url,p.lastModified[d]&&x.setRequestHeader("If-Modified-Since",p.lastModified[d]),p.etag[d]&&x.setRequestHeader("If-None-Match",p.etag[d])),x.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+cx+"; q=0.01":""):l.accepts["*"]);
for(k in l.headers){
x.setRequestHeader(k,l.headers[k])
}
if(!l.beforeSend||l.beforeSend.call(m,x,l)!==!1&&v!==2){
w="abort";
for(k in {
success:1,error:1,complete:1}
){
x[k](l[k])
}
g=cA(cw,l,c,x);
if(!g){
y(-1,"No Transport")
}else{
x.readyState=1,j&&n.trigger("ajaxSend",[x,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){
x.abort("timeout")
}
,l.timeout));
try{
v=1,g.send(t,y)
}
catch(B){
if(v<2){
y(-1,B)
}else{
throw B
}}}
return x
}
return x.abort()
}
,active:0,lastModified:{}
,etag:{}}
);
var cE=[],cF=/\?/,cG=/(=)\?(?=&|$)|\?\?/,cH=p.now();
p.ajaxSetup({
jsonp:"callback",jsonpCallback:function(){
var a=cE.pop()||p.expando+"_"+cH++;
return this[a]=!0,a
}}
),p.ajaxPrefilter("json jsonp",function(c,d,e){
var f,g,h,i=c.data,j=c.url,k=c.jsonp!==!1,l=k&&cG.test(j),m=k&&!l&&typeof i=="string"&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&cG.test(i);
if(c.dataTypes[0]==="jsonp"||l||m){
return f=c.jsonpCallback=p.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,g=a[f],l?c.url=j.replace(cG,"$1"+f):m?c.data=i.replace(cG,"$1"+f):k&&(c.url+=(cF.test(j)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){
return h||p.error(f+" was not called"),h[0]
}
,c.dataTypes[0]="json",a[f]=function(){
h=arguments
}
,e.always(function(){
a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,cE.push(f)),h&&p.isFunction(g)&&g(h[0]),h=g=b
}
),"script"
}}
),p.ajaxSetup({
accepts:{
script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"}
,contents:{
script:/javascript|ecmascript/}
,converters:{
"text script":function(a){
return p.globalEval(a),a
}}}
),p.ajaxPrefilter("script",function(a){
a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)
}
),p.ajaxTransport("script",function(a){
if(a.crossDomain){
var c,d=e.head||e.getElementsByTagName("head")[0]||e.documentElement;
return{
send:function(f,g){
c=e.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,e){
if(e||!c.readyState||/loaded|complete/.test(c.readyState)){
c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||g(200,"success")
}}
,d.insertBefore(c,d.firstChild)
}
,abort:function(){
c&&c.onload(0,1)
}}
}}
);
var cI,cJ=a.ActiveXObject?function(){
for(var a in cI){
cI[a](0,1)
}}
:!1,cK=0;
p.ajaxSettings.xhr=a.ActiveXObject?function(){
return !this.isLocal&&cL()||cM()
}
:cL,function(a){
p.extend(p.support,{
ajax:!!a,cors:!!a&&"withCredentials" in a}
)
}
(p.ajaxSettings.xhr()),p.support.ajax&&p.ajaxTransport(function(c){
if(!c.crossDomain||p.support.cors){
var d;
return{
send:function(e,f){
var g,h,i=c.xhr();
c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async);
if(c.xhrFields){
for(h in c.xhrFields){
i[h]=c.xhrFields[h]
}}
c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");
try{
for(h in e){
i.setRequestHeader(h,e[h])
}}
catch(j){}
i.send(c.hasContent&&c.data||null),d=function(a,e){
var h,j,k,l,m;
try{
if(d&&(e||i.readyState===4)){
d=b,g&&(i.onreadystatechange=p.noop,cJ&&delete cI[g]);
if(e){
i.readyState!==4&&i.abort()
}else{
h=i.status,k=i.getAllResponseHeaders(),l={}
,m=i.responseXML,m&&m.documentElement&&(l.xml=m);
try{
l.text=i.responseText
}
catch(a){}
try{
j=i.statusText
}
catch(n){
j=""
}
!h&&c.isLocal&&!c.crossDomain?h=l.text?200:404:h===1223&&(h=204)
}}}
catch(o){
e||f(-1,o)
}
l&&f(h,j,l,k)
}
,c.async?i.readyState===4?setTimeout(d,0):(g=++cK,cJ&&(cI||(cI={}
,p(a).unload(cJ)),cI[g]=d),i.onreadystatechange=d):d()
}
,abort:function(){
d&&d(0,1)
}}
}}
);
var cN,cO,cP=/^(?:toggle|show|hide)$/,cQ=new RegExp("^(?:([-+])=|)("+q+")([a-z%]*)$","i"),cR=/queueHooks$/,cS=[cY],cT={
"*":[function(a,b){
var c,d,e,f=this.createTween(a,b),g=cQ.exec(b),h=f.cur(),i=+h||0,j=1;
if(g){
c=+g[2],d=g[3]||(p.cssNumber[a]?"":"px");
if(d!=="px"&&i){
i=p.css(f.elem,a,!0)||c||1;
do{
e=j=j||".5",i=i/j,p.style(f.elem,a,i+d),j=f.cur()/h
}
while(j!==1&&j!==e)
}
f.unit=d,f.start=i,f.end=g[1]?i+(g[1]+1)*c:c
}
return f
}
]};
p.Animation=p.extend(cW,{
tweener:function(a,b){
p.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");
var c,d=0,e=a.length;
for(;
d<e;
d++){
c=a[d],cT[c]=cT[c]||[],cT[c].unshift(b)
}}
,prefilter:function(a,b){
b?cS.unshift(a):cS.push(a)
}}
),p.Tween=cZ,cZ.prototype={
constructor:cZ,init:function(a,b,c,d,e,f){
this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(p.cssNumber[c]?"":"px")
}
,cur:function(){
var a=cZ.propHooks[this.prop];
return a&&a.get?a.get(this):cZ.propHooks._default.get(this)
}
,run:function(a){
var b,c=cZ.propHooks[this.prop];
return this.options.duration?this.pos=b=p.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):cZ.propHooks._default.set(this),this
}}
,cZ.prototype.init.prototype=cZ.prototype,cZ.propHooks={
_default:{
get:function(a){
var b;
return a.elem[a.prop]==null||!!a.elem.style&&a.elem.style[a.prop]!=null?(b=p.css(a.elem,a.prop,!1,""),!b||b==="auto"?0:b):a.elem[a.prop]
}
,set:function(a){
p.fx.step[a.prop]?p.fx.step[a.prop](a):a.elem.style&&(a.elem.style[p.cssProps[a.prop]]!=null||p.cssHooks[a.prop])?p.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now
}}}
,cZ.propHooks.scrollTop=cZ.propHooks.scrollLeft={
set:function(a){
a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)
}}
,p.each(["toggle","show","hide"],function(a,b){
var c=p.fn[b];
p.fn[b]=function(d,e,f){
return d==null||typeof d=="boolean"||!a&&p.isFunction(d)&&p.isFunction(e)?c.apply(this,arguments):this.animate(c$(b,!0),d,e,f)
}
}
),p.fn.extend({
fadeTo:function(a,b,c,d){
return this.filter(bZ).css("opacity",0).show().end().animate({
opacity:b}
,a,c,d)
}
,animate:function(a,b,c,d){
var e=p.isEmptyObject(a),f=p.speed(b,c,d),g=function(){
var b=cW(this,p.extend({}
,a),f);
e&&b.stop(!0)
};
return e||f.queue===!1?this.each(g):this.queue(f.queue,g)
}
,stop:function(a,c,d){
var e=function(a){
var b=a.stop;
delete a.stop,b(d)
};
return typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){
var b=!0,c=a!=null&&a+"queueHooks",f=p.timers,g=p._data(this);
if(c){
g[c]&&g[c].stop&&e(g[c])
}else{
for(c in g){
g[c]&&g[c].stop&&cR.test(c)&&e(g[c])
}}
for(c=f.length;
c--;
){
f[c].elem===this&&(a==null||f[c].queue===a)&&(f[c].anim.stop(d),b=!1,f.splice(c,1))
}
(b||!d)&&p.dequeue(this,a)
}
)
}}
),p.each({
slideDown:c$("show"),slideUp:c$("hide"),slideToggle:c$("toggle"),fadeIn:{
opacity:"show"}
,fadeOut:{
opacity:"hide"}
,fadeToggle:{
opacity:"toggle"}}
,function(a,b){
p.fn[a]=function(a,c,d){
return this.animate(b,a,c,d)
}
}
),p.speed=function(a,b,c){
var d=a&&typeof a=="object"?p.extend({}
,a):{
complete:c||!c&&b||p.isFunction(a)&&a,duration:a,easing:c&&b||b&&!p.isFunction(b)&&b};
d.duration=p.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in p.fx.speeds?p.fx.speeds[d.duration]:p.fx.speeds._default;
if(d.queue==null||d.queue===!0){
d.queue="fx"
}
return d.old=d.complete,d.complete=function(){
p.isFunction(d.old)&&d.old.call(this),d.queue&&p.dequeue(this,d.queue)
}
,d
}
,p.easing={
linear:function(a){
return a
}
,swing:function(a){
return 0.5-Math.cos(a*Math.PI)/2
}}
,p.timers=[],p.fx=cZ.prototype.init,p.fx.tick=function(){
var a,b=p.timers,c=0;
for(;
c<b.length;
c++){
a=b[c],!a()&&b[c]===a&&b.splice(c--,1)
}
b.length||p.fx.stop()
}
,p.fx.timer=function(a){
a()&&p.timers.push(a)&&!cO&&(cO=setInterval(p.fx.tick,p.fx.interval))
}
,p.fx.interval=13,p.fx.stop=function(){
clearInterval(cO),cO=null
}
,p.fx.speeds={
slow:600,fast:200,_default:400}
,p.fx.step={}
,p.expr&&p.expr.filters&&(p.expr.filters.animated=function(a){
return p.grep(p.timers,function(b){
return a===b.elem
}
).length
}
);
var c_=/^(?:body|html)$/i;
p.fn.offset=function(a){
if(arguments.length){
return a===b?this:this.each(function(b){
p.offset.setOffset(this,a,b)
}
)
}
var c,d,e,f,g,h,i,j,k,l,m=this[0],n=m&&m.ownerDocument;
if(!n){
return
}
return(e=n.body)===m?p.offset.bodyOffset(m):(d=n.documentElement,p.contains(d,m)?(c=m.getBoundingClientRect(),f=da(n),g=d.clientTop||e.clientTop||0,h=d.clientLeft||e.clientLeft||0,i=f.pageYOffset||d.scrollTop,j=f.pageXOffset||d.scrollLeft,k=c.top+i-g,l=c.left+j-h,{
top:k,left:l}
):{
top:0,left:0}
)
}
,p.offset={
bodyOffset:function(a){
var b=a.offsetTop,c=a.offsetLeft;
return p.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(p.css(a,"marginTop"))||0,c+=parseFloat(p.css(a,"marginLeft"))||0),{
top:b,left:c}
}
,setOffset:function(a,b,c){
var d=p.css(a,"position");
d==="static"&&(a.style.position="relative");
var e=p(a),f=e.offset(),g=p.css(a,"top"),h=p.css(a,"left"),i=(d==="absolute"||d==="fixed")&&p.inArray("auto",[g,h])>-1,j={}
,k={}
,l,m;
i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),p.isFunction(b)&&(b=b.call(a,c,f)),b.top!=null&&(j.top=b.top-f.top+l),b.left!=null&&(j.left=b.left-f.left+m),"using" in b?b.using.call(a,j):e.css(j)
}}
,p.fn.extend({
position:function(){
if(!this[0]){
return
}
var a=this[0],b=this.offsetParent(),c=this.offset(),d=c_.test(b[0].nodeName)?{
top:0,left:0}
:b.offset();
return c.top-=parseFloat(p.css(a,"marginTop"))||0,c.left-=parseFloat(p.css(a,"marginLeft"))||0,d.top+=parseFloat(p.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(p.css(b[0],"borderLeftWidth"))||0,{
top:c.top-d.top,left:c.left-d.left}
}
,offsetParent:function(){
return this.map(function(){
var a=this.offsetParent||e.body;
while(a&&!c_.test(a.nodeName)&&p.css(a,"position")==="static"){
a=a.offsetParent
}
return a||e.body
}
)
}}
),p.each({
scrollLeft:"pageXOffset",scrollTop:"pageYOffset"}
,function(a,c){
var d=/Y/.test(c);
p.fn[a]=function(e){
return p.access(this,function(a,e,f){
var g=da(a);
if(f===b){
return g?c in g?g[c]:g.document.documentElement[e]:a[e]
}
g?g.scrollTo(d?p(g).scrollLeft():f,d?f:p(g).scrollTop()):a[e]=f
}
,a,e,arguments.length,null)
}
}
),p.each({
Height:"height",Width:"width"}
,function(a,c){
p.each({
padding:"inner"+a,content:c,"":"outer"+a}
,function(d,e){
p.fn[e]=function(e,f){
var g=arguments.length&&(d||typeof e!="boolean"),h=d||(e===!0||f===!0?"margin":"border");
return p.access(this,function(c,d,e){
var f;
return p.isWindow(c)?c.document.documentElement["client"+a]:c.nodeType===9?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?p.css(c,d,e,h):p.style(c,d,e,h)
}
,c,g?e:b,g,null)
}
}
)
}
),a.jQuery=a.$=p,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){
return p
}
)
}
)(window)
}
if(AjxPackage.define("zimbra.csfe.ZmBatchCommand")){
ZmBatchCommand=function(e,t,a){
this._onError=(e===false)?ZmBatchCommand.STOP:ZmBatchCommand.CONTINUE;
this._accountName=t;
this._useJson=a;
this._requestBody=null;
this.curId=0;
this._cmds=[];
this._requests=[];
this._respCallbacks=[];
this._errorCallbacks=[]
};
ZmBatchCommand.prototype.toString=function(){
return"ZmBatchCommand"
};
ZmBatchCommand.prototype._sensitive=false;
ZmBatchCommand.prototype._noAuthToken=false;
ZmBatchCommand.STOP="stop";
ZmBatchCommand.CONTINUE="continue";
ZmBatchCommand.prototype.setSensitive=function(e){
this._sensitive=this._sensitive||e
};
ZmBatchCommand.prototype.setNoAuthToken=function(e){
this._noAuthToken=e
};
ZmBatchCommand.prototype.isSensitive=function(){
return this._sensitive
};
ZmBatchCommand.prototype.add=function(e){
this._cmds.push(e)
};
ZmBatchCommand.prototype.size=function(){
return this.curId||this._cmds.length
};
ZmBatchCommand.prototype.run=function(m,h,e){
for(var r=0;
r<this._cmds.length;
r++){
var o=this._cmds[r];
o.run(this);
this.curId++
}
var n={
sensitive:this._sensitive,noAuthToken:this._noAuthToken,asyncMode:true,callback:new AjxCallback(this,this._handleResponseRun,[m,h]),errorCallback:h,offlineCallback:e,accountName:this._accountName};
if(this._useJson){
var f={
BatchRequest:{
_jsns:"urn:zimbra",onerror:this._onError}};
var t=f.BatchRequest;
var p=this.size();
if(p&&this._requests.length){
for(var r=0;
r<p;
r++){
var s=this._requests[r];
if(s){
s.requestId=r;
var u=ZmCsfeCommand.getMethodName(s);
if(!t[u]){
t[u]=[]
}
s[u].requestId=r;
t[u].push(s[u])
}}
n.jsonObj=f;
this._requestBody=f
}}else{
var c=AjxSoapDoc.create("BatchRequest","urn:zimbra");
c.setMethodAttribute("onerror",this._onError);
var p=this.size();
if(p>0){
for(var r=0;
r<p;
r++){
var d=this._requests[r];
var l=d.getMethod();
l.setAttribute("requestId",r);
var a=c.adoptNode(l);
c.getMethod().appendChild(a)
}
n.soapDoc=c;
this._requestBody=c
}}
if(n.jsonObj||n.soapDoc){
appCtxt.getAppController().sendRequest(n)
}else{
if(m){
m.run()
}}};
ZmBatchCommand.prototype.getRequestBody=function(){
return this._requestBody
};
ZmBatchCommand.prototype._handleResponseRun=function(l,n,d){
var h=d.getResponse();
if(!h.BatchResponse){
return
}
var s=[];
for(var e in h.BatchResponse){
if(e.match(/^_/)){
continue
}
var c=h.BatchResponse[e];
for(var o=0;
o<c.length;
o++){
s[c[o].requestId]={
method:e,resp:c[o]}
}}
var t=[];
for(var o=0;
o<s.length;
o++){
var a=s[o];
try{
this._processResponse(a.method,a.resp)
}
catch(r){
t.push(r);
if(this._onError==ZmBatchCommand.STOP){
break
}}}
if(t.length>0&&n){
n.run.apply(n,t)
}else{
if(l){
l.run(d)
}}};
ZmBatchCommand.prototype.addRequestParams=function(t,a,e){
this._requests[this.curId]=t;
this._respCallbacks[this.curId]=a;
this._errorCallbacks[this.curId]=e
};
ZmBatchCommand.prototype.addNewRequestParams=function(t,a,e){
this.addRequestParams(t,a,e);
this.curId++
};
ZmBatchCommand.prototype._processResponse=function(s,o){
var n=o.requestId;
if(s=="Fault"){
var t=ZmCsfeCommand.faultToEx(o,"ZmBatchCommand.prototype.run");
if(this._errorCallbacks[n]){
var i=this._errorCallbacks[n].run(t);
if(!i){
appCtxt.getAppController()._handleException(t)
}}
throw t
}
if(this._respCallbacks[n]){
var a={};
a[s]=o;
var e=new ZmCsfeResult(a);
this._respCallbacks[n].run(e,o)
}}
}
if(AjxPackage.define("zimbra.csfe.ZmCsfeCommand")){
ZmCsfeCommand=function(){};
ZmCsfeCommand.prototype.isZmCsfeCommand=true;
ZmCsfeCommand.prototype.toString=function(){
return"ZmCsfeCommand"
};
ZmCsfeCommand._COOKIE_NAME="ZM_AUTH_TOKEN";
ZmCsfeCommand.serverUri=null;
ZmCsfeCommand._sessionId=null;
ZmCsfeCommand._staleSession={};
ZmCsfeCommand.REAUTH="reauth";
ZmCsfeCommand.RETRY="retry";
ZmCsfeCommand.getAuthToken=function(){
return AjxCookie.getCookie(document,ZmCsfeCommand._COOKIE_NAME)
};
ZmCsfeCommand.setCookieName=function(e){
ZmCsfeCommand._COOKIE_NAME=e
};
ZmCsfeCommand.setServerUri=function(e){
ZmCsfeCommand.serverUri=e
};
ZmCsfeCommand.setAuthToken=function(t,n,o,a){
ZmCsfeCommand._curAuthToken=t;
if(n!=null){
var i=null;
if(n>0){
i=new Date();
var e=parseInt(n);
i.setTime(i.getTime()+e)
}
AjxCookie.setCookie(document,ZmCsfeCommand._COOKIE_NAME,t,i,"/",null,a)
}else{
AjxCookie.deleteCookie(document,ZmCsfeCommand._COOKIE_NAME,"/")
}
if(o){
ZmCsfeCommand.setSessionId(o)
}};
ZmCsfeCommand.clearAuthToken=function(){
AjxCookie.deleteCookie(document,ZmCsfeCommand._COOKIE_NAME,"/")
};
ZmCsfeCommand.getSessionId=function(){
return ZmCsfeCommand._sessionId
};
ZmCsfeCommand.setSessionId=function(t){
var e=ZmCsfeCommand.extractSessionId(t);
if(e){
if(e&&!ZmCsfeCommand._staleSession[e]){
if(e!=ZmCsfeCommand._sessionId){
if(ZmCsfeCommand._sessionId){
ZmCsfeCommand._staleSession[ZmCsfeCommand._sessionId]=true
}
ZmCsfeCommand._sessionId=e
}}}};
ZmCsfeCommand.clearSessionId=function(){
ZmCsfeCommand._sessionId=null
};
ZmCsfeCommand.extractSessionId=function(e){
var t;
if(e instanceof Array){
e=e[0].id
}else{
if(e&&e.id){
e=e.id
}}
t=parseInt(e,10);
if(isNaN(t)){
t=null
}
return t
};
ZmCsfeCommand.faultToEx=function(t,a){
var i={
msg:AjxStringUtil.getAsString(t.Reason.Text),code:AjxStringUtil.getAsString(t.Detail.Error.Code),method:(a?a.methodNameStr:null),detail:AjxStringUtil.getAsString(t.Code.Value),data:t.Detail.Error.a,trace:(t.Detail.Error.Trace||"")};
var e;
if(a){
if(a.soapDoc){
i.request=a.soapDoc.getXml()
}else{
if(a.jsonRequestObj){
if(a.jsonRequestObj&&a.jsonRequestObj.Header&&a.jsonRequestObj.Header.context){
a.jsonRequestObj.Header.context.authToken="(removed)"
}
i.request=AjxStringUtil.prettyPrint(a.jsonRequestObj,true)
}}}
return new ZmCsfeException(i)
};
ZmCsfeCommand.getMethodName=function(t){
var e=(t&&t._methodEl&&t._methodEl.tagName)?t._methodEl.tagName:null;
if(!e){
for(var a in t){
if(/Request|Response$/.test(a)){
e=a;
break
}}}
return(e||"[unknown]")
};
ZmCsfeCommand.prototype.invoke=function(s){
this.cancelled=false;
if(!(s&&(s.soapDoc||s.jsonObj))){
return
}
var e=ZmCsfeCommand.getRequestStr(s);
var n;
try{
var o=(s.serverUri||ZmCsfeCommand.serverUri)+s.methodNameStr;
this._st=new Date();
var i={
"Content-Type":"application/soap+xml; charset=utf-8"};
if(AjxEnv.isIE6&&(location.protocol=="https:")){
i.Connection="Close"
}
if(s.asyncMode){
n=new AjxCallback(this,this._runCallback,[s]);
this._rpcId=AjxRpc.invoke(e,o,i,n)
}else{
var t=AjxRpc.invoke(e,o,i);
return(!s.returnXml)?(this._getResponseData(t,s)):t
}}
catch(a){
this._handleException(a,s,n)
}};
ZmCsfeCommand.prototype.invokeRest=function(i){
if(!(i&&i.restUri)){
return
}
var a;
try{
this._st=new Date();
if(i.asyncMode){
a=new AjxCallback(this,this._runCallback,[i]);
this._rpcId=AjxRpc.invoke(null,i.restUri,null,a,true)
}else{
var e=AjxRpc.invoke(null,i.restUri,null,null,true);
return e.text
}}
catch(t){
this._handleException(t,i,a)
}};
ZmCsfeCommand.prototype.cancel=function(){
if(!this._rpcId){
return
}
this.cancelled=true;
var e=AjxRpc.getRpcRequestById(this._rpcId);
if(e){
e.cancel();
if(AjxEnv.isFirefox3_5up){
AjxRpc.removeRpcCtxt(e)
}}};
ZmCsfeCommand.getRequestStr=function(e){
return e.soapDoc?ZmCsfeCommand._getSoapRequestStr(e):ZmCsfeCommand._getJsonRequestStr(e)
};
ZmCsfeCommand._getJsonRequestStr=function(s){
var o={
Header:{}
,Body:s.jsonObj};
var a=o.Header.context={
_jsns:"urn:zimbra"};
var i=["ZimbraWebClient - ",AjxEnv.browser," (",AjxEnv.platform,")"].join("");
a.userAgent={
name:i};
if(ZmCsfeCommand.clientVersion){
a.userAgent.version=ZmCsfeCommand.clientVersion
}
if(s.noSession){
a.nosession={}
}else{
var n=ZmCsfeCommand.getSessionId();
if(n){
a.session={
_content:n,id:n}
}else{
a.session={}
}}
if(s.targetServer){
a.targetServer={
_content:s.targetServer}
}
if(s.highestNotifySeen){
a.notify={
seq:s.highestNotifySeen}
}
if(s.changeToken){
a.change={
token:s.changeToken,type:"new"}
}
if(!s.skipAuthCheck){
if(s.accountId){
a.account={
_content:s.accountId,by:"id"}
}else{
if(s.accountName){
a.account={
_content:s.accountName,by:"name"}
}}}
if(s.useXml){
a.format={
type:"xml"}
}
s.methodNameStr=ZmCsfeCommand.getMethodName(s.jsonObj);
if(!s.noAuthToken){
var t=s.authToken||ZmCsfeCommand.getAuthToken();
if(!t){
throw new ZmCsfeException(ZMsg.authTokenRequired,ZmCsfeException.NO_AUTH_TOKEN,s.methodNameStr)
}
if(ZmCsfeCommand._curAuthToken&&!s.skipAuthCheck&&(s.resend!=ZmCsfeCommand.REAUTH)&&(t!=ZmCsfeCommand._curAuthToken)){
throw new ZmCsfeException(ZMsg.authTokenChanged,ZmCsfeException.AUTH_TOKEN_CHANGED,s.methodNameStr)
}
a.authToken=ZmCsfeCommand._curAuthToken=t
}else{
if(ZmCsfeCommand.noAuth){
throw new ZmCsfeException(ZMsg.authRequired,ZmCsfeException.NO_AUTH_TOKEN,s.methodNameStr)
}}
if(window.csrfToken){
a.csrfToken=window.csrfToken
}
AjxDebug.logSoapMessage(s);
s.jsonRequestObj=o;
var e=(s.useStringify1?JSON.stringify1(o):JSON.stringify(o));
return AjxStringUtil.jsEncode(e)
};
ZmCsfeCommand._getSoapRequestStr=function(s){
var d=s.soapDoc;
if(!s.resend){
var m=d.createHeaderElement();
var o=d.set("context",null,m,"urn:zimbra");
var t=d.set("userAgent",null,o);
var a=["ZimbraWebClient - ",AjxEnv.browser," (",AjxEnv.platform,")"].join("");
t.setAttribute("name",a);
if(ZmCsfeCommand.clientVersion){
t.setAttribute("version",ZmCsfeCommand.clientVersion)
}
if(s.noSession){
d.set("nosession",null,o)
}else{
var r=ZmCsfeCommand.getSessionId();
var h=d.set("session",null,o);
if(r){
h.setAttribute("id",r)
}}
if(s.targetServer){
d.set("targetServer",s.targetServer,o)
}
if(s.highestNotifySeen){
var f=d.set("notify",null,o);
f.setAttribute("seq",s.highestNotifySeen)
}
if(s.changeToken){
var c=d.set("change",null,o);
c.setAttribute("token",s.changeToken);
c.setAttribute("type","new")
}
if(!s.skipAuthCheck){
if(s.accountId){
var n=d.set("account",s.accountId,o);
n.setAttribute("by","id")
}else{
if(s.accountName){
var n=d.set("account",s.accountName,o);
n.setAttribute("by","name")
}}}
if(s.skipExpiredToken){
var l=d.set("authTokenControl",null,o);
l.setAttribute("voidOnExpired","1")
}
if(!s.useXml){
var i=d.set("format",null,o);
i.setAttribute("type","js")
}}
s.methodNameStr=ZmCsfeCommand.getMethodName(d);
if(!s.noAuthToken){
var u=s.authToken||ZmCsfeCommand.getAuthToken();
if(!u){
throw new ZmCsfeException(ZMsg.authTokenRequired,ZmCsfeException.NO_AUTH_TOKEN,s.methodNameStr)
}
if(ZmCsfeCommand._curAuthToken&&!s.skipAuthCheck&&(s.resend!=ZmCsfeCommand.REAUTH)&&(u!=ZmCsfeCommand._curAuthToken)){
throw new ZmCsfeException(ZMsg.authTokenChanged,ZmCsfeException.AUTH_TOKEN_CHANGED,s.methodNameStr)
}
ZmCsfeCommand._curAuthToken=u;
if(s.resend==ZmCsfeCommand.REAUTH){
var e=d.getDoc().getElementsByTagName("authToken");
if(e&&e.length==1){
e[0].firstChild.data=u
}else{
e=d.getDoc().getElementsByTagName("context");
if(e&&e.length==1){
d.set("authToken",u,e[0])
}else{}}}else{
if(!s.resend){
d.set("authToken",u,o)
}}}else{
if(ZmCsfeCommand.noAuth&&!s.ignoreAuthToken){
throw new ZmCsfeException(ZMsg.authRequired,ZmCsfeException.NO_AUTH_TOKEN,s.methodNameStr)
}}
if(window.csrfToken){
d.set("csrfToken",window.csrfToken,o)
}
AjxDebug.logSoapMessage(s);
return d.getXml()
};
ZmCsfeCommand.prototype._runCallback=function(a,e){
if(!e){
return
}
if(this.cancelled&&a.skipCallbackIfCancelled){
return
}
var t;
if(e instanceof ZmCsfeResult){
t=e
}else{
t=this._getResponseData(e,a)
}
this._en=new Date();
if(a.callback&&t){
a.callback.run(t)
}else{
if(!a.emptyResponseOkay){}}};
ZmCsfeCommand.prototype._getResponseData=function(i,a){
this._en=new Date();
var l=new ZmCsfeResult();
var t=false;
var e=Boolean(a.restUri);
var n=null;
if(!i.success&&!i.xml&&(/<html/i.test(i.text))){
var r=new ZmCsfeException(null,ZmCsfeException.CSFE_SVC_ERROR,a.methodNameStr,"HTTP response status "+i.status);
if(a.asyncMode){
l.set(r,true);
return l
}else{
throw r
}}
if(typeof(i.text)=="string"&&i.text.indexOf("{")==0){
n=i.text
}else{
if(!e){
try{
t=true;
if(!(i.text||(i.xml&&(typeof i.xml)=="string"))){
if(a.emptyResponseOkay){
return null
}else{
throw new ZmCsfeException(null,ZmCsfeException.EMPTY_RESPONSE,a.methodNameStr)
}}
n=(AjxEnv.isIE||i.xml==null)?AjxSoapDoc.createFromXml(i.text):AjxSoapDoc.createFromDom(i.xml)
}
catch(r){
if(a.asyncMode){
l.set(r,true);
return l
}else{
throw r
}}
if(!n){
var r=new ZmCsfeException(null,ZmCsfeException.SOAP_ERROR,a.methodNameStr,"Bad XML response doc");
if(a.asyncMode){
l.set(r,true);
return l
}else{
throw r
}}}}
var o=e?i.text:{};
if(t){
o=n._xmlDoc.toJSObject(true,false,true)
}else{
if(!e){
try{
o=JSON.parse(n)
}
catch(r){
if(r.name=="SyntaxError"){
r=new ZmCsfeException(null,ZmCsfeException.BAD_JSON_RESPONSE,a.methodNameStr,n);
AjxDebug.println(AjxDebug.BAD_JSON,"bad json. respDoc="+n)
}
if(a.asyncMode){
l.set(r,true);
return l
}else{
throw r
}}}}
a.methodNameStr=ZmCsfeCommand.getMethodName(o.Body);
AjxDebug.logSoapMessage(a);
var s=o&&o.Body&&o.Body.Fault;
if(s){
if(AjxUtil.isString(s)&&s.indexOf("<")==0){
s=AjxXmlDoc.createFromXml(s).toJSObject(true,false,true)
}
var r=ZmCsfeCommand.faultToEx(s,a);
if(a.asyncMode){
l.set(r,true,o.Header);
return l
}else{
throw r
}}else{
if(!i.success){
var r=new ZmCsfeException(null,ZmCsfeException.CSFE_SVC_ERROR,a.methodNameStr,"HTTP response status "+i.status);
if(a.asyncMode){
l.set(r,true);
return l
}else{
throw r
}}else{
if(a.asyncMode){
l.set(o)
}}}
var h=o.Header&&o.Header.context&&o.Header.context.session;
ZmCsfeCommand.setSessionId(h);
return a.asyncMode?l:o
};
ZmCsfeCommand.prototype._handleException=function(e,a,i){
if(!(e&&(e instanceof ZmCsfeException||e instanceof AjxSoapException||e instanceof AjxException))){
var t=new ZmCsfeException();
t.method=a.methodNameStr||a.restUri;
t.detail=e?e.toString():"undefined exception";
t.code=ZmCsfeException.UNKNOWN_ERROR;
t.msg="Unknown Error";
e=t
}
if(a.asyncMode){
i.run(new ZmCsfeResult(e,true))
}else{
throw e
}}
}
if(AjxPackage.define("zimbra.csfe.ZmCsfeException")){
ZmCsfeException=function(o){
o=Dwt.getParams(arguments,ZmCsfeException.PARAMS);
AjxException.call(this,o.msg,o.code,o.method,o.detail);
if(o.data){
this.data={};
for(var t=0;
t<o.data.length;
t++){
var a=o.data[t];
var e=a.n;
if(!this.data[e]){
this.data[e]=[]
}
this.data[e].push(a._content)
}}
this.trace=o.trace;
this.request=o.request
};
ZmCsfeException.PARAMS=["msg","code","method","detail","data","trace"];
ZmCsfeException.prototype=new AjxException;
ZmCsfeException.prototype.constructor=ZmCsfeException;
ZmCsfeException.prototype.isZmCsfeException=true;
ZmCsfeException.prototype.toString=function(){
return"ZmCsfeException"
};
ZmCsfeException.MAIL_SEND_ADDRESS_FAILURE_INVALID="invalid";
ZmCsfeException.MAIL_SEND_ADDRESS_FAILURE_UNSENT="unsent";
ZmCsfeException.getErrorMsg=function(t,e){
var a=ZMsg[t];
if(!a){
ZmCsfeException._unknownFormat=ZmCsfeException._unknownFormat||new AjxMessageFormat(ZMsg.unknownError);
return ZmCsfeException._unknownFormat.format(t)
}
this.msg=this.msg||a;
return e?AjxMessageFormat.format(a,e):a
};
ZmCsfeException.prototype.getErrorMsg=function(e){
return ZmCsfeException.getErrorMsg(this.code,e)
};
ZmCsfeException.prototype.getData=function(e){
return this.data&&this.data[e]
};
ZmCsfeException.AUTH_TOKEN_CHANGED="AUTH_TOKEN_CHANGED";
ZmCsfeException.BAD_JSON_RESPONSE="BAD_JSON_RESPONSE";
ZmCsfeException.CSFE_SVC_ERROR="CSFE_SVC_ERROR";
ZmCsfeException.EMPTY_RESPONSE="EMPTY_RESPONSE";
ZmCsfeException.NETWORK_ERROR="NETWORK_ERROR";
ZmCsfeException.NO_AUTH_TOKEN="NO_AUTH_TOKEN";
ZmCsfeException.SOAP_ERROR="SOAP_ERROR";
ZmCsfeException.LICENSE_ERROR="service.LICENSE_ERROR";
ZmCsfeException.SVC_ALREADY_IN_PROGRESS="service.ALREADY_IN_PROGRESS";
ZmCsfeException.SVC_AUTH_EXPIRED="service.AUTH_EXPIRED";
ZmCsfeException.SVC_AUTH_REQUIRED="service.AUTH_REQUIRED";
ZmCsfeException.SVC_FAILURE="service.FAILURE";
ZmCsfeException.SVC_INVALID_REQUEST="service.INVALID_REQUEST";
ZmCsfeException.SVC_PARSE_ERROR="service.PARSE_ERROR";
ZmCsfeException.SVC_PERM_DENIED="service.PERM_DENIED";
ZmCsfeException.SVC_RESOURCE_UNREACHABLE="service.RESOURCE_UNREACHABLE";
ZmCsfeException.SVC_UNKNOWN_DOCUMENT="service.UNKNOWN_DOCUMENT";
ZmCsfeException.SVC_TEMPORARILY_UNAVAILABLE="service.TEMPORARILY_UNAVAILABLE";
ZmCsfeException.SVC_WRONG_HOST="service.WRONG_HOST";
ZmCsfeException.ACCT_AUTH_FAILED="account.AUTH_FAILED";
ZmCsfeException.ACCT_CHANGE_PASSWORD="account.CHANGE_PASSWORD";
ZmCsfeException.ACCT_EXISTS="account.ACCOUNT_EXISTS";
ZmCsfeException.ACCT_TOO_MANY_ACCOUNTS="account.TOO_MANY_ACCOUNTS";
ZmCsfeException.ACCT_INVALID_ATTR_VALUE="account.INVALID_ATTR_VALUE";
ZmCsfeException.ACCT_INVALID_PASSWORD="account.INVALID_PASSWORD";
ZmCsfeException.ACCT_INVALID_PREF_NAME="account.INVALID_PREF_NAME";
ZmCsfeException.ACCT_INVALID_PREF_VALUE="account.INVALID_PREF_VALUE";
ZmCsfeException.ACCT_MAINTENANCE_MODE="account.MAINTENANCE_MODE";
ZmCsfeException.ACCT_NO_SUCH_ACCOUNT="account.NO_SUCH_ACCOUNT";
ZmCsfeException.ACCT_NO_SUCH_SAVED_SEARCH="account.NO_SUCH_SAVED_SEARCH";
ZmCsfeException.ACCT_NO_SUCH_TAG="account.ACCT_NO_SUCH_TAG";
ZmCsfeException.ACCT_PASS_CHANGE_TOO_SOON="account.PASSWORD_CHANGE_TOO_SOON";
ZmCsfeException.ACCT_PASS_LOCKED="account.PASSWORD_LOCKED";
ZmCsfeException.ACCT_PASS_RECENTLY_USED="account.PASSWORD_RECENTLY_USED";
ZmCsfeException.COS_EXISTS="account.COS_EXISTS";
ZmCsfeException.DISTRIBUTION_LIST_EXISTS="account.DISTRIBUTION_LIST_EXISTS";
ZmCsfeException.DOMAIN_EXISTS="account.DOMAIN_EXISTS";
ZmCsfeException.DOMAIN_NOT_EMPTY="account.DOMAIN_NOT_EMPTY";
ZmCsfeException.IDENTITY_EXISTS="account.IDENTITY_EXISTS";
ZmCsfeException.NO_SUCH_DISTRIBUTION_LIST="account.NO_SUCH_DISTRIBUTION_LIST";
ZmCsfeException.NO_SUCH_DOMAIN="account.NO_SUCH_DOMAIN";
ZmCsfeException.MAINTENANCE_MODE="account.MAINTENANCE_MODE";
ZmCsfeException.TOO_MANY_IDENTITIES="account.TOO_MANY_IDENTITIES";
ZmCsfeException.TOO_MANY_SEARCH_RESULTS="account.TOO_MANY_SEARCH_RESULTS";
ZmCsfeException.NO_SUCH_COS="account.NO_SUCH_COS";
ZmCsfeException.SIGNATURE_EXISTS="account.SIGNATURE_EXISTS";
ZmCsfeException.CANNOT_CHANGE_VOLUME="volume.CANNOT_CHANGE_TYPE_OF_CURRVOL";
ZmCsfeException.CANNOT_DELETE_VOLUME_IN_USE="volume.CANNOT_DELETE_VOLUME_IN_USE";
ZmCsfeException.NO_SUCH_VOLUME="volume.NO_SUCH_VOLUME";
ZmCsfeException.ALREADY_EXISTS="volume.ALREADY_EXISTS";
ZmCsfeException.VOLUME_NO_SUCH_PATH="volume.NO_SUCH_PATH";
ZmCsfeException.MAIL_ALREADY_EXISTS="mail.ALREADY_EXISTS";
ZmCsfeException.MAIL_IMMUTABLE="mail.IMMUTABLE_OBJECT";
ZmCsfeException.MAIL_INVALID_NAME="mail.INVALID_NAME";
ZmCsfeException.MAIL_INVITE_OUT_OF_DATE="mail.INVITE_OUT_OF_DATE";
ZmCsfeException.MAIL_MAINTENANCE_MODE="mail.MAINTENANCE";
ZmCsfeException.MAIL_MESSAGE_TOO_BIG="mail.MESSAGE_TOO_BIG";
ZmCsfeException.MAIL_MUST_RESYNC="mail.MUST_RESYNC";
ZmCsfeException.MAIL_NO_SUCH_CALITEM="mail.NO_SUCH_CALITEM";
ZmCsfeException.MAIL_NO_SUCH_CONV="mail.NO_SUCH_CONV";
ZmCsfeException.MAIL_NO_SUCH_FOLDER="mail.NO_SUCH_FOLDER";
ZmCsfeException.MAIL_NO_SUCH_ITEM="mail.NO_SUCH_ITEM";
ZmCsfeException.MAIL_NO_SUCH_MOUNTPOINT="mail.NO_SUCH_MOUNTPOINT";
ZmCsfeException.MAIL_NO_SUCH_MSG="mail.NO_SUCH_MSG";
ZmCsfeException.MAIL_NO_SUCH_PART="mail.NO_SUCH_PART";
ZmCsfeException.MAIL_NO_SUCH_TAG="mail.NO_SUCH_TAG";
ZmCsfeException.MAIL_QUERY_PARSE_ERROR="mail.QUERY_PARSE_ERROR";
ZmCsfeException.MAIL_QUOTA_EXCEEDED="mail.QUOTA_EXCEEDED";
ZmCsfeException.MAIL_SEND_ABORTED_ADDRESS_FAILURE="mail.SEND_ABORTED_ADDRESS_FAILURE";
ZmCsfeException.MAIL_SEND_FAILURE="mail.SEND_FAILURE";
ZmCsfeException.MAIL_TOO_MANY_CONTACTS="mail.TOO_MANY_CONTACTS";
ZmCsfeException.MAIL_TOO_MANY_TERMS="mail.TOO_MANY_QUERY_TERMS_EXPANDED";
ZmCsfeException.MAIL_UNABLE_TO_IMPORT_APPOINTMENTS="mail.MAIL_UNABLE_TO_IMPORT_APPOINTMENTS";
ZmCsfeException.MAIL_UNABLE_TO_IMPORT_CONTACTS="mail.UNABLE_TO_IMPORT_CONTACTS";
ZmCsfeException.MODIFY_CONFLICT="mail.MODIFY_CONFLICT";
ZmCsfeException.TOO_MANY_TAGS="mail.TOO_MANY_TAGS";
ZmCsfeException.CANNOT_RENAME="mail.CANNOT_RENAME";
ZmCsfeException.CANNOT_UNLOCK="mail.CANNOT_UNLOCK";
ZmCsfeException.CANNOT_LOCK="mail.CANNOT_LOCK";
ZmCsfeException.LOCKED="mail.LOCKED";
ZmCsfeException.UPLOAD_REJECTED="mail.UPLOAD_REJECTED";
ZmCsfeException.MUST_BE_ORGANIZER="mail.MUST_BE_ORGANIZER";
ZmCsfeException.OFFLINE_ONLINE_ONLY_OP="offline.ONLINE_ONLY_OP"
}
if(AjxPackage.define("zimbra.csfe.ZmCsfeResult")){
ZmCsfeResult=function(e,t,a){
this.set(e,t,a)
};
ZmCsfeResult.prototype.isZmCsfeResult=true;
ZmCsfeResult.prototype.toString=function(){
return"ZmCsfeResult"
};
ZmCsfeResult.prototype.set=function(e,t,a){
this._data=e;
this._isException=(t===true);
this._header=a
};
ZmCsfeResult.prototype.getResponse=function(){
if(this._isException){
throw this._data
}else{
return this._data
}};
ZmCsfeResult.prototype.getException=function(){
return this._isException?this._data:null
};
ZmCsfeResult.prototype.isException=function(){
return this._isException
};
ZmCsfeResult.prototype.getHeader=function(){
return this._header
}
}
if(AjxPackage.define("zimbraMail.core.ZmId")){
ZmId=function(){};
ZmId.WIDGET="z";
ZmId.WIDGET_VIEW="zv";
ZmId.WIDGET_TOOLBAR="ztb";
ZmId.WIDGET_BUTTON="zb";
ZmId.WIDGET_INPUT="zi";
ZmId.WIDGET_MENU="zm";
ZmId.WIDGET_MENU_ITEM="zmi";
ZmId.WIDGET_SELECT="zs";
ZmId.WIDGET_OVERVIEW_CNTR="zovc";
ZmId.WIDGET_OVERVIEW="zov";
ZmId.WIDGET_TREE="zt";
ZmId.WIDGET_TREE_ITEM_HDR="ztih";
ZmId.WIDGET_TREE_ITEM="zti";
ZmId.WIDGET_TAB="ztab";
ZmId.WIDGET_AUTOCOMPLETE="zac";
ZmId.WIDGET_CHECKBOX="zcb";
ZmId.WIDGET_COMBOBOX="zcombo";
ZmId.WIDGET_CHOOSER="zchooser";
ZmId.WIDGET_CALENDAR="zcal";
ZmId.SKIN_APP_BOTTOM_TOOLBAR="skin_container_app_bottom_toolbar";
ZmId.SKIN_APP_CHOOSER="skin_container_app_chooser";
ZmId.SKIN_APP_MAIN_FULL="skin_container_app_main_full";
ZmId.SKIN_APP_MAIN="skin_container_app_main";
ZmId.SKIN_APP_MAIN_ROW_FULL="skin_tr_main_full";
ZmId.SKIN_APP_MAIN_ROW="skin_tr_main";
ZmId.SKIN_APP_TOP_TOOLBAR="skin_container_app_top_toolbar";
ZmId.SKIN_APP_NEW_BUTTON="skin_container_app_new_button";
ZmId.SKIN_LINKS="skin_container_links";
ZmId.SKIN_LOGO="skin_container_logo";
ZmId.SKIN_QUOTA_INFO="skin_container_quota";
ZmId.SKIN_SASH="skin_container_tree_app_sash";
ZmId.SKIN_SEARCH_BUILDER="skin_container_search_builder";
ZmId.SKIN_SEARCH_BUILDER_TOOLBAR="skin_container_search_builder_toolbar";
ZmId.SKIN_SEARCH_BUILDER_TR="skin_tr_search_builder";
ZmId.SKIN_SEARCH="skin_container_search";
ZmId.SKIN_SEARCH_RESULTS_TOOLBAR="skin_container_search_results_toolbar";
ZmId.SKIN_REFRESH="skin_container_refresh";
ZmId.SKIN_OFFLINE_STATUS="skin_container_offline";
ZmId.SKIN_SHELL="skin_outer";
ZmId.SKIN_SPACING_SEARCH="skin_spacing_search";
ZmId.SKIN_SPLASH_SCREEN="skin_container_splash_screen";
ZmId.SKIN_STATUS="skin_container_status";
ZmId.SKIN_STATUS_ROW="skin_tr_status";
ZmId.SKIN_TREE_FOOTER="skin_container_tree_footer";
ZmId.SKIN_TREE="skin_container_tree";
ZmId.SKIN_USER_INFO="skin_container_username";
ZmId.SKIN_TASKBAR="skin_container_taskbar";
ZmId.SKIN_FOOTER="skin_footer";
ZmId.SKIN_AD="skin_adsrvc";
ZmId.SKIN_UNITTEST="skin_unittest";
ZmId.SHELL="z_shell";
ZmId.LOADING_VIEW="z_loading";
ZmId.MAIN_SASH="z_sash";
ZmId.BANNER="z_banner";
ZmId.SEARCH_TOOLBAR="ztb_search";
ZmId.SEARCHRESULTS_TOOLBAR="ztb_searchresults";
ZmId.SEARCHRESULTS_PANEL="z_filterPanel";
ZmId.USER_NAME="z_userName";
ZmId.USER_QUOTA="z_userQuota";
ZmId.PRESENCE="z_presence";
ZmId.TASKBAR="z_taskbar";
ZmId.NEW_FOLDER_BUTTON="zb_newFolder";
ZmId.STATUS_VIEW="z_status";
ZmId.TOAST="z_toast";
ZmId.APP_CHOOSER="ztb_appChooser";
ZmId.getToolbarId=function(t,e){
return DwtId.makeId(ZmId.WIDGET_TOOLBAR,t,e)
};
ZmId.TB_INVITE="Inv";
ZmId.TB_COUNTER="Cou";
ZmId.TB_NAV="Nav";
ZmId.TB_SHARE="Shr";
ZmId.TB_REPLY="Rep";
ZmId.TB_SUBSCRIBE="Sub";
ZmId.getButtonId=function(t,a,e){
return DwtId.makeId(ZmId.WIDGET_BUTTON,t,e,a)
};
ZmId.getMenuId=function(t,e){
return DwtId.makeId(ZmId.WIDGET_MENU,t,e)
};
ZmId.MENU_PARTICIPANT="Par";
ZmId.MENU_DRAFTS="Dra";
ZmId.getMenuItemId=function(t,a,e){
return DwtId.makeId(ZmId.WIDGET_MENU_ITEM,t,e,a)
};
ZmId.getOverviewContainerId=function(e){
return DwtId.makeId(ZmId.WIDGET_OVERVIEW_CNTR,e)
};
ZmId.getOverviewId=function(e){
return DwtId.makeId(ZmId.WIDGET_OVERVIEW,e)
};
ZmId.getTreeId=function(t,e){
return DwtId.makeId(ZmId.WIDGET_TREE,t,e)
};
ZmId.getTreeItemId=function(a,t,e){
if(!t&&!e){
return
}
if(e){
return DwtId.makeId(ZmId.WIDGET_TREE_ITEM_HDR,a,e)
}else{
return DwtId.makeId(ZmId.WIDGET_TREE_ITEM,a,t)
}};
ZmId.getViewId=function(e,t,a){
var i=DwtId.makeId(ZmId.WIDGET_VIEW,a,e);
return t?[i,t].join(""):i
};
ZmId.getComposeViewId=function(e){
var t=DwtId.makeId(ZmId.WIDGET,ZmId.COMPOSE_VIEW);
return e?[t,e].join(""):t
};
ZmId.getTabId=function(e,t){
return DwtId.makeId(ZmId.WIDGET_TAB,e,t)
};
ZmId.getPrefPageId=function(e){
return"PREF_PAGE_"+e
};
ZmId.SEARCH_INPUT="zi_search";
ZmId.SEARCH_INPUTFIELD=ZmId.SEARCH_INPUT+"_inputfield";
ZmId.SEARCH="Search";
ZmId.SEARCH_CUSTOM="CUSTOM";
ZmId.SEARCH_MENU="MENU";
ZmId.SEARCH_SEARCH="SEARCH";
ZmId.SEARCH_SAVE="SAVE";
ZmId.SEARCH_ADVANCED="ADV";
ZmId.SEARCH_LOCAL="LOCAL";
ZmId.SEARCH_ALL_ACCOUNTS="ALL_ACCOUNTS";
ZmId.SEARCH_GAL="GAL";
ZmId.SEARCH_MAIL="MAIL";
ZmId.SEARCH_SHARED="SHARED";
ZmId.SEARCHRESULTS_INPUT="zi_searchresults";
ZmId.SEARCHRESULTS_INPUTFIELD=ZmId.SEARCHRESULTS_INPUT+"_inputfield";
ZmId.SEARCHRESULTS="SearchResults";
ZmId.SEARCHRESULTS_SEARCH="SEARCH";
ZmId.SEARCHRESULTS_SAVE="SAVE";
ZmId.APP="App";
ZmId.TREEITEM_INBOX="zti|Mail|2";
ZmId.TREEITEM_JUNK="zti|Mail|4";
ZmId.TREEITEM_SENT="zti|Mail|5";
ZmId.TREEITEM_DRAFTS="zti|Mail|6";
ZmId.TREEITEM_TRASH_MAIL="zti|Mail|3";
ZmId.TREEITEM_TRASH_CONTACTS="zti|Contacts|3";
ZmId.TREEITEM_CONTACTS="zti|Contacts|7";
ZmId.TREEITEM_CALENDAR="zti|Calendar|10";
ZmId.TREEITEM_TASKS="zti|Tasks|15";
ZmId.TREEITEM_BRIEFCASE="zti|Briefcase|16";
ZmId.MV_HDR_TABLE="_hdrTable";
ZmId.MV_HDR_TABLE_TOP_ROW="_hdrTableTopRow";
ZmId.MV_REPORT_BTN_CELL="_reportBtnCell";
ZmId.MV_EXPAND_ROW="_expandRow";
ZmId.MV_EXPAND_HDR="_expandHeader";
ZmId.MV_ATT_LINKS="_attLinks";
ZmId.MV_CONTACT_AREA="_contactArea";
ZmId.MV_HIGHLIGHT_OBJ="_highlightObjects";
ZmId.MV_DISPLAY_IMAGES="_displayImages";
ZmId.MV_MSG_TRUNC="_msgTruncation";
ZmId.MV_INFO_BAR="_infoBar";
ZmId.MV_TAG_ROW="_tagRow";
ZmId.MV_TAG_CELL="_tagCell";
ZmId.MV_MSG_BODY="_body";
ZmId.MV_MSG_HEADER="_header";
ZmId.MV_MSG_FOOTER="_footer";
ZmId.MV_PRIORITY="_msgPriority";
ZmId.CMP_HEADER="_header";
ZmId.CMP_FROM_SELECT="_from_select";
ZmId.CMP_TO_ROW="_to_row";
ZmId.CMP_TO_PICKER="_to_picker";
ZmId.CMP_TO_INPUT="_to_control";
ZmId.CMP_CC_ROW="_cc_row";
ZmId.CMP_CC_PICKER="_cc_picker";
ZmId.CMP_CC_INPUT="_cc_control";
ZmId.CMP_BCC_ROW="_bcc_row";
ZmId.CMP_BCC_PICKER="_bcc_picker";
ZmId.CMP_BCC_INPUT="_bcc_control";
ZmId.CMP_OBO_CHECKBOX="_obo_checkbox";
ZmId.CMP_OBO_LABEL="_obo_label";
ZmId.CMP_OBO_ROW="_obo_row";
ZmId.CMP_OBO_SPAN="_obo_span";
ZmId.CMP_BWO_SPAN="_bwo_span";
ZmId.CMP_SUBJECT_ROW="_subject_row";
ZmId.CMP_SUBJECT_INPUT="_subject_control";
ZmId.CMP_IDENTITY_ROW="_identity_row";
ZmId.CMP_IDENTITY_SELECT="_identity_control";
ZmId.CMP_PRIORITY="_priority";
ZmId.CMP_REPLY_ATT_ROW="_reply_attachments_link";
ZmId.CMP_ATT_ROW="_attachments_row";
ZmId.CMP_ATT_DIV="_attachments_div";
ZmId.CMP_ATT_BTN="_attachments_btn";
ZmId.CMP_ATT_INP="_file_input";
ZmId.CMP_ATT_COMPUTER_INP="_file_input_computer";
ZmId.CMP_ATT_INLINE_INP="_file_input_inline";
ZmId.CMP_ATT_INCL_ORIG_LINK="_show_orig";
ZmId.CMP_DND_TOOLTIP="_zdnd_tooltip";
ZmId.CMP_TO_CELL="_to_cell";
ZmId.CMP_CC_CELL="_cc_cell";
ZmId.CMP_BCC_CELL="_bcc_cell";
ZmId.CMP_TO="TO";
ZmId.CMP_CC="CC";
ZmId.CMP_BCC="BCC";
ZmId.APP_BRIEFCASE="Briefcase";
ZmId.APP_CALENDAR="Calendar";
ZmId.APP_CONTACTS="Contacts";
ZmId.APP_IM="IM";
ZmId.APP_MAIL="Mail";
ZmId.APP_PORTAL="Portal";
ZmId.APP_PREFERENCES="Options";
ZmId.APP_SEARCH="Search";
ZmId.APP_SOCIAL="Social";
ZmId.APP_TASKS="Tasks";
ZmId.APP_VOICE="Voice";
ZmId.VIEW_ACCOUNT="ACCT";
ZmId.VIEW_APPOINTMENT="APPT";
ZmId.VIEW_SIMPLE_ADD_APPOINTMENT="SAPPT";
ZmId.VIEW_APPOINTMENT_READONLY="APPTRO";
ZmId.VIEW_APPT_SCHEDULE="APPTS";
ZmId.VIEW_BRIEFCASE="BC";
ZmId.VIEW_BRIEFCASE_DETAIL="BCD";
ZmId.VIEW_BRIEFCASE_COLUMN="BCC";
ZmId.VIEW_BRIEFCASE_ICON="BCI";
ZmId.VIEW_BRIEFCASE_PREVIEW="BCP";
ZmId.VIEW_BRIEFCASE_REVISION="BRLV";
ZmId.VIEW_BRIEFCASE_DETAIL="BDLV";
ZmId.VIEW_CAL="CAL";
ZmId.VIEW_CAL_APPT="CLA";
ZmId.VIEW_CAL_DAY="CLD";
ZmId.VIEW_CAL_LIST="CLL";
ZmId.VIEW_CAL_MONTH="CLM";
ZmId.VIEW_CAL_WEEK="CLW";
ZmId.VIEW_CAL_WORK_WEEK="CLWW";
ZmId.VIEW_CAL_FB="CLFB";
ZmId.VIEW_CAL_TRASH="CLT";
ZmId.VIEW_SUGGEST_TIME_PANE="CSTP";
ZmId.VIEW_SUGGEST_LOCATION_PANE="CSLP";
ZmId.VIEW_CALL_LIST="CLIST";
ZmId.VIEW_COMPOSE="COMPOSE";
ZmId.VIEW_CONTACT_SIMPLE="CNS";
ZmId.VIEW_CONTACT_SRC="CNSRC";
ZmId.VIEW_CONTACT_TGT="CNTGT";
ZmId.VIEW_CONTACT="CN";
ZmId.VIEW_CONV="CV";
ZmId.VIEW_CONV2="CV2";
ZmId.VIEW_CONVLIST="CLV";
ZmId.VIEW_FILTER_RULES="FRV";
ZmId.VIEW_GROUP="GRP";
ZmId.VIEW_IM_CHAT_MEMBER_LIST="IMCML";
ZmId.VIEW_IM_CHAT_MULTI_WINDOW="IMCMW";
ZmId.VIEW_IM_CHAT_TAB="IMCT";
ZmId.VIEW_LOADING="LOADING";
ZmId.VIEW_MAIL_CONFIRM="MAILCONFIRM";
ZmId.VIEW_MOBILE_DEVICES="MD";
ZmId.VIEW_MSG="MSG";
ZmId.VIEW_MSG_CAPSULE="MSGC";
ZmId.VIEW_PORTAL="PORTAL";
ZmId.VIEW_PREF="PREF";
ZmId.VIEW_SEARCH_RESULTS="SR";
ZmId.VIEW_SHARE_PENDING="SVP";
ZmId.VIEW_SHARE_MOUNTED="SVM";
ZmId.VIEW_SHARE_GRANTS="SVG";
ZmId.VIEW_SHORTCUTS="SHORTCUTS";
ZmId.VIEW_TASK="TKV";
ZmId.VIEW_TASK_NOT_STARTED="TKVN";
ZmId.VIEW_TASK_COMPLETED="TKVC";
ZmId.VIEW_TASK_IN_PROGRESS="TKVI";
ZmId.VIEW_TASK_WAITING="TKVW";
ZmId.VIEW_TASK_DEFERRED="TKVD";
ZmId.VIEW_TASK_ALL="TKVA";
ZmId.VIEW_TASK_TODO="TKVT";
ZmId.VIEW_TASKEDIT="TKE";
ZmId.VIEW_TASKLIST="TKL";
ZmId.VIEW_TRAD="TV";
ZmId.VIEW_VOICEMAIL="VM";
ZmId.VIEW_ATTACHMENTS="AV";
ZmId.ITEM_APPOINTMENT="APPT";
ZmId.ITEM_ATT="ATT";
ZmId.ITEM_BRIEFCASE="BRIEFCASE_ITEM";
ZmId.ITEM_BRIEFCASE_REV="BRIEFCASE_REVISION";
ZmId.ITEM_CALL="CALL";
ZmId.ITEM_CHAT="CHAT";
ZmId.ITEM_CONTACT="CONTACT";
ZmId.ITEM_CONV="CONV";
ZmId.ITEM_DATA_SOURCE="DATA_SOURCE";
ZmId.ITEM_DOCUMENT="DOCUMENT";
ZmId.ITEM_GAL_CONTACT="GAL";
ZmId.ITEM_GROUP="GROUP";
ZmId.ITEM_MSG="MSG";
ZmId.ITEM_PAGE="PAGE";
ZmId.ITEM_RESOURCE="RESOURCE";
ZmId.ITEM_ROSTER="ROSTER_ITEM";
ZmId.ITEM_TASK="TASK";
ZmId.ITEM_VOICEMAIL="VOICEMAIL";
ZmId.ORG_ADDRBOOK="ADDRBOOK";
ZmId.ORG_BRIEFCASE="BRIEFCASE";
ZmId.ORG_CALENDAR="CALENDAR";
ZmId.ORG_FOLDER="FOLDER";
ZmId.ORG_PREF_PAGE="PREF_PAGE";
ZmId.ORG_ROSTER_TREE_ITEM="ROSTER_TREE_ITEM";
ZmId.ORG_ROSTER_TREE_GROUP="ROSTER_TREE_GROUP";
ZmId.ORG_SEARCH="SEARCH";
ZmId.ORG_TAG="TAG";
ZmId.ORG_TASKS="TASKS";
ZmId.ORG_ZIMLET="ZIMLET";
ZmId.FLD_ACCOUNT="ac";
ZmId.FLD_ATTACHMENT="at";
ZmId.FLD_CAPACITY="cp";
ZmId.FLD_COMPANY="co";
ZmId.FLD_DATE="dt";
ZmId.FLD_DEPARTMENT="de";
ZmId.FLD_EMAIL="em";
ZmId.FLD_EXPAND="ex";
ZmId.FLD_FILE_TYPE="ft";
ZmId.FLD_FLAG="fg";
ZmId.FLD_FOLDER="fo";
ZmId.FLD_FRAGMENT="fm";
ZmId.FLD_FROM="fr";
ZmId.FLD_HOME_PHONE="hp";
ZmId.FLD_ID="id";
ZmId.FLD_INDEX="ix";
ZmId.FLD_ITEM_ROW="rw";
ZmId.FLD_ITEM_ROW_3PANE="r3";
ZmId.FLD_LOCATION="lo";
ZmId.FLD_LOCK="loid";
ZmId.FLD_MSG_PRIORITY="mp";
ZmId.FLD_NAME="na";
ZmId.FLD_NOTES="no";
ZmId.FLD_PARTICIPANT="pa";
ZmId.FLD_PCOMPLETE="pc";
ZmId.FLD_PRIORITY="pr";
ZmId.FLD_RECURRENCE="re";
ZmId.FLD_SELECTION="se";
ZmId.FLD_SELECTION_CELL="sec";
ZmId.FLD_SIZE="sz";
ZmId.FLD_SORTED_BY="sb";
ZmId.FLD_STATUS="st";
ZmId.FLD_READ="rd";
ZmId.FLD_MUTE="mt";
ZmId.FLD_SUBJECT="su";
ZmId.FLD_TAG="tg";
ZmId.FLD_TAG_CELL="tc";
ZmId.FLD_TYPE="ty";
ZmId.FLD_TO="to";
ZmId.FLD_VERSION="ver";
ZmId.FLD_WORK_PHONE="wp";
ZmId.OP_ACCEPT_PROPOSAL="ACCEPT_PROPOSAL";
ZmId.OP_ADD="ADD";
ZmId.OP_ADD_FILTER_RULE="ADD_FILTER_RULE";
ZmId.OP_ADD_FILTER_RULE_ADDRESS="ADD_FILTER_RULE_ADDRESS";
ZmId.OP_ADD_SIGNATURE="ADD_SIGNATURE";
ZmId.OP_ADD_EXTERNAL_CALENDAR="ADD_EXTERNAL_CALENDAR";
ZmId.OP_ATTACHMENT="ATTACHMENT";
ZmId.OP_ACTIONS_MENU="ACTIONS_MENU";
ZmId.OP_BROWSE="BROWSE";
ZmId.OP_BROWSE_FOLDER="BROWSE_FOLDER";
ZmId.OP_CALL="CALL";
ZmId.OP_CAL_REFRESH="CAL_REFRESH";
ZmId.OP_CAL_REPLY="CAL_REPLY";
ZmId.OP_CAL_REPLY_ALL="CAL_REPLY_ALL";
ZmId.OP_CAL_LIST_VIEW="CAL_LIST_VIEW";
ZmId.OP_CAL_VIEW_MENU="CAL_VIEW_MENU";
ZmId.OP_CANCEL="CANCEL";
ZmId.OP_CHECKIN="CHECKIN";
ZmId.OP_CHECKOUT="CHECKOUT";
ZmId.OP_CHECK_ALL="CHECK_ALL";
ZmId.OP_CHECK_MAIL="CHECK_MAIL";
ZmId.OP_GO_OFFLINE="GOOFFLINE";
ZmId.OP_CALL_BACK="CALL_BACK";
ZmId.OP_CLEAR_ALL="CLEAR_ALL";
ZmId.OP_CLOSE="CLOSE";
ZmId.OP_COMPOSE_FORMAT="COMPOSE_FORMAT";
ZmId.OP_COMPOSE_OPTIONS="COMPOSE_OPTIONS";
ZmId.OP_CONTACT="CONTACT";
ZmId.OP_CONTACTGROUP_MENU="CONTACTGROUP_MENU";
ZmId.OP_COPY="COPY";
ZmId.OP_CREATE_APPT="CREATE_APPT";
ZmId.OP_CREATE_TASK="CREATE_TASK";
ZmId.OP_DAY_VIEW="DAY_VIEW";
ZmId.OP_DECLINE_PROPOSAL="DECLINE_PROPOSAL";
ZmId.OP_DELETE="DELETE";
ZmId.OP_DELETE_WITHOUT_SHORTCUT="DELETE_WITHOUT_SHORTCUT";
ZmId.OP_DELETE_APPT_INSTANCE="DELETE_INSTANCE";
ZmId.OP_DELETE_APPT_SERIES="DELETE_SERIES";
ZmId.OP_DELETE_CONV="DELETE_CONV";
ZmId.OP_DELETE_MENU="DELETE_MENU";
ZmId.OP_DELETE_MSG="DELETE_MSG";
ZmId.OP_DELETE_VERSION="DELETE_VERSION";
ZmId.OP_DETACH="DETACH";
ZmId.OP_DETACH_WIN="DETACH_WIN";
ZmId.OP_DETACH_COMPOSE="DETACH_COMPOSE";
ZmId.OP_DISCARD_CHECKOUT="DISCARD_CHECKOUT";
ZmId.OP_DOWNLOAD_VOICEMAIL="DOWNLOAD_VOICEMAIL";
ZmId.OP_NEW_CALL="NEW_CALL";
ZmId.OP_DUPLICATE_APPT="DUPLICATE_APPT";
ZmId.OP_DRAFT="DRAFT";
ZmId.OP_EDIT="EDIT";
ZmId.OP_EDIT_AS_NEW="EDIT_AS_NEW";
ZmId.OP_EDIT_CONTACT="EDIT_CONTACT";
ZmId.OP_EDIT_FILE="EDIT_FILE";
ZmId.OP_EDIT_FILTER_RULE="EDIT_FILTER_RULE";
ZmId.OP_EDIT_PROPS="EDIT_PROPS";
ZmId.OP_EDIT_REPLY_ACCEPT="EDIT_REPLY_ACCEPT";
ZmId.OP_EDIT_REPLY_CANCEL="EDIT_REPLY_CANCEL";
ZmId.OP_EDIT_REPLY_DECLINE="EDIT_REPLY_DECLINE";
ZmId.OP_EDIT_REPLY_TENTATIVE="EDIT_REPLY_TENTATIVE";
ZmId.OP_EMPTY_FOLDER="EMPTY_FOLDER";
ZmId.OP_EXPAND="EXPAND";
ZmId.OP_EXPAND_ALL="EXPAND_ALL";
ZmId.OP_FB_VIEW="FB_VIEW";
ZmId.OP_FLAG="FLAG";
ZmId.OP_UNFLAG="UNFLAG";
ZmId.OP_FIND_SHARES="FIND_SHARES";
ZmId.OP_FORMAT_HTML="FORMAT_HTML";
ZmId.OP_FORMAT_HTML_SOURCE="FORMAT_HTML_SOURCE";
ZmId.OP_FORMAT_MEDIA_WIKI="FORMAT_MEDIA_WIKI";
ZmId.OP_FORMAT_RICH_TEXT="FORMAT_RICH_TEXT";
ZmId.OP_FORMAT_TEXT="FORMAT_TEXT";
ZmId.OP_FORMAT_TWIKI="FORMAT_TWIKI";
ZmId.OP_FORMAT_MORE_OPTIONS="FORMAT_MORE_OPTIONS";
ZmId.OP_FORWARD="FORWARD";
ZmId.OP_FORWARD_ATT="FORWARD_ATT";
ZmId.OP_FORWARD_BY_EMAIL="FORWARD_BY_EMAIL";
ZmId.OP_FORWARD_CONV="FORWARD_CONV";
ZmId.OP_FORWARD_INLINE="FORWARD_INLINE";
ZmId.OP_FORWARD_MENU="FORWARD_MENU";
ZmId.OP_FORWARD_APPT="FORWARD_APPT";
ZmId.OP_FORWARD_APPT_INSTANCE="FORWARD_APPT_INSTANCE";
ZmId.OP_FORWARD_APPT_SERIES="FORWARD_APPT_SERIES";
ZmId.OP_FREE_BUSY_LINK="FREE_BUSY_LINK";
ZmId.OP_GROUPBY="GROUPBY";
ZmId.OP_GROUPBY_DATE="GROUPBY_DATE";
ZmId.OP_GROUPBY_NONE="GROUPBY_NONE";
ZmId.OP_GROUPBY_FROM="GROUPBY_FROM";
ZmId.OP_GROUPBY_PRIORITY="GROUPBY_PRIORITY";
ZmId.OP_GROUPBY_SIZE="GROUPBY_SIZE";
ZmId.OP_GROUPBY_TAG="GROUPBY_TAG";
ZmId.OP_GO_TO_URL="GO_TO_URL";
ZmId.OP_IM="IM";
ZmId.OP_IMPORT_FILE="IMPORT_FILE";
ZmId.OP_IM_ADD_TO_CONTACT="IM_ADD_TO_CONTACT";
ZmId.OP_IM_BLOCK_BUDDY="IM_BLOCK_BUDDY";
ZmId.OP_IM_BUDDY_ARCHIVE="IM_BUDDY_ARCHIVE";
ZmId.OP_IM_BUDDY_LIST="IM_BUDDY_LIST";
ZmId.OP_IM_CLOSE_ALL_CHATS="IM_CLOSE_ALL_CHATS";
ZmId.OP_IM_CLOSE_OTHER_CHATS="IM_CLOSE_OTHER_CHATS";
ZmId.OP_IM_CLOSE_CHAT="IM_CLOSE_CHATS";
ZmId.OP_IM_CREATE_CONTACT="IM_CREATE_CONTACT";
ZmId.OP_IM_EDIT_CONTACT="IM_EDIT_CONTACT";
ZmId.OP_IM_HTML="IM_HTML";
ZmId.OP_IM_DELETE_GROUP="IM_DELETE_GROUP";
ZmId.OP_IM_INVITE="IM_INVITE";
ZmId.OP_IM_NEW_CHAT="IM_NEW_CHAT";
ZmId.OP_IM_PRESENCE_AWAY="IM_PRESENCE_AWAY";
ZmId.OP_IM_PRESENCE_CHAT="IM_PRESENCE_CHAT";
ZmId.OP_IM_PRESENCE_CUSTOM_MSG="IM_PRESENCE_CUSTOM_MSG";
ZmId.OP_IM_PRESENCE_DND="IM_PRESENCE_DND";
ZmId.OP_IM_PRESENCE_INVISIBLE="IM_PRESENCE_INVISIBLE";
ZmId.OP_IM_PRESENCE_MENU="IM_PRESENCE_MENU";
ZmId.OP_IM_PRESENCE_OFFLINE="IM_PRESENCE_OFFLINE";
ZmId.OP_IM_PRESENCE_ONLINE="IM_PRESENCE_ONLINE";
ZmId.OP_IM_PRESENCE_XA="IM_PRESENCE_XA";
ZmId.OP_IM_LOGOUT_YAHOO="IM_LOGOUT_YAHOO";
ZmId.OP_IM_PRESENCE_CUSTOM_MRU="IM_PRESENCE_CUSTOM_MRU";
ZmId.OP_IM_PRESENCE_MENU="IM_PRESENCE_MENU";
ZmId.OP_IM_SORT_BY_NAME="IM_SORT_BY_NAME";
ZmId.OP_IM_SORT_BY_PRESENCE="IM_SORT_BY_PRESENCE";
ZmId.OP_IM_TOGGLE_BLOCKED="IM_TOGGLE_BLOCKED";
ZmId.OP_IM_TOGGLE_OFFLINE="IM_TOGGLE_OFFLINE";
ZmId.OP_IM_UNBLOCK_BUDDY="IM_UNBLOCK_BUDDY";
ZmId.OP_INC_ATTACHMENT="INC_ATTACHMENT";
ZmId.OP_INC_BODY="INC_BODY";
ZmId.OP_INC_NONE="INC_NONE";
ZmId.OP_INC_SMART="INC_SMART";
ZmId.OP_INCLUDE_HEADERS="INCLUDE_HEADERS";
ZmId.OP_INVITE_ATTENDEES="INVITE_ATTENDEES";
ZmId.OP_INVITE_REPLY_ACCEPT="INVITE_REPLY_ACCEPT";
ZmId.OP_INVITE_REPLY_DECLINE="INVITE_REPLY_DECLINE";
ZmId.OP_INVITE_REPLY_MENU="INVITE_REPLY_MENU";
ZmId.OP_INVITE_REPLY_TENTATIVE="INVITE_REPLY_TENTATIVE";
ZmId.OP_KEEP_READING="KEEP_READING";
ZmId.OP_MARK_ALL_READ="MARK_ALL_READ";
ZmId.OP_MARK_HEARD="MARK_HEARD";
ZmId.OP_MARK_READ="MARK_READ";
ZmId.OP_MARK_UNHEARD="MARK_UNHEARD";
ZmId.OP_MARK_UNREAD="MARK_UNREAD";
ZmId.OP_MARK_AS_COMPLETED="MARK_AS_COMPLETED";
ZmId.OP_MOBILE_REMOVE="MOBILE_REMOVE";
ZmId.OP_MOBILE_CANCEL_WIPE="MOBILE_CANCEL_WIPE";
ZmId.OP_MOBILE_RESUME_SYNC="MOBILE_RESUME_SYNC";
ZmId.OP_MOBILE_SUSPEND_SYNC="MOBILE_SUSPEND_SYNC";
ZmId.OP_MOBILE_WIPE="MOBILE_WIPE";
ZmId.OP_MONTH_VIEW="MONTH_VIEW";
ZmId.OP_MOUNT_ADDRBOOK="MOUNT_ADDRBOOK";
ZmId.OP_MOUNT_BRIEFCASE="MOUNT_BRIEFCASE";
ZmId.OP_MOUNT_CALENDAR="MOUNT_CALENDAR";
ZmId.OP_MOUNT_FOLDER="MOUNT_FOLDER";
ZmId.OP_MOUNT_TASK_FOLDER="MOUNT_TASK_FOLDER";
ZmId.OP_MOVE="MOVE";
ZmId.OP_MOVE_MENU="MOVE_MENU";
ZmId.OP_MOVE_DOWN_FILTER_RULE="MOVE_DOWN_FILTER_RULE";
ZmId.OP_MOVE_TO_BCC="MOVE_TO_BCC";
ZmId.OP_MOVE_TO_CC="MOVE_TO_CC";
ZmId.OP_MOVE_TO_TO="MOVE_TO_TO";
ZmId.OP_MOVE_UP_FILTER_RULE="MOVE_UP_FILTER_RULE";
ZmId.OP_MUTE_CONV="MUTE_CONV";
ZmId.OP_NEW_ADDRBOOK="NEW_ADDRBOOK";
ZmId.OP_NEW_ALLDAY_APPT="NEW_ALLDAY_APPT";
ZmId.OP_NEW_APPT="NEW_APPT";
ZmId.OP_NEW_BRIEFCASE="NEW_BRIEFCASE";
ZmId.OP_NEW_CALENDAR="NEW_CALENDAR";
ZmId.OP_NEW_CONTACT="NEW_CONTACT";
ZmId.OP_NEW_DISTRIBUTION_LIST="NEW_DISTRIBUTION_LIST";
ZmId.OP_NEW_DOC="NEW_DOC";
ZmId.OP_NEW_FILE="NEW_FILE";
ZmId.OP_NEW_FOLDER="NEW_FOLDER";
ZmId.OP_NEW_GROUP="NEW_GROUP";
ZmId.OP_NEW_MENU="NEW_MENU";
ZmId.OP_NEW_MESSAGE="NEW_MESSAGE";
ZmId.OP_NEW_MESSAGE_WIN="NEW_MESSAGE_WIN";
ZmId.OP_NEW_BRIEFCASE_WIN="NEW_BRIEFCASE_WIN";
ZmId.OP_NEW_PAGE="NEW_PAGE";
ZmId.OP_NEW_ROSTER_GROUP="NEW_ROSTER_GROUP";
ZmId.OP_NEW_ROSTER_ITEM="NEW_ROSTER_ITEM";
ZmId.OP_NEW_TAG="NEW_TAG";
ZmId.OP_NEW_TASK="NEW_TASK";
ZmId.OP_NOTIFY="NOTIFY";
ZmId.OP_NEW_TASK_FOLDER="NEW_TASK_FOLDER";
ZmId.OP_OPEN_APPT_INSTANCE="OPEN_APPT_INSTANCE";
ZmId.OP_OPEN_APPT_SERIES="OPEN_APPT_SERIES";
ZmId.OP_OPEN_FILE="OPEN_FILE";
ZmId.OP_PAGE_BACK="PAGE_BACK";
ZmId.OP_PAGE_FORWARD="PAGE_FORWARD";
ZmId.OP_PAUSE_TOGGLE="PAUSE_TOGGLE";
ZmId.OP_PRINT="PRINT";
ZmId.OP_PRINT_ADDRBOOK="PRINT_ADDRBOOK";
ZmId.OP_PRINT_CALENDAR="PRINT_CALENDAR";
ZmId.OP_PRINT_CONTACT="PRINT_CONTACT";
ZmId.OP_PRIORITY_FILTER="PRIORITY_FILTER";
ZmId.OP_PRIORITY_HIGH="PRIORITY_HIGH";
ZmId.OP_PRIORITY_LOW="PRIORITY_LOW";
ZmId.OP_PRIORITY_NORMAL="PRIORITY_NORMAL";
ZmId.OP_PROPOSE_NEW_TIME="PROPOSE_NEW_TIME";
ZmId.OP_OPTS="OPTIONS";
ZmId.OP_RECOVER_DELETED_ITEMS="RECOVER_DELETED_ITEMS";
ZmId.OP_REDIRECT="REDIRECT";
ZmId.OP_REFRESH="REFRESH";
ZmId.OP_REINVITE_ATTENDEES="REINVITE_ATTENDEES";
ZmId.OP_REMOVE_FILTER_RULE="REMOVE_FILTER_RULE";
ZmId.OP_RENAME_FILE="RENAME_FILE";
ZmId.OP_RENAME_FOLDER="RENAME_FOLDER";
ZmId.OP_RENAME_SEARCH="RENAME_SEARCH";
ZmId.OP_RENAME_TAG="RENAME_TAG";
ZmId.OP_REPLY="REPLY";
ZmId.OP_REPLY_ACCEPT="REPLY_ACCEPT";
ZmId.OP_REPLY_ACCEPT_IGNORE="REPLY_ACCEPT_IGNORE";
ZmId.OP_REPLY_ACCEPT_NOTIFY="REPLY_ACCEPT_NOTIFY";
ZmId.OP_REPLY_ALL="REPLY_ALL";
ZmId.OP_REPLY_BY_EMAIL="REPLY_BY_EMAIL";
ZmId.OP_REPLY_CANCEL="REPLY_CANCEL";
ZmId.OP_REPLY_CANCEL="REPLY_CANCEL";
ZmId.OP_REPLY_DECLINE="REPLY_DECLINE";
ZmId.OP_REPLY_DECLINE_IGNORE="REPLY_DECLINE_IGNORE";
ZmId.OP_REPLY_DECLINE_NOTIFY="REPLY_DECLINE_NOTIFY";
ZmId.OP_REPLY_MENU="REPLY_MENU";
ZmId.OP_REPLY_MODIFY="REPLY_MODIFY";
ZmId.OP_REPLY_MODIFY="REPLY_MODIFY";
ZmId.OP_REPLY_NEW_TIME="REPLY_NEW_TIME";
ZmId.OP_REPLY_NEW_TIME="REPLY_NEW_TIME";
ZmId.OP_REPLY_TENTATIVE="REPLY_TENTATIVE";
ZmId.OP_REPLY_TENTATIVE_IGNORE="REPLY_TENTATIVE_IGNORE";
ZmId.OP_REPLY_TENTATIVE_NOTIFY="REPLY_TENTATIVE_NOTIFY";
ZmId.OP_REPORT="REPORT";
ZmId.OP_REQUEST_READ_RECEIPT="REQUEST_READ_RECEIPT";
ZmId.OP_RESET="RESET";
ZmId.OP_RESTORE_VERSION="RESTORE_VERSION";
ZmId.OP_REVERT_PAGE="REVERT_PAGE";
ZmId.OP_RUN_FILTER_RULE="RUN_FILTER_RULE";
ZmId.OP_SAVE="SAVE";
ZmId.OP_SAVE_DRAFT="SAVE_DRAFT";
ZmId.OP_SAVE_FILE="SAVE_FILE";
ZmId.OP_SEARCH="SEARCH";
ZmId.OP_SEARCH_MAIL="SEARCH_MAIL";
ZmId.OP_SEARCH_MENU="SEARCH_MENU";
ZmId.OP_SEARCH_TO="SEARCH_TO";
ZmId.OP_SEND="SEND";
ZmId.OP_SEND_FILE="SEND_FILE";
ZmId.OP_SEND_FILE_AS_ATT="SEND_FILE_AS_ATT";
ZmId.OP_SEND_FILE_MENU="SEND_FILE_MENU";
ZmId.OP_SEND_MENU="SEND_MENU";
ZmId.OP_SEND_LATER="SEND_LATER";
ZmId.OP_SEND_PAGE="SEND_PAGE";
ZmId.OP_SEND_INVITE="SEND_INVITE";
ZmId.OP_SEND_FB_HTML="SEND_FB_HTML";
ZmId.OP_SEND_FB_ICS="SEND_FB_ICS";
ZmId.OP_SEND_FB_ICS_EVENT="SEND_FB_ICS_EVENT";
ZmId.OP_SHARE="SHARE";
ZmId.OP_SHARE_ACCEPT="SHARE_ACCEPT";
ZmId.OP_SHARE_ADDRBOOK="SHARE_ADDRBOOK";
ZmId.OP_SHARE_BRIEFCASE="SHARE_BRIEFCASE";
ZmId.OP_SHARE_CALENDAR="SHARE_CALENDAR";
ZmId.OP_SHARE_DECLINE="SHARE_DECLINE";
ZmId.OP_SHARE_FOLDER="SHARE_FOLDER";
ZmId.OP_SHARE_TASKFOLDER="SHARE_TASKFOLDER";
ZmId.OP_SHOW_ALL_ITEM_TYPES="SHOW_ALL_ITEM_TYPES";
ZmId.OP_SHOW_BCC="SHOW_BCC";
ZmId.OP_SHOW_CONV="SHOW_CONV";
ZmId.OP_SHOW_ONLY_MAIL="SHOW_ONLY_MAIL";
ZmId.OP_SHOW_ORIG="SHOW_ORIG";
ZmId.OP_SORT_ASC="SORT_ASC";
ZmId.OP_SORT_DESC="SORT_DESC";
ZmId.OP_SPAM="SPAM";
ZmId.OP_SPELL_CHECK="SPELL_CHECK";
ZmId.OP_SUBSCRIBE_APPROVE="SUBSCRIBE_APPROVE";
ZmId.OP_SUBSCRIBE_REJECT="SUBSCRIBE_REJECT";
ZmId.OP_SYNC="SYNC";
ZmId.OP_SYNC_ALL="SYNC_ALL";
ZmId.OP_SYNC_OFFLINE_FOLDER="SYNC_OFFLINE_FOLDER";
ZmId.OP_TAG="TAG";
ZmId.OP_TAG_COLOR_MENU="TAG_COLOR_MENU";
ZmId.OP_TAG_MENU="TAG_MENU";
ZmId.OP_PRINT_TASK="PRINT_TASK";
ZmId.OP_PRINT_TASKFOLDER="PRINT_TASKFOLDER";
ZmId.OP_TEXT="TEXT";
ZmId.OP_TODAY="TODAY";
ZmId.OP_UNDELETE="UNDELETE";
ZmId.OP_UNMUTE_CONV="UNMUTE_CONV";
ZmId.OP_USE_PREFIX="USE_PREFIX";
ZmId.OP_VERSION_HISTORY="VERSION_HISTORY";
ZmId.OP_VIEW="VIEW";
ZmId.OP_VIEW_APPOINTMENT="VIEW_APPOINTMENT";
ZmId.OP_VIEW_APPT_INSTANCE="VIEW_APPT_INSTANCE";
ZmId.OP_VIEW_APPT_SERIES="VIEW_APPT_SERIES";
ZmId.OP_VIEW_BY_DATE="VIEW_BY_DATE";
ZmId.OP_VIEW_FILE_AS_HTML="VIEW_FILE_AS_HTML";
ZmId.OP_VIEW_MENU="VIEW_MENU";
ZmId.OP_SORTBY_MENU="SORTBY_MENU";
ZmId.OP_WEEK_VIEW="WEEK_VIEW";
ZmId.OP_WORK_WEEK_VIEW="WORK_WEEK_VIEW";
ZmId.OP_ZIMLET="ZIMLET";
ZmId.GROUPBY_DATE="GROUPBY_DATE";
ZmId.GROUPBY_FROM="GROUPBY_FROM";
ZmId.GROUPBY_NONE="GROUPBY_NONE";
ZmId.GROUPBY_PRIORITY="GROUPBY_PRIORITY";
ZmId.GROUPBY_SIZE="GROUPBY_SIZE";
ZmId.GROUPBY_TAG="GROUPBY_TAG";
ZmId.BASE="zcs";
ZmId.SEQ=1;
ZmId._idList=[];
ZmId._idHash={};
ZmId._valueToParam={};
ZmId.create=function(n,i){
var o=AjxUtil.hashCopy(n);
var a=ZmId.lookup(n);
if(a){
o.sequence=(typeof a==="string")?1:a.length
}
o.description=i||"";
var e=ZmId.BASE+ZmId.SEQ++;
o.id=e;
ZmId._idHash[e]=o;
ZmId._idList.push(o);
for(var t in n){
ZmId._valueToParam[n[t]]=t
}
return e
};
ZmId.lookup=function(r){
if(!r){
return ZmId._idList
}
if(AjxUtil.isArray(r)){
r=ZmId._convertValues(r)
}
var a=[];
for(var t=0,e=ZmId._idList.length;
t<e;
t++){
var n=ZmId._idList[t];
var o=true;
for(var s in r){
if(n[s]&&r[s]!==n[s]){
o=false;
continue
}}
if(o){
a.push(n.id)
}}
return(a.length===0)?null:(a.length===1)?a[0]:a
};
ZmId.getParams=function(e){
return ZmId._idHash[e]
};
ZmId.showIds=function(o){
if(!DBG||DBG.isDisabled()){
return
}
var e=ZmId.lookup(o),h=e.length,c="",s;
for(s=0;
s<h;
s++){
var t=e[s].id;
var o=ZmId._idHash[t];
c+="\n-----\n\n"+t+AjxStringUtil.repeat(" ",16-t.length)+o.description+"\n\n";
var a=AjxUtil.keys(o).sort();
for(var n=0;
n<a.length;
n++){
var r=a[n];
if(r==="id"||r==="description"){
continue
}
var l=o[r];
if(!l){
continue
}
l=ZmId._backMap[l]?"ZmId."+ZmId._backMap[l]:l;
c+=r+AjxStringUtil.repeat(" ",16-r.length)+l+"\n"
}}};
ZmId._backMap=AjxUtil.valueHash(ZmId,function(e){
return typeof ZmId[e]==="string"
}
);
ZmId._isViewType=AjxUtil.arrayAsHash(AjxUtil.values(ZmId,function(e){
return typeof ZmId[e]==="string"&&e.indexOf("VIEW_")===0
}
));
ZmId._convertValues=function(l){
var a={}
,e,h;
for(var o=0;
o<l.length;
o++){
var r=l[o];
if(ZmId._isViewType[r]){
e=r
}else{
if(AjxUtil.isNumber(r)||AjxUtil.isNumeric(r)){
var n=parseInt(r);
if(n<10){
h=n
}}else{
var t=ZmId._valueToParam[r];
a[t]=r
}}}
if(e){
var s=(a.componentType===ZmId.WIDGET_VIEW)?"componentName":"containingView";
a[s]=e
}
if(h){
var s=a.organizerType?"organizerId":"sessionId";
a[s]=e
}
return a
}
}
if(AjxPackage.define("zimbraMail.share.model.events.ZmEvent")){
ZmEvent=function(e){
this.type=e;
this.event=null;
this.source=null;
this.item=null;
this._details={}
};
ZmEvent.L_MODIFY=1;
ZmEvent.L_PICKER=2;
ZmEvent.S_TAG="TAG";
ZmEvent.S_PICKER="PICKER";
ZmEvent.S_SEARCH="SEARCH";
ZmEvent.S_SETTING="SETTING";
ZmEvent.S_SETTINGS="SETTINGS";
ZmEvent.S_SHARE="SHARE";
ZmEvent.S_MOUNTPOINT="MOUNTPOINT";
ZmEvent.S_ZIMLET="ZIMLET";
ZmEvent.E_CREATE="CREATE";
ZmEvent.E_DELETE="DELETE";
ZmEvent.E_MODIFY="MODIFY";
ZmEvent.E_LOAD="LOAD";
ZmEvent.E_REMOVE="REMOVE";
ZmEvent.E_REMOVE_ALL="REMOVE ALL";
ZmEvent.E_MOVE="MOVE";
ZmEvent.E_FLAGS="FLAGS";
ZmEvent.E_TAGS="TAGS";
ZmEvent.E_ZIMLETS="ZIMLET";
ZmEvent.E_COMPLETE="COMPLETE";
ZmEvent.prototype.toString=function(){
return"ZmEvent"
};
ZmEvent.prototype.set=function(e,t){
this.event=e;
this.source=t;
this.handled=false
};
ZmEvent.prototype.setDetail=function(t,e){
this._details[t]=e
};
ZmEvent.prototype.getDetail=function(e){
return this._details[e]
};
ZmEvent.prototype.getItems=function(){
var e=this._details.items;
return e?e:[]
};
ZmEvent.prototype.setDetails=function(e){
this._details=e?e:{}
};
ZmEvent.prototype.getDetails=function(){
return this._details
}
}
if(AjxPackage.define("zimbraMail.share.model.events.ZmAppEvent")){
ZmAppEvent=function(e){
ZmEvent.call(this)
};
ZmAppEvent.prototype=new ZmEvent;
ZmAppEvent.prototype.constructor=ZmAppEvent;
ZmAppEvent.PRE_STARTUP="PRESTARTUP";
ZmAppEvent.POST_STARTUP="POSTSTARTUP";
ZmAppEvent.PRE_LAUNCH="PRELAUNCH";
ZmAppEvent.POST_LAUNCH="POSTLAUNCH";
ZmAppEvent.POST_RENDER="POSTRENDER";
ZmAppEvent.ACTIVATE="ACTIVATE";
ZmAppEvent.RESPONSE="RESPONSE";
ZmAppEvent.prototype.toString=function(){
return"ZmAppEvent"
}
}
if(AjxPackage.define("zimbraMail.share.model.ZmModel")){
ZmModel=function(e){
if(arguments.length==0){
return
}
this._evt=new ZmEvent(e);
this._evtMgr=new AjxEventMgr()
};
ZmModel.prototype.isZmModel=true;
ZmModel.prototype.toString=function(){
return"ZmModel"
};
ZmModel.prototype.addChangeListener=function(e){
return this._evtMgr.addListener(ZmEvent.L_MODIFY,e)
};
ZmModel.prototype.removeChangeListener=function(e){
return this._evtMgr.removeListener(ZmEvent.L_MODIFY,e)
};
ZmModel.prototype.removeAllChangeListeners=function(){
return this._evtMgr.removeAll(ZmEvent.L_MODIFY)
};
ZmModel.prototype._notify=function(t,e){
if(this._evtMgr.isListenerRegistered(ZmEvent.L_MODIFY)){
this._evt.set(t,this);
this._evt.setDetails(e);
this._evtMgr.notifyListeners(ZmEvent.L_MODIFY,this._evt)
}};
ZmModel.notifyEach=function(o,a,t){
if(!(o&&o.length)){
return
}
for(var e=0;
e<o.length;
e++){
o[e]._notify(a,t)
}}
}
if(AjxPackage.define("zimbraMail.share.model.ZmSetting")){
ZmSetting=function(t,e){
if(arguments.length==0){
return
}
ZmModel.call(this,ZmEvent.S_SETTING);
this.id=t;
this.name=e.name;
this.type=e.type;
this.dataType=e.dataType||ZmSetting.D_STRING;
this.defaultValue=e.defaultValue;
this.canPreset=e.canPreset;
if(this.type==ZmSetting.T_METADATA){
this.section=e.section
}
if(e.isGlobal){
ZmSetting.IS_GLOBAL[t]=true
}
if(e.isImplicit){
ZmSetting.IS_IMPLICIT[t]=true
}
if(this.dataType==ZmSetting.D_HASH){
this.value={};
this.defaultValue={}
}else{
if(this.dataType==ZmSetting.D_LIST){
this.value=[];
this.defaultValue=[]
}else{
this.value=null
}}
this.dontSaveDefault=e.dontSaveDefault
};
ZmSetting.prototype=new ZmModel;
ZmSetting.prototype.constructor=ZmSetting;
ZmSetting.T_CONFIG="config";
ZmSetting.T_COS="cos";
ZmSetting.T_DOMAIN="domain";
ZmSetting.T_METADATA="meta";
ZmSetting.T_PREF="pref";
ZmSetting.T_PSEUDO="pseudo";
ZmSetting.M_IMPLICIT="implicit";
ZmSetting.M_OFFLINE="offline";
ZmSetting.M_ZIMLET="zimlet";
ZmSetting.D_STRING="string";
ZmSetting.D_INT="int";
ZmSetting.D_BOOLEAN="boolean";
ZmSetting.D_LDAP_TIME="ldap_time";
ZmSetting.D_HASH="hash";
ZmSetting.D_LIST="list";
ZmSetting.D_NONE="NONE";
ZmSetting.ACL_AUTH="all";
ZmSetting.ACL_GROUP="grp";
ZmSetting.ACL_NONE="none";
ZmSetting.ACL_PUBLIC="pub";
ZmSetting.ACL_DOMAIN="dom";
ZmSetting.ACL_USER="usr";
ZmSetting.CAL_DAY="day";
ZmSetting.CAL_LIST="list";
ZmSetting.CAL_MONTH="month";
ZmSetting.CAL_WEEK="week";
ZmSetting.CAL_WORK_WEEK="workWeek";
ZmSetting.CAL_VISIBILITY_PRIV="private";
ZmSetting.CAL_VISIBILITY_PUB="public";
ZmSetting.CLIENT_ADVANCED="advanced";
ZmSetting.CLIENT_STANDARD="standard";
ZmSetting.COMPOSE_FONT_COLOR="#000000";
ZmSetting.COMPOSE_FONT_FAM="arial,helvetica,sans-serif";
ZmSetting.COMPOSE_FONT_SIZE=AjxMessageFormat.format(ZmMsg.pt,"12");
ZmSetting.LTR="LTR";
ZmSetting.RTL="RTL";
ZmSetting.COMPOSE_TEXT="text";
ZmSetting.COMPOSE_HTML="html";
ZmSetting.CV_CARDS="cards";
ZmSetting.CV_LIST="list";
ZmSetting.DEDUPE_NONE="dedupeNone";
ZmSetting.DEDUPE_SECOND="secondCopyifOnToOrCC";
ZmSetting.DEDUPE_INBOX="moveSentMessageToInbox";
ZmSetting.DEDUPE_ALL="dedupeAll";
ZmSetting.DELETE_SELECT_NEXT="next";
ZmSetting.DELETE_SELECT_PREV="previous";
ZmSetting.DELETE_SELECT_ADAPT="adaptive";
ZmSetting.GROUP_BY_CONV="conversation";
ZmSetting.GROUP_BY_MESSAGE="message";
ZmSetting.HTTP_DEFAULT_PORT=80;
ZmSetting.HTTPS_DEFAULT_PORT=443;
ZmSetting.INC_NONE="includeNone";
ZmSetting.INC_ATTACH="includeAsAttachment";
ZmSetting.INC_BODY="includeBody";
ZmSetting.INC_BODY_ONLY="includeBodyOnly";
ZmSetting.INC_BODY_PRE="includeBodyWithPrefix";
ZmSetting.INC_BODY_HDR="includeBodyAndHeaders";
ZmSetting.INC_BODY_PRE_HDR="includeBodyAndHeadersWithPrefix";
ZmSetting.INC_SMART="includeSmart";
ZmSetting.INC_SMART_PRE="includeSmartWithPrefix";
ZmSetting.INC_SMART_HDR="includeSmartAndHeaders";
ZmSetting.INC_SMART_PRE_HDR="includeSmartAndHeadersWithPrefix";
ZmSetting.MARK_READ_NONE=-1;
ZmSetting.MARK_READ_NOW=0;
ZmSetting.MARK_READ_TIME=1;
ZmSetting.PRINT_FONT_SIZE=AjxMessageFormat.format(ZmMsg.pt,"12");
ZmSetting.PROTO_HTTP="http:";
ZmSetting.PROTO_HTTPS="https:";
ZmSetting.PROTO_MIXED="mixed:";
ZmSetting.RIGHT_VIEW_FREE_BUSY="viewFreeBusy";
ZmSetting.RIGHT_INVITE="invite";
ZmSetting.RP_BOTTOM="bottom";
ZmSetting.RP_OFF="off";
ZmSetting.RP_RIGHT="right";
ZmSetting.SIG_INTERNET="internet";
ZmSetting.SIG_OUTLOOK="outlook";
ZmSetting.CONV_FETCH_NONE="0";
ZmSetting.CONV_FETCH_FIRST_MATCHING="1";
ZmSetting.CONV_FETCH_FIRST="!";
ZmSetting.CONV_FETCH_UNREAD="u";
ZmSetting.CONV_FETCH_UNREAD_OR_FIRST_MATCHING="u1";
ZmSetting.CONV_FETCH_UNREAD_OR_FIRST="u!";
ZmSetting.CONV_FETCH_UNREAD_OR_BOTH_FIRST="u1!";
ZmSetting.CONV_FETCH_MATCHES="hits";
ZmSetting.CONV_FETCH_MATCHES_OR_FIRST="hits!";
ZmSetting.CONV_FETCH_ALL="all";
ZmSetting.LICENSE_GOOD="OK";
ZmSetting.LICENSE_NOT_INSTALLED="NOT_INSTALLED";
ZmSetting.LICENSE_NOT_ACTIVATED="NOT_ACTIVATED";
ZmSetting.LICENSE_FUTURE="IN_FUTURE";
ZmSetting.LICENSE_EXPIRED="EXPIRED";
ZmSetting.LICENSE_BAD="INVALID";
ZmSetting.LICENSE_GRACE="LICENSE_GRACE_PERIOD";
ZmSetting.LICENSE_ACTIV_GRACE="ACTIVATION_GRACE_PERIOD";
ZmSetting.LICENSE_MSG={};
ZmSetting.LICENSE_MSG[ZmSetting.LICENSE_NOT_INSTALLED]=ZmMsg.licenseNotInstalled;
ZmSetting.LICENSE_MSG[ZmSetting.LICENSE_NOT_ACTIVATED]=ZmMsg.licenseNotActivated;
ZmSetting.LICENSE_MSG[ZmSetting.LICENSE_FUTURE]=ZmMsg.licenseExpired;
ZmSetting.LICENSE_MSG[ZmSetting.LICENSE_EXPIRED]=ZmMsg.licenseExpired;
ZmSetting.LICENSE_MSG[ZmSetting.LICENSE_BAD]=ZmMsg.licenseExpired;
ZmSetting.LOCALE_NAME="LOCALE_NAME";
ZmSetting.COMPOSE_INIT_DIRECTION="COMPOSE_INIT_DIRECTION";
ZmSetting.SHOW_COMPOSE_DIRECTION_BUTTONS="SHOW_COMPOSE_DIRECTION_BUTTONS";
ZmSetting.FONT_NAME="FONT_NAME";
ZmSetting.FONT_SIZE="FONT_SIZE";
ZmSetting.SKIN_NAME="SKIN_NAME";
ZmSetting.BRIEFCASE_ENABLED="BRIEFCASE_ENABLED";
ZmSetting.CALENDAR_ENABLED="CALENDAR_ENABLED";
ZmSetting.CONTACTS_ENABLED="CONTACTS_ENABLED";
ZmSetting.IM_ENABLED="IM_ENABLED";
ZmSetting.MAIL_ENABLED="MAIL_ENABLED";
ZmSetting.OPTIONS_ENABLED="OPTIONS_ENABLED";
ZmSetting.PORTAL_ENABLED="PORTAL_ENABLED";
ZmSetting.SEARCH_ENABLED="SEARCH_ENABLED";
ZmSetting.SOCIAL_ENABLED="SOCIAL_ENABLED";
ZmSetting.TASKS_ENABLED="TASKS_ENABLED";
ZmSetting.VOICE_ENABLED="VOICE_ENABLED";
ZmSetting.TAGGING_ENABLED="TAGGING_ENABLED";
ZmSetting.CALENDAR_UPSELL_ENABLED="CALENDAR_UPSELL_ENABLED";
ZmSetting.CONTACTS_UPSELL_ENABLED="CONTACTS_UPSELL_ENABLED";
ZmSetting.MAIL_UPSELL_ENABLED="MAIL_UPSELL_ENABLED";
ZmSetting.SOCIAL_EXTERNAL_URL="SOCIAL_EXTERNAL_URL";
ZmSetting.VOICE_UPSELL_ENABLED="VOICE_UPSELL_ENABLED";
ZmSetting.FONT_CLASSIC="classic";
ZmSetting.FONT_MODERN="modern";
ZmSetting.FONT_WIDE="wide";
ZmSetting.FONT_SYSTEM="system";
ZmSetting.FONT_SIZE_SMALL="small";
ZmSetting.FONT_SIZE_NORMAL="normal";
ZmSetting.FONT_SIZE_LARGE="large";
ZmSetting.FONT_SIZE_LARGER="larger";
ZmSetting.USER_FONT_CLASS="userFontPrefs";
ZmSetting.TASK_FILTER_ALL="";
ZmSetting.TASK_FILTER_TODO="TODO";
ZmSetting.TASK_FILTER_COMPLETED="COMPLETED";
ZmSetting.TASK_FILTER_WAITING="WAITING";
ZmSetting.TASK_FILTER_DEFERRED="DEFERRED";
ZmSetting.TASK_FILTER_INPROGRESS="INPROGRESS";
ZmSetting.TASK_FILTER_NOTSTARTED="NOTSTARTED";
ZmSetting.IS_GLOBAL={};
ZmSetting.IS_IMPLICIT={};
ZmSetting.CHANGED_IMPLICIT={};
ZmSetting.SEND_AS="sendAs";
ZmSetting.SEND_ON_BEHALF_OF="sendOnBehalfOf";
ZmSetting.prototype.toString=function(){
return this.name+": "+this.value
};
ZmSetting.prototype.getValue=function(e,t){
var a=null;
if(this.value!=null){
a=e?this.value[e]:this.value
}else{
if(this.defaultValue!=null){
a=e?this.defaultValue[e]:this.defaultValue
}else{
return null
}}
if(this.dontSaveDefault&&t&&!e){
a=this.getRefinedValue(a)
}
return t?ZmSetting.serialize(a,this.dataType):a
};
ZmSetting.prototype.getRefinedValue=function(a){
if(this.dataType==ZmSetting.D_HASH){
var i={}
,e=this.defaultValue;
for(var t in a){
i[t]=(e[t]!=a[t])?a[t]:""
}
return i
}
return a
};
ZmSetting.prototype.getOrigValue=function(t,a){
var e=null;
if(this.origValue!=null){
e=t?this.origValue[t]:this.origValue
}else{
if(this.defaultValue!=null){
e=t?this.defaultValue[t]:this.defaultValue
}else{
return null
}}
return a?ZmSetting.serialize(e,this.dataType):e
};
ZmSetting.prototype.getDefaultValue=function(e,t){
var a=e?this.defaultValue[e]:this.defaultValue;
return t?ZmSetting.serialize(a,this.dataType):a
};
ZmSetting.prototype.setValue=function(n,s,o,i,h){
var e=n;
var t=Boolean(e!=this.value);
if(this.dataType==ZmSetting.D_STRING){
this.value=e
}else{
if(this.dataType==ZmSetting.D_INT){
e=parseInt(n);
if(isNaN(e)){
e=n
}
t=Boolean(e!=this.value);
this.value=e
}else{
if(this.dataType==ZmSetting.D_BOOLEAN){
if(typeof(e)=="string"){
e=(e.toLowerCase()==="true")
}
t=Boolean(e!=this.value);
this.value=e
}else{
if(this.dataType==ZmSetting.D_LDAP_TIME){
var r=(e.toLowerCase)?r=(e.toLowerCase()).charAt(e.length-1):null;
var a=parseInt(e);
if(r=="d"){
e=a*24*60*60
}else{
if(r=="h"){
e=a*60*60
}else{
if(r=="m"){
e=a*60
}else{
e=a
}}}
t=Boolean(e!=this.value);
this.value=e
}else{
if(this.dataType==ZmSetting.D_HASH){
t=true;
if(s){
if(e){
t=Boolean(e!=this.value[s]);
this.value[s]=e
}else{
delete this.value[s]
}}else{
this.value=e
}}else{
if(this.dataType==ZmSetting.D_LIST){
if(e instanceof Array){
this.value=e
}else{
this.value.push(e)
}
t=true
}}}}}}
if(o){
if(s){
this.defaultValue[s]=this.value[s]
}else{
this.defaultValue=this.value
}}
if(ZmSetting.IS_IMPLICIT[this.id]&&t&&!h){
if(i){
ZmSetting.CHANGED_IMPLICIT[this.id]=true
}else{
this._notify(ZmEvent.E_MODIFY,s);
return
}}
if(!this.name&&!i){
this._notify(ZmEvent.E_MODIFY,s)
}};
ZmSetting.prototype.notifyModify=function(e){
if(this.id==ZmSetting.QUOTA_USED&&e._name=="mbx"&&e.s!=null){
this.setValue(e.s);
this._notify(ZmEvent.E_MODIFY,{
account:e.account}
)
}};
ZmSetting.prototype.copyValue=function(){
if(this.dataType==ZmSetting.D_HASH){
return AjxUtil.hashCopy(this.value)
}else{
if(this.dataType==ZmSetting.D_LIST){
return this.value.concat()
}else{
return this.value
}}};
ZmSetting.serialize=function(n,e){
if(e==ZmSetting.D_BOOLEAN){
n=n?"TRUE":"FALSE"
}else{
if(e==ZmSetting.D_HASH){
var i=[];
for(var a in n){
i.push(a)
}
i.sort();
var o=[];
for(var t=0;
t<i.length;
t++){
var a=i[t];
o.push([a,n[a]].join(":"))
}
n=o.join(",")
}else{
if(e==ZmSetting.D_LIST){
n=n.join(",")
}}}
return n
}
}
if(AjxPackage.define("zimbraMail.core.ZmAppCtxt")){
ZmAppCtxt=function(){
this._trees={};
this.accountList=new ZmAccountList();
this.accountList.add(new ZmZimbraAccount(ZmAccountList.DEFAULT_ID,null,false));
this.inStartup=false;
this.currentRequestParams=null;
this.rememberMe=null;
this.userDomain="";
this.isFamilyMbox=false;
this.multiAccounts=false;
this.sendAsEmails=[];
this.sendOboEmails=[];
this._evtMgr=new AjxEventMgr();
this._itemCache={};
this._itemCacheDeferred={};
this._acCache={};
this._isExpandableDL={};
this._checkAuthTokenWarning()
};
ZmAppCtxt.ONE_MINUTE=60*1000;
ZmAppCtxt.MAX_TIMEOUT_VALUE=2147483647;
ZmAppCtxt._ZIMLETS_EVENT="ZIMLETS";
ZmAppCtxt._AUTHTOKEN_EVENT="AUTHTOKEN";
ZmAppCtxt.INVALID_NAME_CHARS='[\\|?<>:*",\\\\/]';
ZmAppCtxt.INVALID_NAME_CHARS_RE=new RegExp(ZmAppCtxt.INVALID_NAME_CHARS);
ZmAppCtxt.prototype.toString=function(){
return"ZmAppCtxt"
};
ZmAppCtxt.prototype._checkAuthTokenWarning=function(){
this._authIntervalId=window.setInterval(this._authTokenWarningTimeout.bind(this),ZmAppCtxt.ONE_MINUTE)
};
ZmAppCtxt.prototype._setAuthTokenWarning=function(e){
window.setTimeout(this._authTokenWarningTimeout.bind(this),e)
};
ZmAppCtxt.prototype.addAuthTokenWarningListener=function(t,e){
return this._evtMgr.addListener(ZmAppCtxt._AUTHTOKEN_EVENT,t,e)
};
ZmAppCtxt.prototype.removeAuthTokenWarningListener=function(e){
return this._evtMgr.removeListener(ZmAppCtxt._AUTHTOKEN_EVENT,e)
};
ZmAppCtxt.prototype._authTokenWarningTimeout=function(){
if(!window.authTokenExpires){
return
}
var t=new Date().getTime();
var i=window.authTokenExpires-t;
var r=Math.round(i/ZmAppCtxt.ONE_MINUTE);
var s;
if(r>5||i<=0){
if(r===6){
window.clearInterval(this._authIntervalId);
s=i-(5*ZmAppCtxt.ONE_MINUTE);
this._setAuthTokenWarning(s)
}
return
}
if(this._evtMgr.isListenerRegistered(ZmAppCtxt._AUTHTOKEN_EVENT)){
var e=new ZmEvent(ZmAppCtxt._AUTHTOKEN_EVENT);
this._evtMgr.notifyListeners(ZmAppCtxt._AUTHTOKEN_EVENT,e)
}
var a;
var l=0;
var h;
if(r>1){
a=AjxMessageFormat.format(ZmMsg.authTokenExpirationWarning,[r,ZmMsg.minutes]);
h=ZmAppCtxt.ONE_MINUTE/4
}else{
l=Math.round(i/10000);
h=8000;
if(l>=6){
a=AjxMessageFormat.format(ZmMsg.authTokenExpirationWarning,[1,ZmMsg.minute])
}else{
a=AjxMessageFormat.format(ZmMsg.authTokenExpirationWarning,[l*10,ZmMsg.seconds])
}}
var n={
msg:a,level:ZmStatusView.LEVEL_WARNING,transitions:[{
type:"fade-in",duration:500}
,{
type:"pause",duration:h}
,{
type:"fade-out",duration:500}
]};
this.setStatusMsg(n);
if(r>1){
var o=Math.floor(i/ZmAppCtxt.ONE_MINUTE);
if(o===r){
o--
}
s=i-(o*ZmAppCtxt.ONE_MINUTE)
}else{
l--;
s=i-(l*10000)
}
if(s>0){
this._setAuthTokenWarning(s)
}};
ZmAppCtxt.prototype.setZimbraMail=function(e){
this._zimbraMail=e
};
ZmAppCtxt.prototype.getZimbraMail=function(){
return this._zimbraMail
};
ZmAppCtxt.prototype.setAppController=function(e){
this._appController=e
};
ZmAppCtxt.prototype.getAppController=function(){
return this._appController
};
ZmAppCtxt.prototype.getAppChooser=function(){
return this._appController.getAppChooser()
};
ZmAppCtxt.prototype.setRequestMgr=function(e){
this._requestMgr=e
};
ZmAppCtxt.prototype.getRequestMgr=function(){
return this._requestMgr
};
ZmAppCtxt.prototype.setStatusMsg=function(e){
e=Dwt.getParams(arguments,ZmStatusView.MSG_PARAMS);
this._appController.setStatusMsg(e)
};
ZmAppCtxt.prototype.dismissStatusMsg=function(e){
this._appController.dismissStatusMsg(e)
};
ZmAppCtxt.prototype.getSettings=function(e){
var t=this.accountList;
var a=e||t.activeAccount||t.mainAccount||t.getAccount(ZmAccountList.DEFAULT_ID);
return a&&a.settings
};
ZmAppCtxt.prototype.setSettings=function(e,t){
var a=this.accountList;
var o=t?t.id:a.activeAccount?a.activeAccount.id:ZmAccountList.DEFAULT_ID;
var i=a.getAccount(o);
if(i){
i.settings=e
}};
ZmAppCtxt.prototype.get=function(o,t,a){
if(o==ZmSetting.IM_ENABLED){
return false
}
var e=this.isChildWindow?parentAppCtxt:this;
var i=(e.multiAccounts&&ZmSetting.IS_GLOBAL[o])?e.accountList.mainAccount:a;
return e.getSettings(i).get(o,t)
};
ZmAppCtxt.prototype.set=function(e,n,s,o,a,t,h){
var i=(this.multiAccounts&&ZmSetting.IS_GLOBAL[e])?this.accountList.mainAccount:t;
var r=this.getSettings(i).getSetting(e);
if(r){
r.setValue(n,s,o,a,h)
}};
ZmAppCtxt.prototype.getApp=function(e){
return this._appController.getApp(e)
};
ZmAppCtxt.prototype.getCurrentAppName=function(){
var e=this.isChildWindow?parentAppCtxt:this;
return e._appController.getActiveApp()
};
ZmAppCtxt.prototype.getLoggedInUsername=function(){
return appCtxt.get(ZmSetting.USERNAME)
};
ZmAppCtxt.prototype.getCurrentApp=function(){
return this.getApp(this.getCurrentAppName())
};
ZmAppCtxt.prototype.getAppViewMgr=function(){
return this._appController.getAppViewMgr()
};
ZmAppCtxt.prototype.getClientCmdHandler=function(e){
if(!this._clientCmdHandler){
AjxDispatcher.require("Extras");
this._clientCmdHandler=new ZmClientCmdHandler()
}
return this._clientCmdHandler
};
ZmAppCtxt.prototype.getSearchController=function(){
if(!this._searchController){
this._searchController=new ZmSearchController(this._shell)
}
return this._searchController
};
ZmAppCtxt.prototype.getOverviewController=function(e){
if(!this._overviewController){
if(e){
return null
}
this._overviewController=new ZmOverviewController(this._shell)
}
return this._overviewController
};
ZmAppCtxt.prototype.getImportExportController=function(){
if(!this._importExportController){
AjxDispatcher.require("ImportExport");
this._importExportController=new ZmImportExportController()
}
return this._importExportController
};
ZmAppCtxt.prototype.getMsgDialog=function(){
if(!this._msgDialog){
this._msgDialog=new DwtMessageDialog({
parent:this._shell,id:"ZmMsgDialog"}
)
}
return this._msgDialog
};
ZmAppCtxt.prototype.getHelpMsgDialog=function(){
if(!this._helpMsgDialog){
this._helpMsgDialog=new DwtMessageDialog({
parent:this._shell,helpText:ZmMsg.help,id:"ZmHelpMsgDialog"}
)
}
return this._helpMsgDialog
};
ZmAppCtxt.prototype.getYesNoMsgDialog=function(e){
if(!this._yesNoMsgDialog){
this._yesNoMsgDialog=new DwtMessageDialog({
parent:this._shell,buttons:[DwtDialog.YES_BUTTON,DwtDialog.NO_BUTTON],id:"YesNoMsgDialog"}
)
}
return this._yesNoMsgDialog
};
ZmAppCtxt.prototype.getYesNoCancelMsgDialog=function(){
if(!this._yesNoCancelMsgDialog){
this._yesNoCancelMsgDialog=new DwtMessageDialog({
parent:this._shell,buttons:[DwtDialog.YES_BUTTON,DwtDialog.NO_BUTTON,DwtDialog.CANCEL_BUTTON],id:"YesNoCancel"}
)
}
return this._yesNoCancelMsgDialog
};
ZmAppCtxt.prototype.getOkCancelMsgDialog=function(){
if(!this._okCancelMsgDialog){
this._okCancelMsgDialog=new DwtMessageDialog({
parent:this._shell,buttons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON],id:"OkCancel"}
)
}
return this._okCancelMsgDialog
};
ZmAppCtxt.prototype.getCancelMsgDialog=function(){
if(!this._cancelMsgDialog){
this._cancelMsgDialog=new DwtMessageDialog({
parent:this._shell,buttons:[DwtDialog.CANCEL_BUTTON]}
)
}
return this._cancelMsgDialog
};
ZmAppCtxt.prototype.getErrorDialog=function(){
if(!this._errorDialog){
AjxDispatcher.require("Startup2");
this._errorDialog=new ZmErrorDialog(this._shell,ZmMsg)
}
return this._errorDialog
};
ZmAppCtxt.prototype.getNewTagDialog=function(){
if(!this._newTagDialog){
this._newTagDialog=new ZmNewTagDialog(this._shell)
}
return this._newTagDialog
};
ZmAppCtxt.prototype.getNewContactGroupDialog=function(){
if(!this._newContactGroupDialog){
this._newContactGroupDialog=new ZmNewContactGroupDialog(this._shell)
}
return this._newContactGroupDialog
};
ZmAppCtxt.prototype.getRenameTagDialog=function(){
if(!this._renameTagDialog){
AjxDispatcher.require("Extras");
this._renameTagDialog=new ZmRenameTagDialog(this._shell)
}
return this._renameTagDialog
};
ZmAppCtxt.prototype.getPasswordChangeDialog=function(){
if(!this._passwordUpdateDialog){
AjxDispatcher.require("Extras");
this._passwordUpdateDialog=new ZmPasswordUpdateDialog(this._shell)
}
return this._passwordUpdateDialog
};
ZmAppCtxt.prototype.getNewFolderDialog=function(){
if(!this._newFolderDialog){
var t=ZmMsg.createNewFolder;
var e=ZmOrganizer.FOLDER;
this._newFolderDialog=new ZmNewOrganizerDialog(this._shell,null,t,e)
}
return this._newFolderDialog
};
ZmAppCtxt.prototype.getNewAddrBookDialog=function(){
if(!this._newAddrBookDialog){
AjxDispatcher.require("Contacts");
this._newAddrBookDialog=new ZmNewAddrBookDialog(this._shell)
}
return this._newAddrBookDialog
};
ZmAppCtxt.prototype.getNewCalendarDialog=function(){
if(!this._newCalendarDialog){
AjxDispatcher.require(["MailCore","CalendarCore","Calendar","CalendarAppt"]);
this._newCalendarDialog=new ZmNewCalendarDialog(this._shell)
}
return this._newCalendarDialog
};
ZmAppCtxt.prototype.getNewTaskFolderDialog=function(){
if(!this._newTaskFolderDialog){
AjxDispatcher.require(["TasksCore","Tasks"]);
this._newTaskFolderDialog=new ZmNewTaskFolderDialog(this._shell)
}
return this._newTaskFolderDialog
};
ZmAppCtxt.prototype.getSuggestionPreferenceDialog=function(){
if(!this._suggestionPrefDialog){
AjxDispatcher.require(["MailCore","CalendarCore","Calendar"]);
this._suggestionPrefDialog=new ZmTimeSuggestionPrefDialog(this._shell)
}
return this._suggestionPrefDialog
};
ZmAppCtxt.prototype.getDialog=function(){
if(!this._dialog){
this._dialog=new DwtDialog({
parent:this._shell}
)
}
return this._dialog
};
ZmAppCtxt.prototype.getNewSearchDialog=function(){
this._newSearchDialogs=this._newSearchDialogs||{};
this.searchAppName=this.searchAppName||ZmApp.MAIL;
if(!this._newSearchDialogs[this.searchAppName]){
this._newSearchDialogs[this.searchAppName]=new ZmNewSearchDialog(this._shell)
}
this._newSearchDialog=this._newSearchDialogs[this.searchAppName];
return this._newSearchDialog
};
ZmAppCtxt.prototype.getRenameFolderDialog=function(){
if(!this._renameFolderDialog){
AjxDispatcher.require("Extras");
this._renameFolderDialog=new ZmRenameFolderDialog(this._shell)
}
return this._renameFolderDialog
};
ZmAppCtxt.prototype.getChooseFolderDialog=function(e){
var t=e?this.getApp(e):this.getCurrentApp();
e=t.isZmSearchApp?this.searchAppName:t.getName();
this._chooseFolderDialogs=this._chooseFolderDialogs||{};
if(!this._chooseFolderDialogs[e]){
AjxDispatcher.require("Extras");
this._chooseFolderDialogs[e]=new ZmChooseFolderDialog(this._shell)
}
this._chooseFolderDialog=this._chooseFolderDialogs[e];
return this._chooseFolderDialog
};
ZmAppCtxt.prototype.getChooseAccountDialog=function(){
if(!this._chooseAccountDialog){
AjxDispatcher.require("Extras");
this._chooseAccountDialog=new ZmChooseAccountDialog(this._shell)
}
return this._chooseAccountDialog
};
ZmAppCtxt.prototype.getPickTagDialog=function(){
if(!this._pickTagDialog){
AjxDispatcher.require("Extras");
this._pickTagDialog=new ZmPickTagDialog(this._shell)
}
return this._pickTagDialog
};
ZmAppCtxt.prototype.getFolderNotifyDialog=function(){
if(!this._folderNotifyDialog){
this._folderNotifyDialog=new ZmFolderNotifyDialog(this._shell)
}
return this._folderNotifyDialog
};
ZmAppCtxt.prototype.getFolderPropsDialog=function(){
if(!this._folderPropsDialog){
this._folderPropsDialog=new ZmFolderPropsDialog(this._shell)
}
return this._folderPropsDialog
};
ZmAppCtxt.prototype.getSharePropsDialog=function(){
if(!this._sharePropsDialog){
AjxDispatcher.require("Share");
this._sharePropsDialog=new ZmSharePropsDialog(this._shell)
}
return this._sharePropsDialog
};
ZmAppCtxt.prototype.getShareSearchDialog=function(){
if(!this._shareSearchDialog){
AjxDispatcher.require("Share");
this._shareSearchDialog=new ZmShareSearchDialog({
parent:this._shell}
)
}
return this._shareSearchDialog
};
ZmAppCtxt.prototype.getAcceptShareDialog=function(){
if(!this._acceptShareDialog){
AjxDispatcher.require("Share");
this._acceptShareDialog=new ZmAcceptShareDialog(this._shell)
}
return this._acceptShareDialog
};
ZmAppCtxt.prototype.getDeclineShareDialog=function(){
if(!this._declineShareDialog){
AjxDispatcher.require("Share");
this._declineShareDialog=new ZmDeclineShareDialog(this._shell)
}
return this._declineShareDialog
};
ZmAppCtxt.prototype.getRevokeShareDialog=function(){
if(!this._revokeShareDialog){
AjxDispatcher.require("Share");
this._revokeShareDialog=new ZmRevokeShareDialog(this._shell)
}
return this._revokeShareDialog
};
ZmAppCtxt.prototype.getTimezonePickerDialog=function(){
if(!this._timezonePickerDialog){
AjxDispatcher.require("Share");
this._timezonePickerDialog=new ZmTimezonePicker(this._shell)
}
return this._timezonePickerDialog
};
ZmAppCtxt.prototype.getFilterRuleDialog=function(){
if(!this._filterRuleDialog){
AjxDispatcher.require(["PreferencesCore","Preferences"]);
this._filterRuleDialog=new ZmFilterRuleDialog()
}
return this._filterRuleDialog
};
ZmAppCtxt.prototype.getPriorityMessageFilterDialog=function(){
if(!this._priorityMessageFilterDialog){
AjxDispatcher.require(["PreferencesCore","Preferences"]);
this._priorityMessageFilterDialog=new ZmPriorityMessageFilterDialog()
}
return this._priorityMessageFilterDialog
};
ZmAppCtxt.prototype.getActivityStreamFilterDialog=function(){
if(!this._activityStreamFilterDialog){
AjxDispatcher.require(["PreferencesCore","Preferences"]);
this._activityStreamFilterDialog=new ZmActivityStreamPromptDialog()
}
return this._activityStreamFilterDialog
};
ZmAppCtxt.prototype.getActivityToInboxFilterDialog=function(){
if(!this._activityToInboxFilterDialog){
AjxDispatcher.require(["PreferencesCore","Preferences"]);
this._activityToInboxFilterDialog=new ZmActivityToInboxPromptDialog()
}
return this._activityToInboxFilterDialog
};
ZmAppCtxt.prototype.getContactQuickAddDialog=function(){
if(!this._contactQuickAddDialog){
AjxDispatcher.require(["ContactsCore","Contacts"]);
this._contactQuickAddDialog=new ZmContactQuickAddDialog()
}
return this._contactQuickAddDialog
};
ZmAppCtxt.prototype.getConfirmationDialog=function(e){
if(!this._confirmDialog){
this._confirmDialog=new DwtConfirmDialog(this._shell,null,"CONFIRM_DIALOG")
}
return this._confirmDialog
};
ZmAppCtxt.prototype.getUploadDialog=function(){
if(!this._uploadDialog){
AjxDispatcher.require(["Extras"]);
this._uploadDialog=new ZmUploadDialog(this._shell)
}
return this._uploadDialog
};
ZmAppCtxt.prototype.getAttachDialog=function(){
if(!this._attachDialog){
AjxDispatcher.require("Share");
this._attachDialog=new ZmAttachDialog(this._shell);
this.runAttachDialogCallbacks()
}
return this._attachDialog
};
ZmAppCtxt.prototype.getDumpsterDialog=function(){
if(!this._dumpsterDialog){
AjxDispatcher.require("Extras");
this._dumpsterDialog=new ZmDumpsterDialog(this._shell)
}
return this._dumpsterDialog
};
ZmAppCtxt.prototype.getMailRedirectDialog=function(){
if(!this._mailRedirectDialog){
this._mailRedirectDialog=new ZmMailRedirectDialog(this._shell)
}
return this._mailRedirectDialog
};
ZmAppCtxt.prototype.getRetentionWarningDialog=function(){
if(!this._retentionWarningDialog){
this._retentionWarningDialog=new ZmRetentionWarningDialog(this._shell)
}
return this._retentionWarningDialog
};
ZmAppCtxt.prototype.runAttachDialogCallbacks=function(){
while(this._attachDialogCallback&&this._attachDialogCallback.length>0){
var e=this._attachDialogCallback.shift();
if(e&&(e instanceof AjxCallback)){
e.run(this._attachDialog)
}}};
ZmAppCtxt.prototype.addAttachmentDialogCallback=function(e){
if(!this._attachDialogCallback){
this._attachDialogCallback=[]
}
this._attachDialogCallback.push(e)
};
ZmAppCtxt.prototype.getUploadConflictDialog=function(){
if(!this._uploadConflictDialog){
AjxDispatcher.require(["Extras"]);
this._uploadConflictDialog=new ZmUploadConflictDialog(this._shell)
}
return this._uploadConflictDialog
};
ZmAppCtxt.prototype.getNewBriefcaseDialog=function(){
if(!this._newBriefcaseDialog){
AjxDispatcher.require(["BriefcaseCore","Briefcase"]);
this._newBriefcaseDialog=new ZmNewBriefcaseDialog(this._shell)
}
return this._newBriefcaseDialog
};
ZmAppCtxt.prototype.getReplaceDialog=function(){
if(!this._replaceDialog){
AjxDispatcher.require("Share");
this._replaceDialog=new ZmFindnReplaceDialog(this._shell)
}
return this._replaceDialog
};
ZmAppCtxt.prototype.getDebugLogDialog=function(){
if(!this._debugLogDialog){
AjxDispatcher.require("Extras");
this._debugLogDialog=new ZmDebugLogDialog(this._shell)
}
return this._debugLogDialog
};
ZmAppCtxt.prototype.getRootTabGroup=function(){
if(this.isChildWindow){
if(!this._childWinTabGrp){
this._childWinTabGrp=new DwtTabGroup("CHILD_WINDOW")
}}else{
if(!this._rootTabGrp){
this._rootTabGrp=new DwtTabGroup("ROOT")
}}
return this.isChildWindow?this._childWinTabGrp:this._rootTabGrp
};
ZmAppCtxt.prototype.getShell=function(){
return this._shell
};
ZmAppCtxt.prototype.setShell=function(e){
this._shell=e
};
ZmAppCtxt.prototype.getActiveAccount=function(){
return this.isChildWindow?parentAppCtxt.accountList.activeAccount:this.accountList.activeAccount
};
ZmAppCtxt.prototype.isExternalAccount=function(){
return this.get(ZmSetting.IS_EXTERNAL)
};
ZmAppCtxt.prototype.getIdentityCollection=function(t){
var e=this.isChildWindow?window.opener:window;
return e.AjxDispatcher.run("GetIdentityCollection",t)
};
ZmAppCtxt.prototype.getDataSourceCollection=function(t){
var e=this.isChildWindow?window.opener:window;
return e.AjxDispatcher.run("GetDataSourceCollection",t)
};
ZmAppCtxt.prototype.getSignatureCollection=function(t){
var e=this.isChildWindow?window.opener:window;
return e.AjxDispatcher.run("GetSignatureCollection",t)
};
ZmAppCtxt.prototype.killMarkReadTimer=function(){
if(this.markReadActionId>0){
AjxTimedAction.cancelAction(this.markReadActionId);
this.markReadActionId=-1
}};
ZmAppCtxt.prototype.getTree=function(e,t){
if(this.isChildWindow){
return parentAppCtxt.getTree(e,t)
}
var a=this.accountList;
var o=t?t.id:a.activeAccount?a.activeAccount.id:ZmAccountList.DEFAULT_ID;
var i=a.getAccount(o);
return i&&i.trees[ZmOrganizer.TREE_TYPE[e]]
};
ZmAppCtxt.prototype.setTree=function(t,e,a){
var i=this.accountList;
var n=a?a.id:i.activeAccount?i.activeAccount.id:ZmAccountList.DEFAULT_ID;
var o=this.accountList.getAccount(n);
if(o){
o.trees[t]=e
}};
ZmAppCtxt.prototype.getFolderTree=function(e){
return this.getTree(ZmOrganizer.FOLDER,e)
};
ZmAppCtxt.prototype.getTagTree=function(e){
return this.getTree(ZmOrganizer.TAG,e)
};
ZmAppCtxt.prototype.getAccountTagList=function(e){
var t=(e&&appCtxt.multiAccounts)?e.getAccount():null;
return this.getTagTree(t).root
};
ZmAppCtxt.prototype.getZimletTree=function(e){
return this.getTree(ZmOrganizer.ZIMLET,e)
};
ZmAppCtxt.prototype.getUsername=function(e){
return this.get(ZmSetting.USERNAME,e)
};
ZmAppCtxt.prototype.getUserDomain=function(e){
if(!this.userDomain){
var a=this.getUsername(e);
if(a){
var t=a.split("@");
this.userDomain=(t&&t.length)?t[1]:""
}}
return this.userDomain
};
ZmAppCtxt.prototype.getUploadFrameId=function(){
if(!this._uploadManagerIframeId){
var a=Dwt.getNextId();
var e=["<iframe name='",a,"' id='",a,"' src='",(AjxEnv.isIE&&location.protocol=="https:")?appContextPath+"/public/blank.html":'javascript:""',"' style='position: absolute; top: 0; left: 0; visibility: hidden'></iframe>"];
var t=document.createElement("div");
t.innerHTML=e.join("");
document.body.appendChild(t.firstChild);
this._uploadManagerIframeId=a
}
return this._uploadManagerIframeId
};
ZmAppCtxt.prototype.reloadAppCache=function(o,e){
AjxDebug.println(AjxDebug.OFFLINE,"reloadAppCache :: "+AjxDebug._getTimeStamp());
if(this.isWebClientOfflineSupported||o){
var i=localStorage.getItem(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY);
if(i&&AjxEnv.supported.applicationcache&&applicationCache.status!==applicationCache.DOWNLOADING){
var n=i+"_"+new Date().getTime();
AjxCookie.setCookie(document,"ZM_OFFLINE_KEY",n,false,"/")
}
var t=appContextPath+"/appcache/images,common,dwt,msgview,login,zm,spellcheck,skin.appcache?";
var a=[];
a.push("v="+window.cacheKillerVersion);
a.push("debug="+window.appDevMode);
a.push("compress="+!(window.appDevMode===true));
a.push("templates=only");
t=encodeURIComponent(t+a.join("&"));
var s=document.getElementById("offlineIframe");
if(!s){
s=document.createElement("iframe");
s.id="offlineIframe";
s.style.display="none";
document.body.appendChild(s)
}
if(s){
e=AjxUtil.isBoolean(e)?e:true;
s.src="public/Offline.jsp?url="+t+"&isFirefox="+AjxEnv.isFirefox+"&retryOnError="+e
}}};
ZmAppCtxt.prototype.getUploadManager=function(){
if(!this._uploadManager){
this._uploadManager=new AjxPost(this.getUploadFrameId())
}
return this._uploadManager
};
ZmAppCtxt.prototype.getZmUploadManager=function(){
if(!this._zmUploadManager){
AjxDispatcher.require("Extras");
this._zmUploadManager=new ZmUploadManager()
}
return this._zmUploadManager
};
ZmAppCtxt.prototype.getCurrentSearch=function(){
var t=this.getCurrentApp();
if(t&&t.currentSearch){
return t.currentSearch
}
var e=this.getCurrentController();
return e&&e._currentSearch
};
ZmAppCtxt.prototype.getCurrentViewId=function(){
var e=this.getAppViewMgr().getCurrentViewId();
if(e&&e.indexOf(ZmId.VIEW_SEARCH_RESULTS)===0){
e=this.getCurrentController().getCurrentViewId()
}
return e
};
ZmAppCtxt.prototype.getCurrentViewType=function(){
var e=this.getAppViewMgr().getCurrentViewType();
if(e&&e.indexOf(ZmId.VIEW_SEARCH_RESULTS)===0){
e=this.getCurrentController().getCurrentViewType()
}
return e
};
ZmAppCtxt.prototype.getViewTypeFromId=function(e){
var t=e&&e.split(ZmController.SESSION_ID_SEP);
return t?t[0]:""
};
ZmAppCtxt.prototype.getCurrentView=function(){
return this.getAppViewMgr().getCurrentView()
};
ZmAppCtxt.prototype.getCurrentController=function(){
var e=this.getCurrentView();
return(e&&e.getController)?e.getController():null
};
ZmAppCtxt.prototype.setCurrentList=function(e){
this._list=e
};
ZmAppCtxt.prototype.getCurrentList=function(){
var e=this.getCurrentController();
return(e&&e.getList)?e.getList():this._list?this._list:null
};
ZmAppCtxt.prototype.getActionController=function(){
if(!this._actionController&&!this.isChildWindow){
this._actionController=new ZmActionController()
}
return this._actionController
};
ZmAppCtxt.prototype.getNewWindow=function(h,r,e,n){
var o=[];
var s=0;
o[s++]=document.location.protocol;
o[s++]="//";
o[s++]=location.hostname;
o[s++]=(!location.port||location.port=="80")?"":(":"+location.port);
o[s++]=appContextPath;
o[s++]="/public/launchNewWindow.jsp?skin=";
o[s++]=appCurrentSkin;
o[s++]="&localeId=";
o[s++]=AjxEnv.DEFAULT_LOCALE||"";
if(h){
o[s++]="&full=1"
}
if(window.appDevMode){
o[s++]="&dev=1"
}
if(window.appCoverageMode){
o[s++]="&coverage=1"
}
this.__childWindowId=(this.__childWindowId+1)||0;
o[s++]="&childId="+this.__childWindowId;
n=n||"_blank";
r=r||705;
e=e||465;
var a=["height=",e,",width=",r,",location=no,menubar=no,resizable=yes,scrollbars=no,status=yes,toolbar=no"].join("");
if(window.appDevMode){
a=["height=",e,",width=",r,",location=yes,menubar=yes,resizable=yes,scrollbars=no,status=yes,toolbar=yes"].join("")
}
var t=window.open(o.join(""),n,a);
this.handlePopupBlocker(t);
if(t){
return this.getAppController().addChildWindow(t,this.__childWindowId)
}};
ZmAppCtxt.prototype.handlePopupBlocker=function(e){
if(!e){
this.setStatusMsg(ZmMsg.popupBlocker,ZmStatusView.LEVEL_CRITICAL)
}else{
if(e&&AjxEnv.isChrome){
setTimeout(function(){
if(e.innerHeight==0){
appCtxt.setStatusMsg(ZmMsg.popupBlocker,ZmStatusView.LEVEL_CRITICAL)
}}
,50)
}}};
ZmAppCtxt.prototype.cacheSet=function(e,t){
this._itemCache[e]=t;
delete this._itemCacheDeferred[e]
};
ZmAppCtxt.prototype.cacheSetDeferred=function(t,e){
this._itemCache[t]=this._itemCacheDeferred;
this._itemCacheDeferred[t]=e
};
ZmAppCtxt.prototype.cacheGet=function(t){
var a=this._itemCache[t];
if(a===this._itemCacheDeferred){
var e=this._itemCacheDeferred[t];
this.getApp(e).createDeferred();
a=this._itemCache[t]
}
return a
};
ZmAppCtxt.prototype.cacheRemove=function(e){
delete this._itemCache[e];
delete this._itemCacheDeferred[e]
};
ZmAppCtxt.prototype.getById=function(e){
return this.cacheGet(e)||(this.isChildWindow&&window.opener.appCtxt.getById(e))
};
ZmAppCtxt.prototype.getKeyboardMgr=function(){
return this._shell.getKeyboardMgr()
};
ZmAppCtxt.prototype.getHistoryMgr=function(){
if(!this._historyMgr){
this._historyMgr=new AjxHistoryMgr()
}
return this._historyMgr
};
ZmAppCtxt.prototype.zimletsPresent=function(){
return this._zimletsPresent
};
ZmAppCtxt.prototype.setZimletsPresent=function(e){
this._zimletsPresent=e
};
ZmAppCtxt.prototype.getZimletMgr=function(){
if(!this._zimletMgr){
AjxDispatcher.require("Zimlet");
if(!this._zimletMgr){
this._zimletMgr=new ZmZimletMgr()
}}
return this._zimletMgr
};
ZmAppCtxt.prototype.areZimletsLoaded=function(){
return this._zimletsLoaded
};
ZmAppCtxt.prototype.addZimletsLoadedListener=function(t,e){
if(!this._zimletsLoaded){
return this._evtMgr.addListener(ZmAppCtxt._ZIMLETS_EVENT,t,e)
}};
ZmAppCtxt.prototype.allZimletsLoaded=function(){
this._zimletsLoaded=true;
if(this._zimletMgr&&!this.isChildWindow&&appCtxt.get(ZmSetting.PORTAL_ENABLED)){
var e=this.getApp(ZmApp.PORTAL).getPortletMgr();
if(e){
e.allZimletsLoaded()
}}
if(this._evtMgr.isListenerRegistered(ZmAppCtxt._ZIMLETS_EVENT)){
this._evtMgr.notifyListeners(ZmAppCtxt._ZIMLETS_EVENT,new ZmEvent());
this._evtMgr.removeAll(ZmAppCtxt._ZIMLETS_EVENT)
}};
ZmAppCtxt.prototype.notifyZimlets=function(i,t,e){
this.notifySkin(i,t,e);
var a=this.isChildWindow?parentAppCtxt:this;
if(e&&e.noChildWindow&&this.isChildWindow){
return false
}
if(!a.areZimletsLoaded()){
if(e&&e.waitUntilLoaded){
a.addZimletsLoadedListener(new AjxListener(this,this.notifyZimlets,[i,t]))
}
return false
}
return this.getZimletMgr().notifyZimlets(i,t)
};
ZmAppCtxt.prototype.notifyZimlet=function(i,a,t,e){
if(e&&e.noChildWindow&&this.isChildWindow){
return false
}
return this.getZimletMgr().notifyZimlet(i,a,t)
};
ZmAppCtxt.prototype.notifySkin=function(o,a,t){
var i=this.isChildWindow?parentAppCtxt:this;
if(t&&t.noChildWindow&&this.isChildWindow){
return
}
try{
return window.skin&&AjxUtil.isFunction(window.skin.handleNotification)&&window.skin.handleNotification(o,a)
}
catch(n){}};
ZmAppCtxt.prototype.getCalManager=function(){
if(!this._calMgr){
AjxDispatcher.require("Startup2");
this._calMgr=new ZmCalMgr(this._shell)
}
return this._calMgr
};
ZmAppCtxt.prototype.updateOfflineAppt=function(n,o,i,e,r){
var s=appCtxt.getCalManager();
if(s){
var t=s&&s.getCalViewController();
if(t){
var a=t.getApptCache();
if(a){
a.updateOfflineAppt(n,o,i,e,r)
}}}};
ZmAppCtxt.prototype.getTaskManager=function(){
if(!this._taskMgr){
this._taskMgr=new ZmTaskMgr(this._shell)
}
return this._taskMgr
};
ZmAppCtxt.prototype.getACL=function(e,o){
var t=this.accountList;
var i=e?e.id:t.activeAccount?t.activeAccount.id:ZmAccountList.DEFAULT_ID;
var a=t.getAccount(i);
return a&&a.acl
};
ZmAppCtxt.prototype.getShortcutHint=function(s,e){
var n=null;
s=s||"global";
while(!n&&s){
var i=[s,e,"display"].join(".");
var n=AjxKeys[i]||ZmKeys[i];
if(n){
var a=n.split(/;\s*/);
var o=a[0];
if(!o){
return null
}
o=o.replace(/\b[A-Z]\b/g,function(r){
return r.toLowerCase()
}
);
n=[" [",o.replace(",",""),"]"].join("")
}else{
var t=[s,"INHERIT"].join(".");
s=AjxKeys[t]||ZmKeys[t]
}}
return n
};
ZmAppCtxt.prototype.getShortcutsPanel=function(){
if(!this._shortcutsPanel){
AjxDispatcher.require(["PreferencesCore","Preferences"]);
var e=this.isChildWindow?ZmShortcutList.WINDOW_STYLE:ZmShortcutList.PANEL_STYLE;
this._shortcutsPanel=new ZmShortcutsPanel(e)
}
return this._shortcutsPanel
};
ZmAppCtxt.prototype.getChangePasswordWindow=function(r){
var e=appCtxt.get(ZmSetting.CHANGE_PASSWORD_URL);
if(!e){
var i=appCtxt.get(ZmSetting.PROTOCOL_MODE)==ZmSetting.PROTO_HTTP;
var o=i?ZmSetting.PROTO_HTTP:ZmSetting.PROTO_HTTPS;
var t=appCtxt.get(i?ZmSetting.HTTP_PORT:ZmSetting.HTTPS_PORT);
var c=appContextPath+"/h/changepass";
var h=appCtxt.get(ZmSetting.PUBLIC_URL);
if(h){
var a=AjxStringUtil.parseURL(h);
c=a.path+"/h/changepass";
var l=(a.protocol=="http"&&o==ZmSetting.PROTO_HTTPS);
o=l?o:a.protocol;
t=l?t:a.port
}
var s={
skin:appCurrentSkin};
e=AjxUtil.formatUrl({
protocol:o,port:t,path:c,qsReset:true,qsArgs:s}
)
}
var n="height=465,width=705,location=no,menubar=no,resizable=yes,scrollbars=no,status=yes,toolbar=no";
window.open(e,"ChangePasswordWindow",n)
};
ZmAppCtxt.prototype.getSkinHint=function(){
if(arguments.length==0){
return""
}
var a=window.skin&&window.skin.hints;
if(!a){
return""
}
for(var t=0;
t<arguments.length;
t++){
var e=arguments[t];
if(!a[e]){
return""
}
a=a[e]
}
return a
};
ZmAppCtxt.prototype.getAutocompleter=function(){
if(!this._autocompleter){
this._autocompleter=new ZmAutocomplete(null)
}
return this._autocompleter
};
ZmAppCtxt.prototype.isMyAddress=function(n,a,e){
if(a&&(n.indexOf("@")==-1)){
n=[n,this.getUserDomain()].join("@")
}
if(n==this.get(ZmSetting.USERNAME)){
return true
}
var o;
if(e){
o=appCtxt.get(ZmSetting.MAIL_ALIASES)
}else{
o=appCtxt.get(ZmSetting.MAIL_ALIASES).concat(appCtxt.get(ZmSetting.ALLOW_FROM_ADDRESSES))
}
if(o&&o.length){
for(var t=0;
t<o.length;
t++){
if(n==o[t]){
return true
}}}
return false
};
ZmAppCtxt.prototype.getOverviewId=function(t,e){
var a=(t instanceof Array)?t.join("_"):t;
if(appCtxt.multiAccounts&&(e!==null)){
e=e||appCtxt.getActiveAccount();
a=[e.name,a].join(":")
}
return a
};
ZmAppCtxt.prototype.getAutocompleteCache=function(a,o,i,t){
var e=null;
var n=i||this.getActiveAccount();
if(n){
if(this._acCache[n.id]&&this._acCache[n.id][a]){
e=this._acCache[n.id][a][o]
}}
if(!e&&t){
if(n&&!this._acCache[n.id]){
this._acCache[n.id]={}
}
if(!this._acCache[n.id][a]){
this._acCache[n.id][a]={}
}
e=this._acCache[n.id][a][o]={}
}
return e
};
ZmAppCtxt.prototype.clearAutocompleteCache=function(e,t){
var a=t||appCtxt.getActiveAccount();
if(this._acCache[a.id]){
if(e){
this._acCache[a.id][e]={}
}else{
this._acCache[a.id][ZmAutocomplete.AC_TYPE_CONTACT]={};
this._acCache[a.id][ZmAutocomplete.AC_TYPE_LOCATION]={};
this._acCache[a.id][ZmAutocomplete.AC_TYPE_EQUIPMENT]={}
}}};
ZmAppCtxt.prototype.getOutsideMouseEventMgr=function(){
return DwtOutsideMouseEventMgr.INSTANCE
};
ZmAppCtxt.prototype.getCharset=function(){
var e=AjxEnv.isIE?window.navigator.systemLanguage:window.navigator.language;
if((AjxEnv.DEFAULT_LOCALE=="ja"||e=="ja")&&AjxEnv.isWindows){
return"Windows-31J"
}else{
return"UTF-8"
}};
ZmAppCtxt.prototype.isExpandableDL=function(e){
return e&&this._isExpandableDL[e]&&this.get("EXPAND_DL_ENABLED")
};
ZmAppCtxt.prototype.setIsExpandableDL=function(t,e){
this._isExpandableDL[t]=e
};
ZmAppCtxt.prototype.getToolTipMgr=function(){
if(!this._toolTipMgr){
this._toolTipMgr=new ZmToolTipMgr()
}
return this._toolTipMgr
};
ZmAppCtxt.prototype.isZDOnline=function(){
var e=window.appCtxt.getAppController();
return !AjxEnv.isPrism||(e._isPrismOnline&&e._isUserOnline)
};
ZmAppCtxt.handleWindowOpener=function(){
try{
return window.opener&&window.opener.appCtxt||appCtxt
}
catch(e){
return appCtxt
}};
ZmAppCtxt.prototype.isWebClientOffline=function(){
if(this.isWebClientOfflineSupported){
return ZmOffline.isServerReachable===false
}
return false
};
ZmAppCtxt.prototype.initWebOffline=function(){
this.isWebClientOfflineSupported=false;
if(!AjxEnv.isOfflineSupported||!appCtxt.get(ZmSetting.WEBCLIENT_OFFLINE_ENABLED)){
AjxDebug.println(AjxDebug.OFFLINE,"isWebClientOfflineSupported :: false");
return
}
var e=appCtxt.get(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY);
var t=localStorage.getItem(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY);
if(e&&e.indexOf(t)!==-1){
this.isWebClientOfflineSupported=true;
this.webClientOfflineHandler=new ZmOffline()
}
AjxDebug.println(AjxDebug.OFFLINE,"isWebClientOfflineSupported :: "+this.isWebClientOfflineSupported)
};
ZmAppCtxt.prototype.getOfflineSettingsDialog=function(){
if(!this._offlineSettingsDialog){
this._offlineSettingsDialog=new ZmOfflineSettingsDialog()
}
return this._offlineSettingsDialog
};
ZmAppCtxt.prototype.isRemoteId=function(t){
t=String(t);
var e=appCtxt.getActiveAccount();
return(t.indexOf(":")!==-1)&&(t.indexOf(e.id)!==0)
};
ZmAppCtxt.prototype.getClipboard=function(){
return AjxClipboard.isSupported()?new AjxClipboard():null
}
}
if(AjxPackage.define("zimbraMail.core.ZmOperation")){
ZmOperation=function(){};
ZmOperation.NONE="NONE";
ZmOperation.SEP="SEP";
ZmOperation.SPACER="SPACER";
ZmOperation.FILLER="FILLER";
ZmOperation.DIS="Dis";
ZmOperation.SETUP={};
ZmOperation.SETUP[ZmOperation.NONE]={};
ZmOperation.SETUP[ZmOperation.SEP]={};
ZmOperation.SETUP[ZmOperation.SPACER]={};
ZmOperation.SETUP[ZmOperation.FILLER]={};
ZmOperation.SETTING={};
ZmOperation.CALLBACK={};
ZmOperation.registerOp=function(i,t,e,a){
ZmOperation[i]=i;
ZmOperation.SETUP[i]=t||{};
if(e){
ZmOperation.SETTING[i]=e
}
if(a){
ZmOperation.CALLBACK[i]=a
}};
ZmOperation.KEY_ID="opId";
ZmOperation.MENUITEM_ID="menuItemId";
ZmOperation.NEW_ITEM_OPS=[];
ZmOperation.NEW_ITEM_KEY={};
ZmOperation.NEW_ORG_OPS=[];
ZmOperation.NEW_ORG_KEY={};
ZmOperation._operationDesc={};
ZmOperation.initialize=function(){
ZmOperation.registerOp(ZmId.OP_ACTIONS_MENU,{
textKey:"actions",tooltipKey:"",textPrecedence:40}
);
ZmOperation.registerOp(ZmId.OP_ATTACHMENT,{
textKey:"addAttachment",tooltipKey:"attachmentTooltip",image:"Attachment",shortcut:ZmKeyMap.ATTACHMENT,showImageInToolbar:true}
);
ZmOperation.registerOp(ZmId.OP_CALL,{
image:"Telephone"}
);
ZmOperation.registerOp(ZmId.OP_CANCEL,{
textKey:"cancel",tooltipKey:"cancelTooltip",image:"Cancel",shortcut:ZmKeyMap.CANCEL}
);
ZmOperation.registerOp(ZmId.OP_CHECK_ALL,{
textKey:"checkAll",image:"Check"}
);
ZmOperation.registerOp(ZmId.OP_CLEAR_ALL,{
textKey:"clearAll",image:"Cancel"}
);
ZmOperation.registerOp(ZmId.OP_CLOSE,{
textKey:"close",tooltipKey:"closeTooltip",image:"Close",shortcut:ZmKeyMap.CANCEL}
);
ZmOperation.registerOp(ZmId.OP_COMPOSE_FORMAT,{
textKey:"format",tooltipKey:"formatTooltip",image:"SwitchFormat",shortcut:ZmKeyMap.HTML_FORMAT}
,ZmSetting.HTML_COMPOSE_ENABLED);
ZmOperation.registerOp(ZmId.OP_CONTACTGROUP_MENU,{
textKey:"AB_CONTACT_GROUP",tooltipKey:"contactGroupTooltip",image:"Group"}
,null,AjxCallback.simpleClosure(function(e){
ZmOperation.addDeferredMenu(ZmOperation.addContactGroupMenu,e,true)
}
));
ZmOperation.registerOp(ZmId.OP_COPY,{
textKey:"copy",image:"Copy"}
);
ZmOperation.registerOp(ZmId.OP_DELETE,{
textKey:"del",tooltipKey:"deleteTooltip",image:"Delete",shortcut:ZmKeyMap.DEL,textPrecedence:60}
);
ZmOperation.registerOp(ZmId.OP_DELETE_WITHOUT_SHORTCUT,{
textKey:"del",tooltipKey:"deleteTooltip",image:"Delete",textPrecedence:60}
);
ZmOperation.registerOp(ZmId.OP_DETACH,{
textKey:"detachTT",tooltipKey:"detachTT",image:"OpenInNewWindow",showImageInToolbar:true}
);
ZmOperation.registerOp(ZmId.OP_DETACH_WIN,{
textKey:"detachTT",tooltipKey:"detachTT",image:"OpenInNewWindow"}
);
ZmOperation.registerOp(ZmId.OP_EDIT,{
textKey:"edit",tooltipKey:"editTooltip",image:"Edit",shortcut:ZmKeyMap.EDIT}
);
ZmOperation.registerOp(ZmId.OP_EDIT_AS_NEW,{
textKey:"editAsNew",tooltipKey:"editTooltip",image:"Edit",shortcut:ZmKeyMap.EDIT}
);
ZmOperation.registerOp(ZmId.OP_EDIT_PROPS,{
textKey:"editProperties",tooltipKey:"editPropertiesTooltip",image:"Properties"}
);
ZmOperation.registerOp(ZmId.OP_EXPAND,{
textKey:"expand",image:"Plus"}
);
ZmOperation.registerOp(ZmId.OP_EXPAND_ALL,{
textKey:"expandAll",image:"Plus"}
);
ZmOperation.registerOp(ZmId.OP_EMPTY_FOLDER,{
textKey:"emptyFolder",image:"EmptyFolder"}
);
ZmOperation.registerOp(ZmId.OP_FORMAT_HTML,{
textKey:"formatAsHtml"}
,ZmSetting.HTML_COMPOSE_ENABLED);
ZmOperation.registerOp(ZmId.OP_FORMAT_TEXT,{
textKey:"formatAsText"}
,ZmSetting.HTML_COMPOSE_ENABLED);
ZmOperation.registerOp(ZmId.OP_FORMAT_MORE_OPTIONS,{
textKey:"moreComposeOptions"}
);
ZmOperation.registerOp(ZmId.OP_GROUPBY,{
textKey:"groupBy"}
);
ZmOperation.registerOp(ZmId.OP_GROUPBY_NONE,{
textKey:"groupByNone"}
);
ZmOperation.registerOp(ZmId.OP_GROUPBY_DATE,{
textKey:"groupByDate"}
);
ZmOperation.registerOp(ZmId.OP_GROUPBY_FROM,{
textKey:"groupByFrom"}
);
ZmOperation.registerOp(ZmId.OP_GROUPBY_PRIORITY,{
textKey:"groupByPriority"}
);
ZmOperation.registerOp(ZmId.OP_GROUPBY_SIZE,{
textKey:"groupBySize"}
);
ZmOperation.registerOp(ZmId.OP_GROUPBY_TAG,{
textKey:"groupByTag"}
);
ZmOperation.registerOp(ZmId.OP_GO_TO_URL,{
image:"URL",textKey:"goToUrlAlt"}
);
ZmOperation.registerOp(ZmId.OP_MARK_ALL_READ,{
textKey:"markAllRead",image:"ReadMessage"}
);
ZmOperation.registerOp(ZmId.OP_MOVE,{
textKey:"move",tooltipKey:"moveTooltip",image:"MoveToFolder",textPrecedence:40,showImageInToolbar:true}
);
ZmOperation.registerOp(ZmId.OP_MOVE_MENU,{
textKey:"move",tooltipKey:"moveTooltip",image:"MoveToFolder",showImageInToolbar:true}
,null,AjxCallback.simpleClosure(function(e){
ZmOperation.addDeferredMenu(ZmOperation.addMoveMenu,e,true)
}
));
ZmOperation.registerOp(ZmId.OP_MUTE_CONV,{
textKey:"muteConv",tooltipKey:"muteConvTooltip",image:"Mute",shortcut:ZmKeyMap.MUTE_UNMUTE_CONV}
);
ZmOperation.registerOp(ZmId.OP_OPTS,{
textKey:"options",tooltipKey:"options",image:"ContextMenu"}
);
ZmOperation.registerOp(ZmId.OP_NEW_FOLDER,{
textKey:"newFolder",tooltipKey:"newFolderTooltip",image:"NewFolder",shortcut:ZmKeyMap.NEW_FOLDER}
,ZmSetting.USER_FOLDERS_ENABLED);
ZmOperation.registerOp(ZmId.OP_NEW_MENU,{
textKey:"_new",shortcut:ZmKeyMap.NEW,textPrecedence:100}
,null,AjxCallback.simpleClosure(function(e){
ZmOperation.addDeferredMenu(ZmOperation.addNewMenu,e)
}
));
ZmOperation.registerOp(ZmId.OP_NEW_TAG,{
textKey:"newTag",tooltipKey:"newTagTooltip",image:"NewTag",shortcut:ZmKeyMap.NEW_TAG}
,ZmSetting.TAGGING_ENABLED);
ZmOperation.registerOp(ZmId.OP_NOTIFY,{
textKey:"notify",image:"Feedback"}
);
ZmOperation.registerOp(ZmId.OP_PAGE_BACK,{
image:"LeftArrow",shortcut:ZmKeyMap.PREV_PAGE}
);
ZmOperation.registerOp(ZmId.OP_PAGE_FORWARD,{
image:"RightArrow",shortcut:ZmKeyMap.NEXT_PAGE}
);
ZmOperation.registerOp(ZmId.OP_PRINT,{
textKey:"print",tooltipKey:"printTooltip",image:"Print",shortcut:ZmKeyMap.PRINT,textPrecedence:30,showImageInToolbar:true}
,ZmSetting.PRINT_ENABLED);
ZmOperation.registerOp(ZmId.OP_PRIORITY_FILTER,{
image:"Priority",textKey:"activityStream"}
,ZmSetting.PRIORITY_INBOX_ENABLED);
ZmOperation.registerOp(ZmId.OP_FIND_SHARES,{
image:"Group",textKey:"findShares"}
,ZmSetting.SHARING_ENABLED);
ZmOperation.registerOp(ZmId.OP_RECOVER_DELETED_ITEMS,{
textKey:"recoverDeletedItems",image:"Trash",tooltipKey:"recoverDeletedItems"}
,ZmSetting.DUMPSTER_ENABLED);
ZmOperation.registerOp(ZmId.OP_REFRESH,{
textKey:"refresh",tooltipKey:"refreshTooltip"}
);
ZmOperation.registerOp(ZmId.OP_RENAME_FOLDER,{
textKey:"renameFolder",image:"Rename"}
);
ZmOperation.registerOp(ZmId.OP_RENAME_SEARCH,{
textKey:"renameSearch",image:"Rename"}
);
ZmOperation.registerOp(ZmId.OP_RENAME_TAG,{
textKey:"renameTag",image:"Rename"}
,ZmSetting.TAGGING_ENABLED);
ZmOperation.registerOp(ZmId.OP_SAVE,{
textKey:"save",image:"Save",shortcut:ZmKeyMap.SAVE}
);
ZmOperation.registerOp(ZmId.OP_SEARCH,{
textKey:"findEmailFromSender",image:"Search"}
,ZmSetting.SEARCH_ENABLED);
ZmOperation.registerOp(ZmId.OP_SEARCH_TO,{
textKey:"findEmailToSender",image:"Search"}
,ZmSetting.SEARCH_ENABLED);
ZmOperation.registerOp(ZmId.OP_SEARCH_MENU,{
textKey:"findEmails",image:"Search"}
,ZmSetting.SEARCH_ENABLED,AjxCallback.simpleClosure(function(e){
ZmOperation.addDeferredMenu(ZmOperation.addSearchMenu,e,true)
}
));
ZmOperation.registerOp(ZmId.OP_SEND,{
textKey:"send",tooltipKey:"sendTooltip",image:"Send",shortcut:ZmKeyMap.SEND}
);
ZmOperation.registerOp(ZmId.OP_FREE_BUSY_LINK,{
textKey:"freeBusyLink",tooltipKey:"freeBusyLinkTooltip",image:"Send"}
);
ZmOperation.registerOp(ZmId.OP_SEND_FB_HTML,{
textKey:"sendHTMLLink",tooltipKey:"freeBusyLinkTooltip"}
);
ZmOperation.registerOp(ZmId.OP_SEND_FB_ICS,{
textKey:"sendICSLink",tooltipKey:"freeBusyLinkTooltip"}
);
ZmOperation.registerOp(ZmId.OP_SEND_FB_ICS_EVENT,{
textKey:"sendICSEventLink",tooltipKey:"freeBusyLinkTooltip"}
);
ZmOperation.registerOp(ZmId.OP_SHARE,{
textKey:"share",tooltipKey:"shareTooltip"}
,ZmSetting.SHARING_ENABLED);
ZmOperation.registerOp(ZmId.OP_SHARE_ACCEPT,{
textKey:"acceptShare",image:"Check"}
,ZmSetting.SHARING_ENABLED);
ZmOperation.registerOp(ZmId.OP_SHARE_DECLINE,{
textKey:"declineShare",image:"Cancel"}
,ZmSetting.SHARING_ENABLED);
ZmOperation.registerOp(ZmId.OP_SUBSCRIBE_APPROVE,{
textKey:"dlApprove",image:"Check"}
);
ZmOperation.registerOp(ZmId.OP_SUBSCRIBE_REJECT,{
textKey:"dlReject",image:"Cancel"}
);
ZmOperation.registerOp(ZmId.OP_SHARE_FOLDER,{
textKey:"shareFolder",image:"SharedMailFolder"}
);
ZmOperation.registerOp(ZmId.OP_SHOW_ALL_ITEM_TYPES,{
textKey:"showAllItemTypes",image:"Globe"}
);
ZmOperation.registerOp(ZmId.OP_SORT_ASC,{
textKey:"sortAscending"}
);
ZmOperation.registerOp(ZmId.OP_SORT_DESC,{
textKey:"sortDescending"}
);
ZmOperation.registerOp(ZmId.OP_SPELL_CHECK,{
textKey:"spellCheck",image:"SpellCheck",tooltipKey:"spellCheckTooltip",shortcut:ZmKeyMap.SPELLCHECK,showImageInToolbar:true}
,ZmSetting.SPELL_CHECK_ENABLED);
ZmOperation.registerOp(ZmId.OP_SYNC,{
textKey:"reload",image:"Refresh",shortcut:ZmKeyMap.REFRESH}
);
ZmOperation.registerOp(ZmId.OP_SYNC_ALL,{
textKey:"checkAllFeed",image:"Refresh"}
);
ZmOperation.registerOp(ZmId.OP_SYNC_OFFLINE_FOLDER,{
textKey:"syncOfflineFolderOff",image:"Refresh"}
,ZmSetting.OFFLINE_ENABLED);
ZmOperation.registerOp(ZmId.OP_TAG,null,ZmSetting.TAGGING_ENABLED);
ZmOperation.registerOp(ZmId.OP_TAG_COLOR_MENU,{
textKey:"tagColor",image:"TagStack"}
,ZmSetting.TAGGING_ENABLED,AjxCallback.simpleClosure(function(e){
ZmOperation.addDeferredMenu(ZmOperation.addColorMenu,e)
}
));
ZmOperation.registerOp(ZmId.OP_TAG_MENU,{
textKey:"tag",tooltipKey:"tagTooltip",image:"Tag",showImageInToolbar:true}
,ZmSetting.TAGGING_ENABLED,AjxCallback.simpleClosure(function(e){
ZmOperation.addDeferredMenu(ZmOperation.addTagMenu,e,true)
}
));
ZmOperation.registerOp(ZmId.OP_TEXT);
ZmOperation.registerOp(ZmId.OP_UNDELETE,{
textKey:"undelete",tooltipKey:"undelete",image:"MoveToFolder"}
);
ZmOperation.registerOp(ZmId.OP_UNMUTE_CONV,{
textKey:"unmuteConv",tooltipKey:"unmuteConvTooltip",image:"Unmute",shortcut:ZmKeyMap.MUTE_UNMUTE_CONV}
);
ZmOperation.registerOp(ZmId.OP_VIEW,{
textKey:"view",image:"SplitView"}
);
ZmOperation.registerOp(ZmId.OP_VIEW_MENU,{
tooltipKey:"viewTooltip",textKey:"view",image:"SplitPane",textPrecedence:80,showImageInToolbar:true,showTextInToolbar:true}
);
ZmOperation.registerOp(ZmId.OP_ZIMLET,{
image:"ZimbraIcon"}
);
ZmOperation.registerOp(ZmId.OP_ACCEPT_PROPOSAL,{
textKey:"replyAccept",image:"Check"}
);
ZmOperation.registerOp(ZmId.OP_DECLINE_PROPOSAL,{
textKey:"replyDecline",image:"Cancel"}
);
ZmOperation.registerOp(ZmId.OP_CAL_REPLY,{
textKey:"reply",tooltipKey:"replyTooltip",image:"Reply",shortcut:ZmKeyMap.REPLY}
);
ZmOperation.registerOp(ZmId.OP_CAL_REPLY_ALL,{
textKey:"replyAll",tooltipKey:"replyAllTooltip",image:"ReplyAll",shortcut:ZmKeyMap.REPLY_ALL}
);
ZmOperation.registerOp(ZmId.OP_REPLY_ACCEPT,{
textKey:"replyAccept",image:"Check",showTextInToolbar:true,showImageInToolbar:true}
);
ZmOperation.registerOp(ZmId.OP_REPLY_ACCEPT_NOTIFY,{
textKey:"notifyOrganizerLabel",image:"Check"}
);
ZmOperation.registerOp(ZmId.OP_REPLY_ACCEPT_IGNORE,{
textKey:"dontNotifyOrganizerLabel",image:"Check"}
);
ZmOperation.registerOp(ZmId.OP_REPLY_CANCEL);
ZmOperation.registerOp(ZmId.OP_REPLY_DECLINE,{
textKey:"replyDecline",image:"Cancel",showTextInToolbar:true,showImageInToolbar:true}
);
ZmOperation.registerOp(ZmId.OP_REPLY_DECLINE_NOTIFY,{
textKey:"notifyOrganizerLabel",image:"Cancel"}
);
ZmOperation.registerOp(ZmId.OP_REPLY_DECLINE_IGNORE,{
textKey:"dontNotifyOrganizerLabel",image:"Cancel"}
);
ZmOperation.registerOp(ZmId.OP_REPLY_MODIFY);
ZmOperation.registerOp(ZmId.OP_REPLY_NEW_TIME,{
textKey:"replyNewTime",image:"NewTime"}
);
ZmOperation.registerOp(ZmId.OP_REPLY_TENTATIVE,{
textKey:"replyTentative",image:"QuestionMark",showTextInToolbar:true,showImageInToolbar:true}
);
ZmOperation.registerOp(ZmId.OP_REPLY_TENTATIVE_NOTIFY,{
textKey:"notifyOrganizerLabel",image:"QuestionMark"}
);
ZmOperation.registerOp(ZmId.OP_REPLY_TENTATIVE_IGNORE,{
textKey:"dontNotifyOrganizerLabel",image:"QuestionMark"}
);
ZmOperation.NEW_ORG_OPS.push(ZmOperation.NEW_FOLDER,ZmOperation.NEW_TAG);
ZmOperation.NEW_ORG_KEY[ZmOperation.NEW_FOLDER]="folder";
ZmOperation.NEW_ORG_KEY[ZmOperation.NEW_TAG]="tag"
};
ZmOperation.createOperations=function(t,e,i){
var a=new ZmOperation();
return a._createOperations(t,e,i)
};
ZmOperation.prototype._createOperations=function(a,e,n){
if(e==ZmOperation.NONE){
e=null
}
n=n||{};
var o={};
if(e&&e.length){
for(var t=0;
t<e.length;
t++){
var s=e[t];
ZmOperation.defineOperation(s,n[s]);
ZmOperation.addOperation(a,s,o,null,n[s]&&n[s].htmlElId)
}}
return o
};
ZmOperation.defineOperation=function(f,m){
var t=(m&&m.id)||(f&&f.id)||f||Dwt.getNextId();
var a=(m&&m.textKey)||ZmOperation.getProp(f,"textKey");
var p=a&&ZmMsg[a];
var c=(m&&m.tooltipKey)||ZmOperation.getProp(f,"tooltipKey");
var g=c&&ZmMsg[c];
var s=ZmOperation.getProp(f,"image");
var n=ZmOperation.getProp(f,"showImageInToolbar");
var u=ZmOperation.getProp(f,"showTextInToolbar");
var l=ZmOperation.getProp(f,"disImage");
var d=(m&&(m.enabled!==false));
var e=ZmOperation.getProp(f,"style");
var r=ZmOperation.getProp(f,"shortcut");
var o={
id:t,text:p,image:s,showImageInToolbar:n,showTextInToolbar:u,disImage:l,enabled:d,tooltip:g,style:e,shortcut:r};
if(m){
for(var h in m){
o[h]=m[h]
}}
ZmOperation._operationDesc[t]=o;
return o
};
ZmOperation.getProp=function(i,a){
var t=null;
var e=ZmOperation.SETUP[i];
if(e){
t=e[a];
if(!t&&(a=="disImage")&&e.image){
t=e.image
}}
return t
};
ZmOperation.isSep=function(e){
return(e==ZmOperation.SEP||e==ZmOperation.SPACER||e==ZmOperation.FILLER)
};
ZmOperation.addOperation=function(a,s,i,e,t){
var o=ZmOperation._operationDesc[s]||ZmOperation.defineOperation(s);
if(s==ZmOperation.SEP){
if(a instanceof DwtMenu){
a.createSeparator(e)
}else{
a.addSeparator(null,e)
}}else{
if(s==ZmOperation.SPACER){
a.addSpacer(null,e)
}else{
if(s==ZmOperation.FILLER){
a.addFiller(null,e)
}else{
if(e!=null){
o.index=e
}
i[s]=a.createOp(s,o,t)
}}}
var n=ZmOperation.CALLBACK[s];
if(n){
n.run(i[s])
}};
ZmOperation.addDeferredMenu=function(e,o){
var t=[o];
for(var a=2;
a<arguments.length;
a++){
t.push(arguments[a])
}
var n=new AjxCallback(null,e,t);
o.setMenu(n)
};
ZmOperation.removeOperation=function(e,i,t){
var a=e.getOp(i);
if(a){
a.dispose();
delete t[i]
}};
ZmOperation.setOperation=function(t,n,e,o,i,a){
var s=t.getOp(n);
if(!s){
return
}
s.setText(o?o:ZmMsg[ZmOperation.getProp(e,"textKey")]);
s.setImage(i?i:ZmOperation.getProp(e,"image"))
};
ZmOperation.filterOperations=function(s){
var o=[];
if(!(s&&s.length)){
return o
}
for(var t=0;
t<s.length;
t++){
var r=s[t];
if(!r){
continue
}
var a=ZmOperation.SETTING[r];
if(!a||appCtxt.get(a)){
o.push(r)
}}
var e=[];
var n=false;
for(var t=0;
t<o.length;
t++){
var r=o[t];
if(r==ZmOperation.SEP||r==ZmOperation.SPACER){
if(!n){
e.push(r)
}
n=true
}else{
e.push(r);
n=false
}}
if(e&&e.length){
if(e[0]==ZmOperation.SEP||e[0]==ZmOperation.SPACER){
e.shift()
}
var t=e.length-1;
if(e[t]==ZmOperation.SEP||e[t]==ZmOperation.SPACER||e[t]==ZmOperation.FILLER){
e.pop()
}}
return e
};
ZmOperation.addNewMenu=function(a){
var n=ZmOperation.NEW_ITEM_OPS;
n.push(ZmOperation.SEP);
n=n.concat(ZmOperation.NEW_ORG_OPS);
var r={};
for(var t=0;
t<n.length;
t++){
var h=n[t];
var e=a._htmlElId+"_"+h;
r[h]={
htmlElId:e};
var o=ZmOperation.NEW_ITEM_KEY[h]||ZmOperation.NEW_ORG_KEY[h];
if(o){
r[h].textKey=o
}}
var s=new ZmActionMenu({
parent:a,menuItems:n,overrides:r}
);
a.setMenu(s);
return s
};
ZmOperation.addSearchMenu=function(e){
var t=[ZmOperation.SEARCH,ZmOperation.SEARCH_TO];
var a=new ZmActionMenu({
parent:e,menuItems:t}
);
e.setMenu(a);
return a
};
ZmOperation.addContactGroupMenu=function(t){
var e=new ZmContactGroupMenu(t);
t.setMenu(e);
return e
};
ZmOperation.addTagMenu=function(e){
var t=new ZmTagMenu(e);
e.setMenu(t);
return t
};
ZmOperation.addMoveMenu=function(e){
var t=new DwtMenu(e);
e.setMenu(t);
return t
};
ZmOperation.addColorMenu=function(e,a){
var t=new ZmColorMenu({
parent:e,image:"Tag",hideNone:true,hideNoFill:a}
);
e.setMenu(t);
return t
};
ZmOperation.getToolTip=function(o,i,e){
var t=ZmOperation._operationDesc[o]||ZmOperation.defineOperation(o);
e=e||t.tooltip;
var a=e&&t.shortcut&&appCtxt.getShortcutHint(i,t.shortcut);
return a?[e,a].join(""):e
}
}
if(AjxPackage.define("zimbraMail.core.ZmMimeTable")){
ZmMimeTable=function(){};
ZmMimeTable.APP="application";
ZmMimeTable.APP_ADOBE_PDF="application/pdf";
ZmMimeTable.APP_ADOBE_PS="application/postscript";
ZmMimeTable.APP_APPLE_DOUBLE="application/applefile";
ZmMimeTable.APP_EXE="application/exe";
ZmMimeTable.APP_MS_DOWNLOAD="application/x-msdownload";
ZmMimeTable.APP_MS_EXCEL="application/vnd.ms-excel";
ZmMimeTable.APP_MS_PPT="application/vnd.ms-powerpoint";
ZmMimeTable.APP_MS_PROJECT="application/vnd.ms-project";
ZmMimeTable.APP_MS_TNEF="application/ms-tnef";
ZmMimeTable.APP_MS_TNEF2="application/vnd.ms-tnef";
ZmMimeTable.APP_SIGNATURE="application/pkcs7-signature";
ZmMimeTable.APP_MS_VISIO="application/vnd.visio";
ZmMimeTable.APP_MS_WORD="application/msword";
ZmMimeTable.APP_OCTET_STREAM="application/octet-stream";
ZmMimeTable.APP_OPENXML_DOC="application/vnd.openxmlformats-officedocument.wordprocessingml.document";
ZmMimeTable.APP_OPENXML_EXCEL="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";
ZmMimeTable.APP_OPENXML_PPT="application/vnd.openxmlformats-officedocument.presentationml.presentation";
ZmMimeTable.APP_XML="application/xml";
ZmMimeTable.APP_ZIMBRA_DOC="application/x-zimbra-doc";
ZmMimeTable.APP_ZIP="application/zip";
ZmMimeTable.APP_ZIP2="application/x-zip-compressed";
ZmMimeTable.AUDIO="audio";
ZmMimeTable.AUDIO_WAV="audio/x-wav";
ZmMimeTable.AUDIO_MP3="audio/mpeg";
ZmMimeTable.IMG="image";
ZmMimeTable.IMG_GIF="image/gif";
ZmMimeTable.IMG_BMP="image/bmp";
ZmMimeTable.IMG_JPEG="image/jpeg";
ZmMimeTable.IMG_PJPEG="image/pjpeg";
ZmMimeTable.IMG_PNG="image/png";
ZmMimeTable.IMG_TIFF="image/tiff";
ZmMimeTable.MSG_RFC822="message/rfc822";
ZmMimeTable.MSG_READ_RECEIPT="message/disposition-notification";
ZmMimeTable.MULTI_ALT="multipart/alternative";
ZmMimeTable.MULTI_MIXED="multipart/mixed";
ZmMimeTable.MULTI_RELATED="multipart/related";
ZmMimeTable.MULTI_APPLE_DBL="multipart/appledouble";
ZmMimeTable.MULTI_DIGEST="multipart/digest";
ZmMimeTable.TEXT="text";
ZmMimeTable.TEXT_RTF="text/enriched";
ZmMimeTable.TEXT_HTML="text/html";
ZmMimeTable.TEXT_CAL="text/calendar";
ZmMimeTable.TEXT_JAVA="text/x-java";
ZmMimeTable.TEXT_VCARD="text/x-vcard";
ZmMimeTable.TEXT_DIRECTORY="text/directory";
ZmMimeTable.TEXT_PLAIN="text/plain";
ZmMimeTable.TEXT_XML="text/xml";
ZmMimeTable.VIDEO="video";
ZmMimeTable.VIDEO_WMV="video/x-ms-wmv";
ZmMimeTable.XML_ZIMBRA_SHARE="xml/x-zimbra-share";
ZmMimeTable.FORMAT_FLOWED="flowed";
ZmMimeTable._table={};
ZmMimeTable._table[ZmMimeTable.APP]={
desc:ZmMsg.application,image:"ExeDoc",imageLarge:"ExeDoc_48",query:"application/*"};
ZmMimeTable._table[ZmMimeTable.APP_ADOBE_PDF]={
desc:ZmMsg.adobePdfDocument,image:"Doc",imageLarge:"Doc_48"};
ZmMimeTable._table[ZmMimeTable.APP_ADOBE_PS]={
desc:ZmMsg.adobePsDocument,image:"GenericDoc",imageLarge:"GenericDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_EXE]={
desc:ZmMsg.application,image:"ExeDoc",imageLarge:"ExeDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_MS_DOWNLOAD]={
desc:ZmMsg.msDownload,image:"ExeDoc",imageLarge:"ExeDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_MS_EXCEL]={
desc:ZmMsg.msExcelDocument,image:"MSExcelDoc",imageLarge:"MSExcelDoc_48",query:"excel"};
ZmMimeTable._table[ZmMimeTable.APP_MS_PPT]={
desc:ZmMsg.msPPTDocument,image:"MSPowerpointDoc",imageLarge:"MSPowerpointDoc_48",query:"powerpoint"};
ZmMimeTable._table[ZmMimeTable.APP_MS_PROJECT]={
desc:ZmMsg.msProjectDocument,image:"MSProjectDoc",imageLarge:"MSProjectDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_MS_VISIO]={
desc:ZmMsg.msVisioDocument,image:"MSVisioDoc",imageLarge:"MSVisioDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_MS_WORD]={
desc:ZmMsg.msWordDocument,image:"MSWordDoc",imageLarge:"MSWordDoc_48",query:"word"};
ZmMimeTable._table[ZmMimeTable.APP_OCTET_STREAM]={
desc:ZmMsg.unknownBinaryType,image:"UnknownDoc",imageLarge:"UnknownDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_OPENXML_DOC]={
desc:ZmMsg.msWordDocument,image:"MSWordDoc",imageLarge:"MSWordDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_OPENXML_EXCEL]={
desc:ZmMsg.msExcelDocument,image:"MSExcelDoc",imageLarge:"MSExcelDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_OPENXML_PPT]={
desc:ZmMsg.msPPTDocument,image:"MSPowerpointDoc",imageLarge:"MSPowerpointDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_XML]={
desc:ZmMsg.xmlDocument,image:"GenericDoc",imageLarge:"GenericDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_ZIMBRA_DOC]={
desc:ZmMsg.zimbraDocument,image:"Doc",imageLarge:"Doc_48"};
ZmMimeTable._table[ZmMimeTable.APP_ZIP]={
desc:ZmMsg.zipFile,image:"ZipDoc",imageLarge:"ZipDoc_48"};
ZmMimeTable._table[ZmMimeTable.APP_ZIP2]={
desc:ZmMsg.zipFile,image:"ZipDoc",imageLarge:"ZipDoc_48"};
ZmMimeTable._table[ZmMimeTable.AUDIO]={
desc:ZmMsg.audio,image:"AudioDoc",imageLarge:"AudioDoc_48"};
ZmMimeTable._table[ZmMimeTable.AUDIO_WAV]={
desc:ZmMsg.waveAudio,image:"AudioDoc",imageLarge:"AudioDoc_48"};
ZmMimeTable._table[ZmMimeTable.AUDIO_MP3]={
desc:ZmMsg.mp3Audio,image:"AudioDoc",imageLarge:"AudioDoc_48"};
ZmMimeTable._table[ZmMimeTable.IMG]={
desc:ZmMsg.image,image:"ImageDoc",imageLarge:"ImageDoc_48",query:"image/*"};
ZmMimeTable._table[ZmMimeTable.IMG_BMP]={
desc:ZmMsg.bmpImage,image:"ImageDoc",imageLarge:"ImageDoc_48",query:"bmp"};
ZmMimeTable._table[ZmMimeTable.IMG_GIF]={
desc:ZmMsg.gifImage,image:"ImageDoc",imageLarge:"ImageDoc_48",query:"gif"};
ZmMimeTable._table[ZmMimeTable.IMG_JPEG]={
desc:ZmMsg.jpegImage,image:"ImageDoc",imageLarge:"ImageDoc_48",query:"jpeg"};
ZmMimeTable._table[ZmMimeTable.IMG_PNG]={
desc:ZmMsg.pngImage,image:"ImageDoc",imageLarge:"ImageDoc_48",query:"png"};
ZmMimeTable._table[ZmMimeTable.IMG_TIFF]={
desc:ZmMsg.tiffImage,image:"ImageDoc",imageLarge:"ImageDoc_48"};
ZmMimeTable._table[ZmMimeTable.MSG_RFC822]={
desc:ZmMsg.mailMessage,image:"MessageDoc",imageLarge:"MessageDoc_48"};
ZmMimeTable._table[ZmMimeTable.TEXT]={
desc:ZmMsg.textDocuments,image:"Doc",imageLarge:"Doc_48"};
ZmMimeTable._table[ZmMimeTable.TEXT_RTF]={
desc:ZmMsg.enrichedText,image:"Doc",imageLarge:"Doc_48"};
ZmMimeTable._table[ZmMimeTable.TEXT_HTML]={
desc:ZmMsg.htmlDocument,image:"HtmlDoc",imageLarge:"HtmlDoc_48"};
ZmMimeTable._table[ZmMimeTable.TEXT_JAVA]={
desc:ZmMsg.javaSource,image:"GenericDoc",imageLarge:"GenericDoc_48"};
ZmMimeTable._table[ZmMimeTable.TEXT_PLAIN]={
desc:ZmMsg.textFile,image:"Doc",imageLarge:"Doc_48",query:"text"};
ZmMimeTable._table[ZmMimeTable.TEXT_XML]={
desc:ZmMsg.xmlDocument,image:"GenericDoc",imageLarge:"GenericDoc_48"};
ZmMimeTable._table[ZmMimeTable.VIDEO]={
desc:ZmMsg.video,image:"VideoDoc",imageLarge:"VideoDoc_48"};
ZmMimeTable._table[ZmMimeTable.VIDEO_WMV]={
desc:ZmMsg.msWMV,image:"VideoDoc",imageLarge:"VideoDoc_48"};
ZmMimeTable.getInfo=function(t,e){
var a=ZmMimeTable._table[t];
if(!a&&e){
a=ZmMimeTable._table[t]={
desc:t,image:"UnknownDoc",imageLarge:"UnknownDoc_48"}
}
if(a){
if(!a.type){
a.type=t
}}else{
var i=t.split("/")[0];
if(i){
a=ZmMimeTable._table[i]
}}
return a
};
ZmMimeTable.isIgnored=function(e){
return(e==ZmMimeTable.MULTI_ALT||e==ZmMimeTable.MULTI_MIXED||e==ZmMimeTable.MULTI_RELATED||e==ZmMimeTable.MULTI_APPLE_DBL||e==ZmMimeTable.APP_MS_TNEF||e==ZmMimeTable.APP_MS_TNEF2||e==ZmMimeTable.APP_SIGNATURE)
};
ZmMimeTable.isRenderable=function(e,t){
return(e===ZmMimeTable.TEXT_HTML||e===ZmMimeTable.TEXT_PLAIN||(!t&&ZmMimeTable.isRenderableImage(e))||(!t&&e===ZmMimeTable.APP_ADOBE_PDF))
};
ZmMimeTable.isTextType=function(e){
return(e.match(/^text\/.*/)&&e!=ZmMimeTable.TEXT_HTML&&e!=ZmMimeTable.TEXT_CAL)
};
ZmMimeTable.isRenderableImage=function(e){
return(e==ZmMimeTable.IMG_JPEG||e==ZmMimeTable.IMG_GIF||e==ZmMimeTable.IMG_BMP||e==ZmMimeTable.IMG_PNG)
};
ZmMimeTable.hasHtmlVersion=function(e){
return(!(ZmMimeTable.isIgnored(e)||e.match(/^text\/plain/)||e.match(/^image/)||e.match(/^audio/)||e.match(/^video/)))
};
ZmMimeTable.isMultiMedia=function(e){
return(e.match(/^audio/)||e.match(/^video/))
};
ZmMimeTable.isWebDoc=function(e){
return(e==ZmMimeTable.APP_ZIMBRA_DOC)
}
}
if(AjxPackage.define("zimbraMail.offline.ZmOffline")){
ZmOffline=function(){
ZmOffline.SUPPORTED_APPS=[ZmApp.MAIL,ZmApp.CONTACTS,ZmApp.CALENDAR];
ZmOffline.SUPPORTED_MAIL_TREE_VIEWS=[ZmOrganizer.FOLDER,ZmOrganizer.SEARCH,ZmOrganizer.TAG];
ZmOfflineDB.init();
this._addListeners()
};
ZmOffline.appCacheDone=false;
ZmOffline.messageNotShowed=true;
ZmOffline.cacheProgress=[];
ZmOffline.syncStarted=false;
ZmOffline.isServerReachable=true;
ZmOffline.folders={};
ZmOffline.calendars={};
ZmOffline.CALENDAR_LOOK_BEHIND_DAYS=7;
ZmOffline.CALENDAR_READ_AHEAD_DAYS=21;
ZmOffline.ATTACHMENT="Attachment";
ZmOffline.REQUESTQUEUE="RequestQueue";
ZmOffline.META_DATA="MetaData";
ZmOffline.MAIL_PROGRESS="Mail";
ZmOffline.CONTACTS_PROGRESS="Contacts";
ZmOffline.CALENDAR_PROGRESS="Calendar Appointments";
ZmOffline.MAX_REQUEST_IN_BATCH_REQUEST=50;
ZmOffline.SYNC_REQUEST_DELAY=10000;
ZmOffline._checkCacheDone=function(){
if(appCtxt.isWebClientOfflineSupported&&ZmOffline.appCacheDone&&ZmOffline.cacheProgress.length===0&&ZmOffline.syncStarted&&ZmOffline.messageNotShowed){
appCtxt.setStatusMsg(ZmMsg.offlineCachingDone,ZmStatusView.LEVEL_INFO);
ZmOffline.messageNotShowed=false
}};
ZmOffline.prototype._addListeners=function(){
$(window).on("online offline",ZmOffline.checkServerStatus);
$(document).on("ZWCOffline",this._onZWCOffline.bind(this));
$(document).on("ZWCOnline",this._onZWCOnline.bind(this));
ZmZimbraMail.addListener(ZmAppEvent.POST_STARTUP,this._onPostStartup.bind(this));
setInterval(ZmOffline.checkServerStatus,10000)
};
ZmOffline.prototype._onZWCOffline=function(){
ZmOffline.refreshStatusIcon();
this._disableApps();
var e=appCtxt.getZimbraMail();
if(e){
e.setupHelpMenu()
}
this._setSearchOfflineState(true)
};
ZmOffline.prototype._onZWCOnline=function(){
ZmOffline.refreshStatusIcon();
this._enableApps();
this._replayOfflineRequest();
var e=appCtxt.getZimbraMail();
if(e){
e.setupHelpMenu()
}
this._setSearchOfflineState(false)
};
ZmOffline.prototype._setSearchOfflineState=function(e){
var t=appCtxt.getSearchController();
if(t){
var a=t.getSearchToolbar();
if(a){
a.setOfflineState(e)
}}};
ZmOffline.prototype._onPostStartup=function(){
this._initOfflineFolders();
if(appCtxt.isWebClientOffline()){
this._onZWCOffline()
}else{
this._replayOfflineRequest();
this._initStaticResources()
}
ZmOffline.updateFolderCount()
};
ZmOffline.prototype._enableApps=function(){
var a=appCtxt.getAppChooser();
for(var t in ZmApp.ENABLED_APPS){
var e=a.getButton(t);
if(e){
e.setEnabled(true)
}}
var o=appCtxt.getCurrentApp();
o.resetWebClientOfflineOperations()
};
ZmOffline.prototype._disableApps=function(){
var o=appCtxt.getAppChooser();
var t=AjxUtil.keys(ZmApp.ENABLED_APPS);
var e=AjxUtil.arraySubstract(t,ZmOffline.SUPPORTED_APPS);
for(var i=0;
i<e.length;
i++){
var a=o.getButton(e[i]);
if(a){
a.setEnabled()
}}
var n=appCtxt.getCurrentApp();
n.resetWebClientOfflineOperations()
};
ZmOffline.prototype._initOfflineFolders=function(){
var s=appCtxt.getFolderTree();
if(s){
var n=s.getByType("FOLDER");
n.forEach(function(i){
if(i.webOfflineSyncDays!==0){
ZmOffline.folders[i.id]=i
}}
);
var o=s.getByType("ADDRBOOK");
o.forEach(function(i){
if(i.id!=ZmFolder.ID_DLS){
ZmOffline.folders[i.id]=i
}}
);
var r=appCtxt.getApp("Contacts");
if(r){
r._deferredFolders.forEach(function(i){
if(i.obj.id!=ZmFolder.ID_DLS){
ZmOffline.folders[i.obj.id]=i.obj
}}
)
}}
var h=appCtxt.getCalManager();
var e=h&&h.getCalViewController();
var t=e.getOfflineSearchCalendarIds();
for(var a=0;
a<t.length;
a++){
ZmOffline.calendars[t[a]]=t[a]
}};
ZmOffline.prototype._initStaticResources=function(){
ZmOffline.refreshStatusIcon(true);
var e=[];
e.push({
url:"/css/msgview.css",storeInLocalStorage:true}
);
e.push({
url:"/img/large.png"}
);
e.push({
url:"/img/large/ImgPerson_48.png"}
);
e.push({
url:"/img/arrows/ImgSashArrowsUp.png"}
);
e.push({
url:"/img/arrows.png"}
);
e.push({
url:"/img/calendar/ImgCalendarDayGrid.repeat.gif"}
);
e.push({
url:"/css/tinymce-content.css"}
);
e.push({
url:"/js/ajax/3rdparty/tinymce/skins/lightgray/fonts/tinymce-small.woff",appendCacheKillerVersion:false}
);
e.push({
url:"/js/ajax/3rdparty/tinymce/skins/lightgray/content.min.css",appendCacheKillerVersion:false}
);
e.push({
url:"/js/ajax/3rdparty/tinymce/skins/lightgray/skin.min.css",appendCacheKillerVersion:false}
);
this._cacheStaticResources(e)
};
ZmOffline.prototype._cacheStaticResources=function(i,a,e){
if(e&&e.success&&a&&a.storeInLocalStorage){
localStorage.setItem(a.url,e.text)
}
if(i&&i.length>0){
var o=i.shift();
var t=appContextPath+o.url;
if(o.appendCacheKillerVersion!==false){
o.url=t=t+"?v="+cacheKillerVersion
}
var n=this._cacheStaticResources.bind(this,i,o);
AjxRpc.invoke(null,t,null,n,true)
}else{
var n=this._cacheStaticResourcesContinue.bind(this);
AjxDispatcher.require(["Contacts","TinyMCE","Extras"],true,n)
}};
ZmOffline.prototype._cacheStaticResourcesContinue=function(){
var i=this.sendSyncRequest.bind(this,appCtxt.reloadAppCache.bind(appCtxt));
var t=this._cacheSignatureImages.bind(this,i);
var e=tinyMCE.getlanguage(appCtxt.get(ZmSetting.LOCALE_NAME));
if(e==="en"){
t()
}else{
var a=appContextPath+"/js/ajax/3rdparty/tinymce/langs/"+e+".js";
AjxRpc.invoke(null,a,null,t,true)
}};
ZmOffline.prototype._cacheSignatureImages=function(i){
var a=appCtxt.getSignatureCollection().getSignatures();
if(!a||a.length===0){
return i&&i()
}
var e=document.createElement("template");
var t=[];
a.forEach(function(o){
e.innerHTML=o.getValue(ZmMimeTable.TEXT_HTML);
var s=e.content.querySelectorAll("img[src]");
for(var n=0;
n<s.length;
n++){
t.push(s[n].getAttribute("src"))
}}
);
this._storeSignatureImages(t,i)
};
ZmOffline.prototype._storeSignatureImages=function(a,i){
if(!a||a.length===0){
return i&&i()
}
var e=a.shift();
var t=$.ajax({
url:e,dataType:"text",headers:{
"X-Zimbra-Encoding":"x-base64"}}
);
t.done(function(n,o){
var s=n.substr(n.lastIndexOf(".")+1);
localStorage.setItem(n,"data:image/"+s+";base64,"+o)
}
.bind(window,e));
t.always(this._storeSignatureImages.bind(this,a,i))
};
ZmOffline.modifySignature=function(n){
var o=document.createElement("template");
o.innerHTML=n;
var s=o.content.querySelectorAll("img[src]");
for(var a=0;
a<s.length;
a++){
var t=s[a];
var e=localStorage.getItem(t.getAttribute("src"));
if(e){
t.setAttribute("src",e);
t.removeAttribute("dfsrc");
t.removeAttribute("data-mce-src")
}}
return o.innerHTML
};
ZmOffline.prototype._downloadCalendar=function(a,r,c,m,d,s){
var p={
BatchRequest:{
_jsns:"urn:zimbra",onerror:"continue"}};
var o=p.BatchRequest;
var h=appCtxt.getCalManager();
var i=h&&h.getCalViewController();
var e=i.getApptCache();
if(!a){
var n=new Date();
n.setHours(23,59,59,999);
var t=new Date(n.getTime());
t.setDate(t.getDate()-ZmOffline.CALENDAR_LOOK_BEHIND_DAYS);
t.setHours(0,0,0,0);
n.setDate(n.getDate()+ZmOffline.CALENDAR_READ_AHEAD_DAYS);
a=t.getTime();
r=n.getTime()
}
if(!c){
c=[];
for(var u in ZmOffline.calendars){
c.push(u)
}}
localStorage.setItem("calendarSyncTime",r);
var l={
start:a,end:r,accountFolderIds:c,folderIds:c,offset:0};
e.setFolderSearchParams(l.folderIds,l);
o.SearchRequest={
_jsns:"urn:zimbraMail"};
e._setSoapParams(o.SearchRequest,l);
var f=this._handleCalendarResponse.bind(this,a,r,m,d,s,null);
appCtxt.getRequestMgr().sendRequest({
jsonObj:p,asyncMode:true,callback:f}
)
};
ZmOffline.prototype._downloadByApptId=function(e,t,a,o,s){
var h={
BatchRequest:{
_jsns:"urn:zimbra",onerror:"continue"}};
h.BatchRequest.SearchRequest={
_jsns:"urn:zimbraMail"};
var i=h.BatchRequest.SearchRequest;
i.sortBy="none";
i.limit="500";
i.offset=0;
i.locale={
_content:AjxEnv.DEFAULT_LOCALE};
i.types=ZmSearch.TYPE[ZmItem.APPT];
var n=t.join(" OR ");
i.query={
_content:n};
i.calExpandInstStart=a;
i.calExpandInstEnd=o;
var r=this._handleCalendarResponse.bind(this,a,o,s,s==null,null,e);
appCtxt.getRequestMgr().sendRequest({
jsonObj:h,asyncMode:true,callback:r}
)
};
ZmOffline.prototype._handleCalendarResponse=function(m,n,r,z,h,O,t){
var w=t&&t._data&&t._data.BatchResponse;
var T=w&&w.SearchResponse&&w.SearchResponse[0];
try{
var v;
var a;
var f=new ZmApptList();
f.loadFromSummaryJs(T.appt,true);
var x=f.size();
var B=[];
var C;
var e;
var g;
var p=h?h:[];
var W={};
for(var k=0;
k<x;
k++){
a=f.get(k);
e=a.startDate.getTime();
g=a.endDate.getTime();
if(((e>=m)&&(e<=n))||((g>=m)&&(g<=n))){
this._cleanApptForStorage(a);
C={
appt:a,instanceId:this._createApptPrimaryKey(a),id:a.id,invId:a.invId,startDate:e,endDate:g};
B.push(C);
var o=a.invId||a.id;
W[o]=true
}}
for(var d in W){
p.push(d)
}
if(O){
var c;
var y=this._offlineUpdateAppts.bind(this,B);
for(var u in O){
c=[u];
ZmOfflineDB.doIndexSearch(c,ZmApp.CALENDAR,null,y,this.calendarDeleteErrorCallback.bind(this),"id")
}}else{
ZmOfflineDB.setItem(B,ZmApp.CALENDAR,null,this.calendarDownloadErrorCallback.bind(this))
}
if(z){
if(p.length>0){
var l=this._updateCacheProgress.bind(this,ZmOffline.CALENDAR_PROGRESS);
this._loadMessages(p,l)
}else{
this._updateCacheProgress(ZmOffline.CALENDAR_PROGRESS)
}}
var s=appCtxt.getCalManager();
var j=s&&s.getCalViewController();
var A=j.getApptCache();
A.clearCache()
}
catch(q){
if(!r){
this._updateCacheProgress(ZmOffline.CALENDAR_PROGRESS)
}}
if(r){
r.run(p)
}};
ZmOffline.prototype.calendarDownloadErrorCallback=function(t){};
ZmOffline.prototype.calendarDeleteErrorCallback=function(t){};
ZmOffline.prototype._createApptPrimaryKey=function(e){
return e.id+":"+e.startDate.getTime()
};
ZmOffline.prototype._cleanApptForStorage=function(e){
delete e.list;
delete e._list;
delete e._evt;
delete e._evtMgr
};
ZmOffline.prototype._updateCacheProgress=function(t){
var e=$.inArray(t,ZmOffline.cacheProgress);
if(e!=-1){
ZmOffline.cacheProgress.splice(e,1)
}
if(ZmOffline.cacheProgress.length===0){
ZmOffline._checkCacheDone()
}};
ZmOffline.prototype.scheduleSyncRequest=function(t,e){
if(e==="SyncRequest"){
return
}
var a=Object.keys(t.created||{}
);
a=a.concat(Object.keys(t.modified||{}
));
a=a.concat(Object.keys(t.deleted||{}
));
if(a.length===0){
return
}
if(this._syncRequestActionId){
AjxTimedAction.cancelAction(this._syncRequestActionId)
}
this._syncRequestActionId=AjxTimedAction.scheduleAction(new AjxTimedAction(this,this.sendSyncRequest),ZmOffline.SYNC_REQUEST_DELAY)
};
ZmOffline.prototype.sendSyncRequest=function(t){
ZmOffline.refreshStatusIcon(true);
var e=localStorage.getItem("SyncToken");
if(e){
AjxDebug.println(AjxDebug.OFFLINE,"syncToken :: "+e);
this._sendDeltaSyncRequest(t,e)
}else{
this._sendInitialSyncRequest(t)
}};
ZmOffline.prototype._sendInitialSyncRequest=function(h){
var a=[];
var s=AjxUtil.keys(ZmOffline.folders);
for(var t=0,n=s.length;
t<n;
t++){
var o=ZmOffline.folders[s[t]];
if(o&&o.id!=ZmFolder.ID_OUTBOX){
var r={
l:o.id,_jsns:"urn:zimbraMail"};
if(o.type==="FOLDER"){
var e=AjxDateUtil.roll(new Date(),AjxDateUtil.DAY,-parseInt(o.webOfflineSyncDays));
r.msgCutoff=Math.round(e.getTime()/1000)
}
a.push(r)
}}
if(a.length>0){
var r={
jsonObj:{
BatchRequest:{
_jsns:"urn:zimbra",onerror:"continue",SyncRequest:a}}
,asyncMode:true,callback:this._handleInitialSyncResponse.bind(this,true,h),errorCallback:this._handleInitialSyncError.bind(this)};
appCtxt.getRequestMgr().sendRequest(r)
}};
ZmOffline.prototype._handleInitialSyncResponse=function(l,h,c){
var o=c&&c.getResponse();
var r=o&&o.BatchResponse;
var n=r&&r.SyncResponse;
if(!n){
return
}
var i=[];
var e=[];
var t;
var s;
n.forEach(function(u){
var f=u.folder&&u.folder[0];
if(f){
if(f.m){
var d=f.m[0].ids;
if(d){
var m=f.id.split(":");
var g=(m.length>1)?m[0]+":":"";
d.split(",").forEach(function(w){
var y={
m:{
id:g+w,html:1,needExp:1}
,_jsns:"urn:zimbraMail"};
i.push(y)
}
)
}}else{
if(f.cn){
var p=f.cn[0].ids;
if(p){
e=e.concat(p.split(","))
}}}}
t=u.token;
s=u.more
}
);
var a={
msgs:i,contactIds:e};
if(s==1){
a.callback=this.sendSyncRequest.bind(this,h)
}else{
a.callback=h
}
this._sendGetRequest(a);
if(l){
this._downloadCalendar(null,null,null,null,true,null)
}
this._storeSyncToken(t)
};
ZmOffline.prototype._handleInitialSyncError=function(){
ZmOffline.refreshStatusIcon()
};
ZmOffline.prototype._sendGetRequest=function(a){
var s=a.msgs||[];
var h=a.contactIds||[];
var r=s.length;
var e=h.length;
if(r===0&&e===0){
if(a.callback&&!a.isCallbackExecuted){
a.isCallbackExecuted=true;
a.callback()
}
ZmOffline.refreshStatusIcon()
}else{
var i=this._sendGetRequest.bind(this,a);
var n={
jsonObj:{
BatchRequest:{
_jsns:"urn:zimbra",onerror:"continue"}}
,asyncMode:true,callback:this._handleGetResponse.bind(this,i),errorCallback:this._handleGetError.bind(this,i)};
var t=n.jsonObj.BatchRequest;
var o=s.splice(0,ZmOffline.MAX_REQUEST_IN_BATCH_REQUEST);
if(o.length>0){
t.GetMsgRequest=o
}
if(e>0&&o.length<ZmOffline.MAX_REQUEST_IN_BATCH_REQUEST){
t.GetContactsRequest={
_jsns:"urn:zimbraMail",derefGroupMember:1,cn:{
id:h.join()}};
h.splice(0,e)
}
appCtxt.getRequestMgr().sendRequest(n)
}};
ZmOffline.prototype._sendDeltaSyncRequest=function(a,e){
var t={
jsonObj:{
SyncRequest:{
_jsns:"urn:zimbraMail",token:e,typed:1}}
,asyncMode:true,callback:this._handleDeltaSyncResponse.bind(this,a,e),errorCallback:this._handleDeltaSyncError.bind(this)};
appCtxt.getRequestMgr().sendRequest(t)
};
ZmOffline.prototype._handleDeltaSyncResponse=function(i,a,e){
ZmOffline.refreshStatusIcon();
var t=e&&e.getResponse().SyncResponse;
if(!t||t.token===a){
if(i){
i()
}
return
}
this._storeSyncToken(t.token);
if(t.deleted){
this._handleSyncDeletes(t.deleted)
}
if(t.m||t.cn){
this._handleSyncUpdate(t)
}
if(t.appt){
this._handleUpdateAppts(t.appt)
}
if(t.folder){
this._handleUpdateFolders(t.folder)
}
if(t.folder||t.search){
appCtxt.reloadAppCache()
}
if(i){
i()
}};
ZmOffline.prototype._handleDeltaSyncError=function(e){
ZmOffline.refreshStatusIcon();
if(e&&e.code===ZmCsfeException.MAIL_MUST_RESYNC){
localStorage.removeItem("SyncToken");
this.sendSyncRequest();
return true
}};
ZmOffline.prototype._handleSyncDeletes=function(o){
var i=o[0];
if(!i){
return
}
if(i.m){
var t=i.m[0]&&i.m[0].ids;
if(t){
var a=[].concat(t.split(","))
}}
if(i.cn){
var n=i.cn[0]&&i.cn[0].ids;
if(n){
var e=[].concat(n.split(","))
}}
if(a&&a.length>0){
ZmOfflineDB.deleteItem(a,ZmApp.MAIL)
}
if(e&&e.length>0){
ZmOfflineDB.deleteItem(e,ZmApp.CONTACTS)
}};
ZmOffline.prototype._handleSyncUpdate=function(t){
var s=t.m;
var n=t.cn;
var o=[];
var i=[];
if(s){
var a=Object.keys(ZmOffline.folders);
var e=[];
s.forEach(function(h){
if(h.l&&a.indexOf(h.l)!==-1){
var r={
m:{
id:h.id,html:1,needExp:1}
,_jsns:"urn:zimbraMail"};
o.push(r)
}else{
e.push(h.id)
}}
);
if(e.length>0){
ZmOfflineDB.deleteItem(e,ZmApp.MAIL)
}}
if(n){
n.forEach(function(r){
i.push(r.id)
}
)
}
ZmOffline.refreshStatusIcon(true);
this._sendGetRequest({
msgs:o,contactIds:i}
)
};
ZmOffline.prototype._handleUpdateFolders=function(t){
var e=[];
t.forEach(function(s){
var o=s.id;
var r={
l:o,_jsns:"urn:zimbraMail"};
if(s.view==="message"){
var n=ZmOffline.folders.hasOwnProperty(o);
if(n&&s.webOfflineSyncDays==0){
var h=function(l){
ZmOfflineDB.deleteItem(l,ZmApp.MAIL)
};
ZmOfflineDB.doIndexSearch([o.toString()],ZmApp.MAIL,null,h,null,"folder",true);
delete ZmOffline.folders[o]
}else{
if((n&&s.webOfflineSyncDays!=ZmOffline.folders[o].webOfflineSyncDays)||(!n&&s.webOfflineSyncDays!=0)){
var i=AjxDateUtil.roll(new Date(),AjxDateUtil.DAY,-parseInt(s.webOfflineSyncDays));
r.msgCutoff=Math.round(i.getTime()/1000);
e.push(r);
ZmOffline.folders[o]=s
}}}else{
if(s.view==="contact"){
e.push(r);
ZmOffline.folders[o]=s
}}}
);
if(e.length>0){
var a={
jsonObj:{
BatchRequest:{
_jsns:"urn:zimbra",onerror:"continue",SyncRequest:e}}
,asyncMode:true,callback:this._handleInitialSyncResponse.bind(this,false,false)};
ZmOffline.refreshStatusIcon(true);
appCtxt.getRequestMgr().sendRequest(a)
}};
ZmOffline.prototype._storeSyncToken=function(e){
AjxDebug.println(AjxDebug.OFFLINE,"New syncToken :: "+e);
localStorage.setItem("SyncToken",e)
};
ZmOffline.prototype._handleGetResponse=function(h,c){
var e=c&&c.getResponse();
var o=e&&e.BatchResponse;
if(!o){
return
}
var a=o.GetMsgResponse;
if(a){
var n=[];
for(var t=0;
t<a.length;
t++){
n.push(a[t].m[0])
}
var l=this._handleSetItemCallback.bind(this,n,ZmApp.MAIL,h);
ZmOfflineDB.setItem(n,ZmApp.MAIL,l)
}
var s=o.GetContactsResponse;
if(s){
var r=[];
for(var t=0;
t<s.length;
t++){
r=r.concat(s[t].cn)
}
var l=this._handleSetItemCallback.bind(this,r,ZmApp.CONTACTS,h);
ZmOfflineDB.setItem(r,ZmApp.CONTACTS,l)
}};
ZmOffline.prototype._handleSetItemCallback=function(t,e,a){
if(a){
a()
}
if(e===ZmApp.MAIL){
this._fetchMsgAttachments(t)
}};
ZmOffline.prototype._handleGetError=function(a,t,e){
localStorage.removeItem("SyncToken")
};
ZmOffline.prototype._handleUpdateAppts=function(u,a){
if(!u){
u=[]
}
var w=null;
var f={};
var k=new Date();
var p=k.getTime();
var e=new Date(p);
k.setHours(0,0,0,0);
var n=k.getTime()-(AjxDateUtil.MSEC_PER_DAY*ZmOffline.CALENDAR_LOOK_BEHIND_DAYS);
e.setHours(23,59,59,999);
var r=e.getTime()+(AjxDateUtil.MSEC_PER_DAY*ZmOffline.CALENDAR_READ_AHEAD_DAYS);
var d=r;
var g=localStorage.getItem("calendarSyncTime");
if(g){
d=parseInt(g)+(AjxDateUtil.MSEC_PER_DAY*ZmOffline.CALENDAR_READ_AHEAD_DAYS)
}
localStorage.setItem("calendarSyncTime",e.getTime());
var t=[];
var y={};
var l;
for(var m=0,o=u.length;
m<o;
m++){
w=u[m];
l=w.id.toString();
y[l]=true;
t.push('item:"'+l+'"')
}
var h=(r>d)?this._downloadCalendar.bind(this,d,r,null,null,true):null;
if(t.length>0){
this._downloadByApptId(y,t,n,r,h)
}else{
if(h){
h.run()
}}
var c=[0,n];
var s=this._expiredErrorCallback.bind(this);
var v=this._offlineUpdateAppts.bind(this,null);
ZmOfflineDB.doIndexSearch(c,ZmApp.CALENDAR,null,v,s,"endDate")
};
ZmOffline.prototype._offlineUpdateAppts=function(e,o){
var a;
if(o){
for(var t=0;
t<o.length;
t++){
a=o[t].appt;
ZmOfflineDB.deleteItem(this._createApptPrimaryKey(a),ZmApp.CALENDAR,this.calendarDeleteErrorCallback.bind(this))
}}
if(e){
ZmOfflineDB.setItem(e,ZmApp.CALENDAR,null,this.calendarDownloadErrorCallback.bind(this))
}};
ZmOffline.prototype._expiredErrorCallback=function(t){};
ZmOffline.prototype._loadMessages=function(e,h){
if(!e||e.length===0){
return
}
var o=AjxSoapDoc.create("BatchRequest","urn:zimbra");
o.setMethodAttribute("onerror","continue");
for(var a=0,n=e.length;
a<n;
a++){
var t=o.set("GetMsgRequest",null,null,"urn:zimbraMail");
var s=o.set("m",null,t);
s.setAttribute("id",e[a]);
s.setAttribute("read",0);
s.setAttribute("html",1);
s.setAttribute("needExp",1)
}
var r=this._handleGetResponse.bind(this,h);
appCtxt.getRequestMgr().sendRequest({
soapDoc:o,asyncMode:true,callback:r}
)
};
ZmOffline.prototype._replayOfflineRequest=function(){
var e=this._sendOfflineRequest.bind(this);
ZmOfflineDB.getItemInRequestQueue(false,e)
};
ZmOffline.prototype._sendOfflineRequest=function(e,i){
if(!e||e.length===0){
return
}
if(i){
var a=[];
var o=[];
var s={
jsonObj:{
BatchRequest:{
_jsns:"urn:zimbra",onerror:"continue"}}
,asyncMode:true};
s.errorCallback=s.callback=this._handleResponseSendOfflineRequest.bind(this,a,o);
var t=s.jsonObj.BatchRequest;
e.forEach(function(h){
var r=h.methodName;
if(r==="BatchRequest"){
$.extend(true,t,h[r])
}else{
if(!t[r]){
t[r]=[]
}
t[r].push(h[r])
}
a.push(h.id);
o.push(h.oid)
}
);
appCtxt.getRequestMgr().sendRequest(s)
}else{
var n=[];
e.forEach(function(u){
var c=u.methodName;
if(c==="SendMsgRequest"||c==="SaveDraftRequest"){
var m=u[c].m;
var l=m&&m.attach;
if(l){
for(var d in l){
var h=l[d];
if(h&&h.isOfflineUploaded){
n.push(h)
}}}
var r=m&&m.f;
if(r&&r.indexOf(ZmItem.FLAG_OFFLINE_CREATED)!==-1){
m.f=r.replace(ZmItem.FLAG_OFFLINE_CREATED,"");
if(!m.f){
delete m.f
}
delete m.id;
delete m.did
}}}
);
this._uploadOfflineAttachments(n,e)
}};
ZmOffline.prototype._handleResponseSendOfflineRequest=function(e,t){
if(e.length>0){
var a=ZmOffline.updateFolderCountCallback.bind(window,ZmFolder.ID_OUTBOX,0);
ZmOfflineDB.deleteItem(e,ZmApp.MAIL,a)
}
if(t.length>0){
ZmOfflineDB.deleteItemInRequestQueue(t)
}};
ZmOffline.prototype._getFolder=function(e){
for(var t=0,a=ZmOffline.folders.length;
t<a;
t++){
if(ZmOffline.folders[t].id==e){
return ZmOffline.folders[t].name
}}
if(ZmOffline.calendars[e]){
return ZmOffline.calendars[e]
}else{
return null
}};
ZmOffline.prototype.deleteItem=function(s,a,n){
if(!s||s.length===0){
return
}
var e=n+a;
for(var t=0,o=s.length;
t<o;
t++){
ZmOfflineDB.deleteItem(s[t],e)
}};
ZmOffline.deleteOfflineData=function(){
ZmOfflineDB.deleteDB();
localStorage.clear()
};
ZmOffline.generateMsgResponse=function(u){
var o=[],s,e,c,d,r,a;
u=[].concat(u);
for(r=0,a=u.length;
r<a;
r++){
s=u[r];
if(s){
e=s[s.methodName]&&s[s.methodName]["m"];
if(e){
c={
id:e.id,f:e.f||"",mid:e.mid,cid:e.cid,idnt:e.idnt,e:e.e,l:"",fr:"",su:e.su._content,mp:[],d:e.d};
if(s.methodName==="SendMsgRequest"){
c.f=c.f.replace(ZmItem.FLAG_ISSENT,"").concat(ZmItem.FLAG_ISSENT)
}else{
if(s.methodName==="SaveDraftRequest"){
c.f=c.f.replace(ZmItem.FLAG_ISDRAFT,"").concat(ZmItem.FLAG_ISDRAFT)
}}
if(e.attach){
c.f=c.f.replace(ZmItem.FLAG_ATTACH,"").concat(ZmItem.FLAG_ATTACH)
}
if(s.methodName==="SendMsgRequest"){
c.l=ZmFolder.ID_OUTBOX.toString()
}else{
if(s.methodName==="SaveDraftRequest"){
c.l=ZmFolder.ID_DRAFTS.toString()
}}
d=e.mp[0];
if(d){
var l=e.attach;
if(l&&l.aid){
c.mp.push({
ct:ZmMimeTable.MULTI_MIXED,part:ZmMimeTable.TEXT,mp:[]}
);
if(d.ct===ZmMimeTable.TEXT_PLAIN){
c.mp[0].mp.push({
body:true,part:"1",ct:ZmMimeTable.TEXT_PLAIN,content:d.content._content}
);
c.fr=c.mp[0].mp[0].content
}else{
if(d.ct===ZmMimeTable.MULTI_ALT){
c.mp[0].mp.push({
ct:ZmMimeTable.MULTI_ALT,part:"1",mp:[{
ct:ZmMimeTable.TEXT_PLAIN,part:"1.1",content:(d.mp[0].content)?d.mp[0].content._content:""}
,{
ct:ZmMimeTable.TEXT_HTML,part:"1.2",body:true,content:(d.mp[1].content)?d.mp[1].content._content:""}
]}
);
c.fr=c.mp[0].mp[0].mp[0].content
}}
var t=l.aid.split(",");
for(var n=0;
n<t.length;
n++){
var h=l[t[n]];
if(h){
c.mp[0].mp.push({
cd:"attachment",ct:h.ct,filename:h.filename,aid:h.aid,s:h.s,data:h.data,isOfflineUploaded:h.isOfflineUploaded,part:(n+2).toString()}
)
}}}else{
if(d.ct===ZmMimeTable.TEXT_PLAIN){
c.mp.push({
ct:ZmMimeTable.TEXT_PLAIN,body:true,part:"1",content:d.content._content}
);
c.fr=c.mp[0].content
}else{
if(d.ct===ZmMimeTable.MULTI_ALT){
c.mp.push({
ct:ZmMimeTable.MULTI_ALT,part:ZmMimeTable.TEXT,mp:[{
ct:ZmMimeTable.TEXT_PLAIN,part:"1",content:(d.mp[0].content)?d.mp[0].content._content:""}
,{
ct:ZmMimeTable.TEXT_HTML,part:"2",body:true,content:(d.mp[1].content)?d.mp[1].content._content:""}
]}
);
c.fr=c.mp[0].mp[0].content
}}}}}
o.push(c)
}}
return o
};
ZmOffline.addOutboxFolder=function(){
if(!appCtxt.isWebClientOfflineSupported){
return
}
var i=appCtxt.getFolderTree(),t=i.root,e={
id:ZmFolder.ID_OUTBOX,absFolderPath:"/Outbox",activesyncdisabled:false,name:"Outbox"};
var a=ZmFolderTree.createFolder(ZmOrganizer.FOLDER,t,e,i,null,"folder");
t.children.add(a)
};
ZmOffline.updateFolderCount=function(){
var t=[ZmFolder.ID_DRAFTS,ZmFolder.ID_OUTBOX];
for(var e=0,a=t.length;
e<a;
e++){
var o=ZmOffline.updateFolderCountCallback.bind(window,t[e]);
ZmOfflineDB.doIndexSearch([t[e].toString()],ZmApp.MAIL,null,o,null,"folder",true)
}};
ZmOffline.updateFolderCountCallback=function(e,a){
if(AjxUtil.isArray(a)){
a=a.length
}
var t=appCtxt.getById(e);
if(t){
t.notifyModify({
n:a}
)
}};
ZmOffline.prototype._uploadOfflineAttachments=function(t,e){
var o=t.shift();
if(o){
var i=AjxUtil.dataURItoBlob(o.data);
if(i){
i.name=o.filename;
var n=this._uploadOfflineAttachmentsCallback.bind(this,t,e,o.aid);
var a=this._uploadOfflineAttachmentsErrorCallback.bind(this,t,e,o.aid);
ZmComposeController.prototype._uploadImage(i,n,a)
}}else{
this._sendOfflineRequest(e,true)
}};
ZmOffline.prototype._uploadOfflineAttachmentsCallback=function(a,c,l,r){
for(var n=0;
n<c.length;
n++){
var o=c[n];
if(!o){
continue
}
var h=o.methodName;
if(h==="SendMsgRequest"||h==="SaveDraftRequest"){
var t=o[h].m;
var s=t&&t.attach;
var e=s&&s.aid;
if(e&&e.indexOf(l)!==-1){
s.aid=e.replace(l,r[0].aid);
delete s[l];
break
}}}
this._uploadOfflineAttachments(a,c)
};
ZmOffline.prototype._uploadOfflineAttachmentsErrorCallback=function(a,c,l){
for(var n=0;
n<c.length;
n++){
var o=c[n];
if(!o){
continue
}
var h=o.methodName;
if(h==="SendMsgRequest"||h==="SaveDraftRequest"){
var t=o[h].m;
var s=t&&t.attach;
var e=s&&s.aid;
if(e&&e.indexOf(l)!==-1){
var r=e.split(",");
AjxUtil.arrayRemove(r,l);
if(r.length>0){
delete s.aid
}else{
s.aid=r.join()
}
delete s[l];
break
}}}
this._uploadOfflineAttachments(a,c)
};
ZmOffline.prototype._uploadOfflineInlineAttachments=function(n,s){
var o=document.createElement("template");
o.innerHTML=s.mp[0].mp[1].content._content;
var t=o.content.querySelectorAll("img[src^='data:']");
for(var a=0;
a<t.length;
a++){
var e=AjxUtil.dataURItoBlob(t[a].src);
if(e){
var r=this._uploadOfflineInlineAttachmentsCallback.bind(this,t[a],n,s,o);
ZmComposeController.prototype._uploadImage(e,r)
}}};
ZmOffline.prototype._uploadOfflineInlineAttachmentsCallback=function(t,i,n,a,o){
var e=a.content.querySelectorAll("img[src^='data:']");
if(e.length===0){
delete n.isInlineAttachment;
this._sendOfflineRequest([].concat(i))
}};
ZmOffline.checkServerStatus=function(e,a,t){
$.ajax({
type:"HEAD",url:"/public/blank.html",cache:false,statusCode:{
0:function(){
if(ZmOffline.isServerReachable===true){
if(e){
ZmOffline.isServerReachable=false;
if(!a){
$.event.trigger({
type:"ZWCOffline"}
)
}}else{
return ZmOffline.checkServerStatus(true)
}}
ZmOffline.isServerReachable=false
}
,200:function(){
if(ZmOffline.isServerReachable===false){
if(e){
ZmOffline.isServerReachable=true;
if(!a){
$.event.trigger({
type:"ZWCOnline"}
)
}}else{
return ZmOffline.checkServerStatus(true)
}}
ZmOffline.isServerReachable=true
}}
,complete:t}
)
};
ZmOffline.checkServerStatus(true,true);
ZmOffline.isOnlineMode=function(){
return appCtxt.isWebClientOfflineSupported&&!appCtxt.isWebClientOffline()
};
ZmOffline.prototype._fetchMsgAttachments=function(t){
var e=[];
t=ZmOffline.recreateMsg(t);
t.forEach(function(o){
var i=ZmMailMsg.createFromDom(o,{}
,true);
var a=i.getAttachmentInfo();
a.forEach(function(n){
e.push(n)
}
)
}
);
this._saveAttachments(e)
};
ZmOffline.prototype._saveAttachments=function(e){
if(!e||e.length===0){
ZmOffline.refreshStatusIcon();
return
}
ZmOffline.refreshStatusIcon(true);
var t=e.shift();
var a=this._isAttachmentSavedinIndexedDBCallback.bind(this,t,e);
ZmOffline.isAttachmentSavedinIndexedDB(t,a)
};
ZmOffline.isAttachmentSavedinIndexedDB=function(a,i,e){
var t=ZmOffline.createAttachmentKey(a);
ZmOfflineDB.getItemCount(t,ZmOffline.ATTACHMENT,i,e)
};
ZmOffline.createAttachmentKey=function(e){
return"id="+e.mid+"&part="+e.part
};
ZmOffline.prototype._isAttachmentSavedinIndexedDBCallback=function(i,e,a){
var o=this._saveAttachments.bind(this,e);
if(a===0){
var t=$.ajax({
url:i.url,dataType:"text",headers:{
"X-Zimbra-Encoding":"x-base64"}}
);
t.done(function(n){
var s=ZmOffline.createAttachmentKey(i);
var r={
id:s,mid:i.mid,url:i.url,type:i.ct,name:i.label,size:i.sizeInBytes,part:i.part,content:n};
ZmOfflineDB.setItem(r,ZmOffline.ATTACHMENT,o,o)
}
.bind(this));
t.fail(o)
}else{
o()
}};
ZmOffline.prototype._handleAttachmentsForOfflineMode=function(t,a,i){
if(appCtxt.isWebClientOffline()){
var e=[];
if(t){
t.forEach(function(s){
var n=ZmOffline.createAttachmentKey(s);
e.push(n)
}
);
if(e.length>0){
var o=this._handleAttachmentsForOfflineModeCallback.bind(this,t,a,i);
ZmOfflineDB.getItem(e,ZmOffline.ATTACHMENT,o)
}}}};
ZmOffline.prototype._handleAttachmentsForOfflineModeCallback=function(e,t,i,o){
if(!o||!i){
return
}
var a=this;
o.forEach(function(n){
if(n.type&&n.content){
var s="data:"+n.type+";base64,"+n.content;
for(var r=0;
r<i.length;
r++){
var l=t(n.part,i[r]);
var h=document.getElementById(l);
if(h){
h.href=s;
h.onclick=null;
h.download=n.name
}}}}
)
};
ZmOffline.modifyMsg=function(t){
var e=[].concat(t).map(function(a){
if(a.f){
a.f=a.f.split("")
}
if(a.su){
a.su=a.su.split(" ")
}
if(a.fr){
a.fr=a.fr.split(" ")
}
if(a.tn){
a.tn=a.tn.split(",")
}
if(a.l){
a.l=a.l.toString()
}
if(a.e){
var n=[];
var o=[];
var i=[];
a.e.forEach(function(s){
if(s.t==="f"){
if(s.a){
n.push(s.a.toLowerCase())
}
if(s.p){
n=n.concat(s.p.toLowerCase().split(" "))
}}else{
if(s.t==="t"){
if(s.a){
o.push(s.a.toLowerCase())
}
if(s.p){
o=o.concat(s.p.toLowerCase().split(" "))
}}else{
if(s.t==="c"){
if(s.a){
i.push(s.a.toLowerCase())
}
if(s.p){
i=i.concat(s.p.toLowerCase().split(" "))
}}}}}
);
if(n.length){
a.e.from=n
}
if(o.length){
a.e.to=o
}
if(i.length){
a.e.cc=i
}}
return a
}
);
return e
};
ZmOffline.recreateMsg=function(t){
var e=[].concat(t).map(function(a){
if(Array.isArray(a.f)){
a.f=a.f.join()
}
if(Array.isArray(a.su)){
a.su=a.su.join(" ")
}
if(Array.isArray(a.fr)){
a.fr=a.fr.join(" ")
}
if(Array.isArray(a.tn)){
a.tn=a.tn.join()
}
if(a.e){
delete a.e.from;
delete a.e.to;
delete a.e.cc
}
return a
}
);
return e
};
ZmOffline.modifyContact=function(t){
var e=[].concat(t).map(function(a){
if(a.tn){
a.tn=a.tn.split(",")
}
if(a._attrs){
if(a._attrs.jobTitle){
a._attrs.jobTitle=a._attrs.jobTitle.split(" ")
}}
return a
}
);
return e
};
ZmOffline.recreateContact=function(t){
var e=[].concat(t).map(function(a){
if(Array.isArray(a.tn)){
a.tn=a.tn.join()
}
if(a._attrs){
if(Array.isArray(a._attrs.jobTitle)){
a._attrs.jobTitle=a._attrs.jobTitle.join(" ")
}}
ZmOffline._cacheContactMember(a);
return a
}
);
return e
};
ZmOffline._cacheContactMember=function(t){
var a=t.m;
if(!a||!Array.isArray(a)||appCtxt.cacheGet(t.id)){
return
}
var i=ZmContact.createFromDom(t,{}
);
var e=new ZmCsfeResult({
GetContactsResponse:{
cn:[t]}}
);
ZmContact.prototype._handleLoadResponse.call(i,null,e)
};
ZmOffline.refreshStatusIcon=function(e){
if(appCtxt.isWebClientOffline()){
$("#"+ZmId.SKIN_OFFLINE_STATUS).addClass("ImgDisconnect").removeClass("ImgOfflineSync").attr("title",ZmMsg.OfflineServerNotReachable)
}else{
if(e){
$("#"+ZmId.SKIN_OFFLINE_STATUS).addClass("ImgOfflineSync").removeClass("ImgDisconnect").attr("title",ZmMsg.offlineCachingSync)
}else{
$("#"+ZmId.SKIN_OFFLINE_STATUS).removeClass("ImgOfflineSync ImgDisconnect").attr("title",ZmMsg.offlineCachingDone)
}}};
ZmOffline.handleLogOff=function(t,e){
if(t){
ZmOfflineSettingsDialog.showConfirmSignOutDialog()
}else{
if(e){
appCtxt.reloadAppCache();
setTimeout(ZmZimbraMail.logOff,1000)
}}}
}
if(AjxPackage.define("zimbraMail.offline.model.ZmOfflineDB")){
function ZmOfflineDB(){}
ZmOfflineDB.init=function(e){
ZmOfflineDB.OBJECTSTORE_NAMES=[ZmApp.MAIL,ZmApp.CONTACTS,ZmApp.CALENDAR,ZmOffline.ATTACHMENT,ZmOffline.REQUESTQUEUE,ZmOffline.META_DATA];
ZmOfflineDB.open(e)
};
ZmOfflineDB.open=function(s,a,t){
try{
AjxDebug.println(AjxDebug.OFFLINE,"ZmOfflineDB.open");
var i=appCtxt.getLoggedInUsername();
var o=(t)?indexedDB.open(i,t):indexedDB.open(i);
o.onsuccess=function(){
AjxDebug.println(AjxDebug.OFFLINE,"ZmOfflineDB.open success");
var e=o.result;
var r=ZmOfflineDB.OBJECTSTORE_NAMES.filter(function(h){
return e.objectStoreNames.contains(h)
}
);
if(r.length>0){
ZmOfflineDB.db=e;
s&&s()
}else{
e.close();
ZmOfflineDB.open(s,a,e.version+1)
}};
o.onupgradeneeded=function(){
AjxDebug.println(AjxDebug.OFFLINE,"ZmOfflineDB.open onupgradeneeded");
var e=o.result;
ZmOfflineDB.OBJECTSTORE_NAMES.forEach(function(r){
if(!e.objectStoreNames.contains(r)){
if(r===ZmApp.MAIL){
var h=e.createObjectStore(r,{
keyPath:"id"}
);
h.createIndex("size","s");
h.createIndex("folder","l");
h.createIndex("receiveddate","d");
h.createIndex("flags","f",{
multiEntry:true}
);
h.createIndex("tag","tn",{
multiEntry:true}
);
h.createIndex("subject","su",{
multiEntry:true}
);
h.createIndex("fragment","fr",{
multiEntry:true}
);
h.createIndex("from","e.from",{
multiEntry:true}
);
h.createIndex("to","e.to",{
multiEntry:true}
);
h.createIndex("cc","e.cc",{
multiEntry:true}
)
}else{
if(r===ZmApp.CONTACTS){
var h=e.createObjectStore(r,{
keyPath:"id"}
);
h.createIndex("folder","l");
h.createIndex("tag","tn",{
multiEntry:true}
);
h.createIndex("fileasstr","fileAsStr");
h.createIndex("firstname","_attrs.firstName");
h.createIndex("lastname","_attrs.lastName");
h.createIndex("middlename","_attrs.middleName");
h.createIndex("email","_attrs.email");
h.createIndex("company","_attrs.company");
h.createIndex("jobtitle","_attrs.jobTitle",{
multiEntry:true}
)
}else{
if(r===ZmOffline.ATTACHMENT){
var h=e.createObjectStore(r,{
keyPath:"id"}
);
h.createIndex("type","type");
h.createIndex("name","name");
h.createIndex("size","size");
h.createIndex("mid","mid")
}else{
if(r===ZmOffline.REQUESTQUEUE){
var h=e.createObjectStore(r,{
keyPath:"oid",autoIncrement:true}
);
h.createIndex("methodName","methodName");
h.createIndex("id","id");
h.createIndex("methodName, id",["methodName","id"])
}else{
if(r===ZmApp.CALENDAR){
var h=e.createObjectStore(r,{
keyPath:"instanceId"}
);
h.createIndex("id","id");
h.createIndex("invId","invId");
h.createIndex("startDate","startDate");
h.createIndex("endDate","endDate")
}else{
if(r===ZmOffline.META_DATA){
var h=e.createObjectStore(r,{
keyPath:"methodname"}
)
}else{
var h=e.createObjectStore(r,{
keyPath:"key"}
)
}}}}}}}}
)
};
o.onabort=o.onblocked=o.onerror=a
}
catch(n){
a&&a();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.open :: "+n)
}};
ZmOfflineDB.close=function(){
var e=ZmOfflineDB.db;
if(e){
e.close()
}};
ZmOfflineDB.deleteDB=function(o,t){
try{
var a=indexedDB.deleteDatabase(appCtxt.getLoggedInUsername());
a.onsuccess=o;
a.onerror=t
}
catch(i){
t&&t();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.deleteDB :: "+i)
}};
ZmOfflineDB.setItemInRequestQueue=function(r,l,i){
try{
var c=ZmOfflineDB.db,t=c.transaction("RequestQueue","readwrite"),h=t.objectStore("RequestQueue");
if(AjxUtil.isObject(r)&&r.update){
var s=ZmOfflineDB._createIndexAndKeyRange(r,h),o=s.index,a=s.keyRangeArray;
if(o&&a){
a.forEach(function(e){
o.openCursor(e).onsuccess=function(u){
var d=u.target.result;
if(d){
if(r.value){
r.value.oid=d.primaryKey;
d.update(r.value)
}}else{
h.add(r.value)
}}
}
)
}}else{
if(r){
[].concat(r).forEach(function(e){
h.add(e)
}
)
}}
t.oncomplete=l;
t.onerror=i
}
catch(n){
i&&i();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.setItemInRequestQueue :: "+n)
}};
ZmOfflineDB.getItemInRequestQueue=function(h,c,i){
try{
var d=ZmOfflineDB.db,t=d.transaction("RequestQueue"),r=t.objectStore("RequestQueue"),s=ZmOfflineDB._createIndexAndKeyRange(h,r),o=s.index,a=s.keyRangeArray,l=[];
if(o&&a){
a.forEach(function(e){
o.openCursor(e).onsuccess=function(m){
var u=m.target.result;
if(u){
l.push(u.value);
u["continue"]()
}}
}
)
}else{
if(h){
[].concat(h).forEach(function(e){
r.get(e).onsuccess=function(m){
var u=m.target.result;
if(u){
l.push(u)
}}
}
)
}else{
r.openCursor().onsuccess=function(u){
var e=u.target.result;
if(e){
l.push(e.value);
e["continue"]()
}}
}}
if(c){
t.oncomplete=function(){
c(l)
}
}
t.onerror=i
}
catch(n){
i&&i();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.getItemInRequestQueue :: "+n)
}};
ZmOfflineDB.getItemCountInRequestQueue=function(l,c,i){
try{
var d=ZmOfflineDB.db,t=d.transaction("RequestQueue"),h=t.objectStore("RequestQueue"),r=ZmOfflineDB._createIndexAndKeyRange(l,h),n=r.index,a=r.keyRangeArray,o=0;
if(n&&a){
a.forEach(function(e){
n.count(e).onsuccess=function(u){
o+=u.target.result||0
}
}
)
}else{
h.count().onsuccess=function(e){
o=e.target.result||0
}
}
if(c){
t.oncomplete=function(){
c(o)
}
}
t.onerror=i
}
catch(s){
i&&i();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.getItemCountInRequestQueue :: "+s)
}};
ZmOfflineDB.deleteItemInRequestQueue=function(h,l,i){
try{
var c=ZmOfflineDB.db,t=c.transaction("RequestQueue","readwrite"),r=t.objectStore("RequestQueue"),s=ZmOfflineDB._createIndexAndKeyRange(h,r),o=s.index,a=s.keyRangeArray;
if(o&&a){
a.forEach(function(e){
o.openCursor(e).onsuccess=function(u){
var d=u.target.result;
if(d){
d["delete"]();
d["continue"]()
}}
}
)
}else{
if(h){
[].concat(h).forEach(function(e){
r["delete"](e)
}
)
}}
t.oncomplete=l;
t.onerror=i
}
catch(n){
i&&i();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.deleteItemInRequestQueue :: "+n)
}};
ZmOfflineDB._createIndexAndKeyRange=function(i,o){
var a,t=[];
try{
if(i.id&&i.methodName){
a=o.index("methodName, id");
[].concat(i.methodName).forEach(function(e){
[].concat(i.id).forEach(function(s){
t.push(IDBKeyRange.only([e,s]))
}
)
}
)
}else{
if(i.id){
a=o.index("id");
[].concat(i.id).forEach(function(e){
t.push(IDBKeyRange.only(e))
}
)
}else{
if(i.methodName){
a=o.index("methodName");
[].concat(i.methodName).forEach(function(e){
t.push(IDBKeyRange.only(e))
}
)
}}}}
catch(n){
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB._createIndexAndKeyRange :: "+n)
}
finally{
return{
index:a,keyRangeArray:t}
}};
ZmOfflineDB.setItem=function(n,t,h,i){
try{
AjxDebug.println(AjxDebug.OFFLINE,"ZmOfflineDB.setItem :: "+t);
var a=ZmOfflineDB.db;
var r=a.transaction(t,"readwrite");
var o=r.objectStore(t);
if(t===ZmApp.MAIL){
n=ZmOffline.modifyMsg(n)
}else{
if(t===ZmApp.CONTACTS){
n=ZmOffline.modifyContact(n)
}}
[].concat(n).forEach(function(e){
o.put(e)
}
);
r.oncomplete=h;
r.onerror=i
}
catch(s){
i&&i();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.setItem :: "+s+" :: "+JSON.stringify(n))
}};
ZmOfflineDB.getItem=function(s,a,r,i){
try{
var l=ZmOfflineDB.db;
var t=l.transaction(a);
var n=t.objectStore(a);
var h=[];
if(s){
[].concat(s).forEach(function(e){
n.get(e).onsuccess=function(d){
var c=d.target.result;
if(c){
h.push(c)
}}
}
)
}else{
n.openCursor().onsuccess=function(c){
var e=c.target.result;
if(e){
h.push(e.value);
e["continue"]()
}}
}
if(r){
t.oncomplete=function(){
if(a===ZmApp.MAIL){
h=ZmOffline.recreateMsg(h)
}else{
if(a===ZmApp.CONTACTS){
h=ZmOffline.recreateContact(h)
}}
r(h)
}
}
t.onerror=i
}
catch(o){
i&&i();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.getItem :: "+o)
}};
ZmOfflineDB.getItemCount=function(r,a,h,i){
try{
var l=ZmOfflineDB.db;
var t=l.transaction(a);
var s=t.objectStore(a);
var o=0;
if(r){
s.count(r).onsuccess=function(e){
o=e.target.result||0
}
}else{
s.count().onsuccess=function(e){
o=e.target.result||0
}
}
if(h){
t.oncomplete=function(){
h(o)
}
}
t.onerror=i
}
catch(n){
i&&i();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.getItemCount :: "+n)
}};
ZmOfflineDB.deleteItem=function(o,t,h,i){
try{
var a=ZmOfflineDB.db;
var r=a.transaction(t,"readwrite");
var n=r.objectStore(t);
if(o){
[].concat(o).forEach(function(e){
n["delete"](e)
}
)
}
r.oncomplete=h;
r.onerror=i
}
catch(s){
i&&i();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.deleteItem :: "+s)
}};
ZmOfflineDB.search=function(t,a,e){
if(!t){
return
}
t=ZmOfflineDB._parseSearchObj(t);
if(t.searchFor===ZmId.SEARCH_MAIL||t.parsedSearchFor===ZmId.SEARCH_MAIL||(t.types&&t.types.contains(ZmItem.MSG))){
t.searchFor=ZmId.SEARCH_MAIL;
ZmOfflineDB.searchMail(t,a,e)
}else{
if(t.searchFor===ZmItem.CONTACT||t.contactSource===ZmItem.CONTACT){
ZmOfflineDB.searchContacts(t,a,e)
}}};
ZmOfflineDB.searchMail=function(l,r,i){
try{
var h=ZmOfflineDB.db;
var t=h.transaction(ZmApp.MAIL);
var s=t.objectStore(ZmApp.MAIL);
var n=l.parsedQuery.getTokens();
var a=false;
n.forEach(function(c){
var y=c.indexName;
var e=c.indexValue;
if(y&&e){
c.result=[];
var g=[];
var d=[];
if(y==="content"||y==="tag"){
if(y==="content"){
g.push(s.index("subject"),s.index("fragment"));
a=true
}else{
g.push(s.index(y))
}
var m=e.charAt(0).toUpperCase()+e.substr(1).toLowerCase();
var u=IDBKeyRange.bound(e.toUpperCase(),m+"\uffff");
var f=e.charAt(0).toLowerCase()+e.substr(1).toUpperCase();
var w=IDBKeyRange.bound(f,e.toLowerCase()+"\uffff");
d.push(u,w)
}else{
if(y==="size"){
g.push(s.index(y));
if(c.op==="smaller"){
d.push(IDBKeyRange.upperBound(e,true))
}else{
if(c.op==="larger"){
d.push(IDBKeyRange.lowerBound(e,true))
}}}else{
if(y==="type"){
a=true
}else{
if(y==="from"||y==="to"||y==="cc"||y==="tocc"){
if(y==="tocc"){
g.push(s.index("to"),s.index("cc"))
}else{
g.push(s.index(y))
}
d.push(IDBKeyRange.bound(e.toLowerCase(),e.toLowerCase()+"\uffff"))
}else{
if(y==="receiveddate"){
g.push(s.index("receiveddate"));
if(c.op==="after"){
d.push(IDBKeyRange.lowerBound(e))
}else{
if(c.op==="before"){
d.push(IDBKeyRange.upperBound(e,true))
}else{
if(c.op==="date"){
var p=new Date(e);
AjxDateUtil.rollToNextDay(p);
if(c.arg.indexOf("<=")!==-1){
d.push(IDBKeyRange.upperBound(p.getTime()))
}else{
if(c.arg.indexOf(">=")!==-1){
d.push(IDBKeyRange.lowerBound(e))
}else{
if(c.arg.indexOf("<")!==-1){
d.push(IDBKeyRange.upperBound(e,true))
}else{
if(c.arg.indexOf(">")!==-1){
d.push(IDBKeyRange.lowerBound(p.getTime()))
}else{
d.push(IDBKeyRange.bound(e,p.getTime(),false,true))
}}}}}}}}else{
g.push(s.index(y));
d.push(IDBKeyRange.only(e))
}}}}}
g.forEach(function(v){
d.forEach(function(k){
v.openKeyCursor(k).onsuccess=function(q,j){
var x=j.target.result;
if(x){
AjxDebug.println(AjxDebug.OFFLINE,x.key+" : "+x.primaryKey);
if(q.indexName==="content"){
if(x.key.toLowerCase().indexOf(q.indexValue.toLowerCase())!==-1){
q.result.push(x.primaryKey)
}}else{
q.result.push(x.primaryKey)
}
x["continue"]()
}else{
q.result=AjxUtil.uniq(q.result)
}}
.bind(null,c)
}
)
}
)
}}
);
t.oncomplete=function(){
var e=ZmOfflineDB._searchCallback.bind(null,l,r,i);
if(a){
ZmOfflineDB.searchAttachment(l,e,i)
}else{
e()
}};
t.onerror=i
}
catch(o){
if(i){
i()
}else{
if(r){
r([])
}}
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.searchMail :: "+o)
}};
ZmOfflineDB._parseSearchObj=function(e){
var t=e.parsedQuery.getTokens();
t.forEach(function(o){
if(o.op==="content"||o.op==="tag"){
o.indexName=o.op;
o.indexValue=o.arg
}else{
if(o.op==="from"||o.op==="to"||o.op==="cc"||o.op==="tocc"){
o.indexName=o.op;
o.indexValue=o.arg.toLowerCase();
e.parsedSearchFor=ZmId.SEARCH_MAIL
}else{
if(o.op==="has"){
if(o.arg==="attachment"){
o.indexName="flags";
o.indexValue="a"
}}else{
if(o.op==="is"){
o.indexName="flags";
if(o.arg==="unread"){
o.indexValue="u"
}else{
if(o.arg==="flagged"){
o.indexValue="f"
}else{
if(o.arg==="draft"){
o.indexValue="d"
}else{
if(o.arg==="sent"){
o.indexValue="s"
}else{
if(o.arg==="replied"){
o.indexValue="r"
}else{
if(o.arg==="forwarded"){
o.indexValue="w"
}else{
if(o.arg==="received"){
o.indexName="from";
o.indexValue=appCtxt.getLoggedInUsername()
}}}}}}}}else{
if(o.op==="in"){
var s=appCtxt.getFolderTree();
var n=s&&(s.getByName(o.arg)||s.getByPath(o.arg,true));
var i=n&&n.id;
if(i){
o.indexValue=i.toString();
o.indexName="folder"
}}else{
if(o.op==="type"){
o.indexName=o.op;
o.indexValue=o.arg.toLowerCase();
o.objectStoreName=ZmOffline.ATTACHMENT
}else{
if(o.op==="larger"||o.op==="smaller"){
o.indexName="size";
if(o.arg.toLowerCase().indexOf("kb")!==-1){
o.indexValue=parseInt(o.arg)*1024
}
if(o.arg.toLowerCase().indexOf("mb")!==-1){
o.indexValue=parseInt(o.arg)*1024*1024
}}else{
if(o.op==="after"||o.op==="before"||o.op==="date"){
var h=new Date(o.arg.replace(/[<>=]/g,"")).getTime();
if(isNaN(h)){
if(o.arg.indexOf("d")!==-1){
var r=AjxDateUtil.DAY
}else{
if(o.arg.indexOf("w")!==-1){
var r=AjxDateUtil.WEEK
}else{
if(o.arg.indexOf("m")!==-1){
var r=AjxDateUtil.MONTH
}else{
if(o.arg.indexOf("y")!==-1){
var r=AjxDateUtil.YEAR
}}}}
if(r){
var a=AjxDateUtil.roll(new Date(),r,parseInt(o.arg));
var h=a&&a.getTime()
}}else{
if(o.op==="after"){
var l=new Date(h);
AjxDateUtil.rollToNextDay(l);
h=l.getTime()
}}
if(h&&!isNaN(h)){
o.indexValue=h;
o.indexName="receiveddate"
}}}}}}}}}}
);
return e
};
ZmOfflineDB._searchCallback=function(t,o,e){
var i=t.parsedQuery.getTokens();
var a=[];
i.forEach(function(s,n){
var r=i[n-1];
if(s.result){
if(r){
if(r.op==="or"){
a=AjxUtil.union(a,s.result)
}else{
if(r.op==="not"){
a=AjxUtil.arraySubtract(a,s.result)
}else{
a=AjxUtil.intersection(a,s.result)
}}}else{
a=s.result
}}}
);
if(t.searchFor===ZmId.SEARCH_MAIL||t.parsedSearchFor===ZmId.SEARCH_MAIL){
ZmOfflineDB.getItem(a,ZmApp.MAIL,o,e)
}else{
if(t.searchFor===ZmItem.CONTACT||t.contactSource===ZmItem.CONTACT){
ZmOfflineDB._searchContactsCallback(a,t,o,e)
}}};
ZmOfflineDB.searchAttachment=function(i,h,a){
try{
var t=ZmOfflineDB.db;
var r=t.transaction(ZmOffline.ATTACHMENT);
var o=r.objectStore(ZmOffline.ATTACHMENT);
var s=i.parsedQuery.getTokens();
s.forEach(function(l){
var p=l.indexName;
var e=l.indexValue;
if(p&&e){
if(!l.result){
l.result=[]
}
var c=[];
if(p==="type"){
var m=o.index(p);
c.push(IDBKeyRange.only(e))
}else{
var m=o.index("name");
var u=e.charAt(0).toUpperCase()+e.substr(1).toLowerCase();
var d=IDBKeyRange.bound(e.toUpperCase(),u+"\uffff");
var f=e.charAt(0).toLowerCase()+e.substr(1).toUpperCase();
var g=IDBKeyRange.bound(f,e.toLowerCase()+"\uffff");
c.push(d,g)
}}
c.forEach(function(y){
m.openKeyCursor(y).onsuccess=function(x,q){
var w=q.target.result;
if(w){
AjxDebug.println(AjxDebug.OFFLINE,w.key+" : "+w.primaryKey);
var v=w.primaryKey;
var k=v.substring(v.indexOf("id=")+3,v.indexOf("&"));
if(k){
k=parseInt(k);
if(isNaN(k)===false){
x.result.push(k)
}}
w["continue"]()
}else{
x.result=AjxUtil.uniq(x.result)
}}
.bind(null,l)
}
)
}
);
r.oncomplete=h;
r.onerror=a
}
catch(n){
a&&a();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.searchAttachment :: "+n)
}};
ZmOfflineDB.searchContacts=function(u,c,i){
try{
var d=ZmOfflineDB.db;
var t=d.transaction(ZmApp.CONTACTS);
var l=t.objectStore(ZmApp.CONTACTS);
var h=u.parsedQuery.getTokens();
h.forEach(function(m){
var v=m.indexName;
var e=m.indexValue;
if(v&&e){
if(!m.result){
m.result=[]
}
var w=[];
var f=[];
if(v==="content"){
w.push(l.index("firstname"),l.index("lastname"),l.index("middlename"),l.index("email"),l.index("company"),l.index("jobtitle"),l.index("fileasstr"));
var g=e.charAt(0).toUpperCase()+e.substr(1).toLowerCase();
var p=IDBKeyRange.bound(e.toUpperCase(),g+"\uffff");
var y=e.charAt(0).toLowerCase()+e.substr(1).toUpperCase();
var k=IDBKeyRange.bound(y,e.toLowerCase()+"\uffff");
f.push(p,k)
}else{
w.push(l.index(v));
f.push(IDBKeyRange.only(e))
}
w.forEach(function(x){
f.forEach(function(q){
x.openKeyCursor(q).onsuccess=function(z,T){
var j=T.target.result;
if(j){
AjxDebug.println(AjxDebug.OFFLINE,j.key+" : "+j.primaryKey);
if(z.indexName==="content"){
if(j.key.toLowerCase().indexOf(z.indexValue.toLowerCase())!==-1){
z.result.push(j.primaryKey)
}}else{
z.result.push(j.primaryKey)
}
j["continue"]()
}else{
z.result=AjxUtil.uniq(z.result)
}}
.bind(null,m)
}
)
}
)
}}
);
u.sortedResult=[];
var n=l.index("fileasstr");
var r=function(m){
var e=m.target.result;
if(e){
AjxDebug.println(AjxDebug.OFFLINE,e.key+" : "+e.primaryKey);
u.sortedResult.push(e.primaryKey);
e["continue"]()
}};
var o=u.lastSortVal;
if(o){
var a=[];
if(isNaN(o)){
a.push(IDBKeyRange.bound(o,o+"\uffff"));
a.push(IDBKeyRange.bound(o.toLowerCase(),o.toLowerCase()+"\uffff"))
}else{
a.push(IDBKeyRange.bound(o,u.endSortVal,false,true))
}
a.forEach(function(e){
n.openKeyCursor(e).onsuccess=r
}
)
}else{
n.openKeyCursor().onsuccess=r
}
t.oncomplete=function(){
ZmOfflineDB._searchCallback(u,c,i)
};
t.onerror=i
}
catch(s){
i&&i();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.searchContacts :: "+s)
}};
ZmOfflineDB._searchContactsCallback=function(a,t,i,e){
if(a&&t.sortedResult){
a=t.sortedResult.filter(function(o){
if(a.indexOf(o)===-1){
return false
}
return true
}
)
}
ZmOfflineDB.getItem(a,ZmApp.CONTACTS,i,e)
};
ZmOfflineDB.searchContactsForAutoComplete=function(a,m,s){
try{
var p=ZmOfflineDB.db;
var i=p.transaction(ZmApp.CONTACTS);
var d=i.objectStore(ZmApp.CONTACTS);
var c=[d.index("firstname"),d.index("email"),d.index("middlename"),d.index("lastname"),d.index("fileasstr")];
var t=a;
var h=t.charAt(0).toUpperCase()+t.substr(1).toLowerCase();
var n=IDBKeyRange.bound(t.toUpperCase(),h+"\uffff");
var r=t.charAt(0).toLowerCase()+t.substr(1).toUpperCase();
var f=IDBKeyRange.bound(r,t.toLowerCase()+"\uffff");
var o=[n,f];
var u=[];
c.forEach(function(e){
o.forEach(function(g){
e.openKeyCursor(g).onsuccess=function(w){
var y=w.target.result;
if(y){
AjxDebug.println(AjxDebug.OFFLINE,y.key+" : "+y.primaryKey);
if(y.key.toLowerCase().indexOf(t.toLowerCase())!==-1){
u.push(y.primaryKey)
}
y["continue"]()
}}
}
)
}
);
i.oncomplete=function(){
u=AjxUtil.uniq(u);
ZmOfflineDB.getItem(u,ZmApp.CONTACTS,m,s)
};
i.onerror=s
}
catch(l){
s&&s();
AjxDebug.println(AjxDebug.OFFLINE,"Exception ZmOfflineDB.searchContactsForAutoComplete :: "+l)
}};
ZmOfflineDB.doIndexSearch=function(p,a,l,m,n,d,h){
try{
var f=ZmOfflineDB.db;
var t=f.transaction(a);
var c=t.objectStore(a);
var u=[];
var s=c.index(d);
var o=null;
if(p.length==1){
o=IDBKeyRange.only(p[0])
}else{
if(p.length==2){
o=IDBKeyRange.bound(p[0],p[1],false,true)
}}
if(o==null){
n&&n();
AjxDebug.println(AjxDebug.OFFLINE,"ZmOfflineDB.doIndexSearch : Exception : "+r)
}else{
if(h){
var i=s.openKeyCursor(o)
}else{
var i=s.openCursor(o)
}
i.onsuccess=function(g){
var e=g.target.result;
if(e){
if(e.value){
u.push(e.value)
}else{
u.push(e.primaryKey)
}
e["continue"]()
}};
if(m){
t.oncomplete=function(){
if(l){
u=l(u)
}
m(u)
}
}
t.onerror=n
}}
catch(r){
n&&n()
}}
}
if(AjxPackage.define("zimbraMail.share.view.ZmTagsHelper")){
ZmTagsHelper={};
ZmTagsHelper.setupListeners=function(e){
if(appCtxt.isChildWindow){
return
}
e._tagList=appCtxt.getTagTree();
if(!e._tagList){
return
}
e._tagChangeHandler=ZmTagsHelper._tagChangeListener.bind(e);
e._tagList.addChangeListener(e._tagChangeHandler)
};
ZmTagsHelper.disposeListeners=function(e){
e._tagList&&e._tagList.removeChangeListener(e._tagChangeHandler)
};
ZmTagsHelper.getTagsHtml=function(h,t){
if(!appCtxt.get(ZmSetting.TAGGING_ENABLED)){
return""
}
var o=h&&h.getSortedTags();
if(!(o&&o.length)){
return""
}
var s=[],n=0;
for(var a=0;
a<o.length;
a++){
var e=o[a];
if(!e){
continue
}
var r={
tag:e,html:s,i:n,view:t,readOnly:h.isReadOnly()};
n=ZmTagsHelper._getTagHtml(r)
}
return s.join("")
};
ZmTagsHelper._getTagHtml=function(r){
r=r||{};
var e=r.tag;
var o=r.html;
var a=r.i;
var t=r.view;
var h=r.readOnly;
var s=['ZmTagsHelper._tagClick("',t._htmlElId,'","',AjxStringUtil.encodeQuotes(e.name),'");'].join("");
var n=['ZmTagsHelper._removeTagClick("',t._htmlElId,'","',AjxStringUtil.encodeQuotes(e.name),'");'].join("");
o[a++]="<span class='addrBubble TagBubble' notoggle=1 >";
o[a++]="<span class='TagImage' onclick='";
o[a++]=s;
o[a++]="'>";
o[a++]=AjxImg.getImageHtml(e.getIconWithColor(),null);
o[a++]="</span>";
o[a++]="<span class='TagName' onclick='";
o[a++]=s;
o[a++]="'>";
o[a++]=AjxStringUtil.htmlEncodeSpace(e.name);
o[a++]="&nbsp;</span>";
if(!h){
o[a++]="<span class='ImgBubbleDelete' onclick='";
o[a++]=n;
o[a++]="'>";
o[a++]="</span>"
}
o[a++]="</span>";
return a
};
ZmTagsHelper._tagClick=function(i,a){
var e=ZmTagsHelper._getTagClicked(a);
var t=DwtControl.fromElementId(i);
appCtxt.getSearchController().search({
query:e.createQuery(),inclSharedItems:true}
)
};
ZmTagsHelper._removeTagClick=function(i,a){
var e=ZmTagsHelper._getTagClicked(a);
var t=DwtControl.fromElementId(i);
ZmListController.prototype._doTag.call(t._controller,t._item,e,false)
};
ZmTagsHelper._getTagClicked=function(e){
var t=appCtxt.getAccountTagList();
return t.getByNameOrRemote(e)
};
ZmTagsHelper._tagChangeListener=function(e){
if(e.type!=ZmEvent.S_TAG){
return
}
if(this._disposed){
return
}
if(e.event==ZmEvent.E_DELETE||e.event==ZmEvent.E_MODIFY||e.event==ZmEvent.E_CREATE){
this._setTags()
}}
}};
